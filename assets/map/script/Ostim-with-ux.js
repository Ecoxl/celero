/*
Copyright (c) 2002-2011 geOps.
All rights reserved.

Redistribution and use in source and binary forms, with or without modification, are
permitted provided that the following conditions are met:

   1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.

   2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following
   disclaimer in the documentation and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY <COPYRIGHT HOLDER> ''AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL geOps OR
CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
The views and conclusions contained in the software and documentation are those of the authors and should not be
interpreted as representing official policies, either expressed or implied, of geOps.
*/
Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null==this)throw new TypeError("this is null or not defined");var e=Object(this),f=e.length>>>0;if("[object Function]"!=={}.toString.call(a))throw new TypeError(a+" is not a function");b&&(c=b);for(d=0;d<f;){var g;Object.prototype.hasOwnProperty.call(e,d)&&(g=e[d],a.call(c,g,d,e));d++}});/*
  2011 geOps
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor=OpenLayers.Class({map:null,id:null,editLayer:null,editorPanel:null,editMode:!1,dialog:null,showStatus:function(a,b){"error"===a&&alert(b)},activeControls:[],editorControls:"CleanFeature DeleteFeature DeleteAllFeatures Dialog DrawHole DrawRegular DrawPolygon DrawPath DrawPoint DrawText EditorPanel ImportFeature MergeFeature SnappingSettings SplitFeature CADTools TransformFeature".split(" "),featureTypes:["text","point","path","polygon","regular"],sourceLayers:[],params:{},geoJSON:new OpenLayers.Format.GeoJSON,
options:{},oleUrl:"",controls:{},undoRedoActive:!0,initialize:function(a,b){OpenLayers.Util.extend(this,b);this.map=a instanceof OpenLayers.Map?a:new OpenLayers.Map;b||(b={});b.dialog||(this.dialog=new OpenLayers.Editor.Control.Dialog,this.map.addControl(this.dialog));this.id=OpenLayers.Util.createUniqueID("OpenLayers.Editor_");this.editLayer=b.editLayer?b.editLayer:new OpenLayers.Layer.Vector("Editor",{displayInLayerSwitcher:!1});this.editLayer.styleMap=b.styleMap?b.styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style({fillColor:"#07f",
fillOpacity:0.8,strokeColor:"#037",strokeWidth:2,graphicZIndex:1,pointRadius:5}),defaultLabel:new OpenLayers.Style({fillColor:"#07f",fillOpacity:0.8,strokeColor:"#037",strokeWidth:2,graphicZIndex:11,pointRadius:0,cursor:"default",label:"${label}",fontColor:"#000000",fontSize:"11px",fontFamily:"Verdana, Arial, Helvetica, sans-serif",fontWeight:"bold",labelOutlineColor:"#FFFFFF",labelOutlineWidth:4,labelSelect:!0}),select:new OpenLayers.Style({fillColor:"#fc0",strokeColor:"#f70",graphicZIndex:2}),selectLabel:new OpenLayers.Style({pointRadius:5,
label:"${label}",fontColor:"black",fontSize:"11px",fontFamily:"Verdana, Arial, Helvetica, sans-serif",fontWeight:"bold",labelAlign:"cm",labelXOffset:"${xOffset}",labelYOffset:"${yOffset}",fillColor:"#fc0",strokeColor:"#f70",labelOutlineColor:"#fc0",labelOutlineWidth:6,graphicZIndex:2}),temporary:new OpenLayers.Style({fillColor:"#fc0",fillOpacity:0.8,strokeColor:"#f70",strokeWidth:2,graphicZIndex:2,pointRadius:5})});var c={editor:this,layer:this.editLayer,controls:["OpenLayers.Editor.Control.DeleteFeature",
"OpenLayers.Editor.Control.CleanFeature","OpenLayers.Editor.Control.MergeFeature","OpenLayers.Editor.Control.SplitFeature"]};this.editLayer.events.register("featureselected",c,this.selectionChanged);this.editLayer.events.register("featureunselected",c,this.selectionChanged);for(var d=0,e=this.featureTypes.length;d<e;d++)"polygon"==this.featureTypes[d]?this.activeControls.push("DrawPolygon"):"path"==this.featureTypes[d]?this.activeControls.push("DrawPath"):"point"==this.featureTypes[d]?this.activeControls.push("DrawPoint"):
"regular"==this.featureTypes[d]?this.activeControls.push("DrawRegular"):"text"==this.featureTypes[d]&&this.activeControls.push("DrawText");d=0;for(e=this.sourceLayers.length;d<e;d++)c={editor:this,layer:this.sourceLayers[d],controls:["OpenLayers.Editor.Control.ImportFeature"]},this.sourceLayers[d].events.register("featureselected",c,this.selectionChanged),this.sourceLayers[d].events.register("featureunselected",c,this.selectionChanged),this.sourceLayers[d].styleMap=new OpenLayers.StyleMap({"default":new OpenLayers.Style({fillColor:"#0c0",
fillOpacity:0.8,strokeColor:"#070",strokeWidth:2,graphicZIndex:1,pointRadius:5}),select:new OpenLayers.Style({fillColor:"#fc0",strokeColor:"#f70",graphicZIndex:2}),temporary:new OpenLayers.Style({fillColor:"#fc0",fillOpacity:0.8,strokeColor:"#f70",strokeWidth:2,graphicZIndex:2,pointRadius:5})}),this.map.addLayer(this.sourceLayers[d]);this.map.editor=this;this.map.addLayer(this.editLayer);this.map.addControl(new OpenLayers.Editor.Control.LayerSettings(this));this.undoRedoActive&&this.map.addControl(new OpenLayers.Editor.Control.UndoRedo(this.editLayer));
this.addEditorControls();return this},selectionChanged:function(){var a=this.editor.editorPanel.getControlsByClass("OpenLayers.Control.SelectFeature")[0];if(0<this.layer.selectedFeatures.length&&a&&a.active)for(var a=0,b=this.controls.length;a<b;a++){var c=this.editor.editorPanel.getControlsByClass(this.controls[a])[0];c&&OpenLayers.Element.removeClass(c.panel_div,"oleControlDisabled")}else{a=0;for(b=this.controls.length;a<b;a++)(c=this.editor.editorPanel.getControlsByClass(this.controls[a])[0])&&
OpenLayers.Element.addClass(c.panel_div,"oleControlDisabled")}this.editor.editorPanel.redraw()},startEditMode:function(){this.editMode=!0;this.editorPanel.activate()},stopEditMode:function(){this.editMode=!1;this.editorPanel.deactivate()},addEditorControls:function(){for(var a=null,b=[],c=0,d=this.activeControls.length;c<d;c++){a=this.activeControls[c];-1<OpenLayers.Util.indexOf(this.editorControls,a)&&b.push(new OpenLayers.Editor.Control[a](this.editLayer,this.options[a]));switch(a){case "Separator":b.push(new OpenLayers.Control.Button({displayClass:"olControlSeparator"}));
break;case "Navigation":b.push(new OpenLayers.Control.Navigation(OpenLayers.Util.extend({title:OpenLayers.i18n("oleNavigation")},this.options.Navigation)));break;case "DragFeature":b.push(new OpenLayers.Editor.Control.DragFeature(this.editLayer,OpenLayers.Util.extend({},this.options.DragFeature)));break;case "ModifyFeature":b.push(new OpenLayers.Control.ModifyFeature(this.editLayer,OpenLayers.Util.extend({title:OpenLayers.i18n("oleModifyFeature")},this.options.ModifyFeature)));break;case "SelectFeature":b.push(new OpenLayers.Control.SelectFeature(this.sourceLayers.concat([this.editLayer]),
OpenLayers.Util.extend({title:OpenLayers.i18n("oleSelectFeature"),clickout:!0,toggle:!1,multiple:!1,hover:!1,toggleKey:"ctrlKey",multipleKey:"ctrlKey",box:!0},this.options.SelectFeature)));break;case "DownloadFeature":b.push(new OpenLayers.Editor.Control.DownloadFeature(this.editLayer,OpenLayers.Util.extend({},this.DownloadFeature)));break;case "UploadFeature":b.push(new OpenLayers.Editor.Control.UploadFeature(this.editLayer,OpenLayers.Util.extend({},this.UploadFeature)));break;default:-1==OpenLayers.Util.indexOf(this.editorControls,
a)&&OpenLayers.Editor.Control[a]&&b.push(new OpenLayers.Editor.Control[a](this.editLayer,OpenLayers.Util.extend({},this.options[a])))}this.controls[a]=b[b.length-1]}this.editorPanel=this.createEditorPanel(b);this.map.addControl(this.editorPanel)},addEditorControl:function(a){this.controls[a.CLASS_NAME]=a;this.editorPanel.addControls([a]);this.map.addControl(a)},createEditorPanel:function(a){var b=new OpenLayers.Editor.Control.EditorPanel(this);b.addControls(a);return b},status:function(a){"error"==
a.type&&alert(a.content)},loadFeatures:function(a){this.editLayer.destroyFeatures();a&&(this.editLayer.addFeatures(a),this.map.zoomToExtent(this.editLayer.getDataExtent()))},requestComplete:function(a){a=(new OpenLayers.Format.JSON).read(a.responseText);this.map.editor.stopWaiting();a?a.error?this.showStatus("error",a.message):(a.params&&OpenLayers.Util.extend(this.params,a.params),a.geo&&(a=this.geoJSON.read(a.geo),this.editLayer.removeFeatures(this.editLayer.selectedFeatures),this.editLayer.addFeatures(this.toFeatures(a)),
this.editLayer.events.triggerEvent("featureselected"))):this.showStatus("error",OpenLayers.i18n("oleNoJSON"))},toFeatures:function(a){if(null===a||"object"!==typeof a)throw Error("Parameter does not match expected type.");var b=[];a instanceof Array||(a=[a]);for(var c=0,d=a.length;c<d;c++)if("OpenLayers.Geometry.MultiPolygon"===a[c].geometry.CLASS_NAME||"OpenLayers.Geometry.Collection"===a[c].geometry.CLASS_NAME)for(var e=0,f=a[c].geometry.components.length;e<f;e++)b.push(new OpenLayers.Feature.Vector(a[c].geometry.components[e]));
else"OpenLayers.Geometry.Polygon"===a[c].geometry.CLASS_NAME&&b.push(new OpenLayers.Feature.Vector(a[c].geometry));return b},toMultiPolygon:function(a){for(var b=[],c=0,d=a.length;c<d;c++)"OpenLayers.Geometry.Polygon"===a[c].geometry.CLASS_NAME&&b.push(a[c].geometry);return new OpenLayers.Geometry.MultiPolygon(b)},startWaiting:function(a){OpenLayers.Element.addClass(a,"olEditorWaiting");OpenLayers.Element.addClass(this.map.div,"olEditorWaiting");this.waitingDiv=a},stopWaiting:function(){OpenLayers.Element.removeClass(this.waitingDiv,
"olEditorWaiting");OpenLayers.Element.removeClass(this.map.div,"olEditorWaiting")},CLASS_NAME:"OpenLayers.Editor"});OpenLayers.Editor.Control=OpenLayers.Class(OpenLayers.Control,{initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Editor.Control"});OpenLayers.Editor.VERSION_NUMBER="1.0-beta4";/*
  2011 geOps
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.CleanFeature=OpenLayers.Class(OpenLayers.Control.Button,{proxy:null,title:OpenLayers.i18n("oleCleanFeature"),initialize:function(a,b){this.layer=a;OpenLayers.Control.Button.prototype.initialize.apply(this,[b]);this.trigger=this.cleanFeature;this.title=OpenLayers.i18n("oleCleanFeature");this.displayClass="oleControlDisabled "+this.displayClass},cleanFeature:function(){if(0<this.layer.selectedFeatures.length){var a=(new OpenLayers.Format.WKT).write(this.layer.selectedFeatures);
this.map.editor.startWaiting(this.panel_div);OpenLayers.Request.POST({url:this.map.editor.oleUrl+"process/clean",data:OpenLayers.Util.getParameterString({geo:a}),headers:{"Content-Type":"application/x-www-form-urlencoded"},callback:this.map.editor.requestComplete,proxy:this.proxy,scope:this.map.editor})}},CLASS_NAME:"OpenLayers.Editor.Control.CleanFeature"});/*
  2011 geOps
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.DragFeature=OpenLayers.Class(OpenLayers.Control.DragFeature,{title:OpenLayers.i18n("oleDragFeature"),EVENT_TYPES:"activate deactivate dragstart dragdrag dragcomplete dragenter dragleave".split(" "),initialize:function(a,b){OpenLayers.Control.DragFeature.prototype.initialize.apply(this,[a,b]);this.title=OpenLayers.i18n("oleDragFeature")},onStart:function(a,b){this.events.triggerEvent("dragstart",{feature:a,pixel:b})},onDrag:function(a,b){this.events.triggerEvent("dragdrag",
{feature:a,pixel:b})},onComplete:function(a,b){this.events.triggerEvent("dragcomplete",{feature:a,pixel:b});this.layer.events.triggerEvent("afterfeaturemodified",{feature:a})},onEnter:function(a){this.events.triggerEvent("dragenter",{feature:a})},onLeave:function(a){this.events.triggerEvent("dragleave",{feature:a})},CLASS_NAME:"OpenLayers.Editor.Control.DragFeature"});/*
  2011 geOps
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.DeleteFeature=OpenLayers.Class(OpenLayers.Control.Button,{layer:null,title:OpenLayers.i18n("oleDeleteFeature"),initialize:function(a,b){this.layer=a;this.title=OpenLayers.i18n("oleDeleteFeature");OpenLayers.Control.Button.prototype.initialize.apply(this,[b]);this.trigger=this.deleteFeature;this.displayClass="oleControlDisabled "+this.displayClass},deleteFeature:function(){0<this.layer.selectedFeatures.length&&(this.layer.destroyFeatures(this.layer.selectedFeatures),this.layer.events.triggerEvent("featureunselected"))},
CLASS_NAME:"OpenLayers.Editor.Control.DeleteFeature"});/*
  2011 geOps
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.Dialog=OpenLayers.Class(OpenLayers.Control,{dialogDiv:null,buttonClass:null,inputTextClass:null,modal:!0,initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a])},show:function(a){var b,c;-1<OpenLayers.Util.indexOf(this.map.viewPortDiv.childNodes,this.dialogDiv)&&this.map.viewPortDiv.removeChild(this.dialogDiv);a||(a={});this.dialogDiv=document.createElement("div");OpenLayers.Element.addClass(this.dialogDiv,"oleDialog");a.toolbox?OpenLayers.Element.addClass(this.dialogDiv,
"oleDialogToolbar"):OpenLayers.Element.addClass(this.div,"oleFadeMap");a.title&&(b=document.createElement("h3"),b.innerHTML=a.title,this.dialogDiv.appendChild(b));"string"===typeof a.content?(b=document.createElement("div"),b.innerHTML=a.content,this.dialogDiv.appendChild(b)):OpenLayers.Util.isElement(a.content)&&this.dialogDiv.appendChild(a.content);a.save?(b=this.getButton(OpenLayers.i18n("oleDialogCancelButton")),this.dialogDiv.appendChild(b),c=this.getButton(OpenLayers.i18n(a.saveButtonText?a.saveButtonText:
"oleDialogSaveButton")),this.dialogDiv.appendChild(c),OpenLayers.Event.observe(b,"click",OpenLayers.Function.bind(this.hide,this)),a.noHideOnSave||OpenLayers.Event.observe(c,"click",OpenLayers.Function.bind(this.hide,this)),OpenLayers.Event.observe(c,"click",a.save),a.cancel&&OpenLayers.Event.observe(b,"click",a.cancel)):a.toolbox||(b=this.getButton(OpenLayers.i18n("oleDialogOkButton")),this.dialogDiv.appendChild(b),OpenLayers.Event.observe(b,"click",OpenLayers.Function.bind(this.hide,this)),a.close&&
OpenLayers.Event.observe(b,"click",a.close));a=this.dialogDiv.getElementsByTagName("input");for(b=0;b<a.length;b++)"text"==a[b].getAttribute("type")&&OpenLayers.Element.addClass(a[b],this.inputTextClass);this.map.viewPortDiv.appendChild(this.dialogDiv);OpenLayers.Event.observe(this.div,"click",this.ignoreEvent);OpenLayers.Event.observe(this.div,"mousedown",this.ignoreEvent);OpenLayers.Event.observe(this.div,"dblclick",this.ignoreEvent);OpenLayers.Event.observe(this.dialogDiv,"mousedown",this.ignoreEvent);
OpenLayers.Event.observe(this.dialogDiv,"dblclick",this.ignoreEvent)},hide:function(){this.dialogDiv&&(this.map.viewPortDiv.removeChild(this.dialogDiv),OpenLayers.Element.removeClass(this.div,"oleFadeMap"),this.dialogDiv=null)},ignoreEvent:function(a){OpenLayers.Event.stop(a,!0)},getButton:function(a){var b=document.createElement("input");b.value=a;b.type="button";OpenLayers.Element.addClass(b,this.buttonClass);return b},CLASS_NAME:"OpenLayers.Editor.Control.Dialog"});/*
  2011 geOps
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.DrawHole=OpenLayers.Class(OpenLayers.Control.DrawFeature,{minArea:0,title:OpenLayers.i18n("oleDrawHole"),initialize:function(a,b){this.callbacks=OpenLayers.Util.extend(this.callbacks,{point:function(a){this.layer.events.triggerEvent("pointadded",{point:a})}});OpenLayers.Control.DrawFeature.prototype.initialize.apply(this,[a,OpenLayers.Handler.Polygon,b]);this.title=OpenLayers.i18n("oleDrawHole")},drawFeature:function(a){var b=new OpenLayers.Feature.Vector(a);b.state=OpenLayers.State.INSERT;
if(!1!==this.layer.events.triggerEvent("sketchcomplete",{feature:b})&&a.getArea()>=this.minArea){var b=a.getVertices(),c,d=0,e=this.layer.features.length;a:for(;d<e;d++){var f=this.layer.features[d];c=!0;for(var g=0,h=b.length;g<h;g++)f.geometry.intersects(b[g])||(c=!1);if(c){f.state=OpenLayers.State.UPDATE;this.layer.events.triggerEvent("beforefeaturemodified",{feature:f});f.geometry.components.push(a.components[0]);this.layer.drawFeature(f);this.layer.events.triggerEvent("featuremodified",{feature:f});
this.layer.events.triggerEvent("afterfeaturemodified",{feature:f});break a}}}},CLASS_NAME:"OpenLayers.Editor.Control.DrawHole"});/*
  2011 geOps
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.DrawPolygon=OpenLayers.Class(OpenLayers.Control.DrawFeature,{minArea:0,title:OpenLayers.i18n("oleDrawPolygon"),initialize:function(a,b){this.callbacks=OpenLayers.Util.extend(this.callbacks,{point:function(a){this.layer.events.triggerEvent("pointadded",{point:a})}});OpenLayers.Control.DrawFeature.prototype.initialize.apply(this,[a,OpenLayers.Handler.Polygon,b]);this.title=OpenLayers.i18n("oleDrawPolygon")},drawFeature:function(a){var b=new OpenLayers.Feature.Vector(a);!1!==
this.layer.events.triggerEvent("sketchcomplete",{feature:b})&&a.getArea()>=this.minArea&&(b.state=OpenLayers.State.INSERT,this.layer.addFeatures([b]),this.featureAdded(b),this.events.triggerEvent("featureadded",{feature:b}))},CLASS_NAME:"OpenLayers.Editor.Control.DrawPolygon"});/*
  2011 geOps
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.DrawPath=OpenLayers.Class(OpenLayers.Control.DrawFeature,{minLength:0,title:OpenLayers.i18n("oleDrawPath"),initialize:function(a,b){this.callbacks=OpenLayers.Util.extend(this.callbacks,{point:function(a){this.layer.events.triggerEvent("pointadded",{point:a})}});OpenLayers.Control.DrawFeature.prototype.initialize.apply(this,[a,OpenLayers.Handler.Path,b]);this.title=OpenLayers.i18n("oleDrawPath")},drawFeature:function(a){var b=new OpenLayers.Feature.Vector(a);!1!==this.layer.events.triggerEvent("sketchcomplete",
{feature:b})&&a.getLength()>=this.minLength&&(b.state=OpenLayers.State.INSERT,this.layer.addFeatures([b]),this.featureAdded(b),this.events.triggerEvent("featureadded",{feature:b}))},CLASS_NAME:"OpenLayers.Editor.Control.DrawPath"});/*
  2011 geOps
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.DrawPoint=OpenLayers.Class(OpenLayers.Control.DrawFeature,{title:OpenLayers.i18n("oleDrawPoint"),featureType:"point",initialize:function(a,b){this.callbacks=OpenLayers.Util.extend(this.callbacks,{point:function(a){this.layer.events.triggerEvent("pointadded",{point:a})}});OpenLayers.Control.DrawFeature.prototype.initialize.apply(this,[a,OpenLayers.Handler.Point,b]);this.title=OpenLayers.i18n("oleDrawPoint")},drawFeature:function(a){a=new OpenLayers.Feature.Vector(a);var b=
this.layer.events.triggerEvent("sketchcomplete",{feature:a});a.featureType=this.featureType;!1!==b&&(this.events.triggerEvent("beforefeatureadded",{feature:a}),a.state=OpenLayers.State.INSERT,this.layer.addFeatures([a]),this.featureAdded(a),this.events.triggerEvent("featureadded",{feature:a}))},CLASS_NAME:"OpenLayers.Editor.Control.DrawPoint"});/*
  2011 geOps
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.DrawRegular=OpenLayers.Class(OpenLayers.Control.DrawFeature,{minArea:0,title:OpenLayers.i18n("oleDrawRegular"),sides:[3,4,5,6,40],initialize:function(a,b){this.callbacks=OpenLayers.Util.extend(this.callbacks,{point:function(a){this.layer.events.triggerEvent("pointadded",{point:a})}});OpenLayers.Control.DrawFeature.prototype.initialize.apply(this,[a,OpenLayers.Handler.RegularPolygon,b]);this.title=OpenLayers.i18n("oleDrawRegular")},activate:function(){var a=OpenLayers.Control.Button.prototype.activate.call(this),
b,c,d;b=document.createElement("div");c=document.createElement("div");OpenLayers.Element.addClass(c,"oleDrawRegularIrregular");d=document.createElement("input");d.type="checkbox";d.id="oleCADToolsDialogIrregular";d.value="true";OpenLayers.Event.observe(d,"change",OpenLayers.Function.bind(function(a){this.handler.setOptions({irregular:a.target.checked})},this));c.appendChild(d);d=document.createElement("label");d.htmlFor="oleCADToolsDialogIrregular";d.appendChild(document.createTextNode(OpenLayers.i18n("oleDrawRegularIrregular")));
c.appendChild(d);b.appendChild(c);c=document.createElement("div");d=document.createElement("select");d.id="oleCADToolsDialogSides";for(var e=0;e<this.sides.length;++e){var f=20>this.sides[e]?OpenLayers.i18n("oleDrawRegularSides"+this.sides[e]):OpenLayers.i18n("oleDrawRegularCircle");d.options.add(new Option(f,this.sides[e]))}OpenLayers.Event.observe(d,"change",OpenLayers.Function.bind(function(a){this.handler.setOptions({sides:parseInt(a.target.value)})},this));this.handler.setOptions({sides:parseInt(d.value)});
c.appendChild(d);d=document.createElement("label");d.htmlFor="oleCADToolsDialogSides";d.appendChild(document.createTextNode(OpenLayers.i18n("oleDrawRegularShape")));c.appendChild(d);b.appendChild(c);this.map.editor.dialog.show({content:b,toolbox:!0});return a},deactivate:function(){var a=OpenLayers.Control.Button.prototype.deactivate.call(this);a&&"function"==typeof this.map.editor.dialog.hide&&this.map.editor.dialog.hide();return a},drawFeature:function(a){var b=new OpenLayers.Feature.Vector(a);
!1!==this.layer.events.triggerEvent("sketchcomplete",{feature:b})&&a.getArea()>=this.minArea&&(b.state=OpenLayers.State.INSERT,this.layer.addFeatures([b]),this.featureAdded(b),this.events.triggerEvent("featureadded",{feature:b}))},CLASS_NAME:"OpenLayers.Editor.Control.DrawRegular"});/*
  2011 geOps
 @author     Just van den Broecke
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.DeleteAllFeatures=OpenLayers.Class(OpenLayers.Control.Button,{layer:null,title:OpenLayers.i18n("oleDeleteAllFeatures"),initialize:function(a,b){this.layer=a;this.title=OpenLayers.i18n("oleDeleteAllFeatures");OpenLayers.Control.Button.prototype.initialize.apply(this,[b]);this.trigger=this.deleteAllFeatures;this.displayClass="oleControlEnabled "+this.displayClass},deleteAllFeatures:function(){0<this.layer.features.length&&this.layer.destroyFeatures();this.map.editor.editLayer&&
this.map.editor.editLayer.destroyFeatures()},CLASS_NAME:"OpenLayers.Editor.Control.DeleteAllFeatures"});/*
  2011 geOps
 @author     Just van den Broecke
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.DownloadFeature=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["featuredownloaded"],layer:null,title:OpenLayers.i18n("oleDownloadFeature"),url:"",params:{action:"download",mime:"text/plain",filename:"editor",encoding:"none"},formats:[{name:"GeoJSON",fileExt:".json",mimeType:"text/plain",formatter:"OpenLayers.Format.GeoJSON"}],fileProjection:null,formatters:{},initialize:function(a,b){this.layer=a;this.title=OpenLayers.i18n("oleDownloadFeature");OpenLayers.Control.Button.prototype.initialize.apply(this,
[b])},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);a&&this.openDialog();return a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);a&&this.dialog&&(this.dialog.hide(),this.dialog=null);return a},cancelDialog:function(){this.dialog=null;this.deactivate()},openDialog:function(){if(!this.layer.features||0>=this.layer.features.length)this.showMessage(OpenLayers.i18n("oleDownloadFeatureEmpty")),this.deactivate();else{var a=document.createElement("div"),
b=document.createElement("p");b.innerHTML=OpenLayers.i18n("oleDownloadFeatureFileFormat");a.appendChild(b);b=document.createElement("form");b.setAttribute("id","download_form");b.setAttribute("method","POST");b.setAttribute("action",this.url);var c=document.createElement("select");c.setAttribute("name","format_select");c.setAttribute("id","format_select");for(var d,e=0;e<this.formats.length;++e){d=document.createElement("option");var f=this.formats[e],g=f.formatter;"string"==typeof g&&(g=eval("new "+
g+"()"));g.fileProjection=f.fileProjection;this.formatters[f.name]=g;d.setAttribute("value",f.name);d.innerHTML=f.name;d.fileExt=f.fileExt;d.mimeType=f.mimeType;d.sourceFormat=g.CLASS_NAME.split(".")[2];d.targetFormat=f.targetFormat;d.assignSrs=f.fileProjection?f.fileProjection.getCode():void 0;d.sourceSrs=f.sourceSrs?d.sourceSrs:d.assignSrs;d.targetSrs=f.targetSrs;c.appendChild(d)}b.appendChild(c);a.appendChild(b);this.dialog=this.map.editor.dialog;this.dialog.show({title:OpenLayers.i18n("oleDownloadFeature"),
content:a,save:OpenLayers.Function.bind(this.downloadFeature,this),cancel:OpenLayers.Function.bind(this.cancelDialog,this),noHideOnSave:!0})}},downloadFeature:function(){var a=document.getElementById("format_select"),a=a.options[a.selectedIndex],b=this.formatters[a.value];if(!b)return null;this.fileProjection&&(b.internalProjection=this.layer.map.baseLayer.projection,b.externalProjection=b.fileProjection?b.fileProjection:this.fileProjection);b.srsName=b.externalProjection?b.externalProjection.getCode():
this.layer.map.projection;var b=b.write(this.layer.features),c=document.getElementById("download_form"),d=this.params.filename;this.params.filename=d+a.fileExt;this.params.mime=a.mimeType;this.params.data=b;this.params.source_format=a.sourceFormat;this.params.target_format=a.targetFormat;this.params.assign_srs=a.assignSrs;this.params.source_srs=a.sourceSrs;this.params.target_srs=a.targetSrs;for(var e in this.params)this.params[e]&&(c=this.createInputElm(e,"hidden",this.params[e],c));this.params.filename=
d;c.submit();var f=this;setTimeout(function(){f.deactivate()},2E3)},showMessage:function(a){this.map.editor.dialog.show({title:OpenLayers.i18n("oleDownloadFeature"),content:a})},createInputElm:function(a,b,c,d){var e=document.createElement("input");e.setAttribute("type",b);e.name=a;e.value=c?c:null;d&&d.appendChild(e);return d},CLASS_NAME:"OpenLayers.Editor.Control.DownloadFeature"});/*
  2011 geOps
 @author     Just van den Broecke
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.DrawText=OpenLayers.Class(OpenLayers.Editor.Control.DrawPoint,{title:null,featureType:"text",defaultStyle:"defaultLabel",selectStyle:"selectLabel",modal:!0,initialize:function(a,b){OpenLayers.Editor.Control.DrawPoint.prototype.initialize.apply(this,[a,OpenLayers.Handler.Point,b]);this.title=OpenLayers.i18n("oleDrawText");a.events.on({beforefeatureadded:this.onBeforeFeatureAdded,featureselected:this.onFeatureSelected,featureunselected:this.onFeatureUnselected,scope:this})},
deactivate:function(){OpenLayers.Control.Button.prototype.deactivate.call(this);if(this.popup&&this.popup.feature){var a=this.popup.feature;a.layer&&(a.layer.map.removePopup(a.popup),a.layer.removeFeatures([a]));a.popup.destroy();this.popup=a.popup=null}},setLabelText:function(a,b){a.attributes.label=b;a.layer.drawFeature(a,this.defaultStyle)},removePopup:function(a){this.popup=null;a.popup&&(a.layer.map.removePopup(a.popup),a.popup.destroy(),a.popup=null,(a=a.editControl)&&a.activate())},onPopupClose:function(a){this.popup=
null;a=this.feature;if(!a)return!1;var b=a.editControl;if(!b)return!1;var c=document.getElementById("olLabelInput");b.setLabelText(a,c.value);b.removePopup(a);c.value||a.layer.removeFeatures([a])},isTextFeature:function(a){return a?"text"===a.featureType:!1},onFeatureSelected:function(a){a=a.feature;this.isTextFeature(a)&&a.layer.drawFeature(a,this.selectStyle)},onFeatureUnselected:function(a){a=a.feature;this.isTextFeature(a)&&a.layer.drawFeature(a,this.defaultStyle)},onBeforeFeatureAdded:function(a){var b=
a.feature;if(!this.isTextFeature(b))return b.attributes.label&&(b.editControl=this,b.featureType="text",b.layer.drawFeature(b,this.defaultStyle)),!0;a=new OpenLayers.Popup.FramedCloud("featurePopup",b.geometry.getBounds().getCenterLonLat(),new OpenLayers.Size(100,100),'<div class="oleDrawTextPopup"><input type="text" size="32" id="olLabelInput"/><p>'+OpenLayers.i18n("oleDrawTextEdit")+"</p></div>",null,!0,this.onPopupClose);b.popup=a;b.editControl=this;a.feature=b;this.layer.map.addPopup(a,!0);this.deactivate();
var c=document.getElementById("olLabelInput"),d=this;c.onkeypress=function(a){if(13==(window.event?window.event.keyCode:a.keyCode))d.setLabelText(b,c.value),d.removePopup(b)};c.focus();this.popup=a},CLASS_NAME:"OpenLayers.Editor.Control.DrawText"});/*
  2011 geOps
 @author     Just van den Broecke
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.UploadFeature=OpenLayers.Class(OpenLayers.Control,{EVENT_TYPES:["featureuploaded"],layer:null,title:OpenLayers.i18n("oleUploadFeature"),url:"",params:{action:"upload",mime:"text/html",encoding:"escape"},formats:[{name:"GeoJSON",fileExt:".json",mimeType:"text/plain",formatter:"OpenLayers.Format.GeoJSON"}],fileProjection:null,visibleOnUpload:!0,formatters:{},replaceFeatures:!1,initialize:function(a,b){this.layer=a;this.title=OpenLayers.i18n("oleUploadFeature");OpenLayers.Control.Button.prototype.initialize.apply(this,
[b])},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);a&&this.openDialog();return a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);a&&this.cleanUp(this);return a},cleanUp:function(a){this.getDialog().hide();a.iframe&&a.removeIFrame()},delayedOpenDialog:function(){var a=this;setTimeout(function(){a.openDialog()},200)},getDialog:function(){if(this.map&&this.map.editor&&this.map.editor.dialog)return this.map.editor.dialog;this.dialog||(this.dialog=
new OpenLayers.Editor.Control.Dialog,this.map.addControl(this.dialog));return this.dialog},openDialog:function(){var a=document.createElement("div");a.appendChild(document.createElement("p"));var b=document.createElement("form");b.setAttribute("id","upload_form");b.setAttribute("method","POST");b.setAttribute("action",this.url);b.setAttribute("target","upload_iframe");b.setAttribute("enctype","multipart/form-data");b.setAttribute("encoding","multipart/form-data");var b=this.createInputElm("oleFile",
"file","file",null,b),c=document.createElement("select");c.setAttribute("name","format_select");c.setAttribute("id","format_select");for(var d,e=0;e<this.formats.length;++e){d=document.createElement("option");var f=this.formats[e],g=f.formatter;"string"==typeof g&&(g=eval("new "+g+"()"));g.fileProjection=f.fileProjection;this.formatters[f.name]=g;d.setAttribute("value",f.name);d.innerHTML=f.name;d.fileExt=f.fileExt;d.mimeType=f.mimeType;d.params={};f.targetSrs&&(d.params.target_srs=f.targetSrs);f.sourceSrs&&
(d.params.source_srs=f.sourceSrs);c.appendChild(d)}b.appendChild(c);var c=document.createElement("p"),h=document.createElement("input");h.type="checkbox";h.id="oleUploadFeatureReplace";h.name="uploadFeatureReplace";h.value="true";h.checked=!0;h.defaultChecked=!0;this.setReplaceFeatures(h.checked);c.appendChild(h);OpenLayers.Event.observe(c,"click",OpenLayers.Function.bind(function(a){OpenLayers.Event.stop(a,!0);this.setReplaceFeatures(h.checked)},this));d=document.createElement("label");d.htmlFor=
"oleUploadFeatureReplace";d.appendChild(document.createTextNode(OpenLayers.i18n("oleUploadFeatureReplace")));c.appendChild(d);b.appendChild(c);for(var k in this.params)b=this.createInputElm(null,k,"hidden",this.params[k],b);a.appendChild(b);this.showUploadDialog(a);var n=this;document.getElementById("oleFile").onchange=function(a){if(a=n.fileInputValue(this))if(a=a.split("."),1<a.length){a="."+a[a.length-1].toLowerCase();for(var b=document.getElementById("format_select"),c=b.options,d=0;d<c.length;++d)if(a==
c[d].fileExt){b.selectedIndex=d;break}}}},showMessage:function(a,b){this.getDialog().show({title:OpenLayers.i18n("oleUploadFeature"),content:a,close:b})},showUploadDialog:function(a){this.getDialog().show({title:OpenLayers.i18n("oleUploadFeature"),content:a,save:OpenLayers.Function.bind(this.uploadFeature,this),cancel:OpenLayers.Function.bind(this.cancel,this),saveButtonText:"oleDialogOkButton",noHideOnSave:!0})},createIFrame:function(a){var b=document.createElement("iframe");b.setAttribute("id",
a);b.setAttribute("name",a);b.setAttribute("width","0");b.setAttribute("height","0");b.setAttribute("border","0");b.setAttribute("style","width: 0; height: 0; border: none;");b.src="about:blank";return b},removeIFrame:function(){var a=document.getElementById("upload_iframe");a&&a.parentNode.removeChild(a);this.iframe=null},cancel:function(){this.deactivate()},parseFeatures:function(a){var b=document.getElementById("format_select"),b=this.formatters[b.options[b.selectedIndex].value];if(!b)return null;
this.fileProjection&&(b.internalProjection=this.layer.map.baseLayer.projection,b.externalProjection=b.fileProjection?b.fileProjection:this.fileProjection);a=b.read(a);if(!a||1>a.length)return null;var c;a.constructor!=Array&&(a=[a]);for(b=0;b<a.length;++b)c?c.extend(a[b].geometry.getBounds()):c=a[b].geometry.getBounds();this.bounds=c;return a},uploadFeature:function(){var a=document.getElementById("oleFile");if(this.fileInputValue(a)){this.iframe=this.createIFrame("upload_iframe");document.body.appendChild(this.iframe);
var b=this,c=b.iframe,d=function(){c.detachEvent?c.detachEvent("onload",d):c.removeEventListener("load",d,!1);var a;c.contentDocument?a=c.contentDocument.body.innerHTML:c.contentWindow?a=c.contentWindow.document.body.innerHTML:c.document&&(a=c.document.body.innerHTML);a&&"escape"==b.params.encoding&&(a=a.replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&"));a=b.parseFeatures(a);b.replaceFeatures&&b.layer.destroyFeatures();a?(b.layer.addFeatures(a),b.layer.map.zoomToExtent(b.bounds),
b.visibleOnUpload&&b.layer.setVisibility(!0),setTimeout(function(){b.deactivate()},250)):(b.deactivate(),b.showMessage(OpenLayers.i18n("oleUploadFeatureNone")))};c.addEventListener&&c.addEventListener("load",d,!0);c.attachEvent&&c.attachEvent("onload",d);var a=document.getElementById("upload_form"),e=document.getElementById("format_select"),e=e.options[e.selectedIndex],f;for(f in e.params)a=this.createInputElm(null,f,"hidden",e.params[f],a);a.submit()}else this.cleanUp(this),this.showMessage(OpenLayers.i18n("oleUploadFeatureNoFile"),
OpenLayers.Function.bind(this.delayedOpenDialog,this))},createInputElm:function(a,b,c,d,e){var f=document.createElement("input");f.setAttribute("type",c);f.id=a;f.name=b;f.value=d?d:null;e&&e.appendChild(f);return e},fileInputValue:function(a){return a.files?1==a.files.length?a.files[0].name:null:a.value},setReplaceFeatures:function(a){this.replaceFeatures=a},CLASS_NAME:"OpenLayers.Editor.Control.UploadFeature"});/*
  2011 geOps
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.EditorPanel=OpenLayers.Class(OpenLayers.Control.Panel,{autoActivate:!1,initialize:function(a,b){OpenLayers.Control.Panel.prototype.initialize.apply(this,[b])},draw:function(){OpenLayers.Control.Panel.prototype.draw.apply(this,arguments);this.active||(this.div.style.display="none");return this.div},redraw:function(){this.active||(this.div.style.display="none");OpenLayers.Control.Panel.prototype.redraw.apply(this,arguments);this.active&&(this.div.style.display="")},CLASS_NAME:"OpenLayers.Editor.Control.EditorPanel"});/*
  2011 geOps
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.ImportFeature=OpenLayers.Class(OpenLayers.Control.Button,{layer:null,title:OpenLayers.i18n("oleImportFeature"),initialize:function(a,b){this.layer=a;OpenLayers.Control.Button.prototype.initialize.apply(this,[b]);this.trigger=this.importFeature;this.title=OpenLayers.i18n("oleImportFeature");this.displayClass="oleControlDisabled "+this.displayClass},importFeature:function(){var a=[];if(0<this.map.editor.sourceLayers.length){for(var b=0,c=this.map.editor.sourceLayers.length;b<
c;b++){for(var d=0,e=this.map.editor.sourceLayers[b].selectedFeatures.length;d<e;d++)this.map.editor.sourceLayers[b].selectedFeatures[d].renderIntent="default",a.push(this.map.editor.sourceLayers[b].selectedFeatures[d]);this.map.editor.sourceLayers[b].removeFeatures(this.map.editor.sourceLayers[b].selectedFeatures);this.map.editor.sourceLayers[b].events.triggerEvent("featureunselected")}if(0<a.length)this.layer.addFeatures(a);else return this.map.editor.showStatus("error",OpenLayers.i18n("oleImportFeatureSourceFeature"))}else return this.map.editor.showStatus("error",
OpenLayers.i18n("oleImportFeatureSourceLayer"))},CLASS_NAME:"OpenLayers.Editor.Control.ImportFeature"});/*
  2011 geOps
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.LayerSettings=OpenLayers.Class(OpenLayers.Control,{currentLayer:null,layerSwitcher:null,initialize:function(a,b){OpenLayers.Control.prototype.initialize.apply(this,[b]);this.layerSwitcher=a.map.getControlsByClass("OpenLayers.Control.LayerSwitcher")[0];this.layerSwitcher instanceof OpenLayers.Control.LayerSwitcher&&OpenLayers.Event.observe(this.layerSwitcher.maximizeDiv,"click",OpenLayers.Function.bind(this.redraw,this))},redraw:function(){var a,b;this.layerSwitcher.dataLayersDiv.innerHTML=
"";for(var c=0,d=this.layerSwitcher.dataLayers.length;c<d;c++){var e=this.layerSwitcher.dataLayers[c];a=document.createElement("input");a.type="checkbox";a.id="list"+e.layer.name;a.name=e.layer.name;e.layer.visibility&&(a.checked="checked",a.defaultChecked="selected");this.layerSwitcher.dataLayersDiv.appendChild(a);b=document.createElement("span");b.innerHTML=e.layer.name;OpenLayers.Element.addClass(b,"labelSpan");this.layerSwitcher.dataLayersDiv.appendChild(b);this.layerSwitcher.dataLayersDiv.appendChild(document.createElement("br"));
OpenLayers.Event.observe(a,"click",OpenLayers.Function.bind(this.toggleLayerVisibility,this,e.layer.name));OpenLayers.Event.observe(b,"click",OpenLayers.Function.bind(this.showLayerSettings,this,e.layer.name))}},showLayerSettings:function(a){var b,c,d,e;this.currentLayer=this.map.getLayersByName(a)[0];b=document.createElement("div");c=document.createElement("h4");c.innerHTML=OpenLayers.i18n("oleLayerSettingsOpacityHeader");b.appendChild(c);e=this.currentLayer.opacity?this.currentLayer.opacity:1;c=
document.createElement("input");c.type="text";c.size="2";c.value=(100*e).toFixed(0);OpenLayers.Event.observe(c,"change",OpenLayers.Function.bind(this.changeLayerOpacity,this,c));b.appendChild(c);if(this.currentLayer instanceof OpenLayers.Layer.Vector){c=document.createElement("h4");c.innerHTML=OpenLayers.i18n("oleLayerSettingsImportHeader");c.style.marginTop="10px";b.appendChild(c);e=document.createElement("input");e.type="checkbox";e.name="import"+this.currentLayer.name;b.appendChild(e);c=document.createElement("label");
c.htmlFor="import"+this.currentLayer.name;c.innerHTML=OpenLayers.i18n("oleLayerSettingsImportLabel");b.appendChild(c);b.appendChild(document.createElement("p"));c=0;for(d=this.map.editor.sourceLayers.length;c<d;c++)if(this.currentLayer.id==this.map.editor.sourceLayers[c].id){e.writeAttribute("checked","checked");e.defaultChecked="selected";break}OpenLayers.Event.observe(e,"click",OpenLayers.Function.bind(this.toggleExportFeature,this))}e=this.getLegendGraphics(this.currentLayer);if(0<e.length){c=
document.createElement("h4");c.innerHTML=OpenLayers.i18n("oleLayerSettingsLegendHeader");c.style.marginTop="10px";b.appendChild(c);for(c=0;c<e.length;c++)d=document.createElement("img"),d.src=e[c],b.appendChild(d)}this.map.editor.dialog.show({content:b,title:a})},toggleExportFeature:function(){for(var a=!0,b=0,c=this.map.editor.sourceLayers.length;b<c;b++)if(this.currentLayer.id==this.map.editor.sourceLayers[b].id){this.map.editor.sourceLayers.splice(b,1);a=!1;break}a&&this.map.editor.sourceLayers.push(this.currentLayer)},
toggleLayerVisibility:function(a){a=this.map.getLayersByName(a)[0];a.visibility?a.setVisibility(!1):a.setVisibility(!0);this.redraw()},changeLayerOpacity:function(a){this.currentLayer.setOpacity(a.value/100)},getLegendGraphics:function(a){var b=[];if(a.legendGraphics)b=a.legendGraphics;else if(a instanceof OpenLayers.Layer.WMS)for(var c=a.params.LAYERS.split(","),d=0;d<c.length;d++){var e=c[d],f=a.url,f=f+(-1===f.indexOf("?")?"?":""),f=f+"&SERVICE=WMS",f=f+"&VERSION=1.1.1",f=f+"&REQUEST=GetLegendGraphic",
f=f+"&FORMAT=image/png",f=f+("&LAYER="+e);b.push(f)}return b},CLASS_NAME:"OpenLayers.Editor.Control.LayerSettings"});/*
  2011 geOps
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.MergeFeature=OpenLayers.Class(OpenLayers.Control.Button,{proxy:null,title:OpenLayers.i18n("oleMergeFeature"),initialize:function(a,b){this.layer=a;OpenLayers.Control.Button.prototype.initialize.apply(this,[b]);this.trigger=this.mergeFeature;this.title=OpenLayers.i18n("oleMergeFeature");this.displayClass="oleControlDisabled "+this.displayClass},mergeFeature:function(){if(2>this.layer.selectedFeatures.length)this.map.editor.showStatus("error",OpenLayers.i18n("oleMergeFeatureSelectFeature"));
else{var a=(new OpenLayers.Format.WKT).write(this.layer.selectedFeatures);this.map.editor.startWaiting(this.panel_div);OpenLayers.Request.POST({url:this.map.editor.oleUrl+"process/merge",data:OpenLayers.Util.getParameterString({geo:a}),headers:{"Content-Type":"application/x-www-form-urlencoded"},callback:this.map.editor.requestComplete,proxy:this.proxy,scope:this.map.editor})}},CLASS_NAME:"OpenLayers.Editor.Control.MergeFeature"});OpenLayers.Editor.Control.TransformFeature=OpenLayers.Class(OpenLayers.Control.TransformFeature,{CLASS_NAME:"OpenLayers.Editor.Control.TransformFeature",editLayer:null,strategiesOnHold:null,drawOriginalsFeature:null,drawOriginalsRenderIntent:null,initialize:function(a){this.strategiesOnHold=[];OpenLayers.Control.TransformFeature.prototype.initialize.call(this,a,{renderIntent:"transform",rotationHandleSymbolizer:"rotate"});this.editLayer=a;this.addStyles();this.events.on({transformcomplete:function(a){a.feature.state=
OpenLayers.State.UPDATE;this.editLayer.events.triggerEvent("afterfeaturemodified",{feature:a.feature})},scope:this});this.title=OpenLayers.i18n("oleTransformFeature")},addStyles:function(){var a=this;this.editLayer.styleMap.styles.transform=new OpenLayers.Style({display:"${getDisplay}",cursor:"${role}",pointRadius:5,fillColor:"#07f",strokeOpacity:"${getStrokeOpacity}",fillOpacity:1,strokeColor:"${getStrokeColor}",strokeWidth:"${getStrokeWidth}",strokeDashstyle:"${getStrokeDashstyle}"},{context:{getDisplay:function(b){return null===
a.feature||a.feature.geometry instanceof OpenLayers.Geometry.Point?"none":"se-resize"===b.attributes.role?"none":""},getStrokeColor:function(a){return a.geometry instanceof OpenLayers.Geometry.Point?"#037":"#ff00ff"},getStrokeOpacity:function(a){return a.geometry instanceof OpenLayers.Geometry.Point?0.8:0.5},getStrokeWidth:function(a){return a.geometry instanceof OpenLayers.Geometry.Point?2:1},getStrokeDashstyle:function(a){return a.geometry instanceof OpenLayers.Geometry.Point?"solid":"longdash"}}});
this.editLayer.styleMap.styles.rotate=new OpenLayers.Style({display:"${getDisplay}",pointRadius:10,fillColor:"#ddd",fillOpacity:1,strokeColor:"black",externalGraphic:"msie"===OpenLayers.Util.getBrowserName()?void 0:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAWCAYAAAArdgcFAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAOnAAADnUBiCgbeAAAAAd0SU1FB9wIAgsPAyGVVyoAAAQFSURBVDjLjZVfTJNnFMZ//aQ0UVMgIi11Kngx1KUGBo0XU+bmmFnmErzRkBK2RBMUyfaV4cQ4t5GNm8UMTJTMbDSj4YI5GFmcMxvyZ4yIJJUbY5GNJv7ZQtGJNBoTL+yzC+NnugJykpO8Oe85z/u85z3vOUhiPj13tsfcX71PGzesV0ZGhgA5nU5tWF+gfXvf0089Z8yF4uc0XvjtnOkrKRbwXC1+uUjnzvaYiwL/4vNPtWTJEgHKyclRTU2Nurq6FA6HFY1GdfnyZXV3d+vgwYPKyckRIMMw9MnHR7Qg+Id1HwiQzWZTdXW1rly5omg0Oq9evXpVtbW1MgxDgGpr9mtO8OC3X5s2m01paWk6derUgqD/19OnT8tutwtQ68kTVopskgDIzl6hu3dnaGxspLKykvnk4cOHRCKRJJvD4eDatWs0NDSQkeFkdjZuA54wP1QfEKDNmzc/l6Xf70951DVr1igajaq0tFSA3q+tkSQMgO/PdAFgmmYSo4mJiRTm9+/ft9Z1dXWEQiGOHz8OQCAQAOCHrh8BMEaGB8ybN2/hcrnw+XxWYDgcZufOnfT29qYckJmZSV5eHu3t7Xi9XoqLiwHYtGkTq1evZioWY7D/V9P486/JZoDCwkJsNpsF0NLSgsfjobS0NAV86dKltLa2MjMzQygUStorKSkBYHx8otmYmooBkJubazk8evSI0dFRdu3ahcPhmPNhCwoKKCoqYmhoKMm+cuVKAGKxGGlP2SYSCcshHo+TSCRwu90poKZp8uDBAwBcLhfj4+NJ+0+rzzAM0jyeJ4ynpqYsh6ysLNLT07l+/XoK+Nq1a631jRs3Ugjcvn0bALfbhVFQ8GIAYGxsjMePHwNgt9vZtm0b3d3d3Lt3b860XLx4kUgkQllZWRLrS5cuAfDSxg0BJJGfnydA7e3tVj2fP39eDodDXq9Xg4ODSbXe0dGhrKws5efnKxKJWPbOzk4BWrXKI+v7HzvaIECFhYWanJy0nNva2rRs2TLZ7XZt3bpV5eXl8nq9ArRu3ToNDAwkHerz+QToUH1ASd8/1+1WbHqa+vp6Dhw4YF11enqaYDDIyMgI8Xgct9vNjh078Pv9SZUUDAZpamoiO3sFd+78awOegZ/p7DAr/O82AzQ1NbF7924WKz09PRw+fJhEIkHou2+orNr7rLc81cbPjln9Ys+ePVYPn0/D4bCqqqqsmKNHPtKCw6L15Ak5HOkCtHz5clVUVKitrU19fX0aGxtTf3+/gsGg/H6/nE6nANntdrV89aUWNeZGR4bMN8u2L2rMbX/9NQ3/fmHOMWflfC4ZGR4wz/78S/PQH8Pc+vsfZmfjZGZm8MIqD1u2vMI7b78V2PLqGy3zxf8Hbd5G4wGXKsEAAAAASUVORK5CYII=",
graphicWidth:23,graphicHeight:22},{context:{getDisplay:function(b){return null===a.feature||a.feature.geometry instanceof OpenLayers.Geometry.Point?"none":"se-rotate"===b.attributes.role?"":"none"}}})},activate:function(){for(var a=0;OpenLayers.Util.isArray(this.layer.strategies)&&a<this.layer.strategies.length;a++)this.layer.strategies[a]instanceof OpenLayers.Strategy.BBOX&&(this.strategiesOnHold.push(this.layer.strategies[a]),this.layer.strategies[a].deactivate());a=OpenLayers.Control.TransformFeature.prototype.activate.call(this);
if(null===this.feature||this.feature.geometry instanceof OpenLayers.Geometry.Point){this.editLayer.drawFeature(this.box,this.renderIntent);var b,c;for(c=0;c<this.rotationHandles.length;c++)b=this.rotationHandles[c],this.editLayer.drawFeature(b,this.renderIntent);for(c=0;c<this.handles.length;c++)b=this.handles[c],this.editLayer.drawFeature(b,this.renderIntent)}this.events.on({setfeature:this.highlightTransformedFeature,scope:this});return a},deactivate:function(){this._moving=!0;this.box.geometry.rotate(-this.rotation,
this.center);delete this._moving;for(var a=0;a<this.strategiesOnHold.length;a++)this.strategiesOnHold[a].activate();a=OpenLayers.Control.TransformFeature.prototype.deactivate.apply(this,arguments);this.unsetFeature();this.events.un({setfeature:this.highlightTransformedFeature,scope:this});this.drawOriginalsFeature&&(this.layer.drawFeature(this.drawOriginalsFeature,this.drawOriginalsRenderIntent),this.drawOriginalsRenderIntent=this.drawOriginalsFeature=null);return a},highlightTransformedFeature:function(a){this.drawOriginalsFeature&&
this.layer.drawFeature(this.drawOriginalsFeature,this.drawOriginalsRenderIntent);this.drawOriginalsFeature=a.feature;this.drawOriginalsRenderIntent=a.feature.renderIntent;this.layer.drawFeature(a.feature,"select")},createBox:function(){var a=this;this.center=new OpenLayers.Geometry.Point(0,0);this.box=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(-1,-1),new OpenLayers.Geometry.Point(0,-1),new OpenLayers.Geometry.Point(1,-1),new OpenLayers.Geometry.Point(1,
0),new OpenLayers.Geometry.Point(1,1),new OpenLayers.Geometry.Point(0,1),new OpenLayers.Geometry.Point(-1,1),new OpenLayers.Geometry.Point(-1,0),new OpenLayers.Geometry.Point(-1,-1)]),null,"string"==typeof this.renderIntent?null:this.renderIntent);this.box.geometry.move=function(b,c){a._moving=!0;OpenLayers.Geometry.LineString.prototype.move.apply(this,arguments);a.center.move(b,c);delete a._moving};for(var b=function(a,b){OpenLayers.Geometry.Point.prototype.move.apply(this,arguments);this._rotationHandle&&
this._rotationHandle.geometry.move(a,b);this._handle.geometry.move(a,b)},c=function(a,b,c){OpenLayers.Geometry.Point.prototype.resize.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.resize(a,b,c);this._handle.geometry.resize(a,b,c)},d=function(a,b){OpenLayers.Geometry.Point.prototype.rotate.apply(this,arguments);this._rotationHandle&&this._rotationHandle.geometry.rotate(a,b);this._handle.geometry.rotate(a,b)},e=function(b,c){var d=this.x,e=this.y;OpenLayers.Geometry.Point.prototype.move.call(this,
b,c);if(!a._moving){var f=a.dragControl.handlers.drag.evt,g=!(!a._setfeature&&a.preserveAspectRatio)&&!(f&&f.shiftKey),h=new OpenLayers.Geometry.Point(d,e),f=a.center;this.rotate(-a.rotation,f);h.rotate(-a.rotation,f);var k=this.x-f.x,m=this.y-f.y,l=k-(this.x-h.x),n=m-(this.y-h.y);a.irregular&&!a._setfeature&&(k-=(this.x-h.x)/2,m-=(this.y-h.y)/2);this.x=d;this.y=e;h=1;a.feature.geometry instanceof OpenLayers.Geometry.Point?m=1:g?(m=1E-5>Math.abs(n)?1:m/n,h=(1E-5>Math.abs(l)?1:k/l)/m):(l=Math.sqrt(l*
l+n*n),m=Math.sqrt(k*k+m*m)/l);a._moving=!0;a.box.geometry.rotate(-a.rotation,f);delete a._moving;a.box.geometry.resize(m,f,h);a.box.geometry.rotate(a.rotation,f);a.transformFeature({scale:m,ratio:h});a.irregular&&!a._setfeature&&(k=f.clone(),k.x+=1E-5>Math.abs(d-f.x)?0:this.x-d,k.y+=1E-5>Math.abs(e-f.y)?0:this.y-e,a.box.geometry.move(this.x-d,this.y-e),a.transformFeature({center:k}))}},f=function(b,c){var d=this.x,e=this.y;OpenLayers.Geometry.Point.prototype.move.call(this,b,c);if(!a._moving){var f=
a.dragControl.handlers.drag.evt,f=f&&f.shiftKey?45:1,g=a.center,h=this.x-g.x,k=this.y-g.y;this.x=d;this.y=e;d=Math.atan2(k-c,h-b);d=Math.atan2(k,h)-d;d*=180/Math.PI;a._angle=(a._angle+d)%360;d=a.rotation%f;if(Math.abs(a._angle)>=f||0!==d)d=Math.round(a._angle/f)*f-d,a._angle=0,a.box.geometry.rotate(d,g),a.transformFeature({rotation:d})}},g=Array(8),h=Array(4),k,n,p,q="sw s se e ne n nw w".split(" "),l=0;8>l;++l)k=this.box.geometry.components[l],n=new OpenLayers.Feature.Vector(k.clone(),{role:q[l]+
"-resize"},"string"==typeof this.renderIntent?null:this.renderIntent),0==l%2&&(p=new OpenLayers.Feature.Vector(k.clone(),{role:q[l]+"-rotate"},"string"==typeof this.rotationHandleSymbolizer?null:this.rotationHandleSymbolizer),p.geometry.move=f,k._rotationHandle=p,h[l/2]=p),k.move=b,k.resize=c,k.rotate=d,n.geometry.move=e,k._handle=n,g[l]=n;this.rotationHandles=h;this.handles=g}});OpenLayers.Editor.Control.FixedAngleDrawing=OpenLayers.Class(OpenLayers.Control,{CLASS_NAME:"OpenLayers.Editor.Control.FixedAngleDrawing",active:!1,sketchVerticesAmount:null,guides:null,initialize:function(a){this.guides=[];OpenLayers.Control.prototype.initialize.call(this);this.layer=a},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);if(a)this.layer.events.on({sketchstarted:this.onSketchStarted,sketchmodified:this.onSketchModified,sketchcomplete:this.onSketchComplete,scope:this});
return a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);a&&this.layer.events.un({sketchstarted:this.onSketchStarted,sketchmodified:this.onSketchModified,sketchcomplete:this.onSketchComplete,scope:this});return a},onSketchModified:function(a){a=a.feature.geometry.getVertices();if(2<a.length&&this.sketchVerticesAmount!==a.length){this.removeGuides();this.sketchVerticesAmount=a.length;this.updateGuideLines(a[a.length-3],a[a.length-2]);var b=this.getSnappingGuideLayer(),
c=-1/b.getLine({x1:a[0].x,y1:a[0].y,x2:a[1].x,y2:a[1].y}).m;this.guides.push(b.addLine({m:c,b:a[0].y-c*a[0].x}))}},onSketchComplete:function(){this.removeGuides()},removeGuides:function(){this.getSnappingGuideLayer().removeFeatures(this.guides);this.guides=[]},onSketchStarted:function(a){var b=a.feature,c;if(b.geometry instanceof OpenLayers.Geometry.LineString||b.geometry instanceof OpenLayers.Geometry.Polygon){for(a=0;a<this.map.controls.length;a++){var d=this.map.controls[a];if(d.active&&d.handler instanceof
OpenLayers.Handler.Path){c=d.handler.layer;break}}c.events.on({featureremoved:function(a){a.feature.id===b.id&&(this.sketchVerticesAmount=null,this.getSnappingGuideLayer().destroyFeatures())},scope:this})}},getSnappingGuideLayer:function(){return this.map.getLayersByClass("OpenLayers.Editor.Layer.Snapping")[0]},updateGuideLines:function(a,b){var c=this.getSnappingGuideLayer(),d=-1/((b.y-a.y)/(b.x-a.x));this.guides.push(c.addLine({m:d,b:b.y-d*b.x,x:b.x}))}});OpenLayers.Editor.Layer=OpenLayers.Class(OpenLayers.Layer,{initialize:function(a){OpenLayers.Control.prototype.initialize.apply(this,[a])},CLASS_NAME:"OpenLayers.Editor.Layer"});OpenLayers.Editor.Layer.Snapping=OpenLayers.Class(OpenLayers.Layer.Vector,{CLASS_NAME:"OpenLayers.Editor.Layer.Snapping",intersectionPoints:null,initialize:function(a,b){this.intersectionPoints=[];void 0===b.styleMap&&(b.styleMap=new OpenLayers.StyleMap({"default":new OpenLayers.Style({strokeColor:"#ff00ff",strokeOpacity:0.5,strokeWidth:1,strokeDashstyle:"solid",fillColor:"#ff00ff"},{rules:[new OpenLayers.Rule({evaluate:function(a){return a.geometry instanceof OpenLayers.Geometry.LineString},symbolizer:{strokeDashstyle:"longdash"}}),
new OpenLayers.Rule({evaluate:function(a){return a.geometry instanceof OpenLayers.Geometry.Point},symbolizer:{graphicName:"cross",pointRadius:3,strokeWidth:0}}),new OpenLayers.Rule]})}));OpenLayers.Layer.Vector.prototype.initialize.call(this,a,b)},addGuides:function(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=a[d]instanceof OpenLayers.Feature.Vector?a[d]:new OpenLayers.Feature.Vector(a[d]);OpenLayers.Layer.Vector.prototype.addFeatures.call(this,c,b);return c},getLine:function(a){if(a.x1===a.x2)return{m:Infinity,
x:a.x1};var b=(a.y2-a.y1)/(a.x2-a.x1);return{m:b,b:a.y2-b*a.x2}},addLine:function(a){var b=this.map.getMaxExtent();a=Infinity===a.m?new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(a.x,b.top),new OpenLayers.Geometry.Point(a.x,b.bottom)])):new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.createWorldBoundaryPoint(a.m,b.left,a.b,b),this.createWorldBoundaryPoint(a.m,b.right,a.b,b)]));this.addFeatures([a]);this.rebuildIntersectionPoints();
return a},createWorldBoundaryPoint:function(a,b,c,d){var e=a*b+c;b=e>d.top?(d.top-c)/a:e<d.bottom?(d.bottom-c)/a:b;return new OpenLayers.Geometry.Point(b,a*b+c)},rebuildIntersectionPoints:function(){var a=this.map.getMaxExtent();this.removeFeatures(this.intersectionPoints);this.intersectionPoints=[];this.features.forEach(function(b){b.geometry instanceof OpenLayers.Geometry.Curve&&b.geometry.getSortedSegments().forEach(function(b){var d=this.getLine(b);this.features.forEach(function(b){b.geometry instanceof
OpenLayers.Geometry.Curve&&b.geometry.getSortedSegments().forEach(function(b){b=this.getLine(b);if(d.m!==b.m){b=(b.b-d.b)/(d.m-b.m);var c=d.m*b+d.b;b>=a.left&&(b<=a.right&&c>=a.bottom&&c<=a.top)&&this.intersectionPoints.push(new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(b,c)))}},this)},this)},this)},this);this.addFeatures(this.intersectionPoints)},removeFeatures:function(a,b){OpenLayers.Layer.Vector.prototype.removeFeatures.apply(this,arguments);a!==this.intersectionPoints&&this.rebuildIntersectionPoints()},
drawFeature:function(a,b){var c=OpenLayers.Layer.Vector.prototype.drawFeature.apply(this,arguments);if(this.unrenderedFeatures[a.id]===a){var d=this.map.getExtent();if(a.geometry.intersects(d.toGeometry()))if(a.geometry instanceof OpenLayers.Geometry.LineString&&2===a.geometry.components.length){var e=a.geometry.getSortedSegments()[0],f=this.getLine(e);Infinity===f.m?(c=new OpenLayers.Geometry.Point(f.x,d.top),f=new OpenLayers.Geometry.Point(f.x,d.bottom)):(c=this.createWorldBoundaryPoint(f.m,d.left,
f.b,d),f=this.createWorldBoundaryPoint(f.m,d.right,f.b,d));d=a.geometry.components[0];d.x=c.x;d.y=c.y;var g=a.geometry.components[1];g.x=f.x;g.y=f.y;c=OpenLayers.Layer.Vector.prototype.drawFeature.apply(this,arguments);d.x=e.x1;d.y=e.y1;g.x=e.x2;g.y=e.y2}else console.warn("Failed to render a feature",a)}return c},moveTo:function(a,b,c){OpenLayers.Layer.Vector.prototype.moveTo.apply(this,arguments);this.features.forEach(function(a){this.drawFeature(a)},this)}});/*
  2011 geOps
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.SnappingSettings=OpenLayers.Class(OpenLayers.Control.Button,{title:OpenLayers.i18n("oleSnappingSettings"),layer:null,snapping:new OpenLayers.Control.Snapping,tolerance:10,snappingLayers:null,snappingGuideLayer:null,layerListDiv:null,toleranceInput:null,initialize:function(a,b){this.snappingLayers=[];this.layer=a;OpenLayers.Control.Button.prototype.initialize.apply(this,[b]);this.trigger=OpenLayers.Function.bind(this.openSnappingDialog,this);this.events.register("deactivate",
this,this.onDeactivate);this.title=OpenLayers.i18n("oleSnappingSettings")},deactivate:function(){OpenLayers.Control.Button.prototype.deactivate.call(this);this.map&&(this.map.editor&&this.map.editor.dialog)&&this.map.editor.dialog.hide()},onDeactivate:function(){this.snapping.active&&this.activate()},openSnappingDialog:function(){var a,b;this.activate();this.layerListDiv=document.createElement("div");a=document.createElement("div");b=document.createElement("h4");b.innerHTML=OpenLayers.i18n("oleSnappingSettingsTolerance");
a.appendChild(b);this.toleranceInput=document.createElement("input");this.toleranceInput.type="text";this.toleranceInput.size=4;this.toleranceInput.value=this.tolerance;a.appendChild(this.toleranceInput);a.appendChild(document.createTextNode(OpenLayers.i18n("olePixelUnit")));b=document.createElement("h4");b.innerHTML=OpenLayers.i18n("oleSnappingSettingsLayer");a.appendChild(b);a.appendChild(this.layerListDiv);this.map.editor.dialog.show({content:a,title:OpenLayers.i18n("oleSnappingSettings"),close:OpenLayers.Function.bind(this.changeSnapping,
this)});this.redraw()},redraw:function(){var a,b,c;this.layerListDiv.innerHTML="";for(var d=0;d<this.map.layers.length;d++)a=this.map.layers[d],!(a instanceof OpenLayers.Layer.Vector.RootContainer)&&(a instanceof OpenLayers.Layer.Vector&&!(a instanceof OpenLayers.Editor.Layer.Snapping)&&-1==a.name.search(/OpenLayers.Handler.+/))&&(c=document.createElement("div"),b=document.createElement("input"),b.type="checkbox",b.name="snappingLayer",b.id="Snapping."+a.id,b.value="true",0<=this.snappingLayers.indexOf(a)&&
(b.checked="checked",b.defaultChecked="selected"),c.appendChild(b),OpenLayers.Event.observe(b,"click",OpenLayers.Function.bind(this.setLayerSnapping,this,a,b.checked)),b=document.createElement("label"),b.setAttribute("for","Snapping."+a.id),b.innerHTML=a.name,OpenLayers.Event.observe(b,"click",OpenLayers.Function.bind(function(a){OpenLayers.Event.stop(a,!0)},this)),c.appendChild(b),this.layerListDiv.appendChild(c))},setLayerSnapping:function(a,b){b?this.snappingLayers.splice(this.snappingLayers.indexOf(a),
1):this.snappingLayers.push(a);this.redraw()},changeSnapping:function(){this.tolerance=parseInt(this.toleranceInput.value,10);if(0<this.snappingLayers.length){this.snapping.deactivate();for(var a=[],b=0;b<this.snappingLayers.length;b++)a.push({layer:this.snappingLayers[b],tolerance:this.tolerance});this.snapping=new OpenLayers.Control.Snapping({layer:this.layer,targets:a});for(b=0;b<a.length;b++){var c=a[b].layer;if(!1===c.visibility)for(var d=0,e=c.strategies.length;d<e;d++)"OpenLayers.Strategy.BBOX"===
c.strategies[d].CLASS_NAME&&c.strategies[d].update({force:!0})}this.snapping.activate()}else this.snapping.active&&(this.snapping.deactivate(),this.snapping.targets=null);this.snapping.active||this.deactivate()},setMap:function(a){OpenLayers.Control.Button.prototype.setMap.apply(this,arguments);null===this.snappingGuideLayer&&(this.snappingGuideLayer=this.createSnappingGuideLayer())},createSnappingGuideLayer:function(){var a=new OpenLayers.Editor.Layer.Snapping(OpenLayers.i18n("Snapping Layer"),{visibility:!1});
this.map.addLayer(a);return a},CLASS_NAME:"OpenLayers.Editor.Control.SnappingSettings"});/*
  2011 geOps
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.SplitFeature=OpenLayers.Class(OpenLayers.Control.DrawFeature,{proxy:null,title:OpenLayers.i18n("oleSplitFeature"),initialize:function(a,b){OpenLayers.Control.DrawFeature.prototype.initialize.apply(this,[a,OpenLayers.Handler.Path,b]);this.events.register("activate",this,this.test);this.title=OpenLayers.i18n("oleSplitFeature");this.displayClass="oleControlDisabled "+this.displayClass},test:function(){1>this.layer.selectedFeatures.length&&this.deactivate()},drawFeature:function(a){a=
new OpenLayers.Feature.Vector(a);var b=new OpenLayers.Format.WKT,c=this.layer.events.triggerEvent("sketchcomplete",{feature:a});this.deactivate();!1!==c&&0<this.layer.selectedFeatures.length&&(c=b.write(this.layer.selectedFeatures),a=b.write(a),this.map.editor.startWaiting(this.panel_div),OpenLayers.Request.POST({url:this.map.editor.oleUrl+"process/split",data:OpenLayers.Util.getParameterString({cut:a,geo:c}),headers:{"Content-Type":"application/x-www-form-urlencoded"},callback:this.map.editor.requestComplete,
proxy:this.proxy,scope:this.map.editor}))},CLASS_NAME:"OpenLayers.Editor.Control.SplitFeature"});/*
  2011 geOps
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.UndoRedo=OpenLayers.Class(OpenLayers.Control,{layer:null,handler:null,autoActivate:!0,KEY_Z:90,KEY_Y:89,onUndo:function(){},onRedo:function(){},onRemoveFeature:function(){},undoStack:null,redoStack:null,currentState:null,initialize:function(a,b){this.layer=a;OpenLayers.Control.prototype.initialize.apply(this,[b]);this.layer.events.register("featureadded",this,this.register);this.layer.events.register("afterfeaturemodified",this,this.register);this.undoStack=[];this.redoStack=
[]},draw:function(){this.handler=new OpenLayers.Handler.Keyboard(this,{keydown:this.handleKeydown})},handleKeydown:function(a){a.keyCode===this.KEY_Z&&!0===a.ctrlKey&&!1===a.shiftKey?this.undo():!0===a.ctrlKey&&(a.keyCode===this.KEY_Y||a.keyCode===this.KEY_Z&&!0===a.shiftKey)&&this.redo()},undo:function(){var a=this.moveBetweenStacks(this.undoStack,this.redoStack,!0);if(a)this.onUndo(a)},redo:function(){var a=this.moveBetweenStacks(this.redoStack,this.undoStack,!1);if(a)this.onRedo(a)},moveBetweenStacks:function(a,
b,c){if(0<a.length)if(this.map.editor.editLayer.removeAllFeatures(),a=a.pop(),b.push(this.currentState),a){b=Array(d);var d=a.length;for(c=0;c<d;++c)b[c]=a[c].clone();this.currentState=b;this.map.editor.editLayer.addFeatures(a,{silent:!0})}else this.currentState=null;else this.currentState&&c&&(b.push(this.currentState),this.map.editor.editLayer.removeAllFeatures(),this.currentState=null)},register:function(){for(var a=this.map.editor.editLayer.features,b=a.length,c=Array(b),d=0;d<b;++d)c[d]=a[d].clone();
this.currentState&&this.undoStack.push(this.currentState);this.currentState=c;this.redoStack=[]},CLASS_NAME:"OpenLayers.Editor.Control.UndoRedo"});/*
  2011 geOps
 @license    https://github.com/geops/ole/blob/master/license.txt
 @link       https://github.com/geops/ole
*/
OpenLayers.Editor.Control.CADTools=OpenLayers.Class(OpenLayers.Control.Button,{title:OpenLayers.i18n("oleCADTools"),layer:null,parallelDrawingButton:null,guidedDrawingButton:null,tolerance:10,fixedAngleDrawingControl:null,parallelDrawingControl:null,snappingControl:null,initialize:function(a,b){this.layer=a;this.fixedAngleDrawingControl=new OpenLayers.Editor.Control.FixedAngleDrawing(a);this.parallelDrawingControl=new OpenLayers.Editor.Control.ParallelDrawing(a);OpenLayers.Control.Button.prototype.initialize.apply(this,
[b]);this.trigger=OpenLayers.Function.bind(this.openCADToolsDialog,this);this.events.register("deactivate",this,this.onDeactivate);this.title=OpenLayers.i18n("oleCADTools")},activate:function(){var a=OpenLayers.Control.Button.prototype.activate.call(this);a&&this.snappingControl.activate();return a},deactivate:function(){var a=OpenLayers.Control.Button.prototype.deactivate.call(this);a&&this.snappingControl.deactivate();return a},onDeactivate:function(){this.deactivate();this.map.editor.dialog.hide()},
setMap:function(a){OpenLayers.Control.Button.prototype.setMap.call(this,a);this.map.addControl(this.fixedAngleDrawingControl);this.map.addControl(this.parallelDrawingControl);this.snappingControl=new OpenLayers.Control.Snapping({layer:this.layer,targets:[{layer:this.map.getLayersByClass("OpenLayers.Editor.Layer.Snapping")[0],tolerance:this.tolerance}]})},openCADToolsDialog:function(){if(this.active)this.deactivate(),this.map.editor.dialog.hide();else{this.activate();var a,b;a=document.createElement("div");
b=document.createElement("div");b.className="olEditorControlEditorPanel olEditorCADToolsToolbar";b.style.top="10px";b.style.right="10px";this.parallelDrawingButton=document.createElement("div");this.parallelDrawingButton.title=OpenLayers.i18n("oleCADToolsDialogParallelDrawing");this.parallelDrawingButton.className=this.parallelDrawingControl.active?"olEditorParallelDrawingActive":"olEditorParallelDrawingInactive";OpenLayers.Event.observe(this.parallelDrawingButton,"click",OpenLayers.Function.bind(function(){this.parallelDrawingControl.active?
(this.parallelDrawingControl.deactivate(),this.parallelDrawingButton.className="olEditorParallelDrawingInactive"):(this.parallelDrawingControl.activate(),this.parallelDrawingButton.className="olEditorParallelDrawingActive")},this,this.parallelDrawingButton));b.appendChild(this.parallelDrawingButton);this.guidedDrawingButton=document.createElement("div");this.guidedDrawingButton.title=OpenLayers.i18n("oleCADToolsDialogGuidedDrawing");this.guidedDrawingButton.className=this.fixedAngleDrawingControl.active?
"olEditorGuidedDrawingActive":"olEditorGuidedDrawingInactive";OpenLayers.Event.observe(this.guidedDrawingButton,"click",OpenLayers.Function.bind(function(){this.fixedAngleDrawingControl.active?(this.fixedAngleDrawingControl.deactivate(),this.guidedDrawingButton.className="olEditorGuidedDrawingInactive"):(this.fixedAngleDrawingControl.activate(),this.guidedDrawingButton.className="olEditorGuidedDrawingActive")},this,this.guidedDrawingButton));b.appendChild(this.guidedDrawingButton);a.appendChild(b);
var c=document.createElement("div"),d=document.createElement("p"),e=document.createElement("input");e.type="checkbox";e.id="oleCADToolsDialogShowLayer";e.name="guidedDrawing";e.value="true";e.checked=!0;e.defaultChecked=!0;this.setShowGuides(e.checked);d.appendChild(e);OpenLayers.Event.observe(d,"click",OpenLayers.Function.bind(function(a){OpenLayers.Event.stop(a,!0);this.setShowGuides(e.checked)},this));b=document.createElement("label");b.htmlFor="oleCADToolsDialogShowLayer";b.appendChild(document.createTextNode(OpenLayers.i18n("oleCADToolsDialogShowLayer")));
d.appendChild(b);c.appendChild(d);d=document.createElement("p");b=document.createElement("input");b.type="text";b.id="oleCADToolsDialogTolerance";b.size=4;b.value=this.tolerance;OpenLayers.Event.observe(b,"change",OpenLayers.Function.bind(function(a){this.setTolerance(a.target.value)},this));d.appendChild(b);b=document.createElement("label");b.htmlFor="oleCADToolsDialogTolerance";b.appendChild(document.createTextNode(OpenLayers.i18n("oleCADToolsDialogTolerance")));d.appendChild(b);c.appendChild(d);
a.appendChild(c);this.map.editor.dialog.show({content:a,toolbox:!0})}},setTolerance:function(a){this.tolerance=a;this.snappingControl.setTargets([{layer:this.map.getLayersByClass("OpenLayers.Editor.Layer.Snapping")[0],tolerance:this.tolerance}])},setShowGuides:function(a){this.map.getLayersByClass("OpenLayers.Editor.Layer.Snapping")[0].setVisibility(a)},CLASS_NAME:"OpenLayers.Editor.Control.CADTools"});OpenLayers.Editor.Control.ParallelDrawing=OpenLayers.Class(OpenLayers.Control,{CLASS_NAME:"OpenLayers.Editor.Control.ParallelDrawing",active:!1,guideLine:null,guideLineSegment:null,initialize:function(a){OpenLayers.Control.prototype.initialize.call(this);this.layer=a},activate:function(){var a=OpenLayers.Control.prototype.activate.call(this);if(a)this.layer.events.on({pointadded:this.closestSegment,sketchcomplete:this.onSketchComplete,scope:this});return a},deactivate:function(){var a=OpenLayers.Control.prototype.deactivate.call(this);
a&&this.layer.events.un({pointadded:this.closestSegment,sketchcomplete:this.onSketchComplete,scope:this});return a},closestSegment:function(a){var b=null,c=Number.MAX_VALUE;this.layer.features.forEach(function(d){var e=[];d.geometry instanceof OpenLayers.Geometry.Curve?e=d.geometry.getSortedSegments():d.geometry instanceof OpenLayers.Geometry.Polygon&&d.geometry.components.forEach(function(a){a.getSortedSegments().forEach(function(a){e.push(a)})});e.forEach(function(d){if(!(null!==this.guideLineSegment&&
this.guideLineSegment.x1===d.x1&&this.guideLineSegment.y1===d.y1&&this.guideLineSegment.x2===d.x2&&this.guideLineSegment.y2===d.y2)){var e=(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(d.x1,d.y1),new OpenLayers.Geometry.Point(d.x2,d.y2)])).distanceTo(new OpenLayers.Geometry.Point(a.point.x,a.point.y));e<c&&(c=e,b=d)}},this)},this);if(b){this.guideLineSegment=b;this.removeGuides();var d=this.getSnappingGuideLayer(),e=d.getLine(b);e.b+=a.point.y-(e.m*a.point.x+e.b);this.guideLine=
d.addLine(e)}},getSnappingGuideLayer:function(){return this.map.getLayersByClass("OpenLayers.Editor.Layer.Snapping")[0]},onSketchComplete:function(){this.removeGuides()},removeGuides:function(){null!==this.guideLine&&this.getSnappingGuideLayer().removeFeatures([this.guideLine]);this.guideLine=null}});OpenLayers.Lang.ca=OpenLayers.Util.extend(OpenLayers.Lang.ca,{oleCleanFeature:"Netejar la geometria seleccionada",oleDeleteFeature:"Esborrar la geometria seleccionada",oleDragFeature:"Moure geometria",oleDrawHole:"Dibuixar forat",oleDrawPolygon:"Dibuixar polígon",oleDrawPath:"Dibuixar línia",oleDrawPoint:"Dibuixar punt",oleImportFeature:"Importar la geometria seleccionada",oleImportFeatureSourceLayer:"No s'ha trobat la capa origen.",oleImportFeatureSourceFeature:"Si us plau seleccioneu una geometria abans.",
oleLayerSettingsImportHeader:"Importar",oleLayerSettingsImportLabel:"Fer servir com a capa origen",oleLayerSettingsLegendHeader:"Llegenda",oleLayerSettingsOpacityHeader:"Opacitat (%)",oleMergeFeature:"Barrejar les geometries seleccionades",oleMergeFeatureSelectFeature:"Si us plau seleccioneu com a mínim 2 geometries.",oleModifyFeature:"Modificar geometria",oleNavigation:"Navegació",olePixelUnit:"px",oleSelectFeature:"Seleccionar geometria",oleSnappingSettings:"Configuració de l'ajust automàtic",oleSnappingSettingsLayer:"Capa d'ajust automàtic",
oleSnappingSettingsTolerance:"Tolerancia de l'ajust automàtic",oleSplitFeature:"Partir la geometria seleccionada"});OpenLayers.Lang.de=OpenLayers.Util.extend(OpenLayers.Lang.de,{oleCleanFeature:"Selektierte Geometrien bereinigen",oleDeleteFeature:"Selektierte Geometrien löschen",oleDeleteAllFeatures:"Alle Geometrien löschen",oleDownloadFeature:"Geometrien herunterladen",oleDownloadFeatureEmpty:"Keine Geometrie zum herunterladen",oleDownloadFeatureFileFormat:"Dateiformat wählen",oleUploadFeature:"Geometrien aus lokaler Datei hochladen",oleUploadFeatureNoFile:"Keine Datei angegeben. Bitte Datei wählen und erneut ausführen.",
oleUploadFeatureNone:"Keine lesbaren Geometrien in der Datei gefunden",oleUploadFeatureReplace:"Geometrien im Layer ersetzen",oleDragFeature:"Geometrie verschieben",oleDrawHole:"Loch schneiden",oleDrawPolygon:"Fläche erstellen",oleDrawPath:"Linie erstellen",oleDrawPoint:"Punkt erstellen",oleDrawText:"Bezeichnung einfügen",oleDrawTextEdit:"Text in Eingabefeld schreiben,<br>dann mit Enter oder Schließen des Popups bestätigen",oleDrawRegular:"Gleichseitige Form erstellen",oleDrawRegularShape:"Form",
oleDrawRegularIrregular:"nicht gleichseitig",oleDrawRegularSides3:"Dreieck",oleDrawRegularSides4:"Viereck",oleDrawRegularSides5:"Fünfeck",oleDrawRegularSides6:"Sechseck",oleDrawRegularCircle:"Kreis",oleImportFeature:"Selektierte Geometrien importieren",oleImportFeatureSourceLayer:"Keine Ebenen für den Import gefunden",oleImportFeatureSourceFeature:"Keine selektierten Geometrien für den Import gefunden.",oleLayerSettingsImportHeader:"Import",oleLayerSettingsImportLabel:"Layer als Quelle für Import verwenden",
oleLayerSettingsLegendHeader:"Legende",oleLayerSettingsOpacityHeader:"Opazität in %",oleMergeFeature:"Selektierte Geometrien verschmelzen",oleMergeFeatureSelectFeature:"Bitte mindestens 2 Flächen auswählen.",oleModifyFeature:"Geometrien bearbeiten",oleNavigation:"Navigation",olePixelUnit:"px",oleSelectFeature:"Geometrien selektieren",oleSnappingSettings:"Snapping Einstellungen",oleSnappingSettingsLayer:"Snapping Layer",oleSnappingSettingsTolerance:"Snapping Toleranz in px",oleSplitFeature:"Selektierte Geometrien teilen",
oleTransformFeature:"Geometrie skalieren, drehen und verschieben",oleCADTools:"CAD Funktionen",oleCADToolsDialogParallelDrawing:"Paralleles Zeichnen aktivieren",oleCADToolsDialogGuidedDrawing:"Geführtes Zeichnen aktivieren",oleCADToolsDialogShowLayer:"Hilfslinien anzeigen",oleCADToolsDialogTolerance:"px Toleranz",oleDialogCancelButton:"Abbrechen",oleDialogSaveButton:"Speichern",oleDialogOkButton:"Okay"});OpenLayers.Lang.en=OpenLayers.Util.extend(OpenLayers.Lang.en,{oleCleanFeature:"Clean selected geometry",oleDeleteFeature:"Delete selected geometry",oleDeleteAllFeatures:"Delete all geometries",oleDownloadFeature:"Download geometries",oleDownloadFeatureEmpty:"No geometries to download",oleDownloadFeatureFileFormat:"Select a file format",oleUploadFeature:"Upload geometries from local file",oleUploadFeatureNoFile:"No file specified. Please choose a file and try again.",oleUploadFeatureNone:"No or unreadable geometries found in file",
oleUploadFeatureReplace:"Replace current geometries in layer",oleDragFeature:"Drag geometry",oleDrawHole:"Draw hole",oleDrawPolygon:"Draw polygon",oleDrawPath:"Draw path",oleDrawPoint:"Draw point",oleDrawText:"Draw text label",oleDrawTextEdit:"Add label text in box,<br>then press enter or close popup",oleDrawRegular:"Draw regular polygon",oleDrawRegularShape:"Shape",oleDrawRegularIrregular:"Irregular",oleDrawRegularSides3:"triangle",oleDrawRegularSides4:"square",oleDrawRegularSides5:"pentagon",oleDrawRegularSides6:"hexagon",
oleDrawRegularCircle:"circle",oleImportFeature:"Import selected geometry",oleImportFeatureSourceLayer:"Found no source layer.",oleImportFeatureSourceFeature:"Please select a geometry first.",oleLayerSettingsImportHeader:"Import",oleLayerSettingsImportLabel:"Use as source layer",oleLayerSettingsLegendHeader:"Legend",oleLayerSettingsOpacityHeader:"Opacity (%)",oleMergeFeature:"Merge selected geometry",oleMergeFeatureSelectFeature:"Please select at least 2 geometries.",oleModifyFeature:"Modify geometry",
oleNavigation:"Navigation",olePixelUnit:"px",oleSelectFeature:"Select geometry",oleSnappingSettings:"Snapping settings",oleSnappingSettingsLayer:"Snapping layer",oleSnappingSettingsTolerance:"Snapping tolerance",oleSplitFeature:"Split selected geometry",oleTransformFeature:"Scale, rotate and move geometry",oleCADTools:"CAD Tools",oleCADToolsDialogParallelDrawing:"Parallel Drawing",oleCADToolsDialogGuidedDrawing:"Guided Drawing",oleCADToolsDialogShowLayer:"Show Guide Lines",oleCADToolsDialogTolerance:"px tolerance",
oleDialogCancelButton:"Cancel",oleDialogSaveButton:"Save",oleDialogOkButton:"Okay"});OpenLayers.Lang.hu=OpenLayers.Util.extend(OpenLayers.Lang.hu,{oleCleanFeature:"Kijelölt geometria javítása",oleDeleteFeature:"Kijelölt geometria törlése",oleDeleteAllFeatures:"Az összes geometria törlése",oleDownloadFeature:"Geometriák letöltése",oleDownloadFeatureEmpty:"Nincs letölthető geometria",oleDownloadFeatureFileFormat:"Fájl formátum kiválasztása",oleUploadFeature:"Geometriák feltöltése fájlból",oleUploadFeatureNoFile:"Nincs meghatározott fájl. Kérem válasszon újra egy fájlt.",oleUploadFeatureNone:"Nincsenek vagy csak olvashatatlan geometriák találhatóak a fájlban",
oleUploadFeatureReplace:"A jelenlegi geometriák cseréje a rétegen",oleDragFeature:"Geometria mozgatása",oleDrawHole:"Lyuk rajzolása",oleDrawPolygon:"Poligon rajzolása",oleDrawPath:"Vonal rajzolása",oleDrawPoint:"Pont rajzolása",oleDrawText:"Szöveges felirat rajzolása",oleDrawTextEdit:"Szöveges felirat hozzáadása a dobozhoz, azután Enter-rel zárja be az ablakot",oleDrawRegular:"Szabályos poligon rajzolása",oleDrawRegularShape:"Alakzat",oleDrawRegularIrregular:"Szabálytalan",oleDrawRegularSides3:"háromszög",
oleDrawRegularSides4:"négyzet",oleDrawRegularSides5:"ötszög",oleDrawRegularSides6:"hatszög",oleDrawRegularCircle:"kör",oleImportFeature:"Kijelölt geometriák importálása",oleImportFeatureSourceLayer:"Nem található forrásréteg.",oleImportFeatureSourceFeature:"Kérem, előbb válasszon ki egy geometriát!",oleLayerSettingsImportHeader:"Importálás",oleLayerSettingsImportLabel:"Használat forrásrétegként",oleLayerSettingsLegendHeader:"Jelmagyarázat",oleLayerSettingsOpacityHeader:"Átlátszóság (%)",oleMergeFeature:"Kijelölt geometriák összevonása",
oleMergeFeatureSelectFeature:"Kérem, válasszon ki legalább két geometriát!",oleModifyFeature:"Geometria módosítása",oleNavigation:"Navigáció",olePixelUnit:"px",oleSelectFeature:"Geometria kiválasztása",oleSnappingSettings:"Illesztés beállításai",oleSnappingSettingsLayer:"Illesztő réteg",oleSnappingSettingsTolerance:"Illesztés toleranciája",oleSplitFeature:"Kijelölt geometria szétvágása",oleTransformFeature:"Geometria átméretezése, forgatása és mozgatása",oleCADTools:"CAD Eszközök",oleCADToolsDialogParallelDrawing:"Párhuzamos rajzolás",
oleCADToolsDialogGuidedDrawing:"Segédvonalas rajzolás",oleCADToolsDialogShowLayer:"Segédvonalak megjelenítése",oleCADToolsDialogTolerance:"px tolerancia",oleDialogCancelButton:"Mégse",oleDialogSaveButton:"Mentés",oleDialogOkButton:"Ok"});OpenLayers.Lang.nl=OpenLayers.Util.extend(OpenLayers.Lang.nl,{oleCleanFeature:"Geselecteerde geometrie opschonen",oleDeleteFeature:"Geselecteerde geometrie verwijderen",oleDeleteAllFeatures:"Alle geometrieën verwijderen",oleDownloadFeature:"Download geometrieën",oleDownloadFeatureEmpty:"Geen geometrieën om te downloaden",oleDownloadFeatureFileFormat:"Selecteer een file formaat",oleUploadFeature:"Upload geometrieën vanuit lokaal bestand",oleUploadFeatureNoFile:"Geen bestand geselecteerd. Probeer opnieuw en kies een bestand.",
oleUploadFeatureNone:"Geen of onleesbare geometrieën in bestand",oleUploadFeatureReplace:"Vervang huidige geometrieën in laag",oleDragFeature:"Geometrie verschuiven",oleDrawHole:"Gat knippen in geometrie",oleDrawPolygon:"Teken vlak",oleDrawPath:"Teken lijn",oleDrawPoint:"Teken punt",oleDrawText:"Teken tekst label",oleDrawTextEdit:"Voer tekst hierboven in,<br>doe dan return of sluit dit venster",oleDrawRegular:"Teken regelmatig polygoon",oleDrawRegularShape:"Vorm",oleDrawRegularIrregular:"Niet gelijkzijdig",
oleDrawRegularSides3:"driehoek",oleDrawRegularSides4:"vierkant",oleDrawRegularSides5:"vijfhoek",oleDrawRegularSides6:"zeshoek",oleDrawRegularCircle:"cirkel",oleImportFeature:"Importeer geselecteerde geometrie",oleImportFeatureSourceLayer:"Geen bron-laag.",oleImportFeatureSourceFeature:"Selecteer eerst een geometrie.",oleLayerSettingsImportHeader:"Importeer",oleLayerSettingsImportLabel:"Gebruik als bron-laag",olelayerSettingsLegendHeader:"Legenda",olelayerSettingsOpacityHeader:"Ondoorzichtigheid (%)",
oleMergeFeature:"Combineer geselecteerde geometrie",oleMergeFeatureSelectFeature:"Selecteer tenminste 2 geometrieën.",oleModifyFeature:"Geometrie wijzigen",oleNavigation:"Navigatie",olePixelUnit:"px",oleSelectFeature:"Selecteer geometrie",oleSnappingSettings:"Uitlijn-instellingen",oleSnappingSettingsLayer:"Uitlijnen laag",oleSnappingSettingsTolerance:"Uitlijn-tolerantie",oleSplitFeature:"Splits geselecteerde geometrie",oleTransformFeature:"Geometrie schalen, roteren en verschuiven",oleCADTools:"CAD Functies",
oleCADToolsDialogParallelDrawing:"Parallel tekenen aktiveren",oleCADToolsDialogGuidedDrawing:"Geleid tekenen aktiveren",oleCADToolsDialogShowLayer:"Toon hulplijnen",oleCADToolsDialogTolerance:"px tolerantie",oleDialogCancelButton:"Annuleren",oleDialogSaveButton:"Bewaren",oleDialogOkButton:"Oke"});
/*
    gxp.js - High level widgets for web mapping applications.
    Copyright (c) 2008-2011, The Open Planning Project
    All rights reserved.

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
*/
Ext.namespace("gxp.form");
gxp.form.ColorField=Ext.extend(Ext.form.TextField,{cssColors:{aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},defaultBackground:"#ffffff",initComponent:function(){if(this.value)this.value=this.hexToColor(this.value);gxp.form.ColorField.superclass.initComponent.call(this);this.on({render:this.colorField,
valid:this.colorField,scope:this})},isDark:function(a){var b=!1;if(a)var b=parseInt(a.substring(1,3),16)/255,c=parseInt(a.substring(3,5),16)/255,a=parseInt(a.substring(5,7),16)/255,b=0.5>0.299*b+0.587*c+0.144*a;return b},colorField:function(){var a=this.colorToHex(this.getValue())||this.defaultBackground;this.getEl().setStyle({background:a,color:this.isDark(a)?"#ffffff":"#000000"})},expand3DigitHex:function(a){a&&4==a.length&&0==a.indexOf("#")&&(a="#"+a.charAt(1)+a.charAt(1)+a.charAt(2)+a.charAt(2)+
a.charAt(3)+a.charAt(3));return a},getHexValue:function(){return this.colorToHex(gxp.form.ColorField.superclass.getValue.apply(this,arguments))},getValue:function(){var a=this.getHexValue(),b=this.initialConfig.value;a===this.hexToColor(b)&&(a=b);return a},setValue:function(a){gxp.form.ColorField.superclass.setValue.apply(this,[this.hexToColor(a)])},colorToHex:function(a){if(!a)return a;a=this.expand3DigitHex(a);return a.match(/^#[0-9a-f]{6}$/i)?a:this.cssColors[a.toLowerCase()]||null},hexToColor:function(a){if(!a)return a;
var a=this.expand3DigitHex(a),b;for(b in this.cssColors)if(this.cssColors[b]==a.toUpperCase()){a=b;break}return a}});Ext.reg("gxp_colorfield",gxp.form.ColorField);Ext.namespace("gxp");gxp.ColorManager=function(a){Ext.apply(this,a)};
Ext.apply(gxp.ColorManager.prototype,{field:null,init:function(a){this.register(a)},destroy:function(){this.field&&this.unregister(this.field)},register:function(a){this.field&&this.unregister(this.field);this.field=a;a.on({focus:this.fieldFocus,destroy:this.destroy,scope:this})},unregister:function(a){a.un("focus",this.fieldFocus,this);a.un("destroy",this.destroy,this);gxp.ColorManager.picker&&a==this.field&&gxp.ColorManager.picker.un("pickcolor",this.setFieldValue,this);this.field=null},fieldFocus:function(){gxp.ColorManager.pickerWin?
gxp.ColorManager.picker.purgeListeners():(gxp.ColorManager.picker=new Ext.ColorPalette,gxp.ColorManager.pickerWin=new Ext.Window({title:"Color Picker",closeAction:"hide",autoWidth:!0,autoHeight:!0}));var a={select:this.setFieldValue,scope:this},b=this.getPickerValue();if(b){var c=[].concat(gxp.ColorManager.picker.colors);if(!~c.indexOf(b)){if(gxp.ColorManager.picker.ownerCt)gxp.ColorManager.pickerWin.remove(gxp.ColorManager.picker),gxp.ColorManager.picker=new Ext.ColorPalette;c.push(b);gxp.ColorManager.picker.colors=
c}gxp.ColorManager.pickerWin.add(gxp.ColorManager.picker);gxp.ColorManager.pickerWin.doLayout();gxp.ColorManager.picker.rendered?gxp.ColorManager.picker.select(b):a.afterrender=function(){gxp.ColorManager.picker.select(b)}}gxp.ColorManager.picker.on(a);gxp.ColorManager.pickerWin.show()},setFieldValue:function(a,b){this.field.isVisible()&&this.field.setValue("#"+b)},getPickerValue:function(){var a=this.field;if(a=a.getHexValue?a.getHexValue()||a.defaultBackground:a.getValue())return a.substr(1)}});
(function(){Ext.util.Observable.observeClass(gxp.form.ColorField);gxp.form.ColorField.on({render:function(a){(new gxp.ColorManager).register(a)}})})();gxp.ColorManager.picker=null;gxp.ColorManager.pickerWin=null;Ext.ns("gxp.data");
gxp.data.AutoCompleteProxy=Ext.extend(GeoExt.data.ProtocolProxy,{doRequest:function(a,b,c,d,e,f,g){if(c.query)c.filter=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,matchCase:!1,property:this.protocol.propertyNames[0],value:"*"+c.query+"*"}),delete c.query;gxp.data.AutoCompleteProxy.superclass.doRequest.apply(this,arguments)}});Ext.ns("gxp.data");
gxp.data.AutoCompleteReader=Ext.extend(GeoExt.data.FeatureReader,{read:function(a){var b=this.meta.uniqueField;this.features=[];for(var c=0,d=a.features.length;c<d;++c){var e=a.features[c];!1===this.isDuplicate(b,e.attributes[b])?this.features.push(e):e.destroy()}a.features=this.features;return gxp.data.AutoCompleteReader.superclass.read.apply(this,arguments)},isDuplicate:function(a,b){for(var c=0,d=this.features.length;c<d;++c)if(this.features[c].attributes[a]===b)return!0;return!1}});Ext.ns("gxp.util");
gxp.util.color=function(){function a(a,b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*c:0.5>c?b:c<2/3?a+6*(b-a)*(2/3-c):a}var b={},c={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",
crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",
forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",
lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",
moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",
seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};rgb=b.rgb=function(a){var a=a.toLowerCase(),b;"#"===a[0]?b=a:a in c?b=c[a]:a.match(/^[0-9a-f]{6}$/)&&(b="#"+a);var a=b,f;a&&(f=[parseInt(a.substr(1,
2),16),parseInt(a.substr(3,2),16),parseInt(a.substr(5,2),16)]);return f};hex=b.hex=function(a){return["#",Number(a[0]).toString(16),Number(a[1]).toString(16),Number(a[2]).toString(16)].join("")};b.rgb2hsl=function(a){var b=a[0]/255,c=a[1]/255,a=a[2]/255,g=Math.max(b,c,a),h=Math.min(b,c,a),j,k=(g+h)/2;if(g==h)j=h=0;else{var l=g-h,h=0.5<k?l/(2-g-h):l/(g+h);switch(g){case b:j=(c-a)/l+(c<a?6:0);break;case c:j=(a-b)/l+2;break;case a:j=(b-c)/l+4}j/=6}return[j,h,k]};b.hsl2rgb=function(b){var c,f;f=b[0];
c=b[1];b=b[2];if(0==c)c=b=f=b;else{var g=0.5>b?b*(1+c):b+c-b*c,h=2*b-g;c=a(h,g,f+1/3);b=a(h,g,f);f=a(h,g,f-1/3)}return[Math.round(255*c),Math.round(255*b),Math.round(255*f)]};return b}();Ext.ns("gxp.util");
gxp.util.style=function(){function a(a,b,l){var n=Ext.apply({},a);Ext.iterate(a,function(m){if(g.test(m)){var o=d(e(a[m])),q=d(e(b[m]));if(o&&q){for(var r=[],s=o.length-1;0<=s;--s)r[s]=o[s]+l*(q[s]-o[s]);n[m]=f(c(r))}}else h.test(m)&&(o=null,m in a&&m in b&&(q=a[m],r=b[m],q.literal&&r.literal&&(q=parseFloat(q.text),r=parseFloat(r.text),o=q+l*(r-q))),null!==o&&(n[m]=o))});return n}var b={},c=gxp.util.color.hsl2rgb,d=gxp.util.color.rgb2hsl,e=gxp.util.color.rgb,f=gxp.util.color.hex,g=/Color$/,h=/(Width|Height|[rR]otation|Opacity|Size)$/;
b.interpolateSymbolizers=function(b,c,d){for(var e,f,g=[],h=0,r=b.length;h<r;++h){e=b[h];f=c[h];if(!f)throw Error("Start style and end style must have equal number of parts.");g[h]=a(e,f,d)}return g};return b}();Ext.ns("gxp.data");
gxp.data.FeatureTypeClassifier=Ext.extend(Ext.util.Observable,{store:null,constructor:function(a){gxp.data.FeatureTypeClassifier.superclass.constructor.apply(this,arguments);Ext.apply(this,a)},classify:function(a,b,c,d,e){this.store.filter("group",a);var f,g,h=this.store.getCount();0<h&&(f=this.store.getAt(0).get("symbolizers"),g=this.store.getAt(h-1).get("symbolizers"));h=[function(h){var k,l=0,n=h.getCount(),m;for(h.each(function(d){k=l/n;var e=this.store.getAt(l);e||(e=new this.store.recordType(Ext.apply({},
m)),this.store.add([e]));m=e.data;d=d.get("filter");f&&g&&e.set("symbolizers",gxp.util.style.interpolateSymbolizers(f,g,k));e.set("filter",d);e.set("label",d.lowerBoundary+"-"+d.upperBoundary);e.set("group",a);e.set("name",Ext.applyIf({group:a,method:b,args:c},e.get("name")));l++},this);h=this.store.getAt(l);)this.store.remove(h),l++;this.store.clearFilter();d&&d.call(e)}];h.unshift.apply(h,c);this.methods[b].apply(this,h)},methods:{graduated:function(a,b,c,d){b={identifier:"gs:FeatureClassStats",
dataInputs:[{identifier:"features",reference:{mimeType:"text/xml; subtype=wfs-collection/1.0",href:"http://geoserver/wfs",method:"POST",body:{wfs:{version:"1.0.0",outputFormat:"GML2",featureType:this.store.reader.raw.layerName}}}},{identifier:"attribute",data:{literalData:{value:a}}},{identifier:"classes",data:{literalData:{value:b}}},{identifier:"method",data:{literalData:{value:c}}}],responseForm:{rawDataOutput:{mimeType:"text/xml",identifier:"results"}}};return new Ext.data.XmlStore({record:"Class",
fields:[{name:"count",mapping:"@count"},{name:"filter",convert:function(b,c){return new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN,property:a,lowerBoundary:parseFloat(c.getAttribute("lowerBound")),upperBoundary:parseFloat(c.getAttribute("upperBound"))})}}],proxy:new Ext.data.HttpProxy({url:"/geoserver/wps",method:"POST",xmlData:(new OpenLayers.Format.WPSExecute).write(b)}),autoLoad:!0,listeners:{load:d,scope:this}})}}});Ext.ns("gxp.data");
gxp.data.GroupStyleReader=Ext.extend(GeoExt.data.StyleReader,{onMetaChange:function(){gxp.data.GroupStyleReader.superclass.onMetaChange.apply(this,arguments);var a=this.recordType,b=!1;a.prototype.set=Ext.createInterceptor(this.recordType.prototype.set,function(c,d){if(!b&&"filter"===c){b=!0;var e=this.store,f=this.get("filter");BETWEEN=OpenLayers.Filter.Comparison.BETWEEN;f instanceof OpenLayers.Filter&&"string"===typeof d&&(d=OpenLayers.Format.CQL.prototype.read(d));var g,h=e.indexOf(this);if(h<
e.getCount()-1&&(g=d.type===BETWEEN?"upperBoundary":"value",d[g]!==f[g])){var j=e.getAt(h+1),k=j.get("filter").clone();k[k.type===BETWEEN?"lowerBoundary":"value"]=d[g];j.set("filter",k)}0<h&&(g=d.type===BETWEEN?"lowerBoundary":"value",d[g]!==f[g]&&(e=e.getAt(h-1),f=e.get("filter").clone(),f[f.type===BETWEEN?"upperBoundary":"value"]=d[g],e.set("filter",f)));a.prototype.set.apply(this,[c,d]);return b=!1}})}});Ext.ns("gxp.data");
gxp.data.RuleGroupReader=Ext.extend(GeoExt.data.StyleReader,{constructor:function(a,b){a=a||{fields:["symbolizers","filter",{name:"label",mapping:"title"},{name:"name",convert:function(a,b){var e;try{e=Ext.util.JSON.decode(a)}catch(f){e={group:"Custom",name:a}}b.group=e.group;return e}},"group","description","elseFilter","minScaleDenominator","maxScaleDenominator"],storeToData:function(a){var a=GeoExt.data.StyleReader.metaData.rules.storeToData(a),b,e;for(e=a.length-1;0<=e;--e)if(b=a[e],"object"===
typeof b.name)b.name="Custom"===b.group?b.name.name:Ext.util.JSON.encode(b.name),delete b.group;return a}};gxp.data.RuleGroupReader.superclass.constructor.apply(this,[a,b])}});Ext.namespace("gxp.data");
gxp.data.WFSProtocolProxy=Ext.extend(GeoExt.data.ProtocolProxy,{setFilter:function(a){this.protocol.filter=a;this.protocol.options.filter=a},constructor:function(a){Ext.applyIf(a,{version:"1.1.0"});if(!(this.protocol&&this.protocol instanceof OpenLayers.Protocol))a.protocol=new OpenLayers.Protocol.WFS(Ext.apply({version:a.version,srsName:a.srsName,url:a.url,featureType:a.featureType,featureNS:a.featureNS,geometryName:a.geometryName,schema:a.schema,filter:a.filter,maxFeatures:a.maxFeatures,multi:a.multi},
a.protocol));gxp.data.WFSProtocolProxy.superclass.constructor.apply(this,arguments)},doRequest:function(a,b,c,d,e,f,g){delete c.xaction;if(a===Ext.data.Api.actions.read)this.load(c,d,e,f,g);else{b instanceof Array||(b=[b]);var h=Array(b.length),j;Ext.each(b,function(a,b){h[b]=a.getFeature();j=h[b];j.modified=Ext.apply(j.modified||{},{attributes:Ext.apply(j.modified&&j.modified.attributes||{},a.modified)})},this);var k={action:a,records:b,callback:e,scope:f},a={callback:function(a){this.onProtocolCommit(a,
k)},scope:this};Ext.applyIf(a,c);this.protocol.commit(h,a)}},onProtocolCommit:function(a,b){if(a.success()){var c=a.reqFeatures,d,e,f=[],g=a.insertIds||[],h,j,k=0;for(h=0,j=c.length;h<j;++h)if(e=c[h],d=e.state){if(d==OpenLayers.State.DELETE)f.push(e);else if(d==OpenLayers.State.INSERT)e.fid=g[k],++k;else if(e.modified)e.modified={};e.state=null}for(h=0,j=f.length;h<j;++h)e=f[h],e.layer&&e.layer.destroyFeatures([e]);j=c.length;d=Array(j);for(h=0;h<j;++h){e=c[h];d[h]={id:e.id,feature:e,state:null};
var f=b.records[h].fields,l;for(l in e.attributes)f.containsKey(l)&&(d[h][l]=e.attributes[l])}b.callback.call(b.scope,d,a.priv,!0)}else c=a.priv,200<=c.status&&300>c.status?this.fireEvent("exception",this,"remote",b.action,b,a.error,b.records):this.fireEvent("exception",this,"response",b.action,b,c),b.callback.call(b.scope,[],c,!1)}});Ext.namespace("gxp.data");
gxp.data.WFSFeatureStore=Ext.extend(GeoExt.data.FeatureStore,{setOgcFilter:function(a){this.proxy.setFilter(a)},constructor:function(a){if(!(a.proxy&&a.proxy instanceof GeoExt.data.ProtocolProxy))a.proxy=new gxp.data.WFSProtocolProxy(Ext.apply({srsName:a.srsName,url:a.url,featureType:a.featureType,featureNS:a.featureNS,geometryName:a.geometryName,schema:a.schema,filter:a.ogcFilter,maxFeatures:a.maxFeatures,multi:a.multi},a.proxy));if(!a.writer)a.writer=new Ext.data.DataWriter({write:Ext.emptyFn});
gxp.data.WFSFeatureStore.superclass.constructor.apply(this,arguments);this.reader.extractValues=function(a){return this.readRecords([a.feature]).records[0].data}.createDelegate(this.reader);this.reader.meta.idProperty="id";this.reader.getId=function(a){return a.id}}});
GeoExt.Lang.add("ca",{"gxp.menu.LayerMenu.prototype":{layerText:"Capa"},"gxp.plugins.AddLayers.prototype":{addActionMenuText:"Afegeix Capes",addActionTip:"Afegeix Capes",addServerText:"Afegeix servidor",addButtonText:"Afegeix Capes",untitledText:"Sense T\u00edtol",addLayerSourceErrorText:"Error obtenint les capabilities del WMS ({msg}).\nSi us plau, comproveu la URL i torneu-ho a intentar.",availableLayersText:"Capes disponibles",expanderTemplateText:"<p><b>Resum:</b> {abstract}</p>",panelTitleText:"T\u00edtol",
layerSelectionText:"Veure dades disponibles de:",doneText:"Fet",uploadText:"Puja dades",addFeedActionMenuText:"Add feeds",searchText:"Search for layers"},"gxp.plugins.BingSource.prototype":{title:"Capes Bing",roadTitle:"Bing Carrerer",aerialTitle:"Bing Fotografia A\u00e8ria",labeledAerialTitle:"Bing Fotografia A\u00e8ria amb Etiquetes"},"gxp.plugins.FeatureEditor.prototype":{splitButtonText:"Edit",createFeatureActionText:"Create",editFeatureActionText:"Modify",createFeatureActionTip:"Crea nou element",
editFeatureActionTip:"Edita element existent",commitTitle:"Commit message",commitText:"Please enter a commit message for this edit:"},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"Mostra al mapa",firstPageTip:"Primera p\u00e0gina",previousPageTip:"P\u00e0gina anterior",zoomPageExtentTip:"Ajusta vista a l'extensi\u00f3 de la p\u00e0gina",nextPageTip:"P\u00e0gina seg\u00fcent",lastPageTip:"P\u00e0gina anterior",totalMsg:"Features {1} to {2} of {0}"},"gxp.plugins.GoogleEarth.prototype":{menuText:"Vista 3D",
tooltip:"Vista 3D"},"gxp.plugins.GoogleSource.prototype":{title:"Capes Google",roadmapAbstract:"Mostra carrerer",satelliteAbstract:"Mostra imatges de sat\u00e8l\u00b7lit",hybridAbstract:"Mostra imatges amb noms de carrer",terrainAbstract:"Mostra carrerer amb terreny"},"gxp.plugins.LayerProperties.prototype":{menuText:"Propietats de la capa",toolTip:"Propietats de la capa"},"gxp.plugins.LayerTree.prototype":{shortTitle:"Capes",rootNodeText:"Capes",overlayNodeText:"Capes addicionals",baseNodeText:"Capa base"},
"gxp.plugins.LayerManager.prototype":{baseNodeText:"Capa base"},"gxp.plugins.Legend.prototype":{menuText:"Mostra Llegenda",tooltip:"Mostra Llegenda"},"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:"Loading Map..."},"gxp.plugins.MapBoxSource.prototype":{title:"MapBox Layers",blueMarbleTopoBathyJanTitle:"Blue Marble Topography & Bathymetry (January)",blueMarbleTopoBathyJulTitle:"Blue Marble Topography & Bathymetry (July)",blueMarbleTopoJanTitle:"Blue Marble Topography (January)",blueMarbleTopoJulTitle:"Blue Marble Topography (July)",
controlRoomTitle:"Control Room",geographyClassTitle:"Geography Class",naturalEarthHypsoTitle:"Natural Earth Hypsometric",naturalEarthHypsoBathyTitle:"Natural Earth Hypsometric & Bathymetry",naturalEarth1Title:"Natural Earth I",naturalEarth2Title:"Natural Earth II",worldDarkTitle:"World Dark",worldLightTitle:"World Light",worldPrintTitle:"World Print"},"gxp.plugins.Measure.prototype":{buttonText:"Mesura",lengthMenuText:"Longitud",areaMenuText:"\u00c0rea",lengthTooltip:"Mesura Longitud",areaTooltip:"Mesura \u00c0rea",
measureTooltip:"Mesura"},"gxp.plugins.Navigation.prototype":{menuText:"Despla\u00e7a mapa",tooltip:"Despla\u00e7a mapa"},"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"Vista anterior",nextMenuText:"Vista seg\u00fcent",previousTooltip:"Vista anterior",nextTooltip:"Vista seg\u00fcent"},"gxp.plugins.OSMSource.prototype":{title:"Capes OpenStreetMap",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Daded CC-By-SA de <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},
"gxp.plugins.Print.prototype":{buttonText:"Imprimeix",menuText:"Imprimeix mapa",tooltip:"Imprimeix mapa",previewText:"Vista pr\u00e8via",notAllNotPrintableText:"No es poden imprimir totes les capes",nonePrintableText:"No es pot imprimir cap de les capes del mapa"},"gxp.plugins.MapQuestSource.prototype":{title:"MapQuest Layers",osmAttribution:"Tessel\u00b7les cortesia de <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",
osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Tessel\u00b7les cortesia de <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:"MapQuest Imatge"},"gxp.plugins.QueryForm.prototype":{queryActionText:"Consulta",queryMenuText:"Consulta layer",queryActionTip:"Consulta la capa sel\u00b7leccionada",queryByLocationText:"Query by current map extent",queryByAttributesText:"Consulta per atributs",queryMsg:"Consultant...",
cancelButtonText:"Cancel\u00b7la",noFeaturesTitle:"Sense coincid\u00e8ncies",noFeaturesMessage:"La vostra consulta no ha produ\u00eft resultats."},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"Elimina Capa",removeActionTip:"Elimina Capa"},"gxp.plugins.Styler.prototype":{menuText:"Edita Estils",tooltip:"Gestiona els estils de les capes"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Identify",infoActionTip:"Consulta elements",popupTitle:"Informaci\u00f3 dels elements"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom Box",
zoomInMenuText:"Apropa",zoomOutMenuText:"Allunya",zoomTooltip:"Zoom by dragging a box",zoomInTooltip:"Apropa",zoomOutTooltip:"Allunya"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"Mostra l'extensi\u00f3 total",tooltip:"Mostra l'extensi\u00f3 total"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"Mostra tota la capa",tooltip:"Mostra tota la capa"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"Mostra tota la capa",tooltip:"Mostra tota la capa"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"Mostra els elements seleccionats",
tooltip:"Mostra els elements seleccionats"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"Desitgeu desar els canvis?",closeMsg:"Els canvis en aquest element no s'han desat. Desitja desar-los?",deleteMsgTitle:"Desitgeu esborrar l'element?",deleteMsg:"Esteu segurs de voler esborrar aquest element?",editButtonText:"Edita",editButtonTooltip:"Fes que aquest element sigui editable",deleteButtonText:"Esborra",deleteButtonTooltip:"Esborra aquest element",cancelButtonText:"Cancel\u00b7la",cancelButtonTooltip:"Deixa d'editar, descarta els canvis",
saveButtonText:"Desa",saveButtonTooltip:"Desa els canvis"},"gxp.FillSymbolizer.prototype":{fillText:"Farcit",colorText:"Color",opacityText:"Opacitat"},"gxp.FilterBuilder.prototype":{builderTypeNames:["alguna de","totes","cap de","no totes"],preComboText:"Acompleix",postComboText:"les condicions seg\u00fcents:",addConditionText:"afegeix condici\u00f3",addGroupText:"afegeix grup",removeConditionText:"treu condici\u00f3"},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"Nom",titleHeaderText:"T\u00edtol",
queryableHeaderText:"Consultable",layerSelectionLabel:"Llista les capes de:",layerAdditionLabel:"o afegeix un altre servidor.",expanderTemplateText:"<p><b>Resum:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"cercle",graphicSquareText:"quadrat",graphicTriangleText:"triangle",graphicStarText:"estrella",graphicCrossText:"creu",graphicXText:"x",graphicExternalText:"extern",urlText:"URL",opacityText:"opacitat",symbolText:"S\u00edmbol",sizeText:"Mides",rotationText:"Gir"},"gxp.QueryPanel.prototype":{queryByLocationText:"Consulta per lloc",
currentTextText:"Vista actual",queryByAttributesText:"Consulta per atributs",layerText:"Capa"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} Escala 1:{scale}",labelFeaturesText:"Etiqueta elements",labelsText:"Etiquetes",basicText:"B\u00e0sic",advancedText:"Avan\u00e7at",limitByScaleText:"Restringeix per escala",limitByConditionText:"Restringeix per condici\u00f3",symbolText:"S\u00edmbol",nameText:"Nom"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} Escala 1:{scale}",
minScaleLimitText:"Escala m\u00ednima",maxScaleLimitText:"Escala m\u00e0xima"},"gxp.StrokeSymbolizer.prototype":{solidStrokeName:"continu",dashStrokeName:"guions",dotStrokeName:"punts",titleText:"Tra\u00e7",styleText:"Estil",colorText:"Color",widthText:"Amplada",opacityText:"Opacitad"},"gxp.StylePropertiesDialog.prototype":{titleText:"General",nameFieldText:"Nom",titleFieldText:"T\u00edtol",abstractFieldText:"Resum"},"gxp.TextSymbolizer.prototype":{labelValuesText:"Etiquetatge",haloText:"Halo",sizeText:"Mida"},
"gxp.WMSLayerPanel.prototype":{attributionText:"Attribution",aboutText:"Quant a",titleText:"T\u00edtol",nameText:"Nom",descriptionText:"Descripci\u00f3",displayText:"Mostra",opacityText:"Opacitat",formatText:"Format",transparentText:"Transparent",cacheText:"Cach\u00e9",cacheFieldText:"Utiliza la versi\u00f3 en cach\u00e9",stylesText:"Estils disponibles",infoFormatText:"Info format",infoFormatEmptyText:"Select a format",displayOptionsText:"Display options",queryText:"Limit with filters",scaleText:"Limit by scale",
minScaleText:"Min scale",maxScaleText:"Max scale",switchToFilterBuilderText:"Switch back to filter builder",cqlPrefixText:"or ",cqlText:"use CQL filter instead",singleTileText:"Single tile",singleTileFieldText:"Use a single tile"},"gxp.EmbedMapDialog.prototype":{publishMessage:"Ja podeu incloure el vostre mapa a altres webs! Simplement copieu el seg\u00fcent codi HTML all\u00e0 on desitgeu incrustar-ho:",heightLabel:"Al\u00e7\u00e0ria",widthLabel:"Amplada",mapSizeLabel:"Mida",miniSizeLabel:"M\u00ednima",
smallSizeLabel:"Petita",premiumSizeLabel:"Premium",largeSizeLabel:"Gran"},"gxp.WMSStylesDialog.prototype":{addStyleText:"Afegeix",addStyleTip:"Afegeix nou estil",chooseStyleText:"Escull estil",deleteStyleText:"Treu",deleteStyleTip:"Esborra l'estil sel\u00b7leccionat",editStyleText:"Canvia",editStyleTip:"Edita l'estil sel\u00b7leccionat",duplicateStyleText:"Clona",duplicateStyleTip:"Duplica l'estil sel\u00b7leccionat",addRuleText:"Afegeix",addRuleTip:"Afegeix nova regla",newRuleText:"Nova regla",deleteRuleText:"Treu",
deleteRuleTip:"Esborra la regla sel\u00b7leccionada",editRuleText:"Edita",editRuleTip:"Edita la regla sel\u00b7leccionada",duplicateRuleText:"Clona",duplicateRuleTip:"Duplica la regla sel\u00b7leccionada",cancelText:"Cancel\u00b7la",saveText:"Desa",styleWindowTitle:"Estil: {0}",ruleWindowTitle:"Regla: {0}",stylesFieldsetTitle:"Estils",rulesFieldsetTitle:"Regles"},"gxp.LayerUploadPanel.prototype":{titleLabel:"T\u00edtol",titleEmptyText:"T\u00edtol de la capa",abstractLabel:"Descripci\u00f3",abstractEmptyText:"Descripci\u00f3 de la capa",
fileLabel:"Dades",fieldEmptyText:"Navegueu per les dades...",uploadText:"Puja",uploadFailedText:"Upload failed",processingUploadText:"Processing upload...",waitMsgText:"Pugeu les vostres dades...",invalidFileExtensionText:"L'extensi\u00f3 del fitxer ha de ser alguna d'aquestes: ",optionsText:"Opcions",workspaceLabel:"Espai de treball",workspaceEmptyText:"Espai de treball per defecte",dataStoreLabel:"Magatzem",dataStoreEmptyText:"Create new store",defaultDataStoreEmptyText:"Magatzem de dades per defecte"},
"gxp.NewSourceDialog.prototype":{title:"Afegeix Servidor...",cancelText:"Cancel\u00b7la",addServerText:"Afegeix Servidor",invalidURLText:"Enter a valid URL to a WMS endpoint (e.g. http://example.com/geoserver/wms)",contactingServerText:"Connectant amb el Servidor..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"Escala"},"gxp.Viewer.prototype":{saveErrorText:"Problemes desant: "},"gxp.FeedSourceDialog.prototype":{feedTypeText:"Font",addPicasaText:"Picasa fotos",addYouTubeText:"YouTube Videos",addRSSText:"Feed GeoRSS Un altre",
addFeedText:"Afegeix a Mapa",addTitleText:"T\u00edtol",keywordText:"Paraula clau",doneText:"Fet",titleText:"Afegir Feeds",maxResultsText:"Productes Max"}});
GeoExt.Lang.add("en",{"gxp.menu.LayerMenu.prototype":{layerText:"\u56fe\u5c42"},"gxp.plugins.AddLayers.prototype":{addActionMenuText:"\u6dfb\u52a0\u56fe\u5c42",addActionTip:"\u6dfb\u52a0\u56fe\u5c42",addServerText:"\u6dfb\u52a0\u65b0\u670d\u52a1\u5668",addButtonText:"\u6dfb\u52a0\u56fe\u5c42",untitledText:"\u65e0\u6807\u9898",addLayerSourceErrorText:"WMS\u83b7\u53d6\u53d1\u751f\u9519\u8bef ({msg}).\n\u8bf7\u68c0\u67e5URL\u5e76\u91cd\u8bd5",availableLayersText:"\u73b0\u6709\u56fe\u5c42",expanderTemplateText:"<p><b>\u7b80\u4ecb:</b> {\u7b80\u4ecb}</p>",
panelTitleText:"\u6807\u9898",layerSelectionText:"\u67e5\u770b\u73b0\u6709\u6570\u636e:",doneText:"\u5b8c\u6210",uploadText:"\u4e0a\u4f20\u56fe\u5c42",addFeedActionMenuText:"Add feeds",searchText:"Search for layers"},"gxp.plugins.BingSource.prototype":{title:"Bing\u56fe\u5c42",roadTitle:"Bing\u9053\u8def",aerialTitle:"Bing\u822a\u62cd\u56fe\u7247",labeledAerialTitle:"Bing\u822a\u62cd\u56fe\u7247\u5e26\u6807\u8bb0"},"gxp.plugins.FeatureEditor.prototype":{splitButtonText:"\u7f16\u8f91",createFeatureActionText:"\u521b\u5efa",
editFeatureActionText:"\u4fee\u6539",createFeatureActionTip:"\u521b\u5efa\u65b0\u56fe\u5f62",editFeatureActionTip:"\u4fee\u6539\u5df2\u5b58\u5728\u56fe\u5f62",commitTitle:"Commit message",commitText:"Please enter a commit message for this edit:"},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"\u5728\u5730\u56fe\u4e0a\u663e\u793a",firstPageTip:"\u7b2c\u4e00\u9875",previousPageTip:"\u524d\u4e00\u9875",zoomPageExtentTip:"\u805a\u7126\u5230\u9875\u9762\u5c3a\u5bf8",nextPageTip:"\u4e0b\u4e00\u9875",
lastPageTip:"\u6700\u540e\u4e00\u9875",totalMsg:"\u56fe\u5f62 {1} \u5230 {2} \u4ece {0}"},"gxp.plugins.GoogleEarth.prototype":{menuText:"3D\u89c6\u89d2",tooltip:"\u5207\u6362\u52303D\u89c6\u89d2"},"gxp.plugins.GoogleSource.prototype":{title:"Google\u56fe\u5c42",roadmapAbstract:"\u663e\u793a\u8857\u9053",satelliteAbstract:"\u663e\u793a\u536b\u661f\u56fe",hybridAbstract:"\u663e\u793a\u536b\u661f\u56fe\u53ca\u8857\u9053\u540d\u79f0",terrainAbstract:"\u663e\u793a\u8857\u9053\u548c\u5730\u5f62"},"gxp.plugins.LayerProperties.prototype":{menuText:"\u56fe\u5c42\u5c5e\u6027",
toolTip:"\u56fe\u5c42\u5c5e\u6027"},"gxp.plugins.LayerTree.prototype":{shortTitle:"\u56fe\u5c42",rootNodeText:"\u56fe\u5c42",overlayNodeText:"\u53e0\u52a0",baseNodeText:"\u57fa\u56fe\u5c42"},"gxp.plugins.Legend.prototype":{menuText:"\u663e\u793a\u56fe\u4f8b",tooltip:"\u663e\u793a\u56fe\u4f8b"},"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:"\u8bfb\u53d6\u5730\u56fe..."},"gxp.plugins.MapBoxSource.prototype":{title:"MapBox\u56fe\u5c42",blueMarbleTopoBathyJanTitle:"Blue Marble Topography & Bathymetry (January)\u84dd\u5927\u7406\u77f3\u5730\u5f62\u56fe\u548c\u6e56\u76c6\u56fe\uff08\u4e00\u6708\uff09",
blueMarbleTopoBathyJulTitle:"Blue Marble Topography & Bathymetry (July)\u84dd\u5927\u7406\u77f3\u5730\u5f62\u56fe\u548c\u6e56\u76c6\u56fe\uff08\u4e03\u6708)",blueMarbleTopoJanTitle:"Blue Marble Topography (January)\u84dd\u5927\u7406\u77f3\u5730\u5f62\u56fe\uff08\u4e00\u6708\uff09",blueMarbleTopoJulTitle:"Blue Marble Topography (July)\u84dd\u5927\u7406\u77f3\u5730\u5f62\u56fe\uff08\u4e03\u6708\uff09",controlRoomTitle:"Control Room\u63a7\u5236\u5ba4",geographyClassTitle:"Geography Class\u5730\u7406\u8bfe",
naturalEarthHypsoTitle:"Natural Earth Hypsometric",naturalEarthHypsoBathyTitle:"Natural Earth Hypsometric & Bathymetry",naturalEarth1Title:"Natural Earth I",naturalEarth2Title:"Natural Earth II",worldDarkTitle:"World Dark",worldLightTitle:"World Light",worldPrintTitle:"World Print"},"gxp.plugins.Measure.prototype":{buttonText:"\u6d4b\u91cf",lengthMenuText:"\u957f\u5ea6",areaMenuText:"\u9762\u79ef",lengthTooltip:"\u6d4b\u91cf\u957f\u5ea6",areaTooltip:"\u6d4b\u91cf\u9762\u79ef",measureTooltip:"\u6d4b\u91cf"},
"gxp.plugins.Navigation.prototype":{menuText:"\u5e73\u79fb\u5730\u56fe",tooltip:"\u5e73\u79fb\u5730\u56fe"},"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"\u805a\u7126\u5230\u524d\u4e00\u5c3a\u5bf8",nextMenuText:"\u805a\u96c6\u5230\u4e0b\u4e00\u5c3a\u5bf8",previousTooltip:"\u805a\u7126\u5230\u524d\u4e00\u5c3a\u5bf8",nextTooltip:"\u805a\u7126\u5230\u4e0b\u4e00\u5c3a\u5bf8"},"gxp.plugins.OSMSource.prototype":{title:"OpenStreetMap\u56fe\u5c42",mapnikAttribution:"CC-By-SA\u6570\u636e<a href='http://openstreetmap.org/'>OpenStreetMap</a>",
osmarenderAttribution:"CC-By-SA\u6570\u636e<a href='http://openstreetmap.org/'>OpenStreetMap</a>"},"gxp.plugins.Print.prototype":{buttonText:"\u6253\u5370",menuText:"\u6253\u5370\u5730\u56fe",tooltip:"\u6253\u5370\u5730\u56fe",previewText:"\u6253\u5370\u9884\u89c8",notAllNotPrintableText:"\u5e76\u975e\u6240\u6709\u56fe\u5c42\u90fd\u53ef\u6253\u5370",nonePrintableText:"\u73b0\u6709\u5730\u56fe\u4e2d\u7684\u56fe\u5c42\u90fd\u4e0d\u53ef\u6253\u5370"},"gxp.plugins.MapQuestSource.prototype":{title:"MapQuest\u56fe\u5c42",
osmAttribution:"\u6805\u683c\u83b7\u53d6\u81ea <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",osmTitle:"MapQuest OpenStreetMap",naipAttribution:"\u6805\u683c\u83b7\u53d6\u81ea <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:"MapQuest\u56fe\u7247"},"gxp.plugins.QueryForm.prototype":{queryActionText:"\u67e5\u8be2",
queryMenuText:"\u67e5\u8be2\u56fe\u5c42",queryActionTip:"\u67e5\u8be2\u88ab\u9009\u56fe\u5c42",queryByLocationText:"\u6839\u636e\u73b0\u6709\u5730\u56fe\u5c3a\u5bf8\u67e5\u8be2",queryByAttributesText:"\u6839\u636e\u5c5e\u6027\u67e5\u8be2",queryMsg:"\u67e5\u8be2\u4e2d...",cancelButtonText:"\u53d6\u6d88",noFeaturesTitle:"\u6ca1\u6709\u5339\u914d\u5bf9\u8c61",noFeaturesMessage:"\u60a8\u7684\u67e5\u8be2\u672a\u8fd4\u56de\u4efb\u4f55\u7ed3\u679c"},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"\u5220\u9664\u56fe\u5c42",
removeActionTip:"\u5220\u9664\u56fe\u5c42"},"gxp.plugins.Styler.prototype":{menuText:"\u4fee\u6539\u5f0f\u6837",tooltip:"\u7ba1\u7406\u56fe\u5c42\u5f0f\u6837"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"\u8bc6\u522b",infoActionTip:"\u83b7\u53d6\u56fe\u5f62\u4fe1\u606f",popupTitle:"\u56fe\u5f62\u4fe1\u606f"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"\u805a\u7126\u6846",zoomInMenuText:"\u653e\u5927",zoomOutMenuText:"\u7f29\u5c0f",zoomTooltip:"\u8ddf\u636e\u5212\u6846\u805a\u7126",zoomInTooltip:"\u653e\u5927",
zoomOutTooltip:"\u7f29\u5c0f"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"\u805a\u7126\u5230\u6700\u5927\u5c3a\u5bf8",tooltip:"\u805a\u7126\u5230\u6700\u5927\u5c3a\u5bf8"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"\u805a\u7126\u5230\u56fe\u5c42\u5c3a\u5bf8",tooltip:"\u805a\u7126\u5230\u56fe\u5c42\u5c3a\u5bf8"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"\u805a\u7126\u5230\u56fe\u5c42\u5c3a\u5bf8",tooltip:"\u805a\u7126\u5230\u56fe\u5c42\u5c3a\u5bf8"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"\u805a\u7126\u5230\u88ab\u9009\u56fe\u5f62",
tooltip:"\u805a\u7126\u5230\u88ab\u9009\u56fe\u5f62"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"\u4fdd\u5b58\u4fee\u6539?",closeMsg:"\u56fe\u5f62\u4fee\u6539\u672a\u88ab\u4fdd\u5b58,\u60a8\u6253\u7b97\u4fdd\u5b58\u8fd9\u4e9b\u4fee\u6539\u4e48\uff1f",deleteMsgTitle:"\u5220\u9664\u56fe\u5f62?",deleteMsg:"\u60a8\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u4e9b\u56fe\u5f62\uff1f",editButtonText:"\u4fee\u6539",editButtonTooltip:"\u4f7f\u6b64\u56fe\u5f62\u53ef\u7f16\u8f91",deleteButtonText:"\u5220\u9664",
deleteButtonTooltip:"\u5220\u9664\u8fd9\u4e00\u56fe\u5f62",cancelButtonText:"\u53d6\u6d88",cancelButtonTooltip:"\u505c\u6b62\u7f16\u8f91,\u653e\u5f03\u4fee\u6539",saveButtonText:"\u4fdd\u5b58",saveButtonTooltip:"\u4fdd\u5b58\u4fee\u6539"},"gxp.FillSymbolizer.prototype":{fillText:"\u586b\u6ee1",colorText:"\u989c\u8272",opacityText:"\u900f\u660e\u5ea6"},"gxp.FilterBuilder.prototype":{builderTypeNames:["\u4efb\u4f55","\u5168\u90e8","\u6ca1\u6709","\u975e\u5168\u90e8"],preComboText:"\u5339\u914d",postComboText:"\u81ea\u4e0b\u5217:",
addConditionText:"\u6dfb\u52a0\u6761\u4ef6",addGroupText:"\u6dfb\u52a0\u7ec4",removeConditionText:"\u53bb\u9664\u6761\u4ef6"},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"\u540d\u5b57",titleHeaderText:"\u6807\u9898",queryableHeaderText:"\u53ef\u67e5\u8be2",layerSelectionLabel:"\u67e5\u770b\u73b0\u6709\u6570\u636e",layerAdditionLabel:"\u6216\u6dfb\u52a0\u65b0\u670d\u52a1\u5668",expanderTemplateText:"<p><b>\u7b80\u4ecb:</b> {\u7b80\u4ecb:}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"\u5706",
graphicSquareText:"\u65b9",graphicTriangleText:"\u4e09\u89d2",graphicStarText:"\u661f",graphicCrossText:"\u5341\u5b57",graphicXText:"\u53c9",graphicExternalText:"\u5916\u90e8",urlText:"URL",opacityText:"\u900f\u660e\u5ea6",symbolText:"\u6807\u5fd7",sizeText:"\u5c3a\u5bf8",rotationText:"\u65cb\u8f6c"},"gxp.QueryPanel.prototype":{queryByLocationText:"\u6839\u636e\u65b9\u4f4d\u67e5\u8be2",currentTextText:"\u73b0\u6709\u5c3a\u5bf8",queryByAttributesText:"\u6839\u636e\u5c5e\u6027\u67e5\u8be2",layerText:"\u56fe\u5c42"},
"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType}\u6bd4\u4f8b 1:{scale}",labelFeaturesText:"\u6807\u8bb0\u56fe\u5f62",labelsText:"\u6807\u8bb0",basicText:"\u57fa\u672c",advancedText:"\u9ad8\u7ea7",limitByScaleText:"\u7528\u6bd4\u4f8b\u5c3a\u7b5b\u9009",limitByConditionText:"\u7528\u6761\u4ef6\u7b5b\u9009",symbolText:"\u6807\u5fd7",nameText:"\u540d\u5b57"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} \u6bd4\u4f8b 1:{scale}",minScaleLimitText:"\u6700\u5c0f\u6bd4\u4f8b\u6781\u9650",
maxScaleLimitText:"\u6700\u5927\u6bd4\u4f8b\u6781\u9650"},"gxp.StrokeSymbolizer.prototype":{solidStrokeName:"\u5b9e\u7ebf",dashStrokeName:"\u865a\u7ebf",dotStrokeName:"\u70b9\u7ebf",titleText:"\u7ebf\u5bbd",styleText:"\u6837\u5f0f",colorText:"\u989c\u8272",widthText:"\u5bbd\u5ea6",opacityText:"\u900f\u660e\u5ea6"},"gxp.StylePropertiesDialog.prototype":{titleText:"\u5e38\u89c4",nameFieldText:"\u540d\u79f0",titleFieldText:"\u6807\u9898",abstractFieldText:"\u7b80\u4ecb"},"gxp.TextSymbolizer.prototype":{labelValuesText:"\u6807\u8bb0\u6570\u503c",
haloText:"\u5149\u6655",sizeText:"\u5c3a\u5bf8"},"gxp.WMSLayerPanel.prototype":{attributionText:"Attribution",aboutText:"\u5173\u4e8e",titleText:"\u6807\u9898",nameText:"\u540d\u5b57",descriptionText:"\u63cf\u8ff0",displayText:"\u663e\u793a",opacityText:"\u534a\u900f\u660e",formatText:"\u683c\u5f0f",transparentText:"\u900f\u660e",cacheText:"\u7f13\u5b58",cacheFieldText:"\u4f7f\u7528\u7f13\u5b58\u7248\u672c",stylesText:"Available styles",infoFormatText:"\u683c\u5f0f\u4fe1\u606f",infoFormatEmptyText:"\u9009\u62e9\u4e00\u79cd\u683c\u5f0f",
displayOptionsText:"Display options",queryText:"Limit with filters",scaleText:"Limit by scale",minScaleText:"Min scale",maxScaleText:"Max scale",switchToFilterBuilderText:"Switch back to filter builder",cqlPrefixText:"or ",cqlText:"use CQL filter instead",singleTileText:"Single tile",singleTileFieldText:"Use a single tile"},"gxp.EmbedMapDialog.prototype":{publishMessage:"\u60a8\u7684\u5730\u56fe\u5df2\u7ecf\u53ef\u4ee5\u5728\u7f51\u4e0a\u53d1\u5e03\uff01\u8bf7\u62f7\u8d1d\u4ee5\u4e0bHTML\u4ee5\u5c06\u5730\u56fe\u63d2\u5165\u60a8\u7684\u7f51\u7ad9",
heightLabel:"\u9ad8",widthLabel:"\u5bbd",mapSizeLabel:"\u5730\u56fe\u5927\u5c0f",miniSizeLabel:"\u8ff7\u4f60",smallSizeLabel:"\u5c0f",premiumSizeLabel:"\u6700\u4f73",largeSizeLabel:"\u5927"},"gxp.WMSStylesDialog.prototype":{addStyleText:"\u6dfb\u52a0",addStyleTip:"\u6dfb\u52a0\u65b0\u5f0f\u6837",chooseStyleText:"\u9009\u62e9\u5f0f\u6837",deleteStyleText:"\u79fb\u9664",deleteStyleTip:"\u5220\u9664\u88ab\u9009\u5f0f\u6837",editStyleText:"\u4fee\u6539",editStyleTip:"\u4fee\u6539\u88ab\u9009\u5f0f\u6837",
duplicateStyleText:"\u590d\u5236",duplicateStyleTip:"\u590d\u5236\u88ab\u9009\u5f0f\u6837",addRuleText:"\u6dfb\u52a0",addRuleTip:"\u6dfb\u52a0\u65b0\u89c4\u5219",newRuleText:"\u65b0\u89c4\u5219",deleteRuleText:"\u79fb\u9664",deleteRuleTip:"\u5220\u9664\u88ab\u9009\u89c4\u5219",editRuleText:"\u4fee\u6539",editRuleTip:"\u4fee\u6539\u88ab\u9009\u89c4\u5219",duplicateRuleText:"\u590d\u5236",duplicateRuleTip:"\u590d\u5236\u88ab\u9009\u89c4\u5219",cancelText:"\u53d6\u6d88",saveText:"\u4fdd\u5b58",styleWindowTitle:"\u7528\u6237\u5f0f\u6837: {0}",
ruleWindowTitle:"\u5f0f\u6837\u89c4\u5219: {0}",stylesFieldsetTitle:"\u5f0f\u6837",rulesFieldsetTitle:"\u89c4\u5219"},"gxp.LayerUploadPanel.prototype":{titleLabel:"\u6807\u9898",titleEmptyText:"\u56fe\u5c42\u6807\u9898",abstractLabel:"\u63cf\u8ff0",abstractEmptyText:"\u56fe\u5c42\u63cf\u8ff0",fileLabel:"\u6570\u636e",fieldEmptyText:"\u6d4f\u89c8\u6570\u636e\u6863\u6848...",uploadText:"\u4e0a\u4f20",uploadFailedText:"Upload failed",processingUploadText:"Processing upload...",waitMsgText:"\u4e0a\u4f20\u60a8\u7684\u6570\u636e",
invalidFileExtensionText:"\u6587\u4ef6\u540e\u7f00\u540d\u5fc5\u987b\u662f: ",optionsText:"\u9009\u9879",workspaceLabel:"\u5de5\u4f5c\u533a",workspaceEmptyText:"\u9ed8\u8ba4\u5de5\u4f5c\u533a",dataStoreLabel:"\u6570\u636e\u5305",dataStoreEmptyText:"\u751f\u6210\u65b0\u6570\u636e\u5305",defaultDataStoreEmptyText:"\u9ed8\u8ba4\u6570\u636e\u5305"},"gxp.NewSourceDialog.prototype":{title:"\u6dfb\u52a0\u65b0\u670d\u52a1\u5668...",cancelText:"\u53d6\u6d88",addServerText:"\u6dfb\u52a0\u670d\u52a1\u5668",
invalidURLText:"\u8bf7\u6dfb\u52a0\u6709\u6548\u7684URL\u4ee5\u8054\u63a5WMS\u7aef\u70b9(\u6bd4\u5982http://example.com/geoserver/wms)",contactingServerText:"\u8054\u63a5\u670d\u52a1\u5668\u4e2d..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"\u805a\u7126\u5ea6"},"gxp.Viewer.prototype":{saveErrorText:"Trouble saving: "},"gxp.FeedSourceDialog.prototype":{feedTypeText:"\u6e90",addPicasaText:"Picasa\u7167\u7247",addYouTubeText:"YouTube\u8996\u983b",addRSSText:"\u5176\u4ed6\u7684GeoRSS\u98fc\u6599",
addFeedText:"\u5730\u5716",addTitleText:"\u6a19\u984c",keywordText:"\u95dc\u9375\u5b57",doneText:"\u5b8c\u6210",titleText:"\u6dfb\u52a0\u8a02\u95b1",maxResultsText:"\u6700\u5927\u9805\u76ee"}});
GeoExt.Lang.add("de",{"gxp.menu.LayerMenu.prototype":{layerText:"Layer"},"gxp.plugins.AddLayers.prototype":{addActionMenuText:"Layer hinzuf\u00fcgen",addActionTip:"Layer hinzuf\u00fcgen",addServerText:"Server hinzuf\u00fcgen",addButtonText:"Layer hinzuf\u00fcgen",untitledText:"ohne Titel",addLayerSourceErrorText:"Fehler beim Abfragen der WMS Capabilities ({msg}).\nBitte URL pr\u00fcfen und erneut versuchen.",availableLayersText:"verf\u00fcgbare Layer",expanderTemplateText:"<p><b>Kurzbeschreibung:</b> {abstract}</p>",
panelTitleText:"Titel",layerSelectionText:"Verf\u00fcgbare Daten anzeigen von:",doneText:"Fertig",uploadText:"Daten hochladen",addFeedActionMenuText:"Add feeds",searchText:"Search for layers"},"gxp.plugins.BingSource.prototype":{title:"Bing Layer",roadTitle:"Bing Strassen",aerialTitle:"Bing Luftbilder",labeledAerialTitle:"Bing Luftbilder mit Beschriftung"},"gxp.plugins.FeatureEditor.prototype":{splitButtonText:"Editieren",createFeatureActionText:"Erzeugen",editFeatureActionText:"Bearbeiten",createFeatureActionTip:"neues Objekt erstellen",
editFeatureActionTip:"bestehendes Objekt bearbeiten",commitTitle:"Commit message",commitText:"Please enter a commit message for this edit:"},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"auf der Karte darstellen",firstPageTip:"erste Seite",previousPageTip:"vorherige Seite",zoomPageExtentTip:"Zoom zur max. Ausdehnung",nextPageTip:"n\u00e4chste Seite",lastPageTip:"letzte Seite",totalMsg:"{1} bis {2} von {0} Datens\u00e4tzen"},"gxp.plugins.GoogleEarth.prototype":{menuText:"3D Viewer",tooltip:"zum 3D Viewer wechseln"},
"gxp.plugins.GoogleSource.prototype":{title:"Google Layers",roadmapAbstract:"Strassenkarte zeigen",satelliteAbstract:"Luftbilder zeigen",hybridAbstract:"Luftbilder mit Strassennamen zeigen",terrainAbstract:"Strassenkarte mit Gel\u00e4nde zeigen"},"gxp.plugins.LayerProperties.prototype":{menuText:"Layer Eigenschaften",toolTip:"Layer Eigenschaften"},"gxp.plugins.LayerTree.prototype":{shortTitle:"Layer",rootNodeText:"Layer",overlayNodeText:"\u00fcberlagernde Layer",baseNodeText:"Basiskarten"},"gxp.plugins.LayerManager.prototype":{baseNodeText:"Basiskarte"},
"gxp.plugins.Legend.prototype":{menuText:"Legende zeigen",tooltip:"Legende zeigen"},"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:"Karte laden..."},"gxp.plugins.MapBoxSource.prototype":{title:"MapBox Layers",blueMarbleTopoBathyJanTitle:"Blue Marble Topography & Bathymetry (January)",blueMarbleTopoBathyJulTitle:"Blue Marble Topography & Bathymetry (July)",blueMarbleTopoJanTitle:"Blue Marble Topography (January)",blueMarbleTopoJulTitle:"Blue Marble Topography (July)",controlRoomTitle:"Control Room",
geographyClassTitle:"Geography Class",naturalEarthHypsoTitle:"Natural Earth Hypsometric",naturalEarthHypsoBathyTitle:"Natural Earth Hypsometric & Bathymetry",naturalEarth1Title:"Natural Earth I",naturalEarth2Title:"Natural Earth II",worldDarkTitle:"World Dark",worldLightTitle:"World Light",worldPrintTitle:"World Print"},"gxp.plugins.Measure.prototype":{buttonText:"Messen",lengthMenuText:"L\u00e4nge",areaMenuText:"Fl\u00e4che",lengthTooltip:"L\u00e4nge messen",areaTooltip:"Fl\u00e4che messen",measureTooltip:"Messen"},
"gxp.plugins.Navigation.prototype":{menuText:"Kartenausschnitt verschieben",tooltip:"Kartenausschnitt verschieben"},"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"Kartenausschnitt zur\u00fcck",nextMenuText:"Kartenausschnitt vorw\u00e4rts",previousTooltip:"Vorherigen Kartenausschnitt anzeigen",nextTooltip:"N\u00e4chsten Kartenausschnit anzeigen"},"gxp.plugins.OSMSource.prototype":{title:"OpenStreetMap Layer",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",
osmarenderAttribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},"gxp.plugins.Print.prototype":{buttonText:"Drucken",menuText:"Karte drucken",tooltip:"Karte drucken",previewText:"Druckansicht",notAllNotPrintableText:"Es k\u00f6nnen nicht alle Layer gedruckt werden.",nonePrintableText:"Keiner der aktuellen Kartenlayer kann gedruckt werden."},"gxp.plugins.MapQuestSource.prototype":{title:"MapQuest Layers",osmAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",
osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:"MapQuest Imagery"},"gxp.plugins.QueryForm.prototype":{queryActionText:"Abfrage",queryMenuText:"Abfrage Layer",queryActionTip:"selektierten Layer abfragen",queryByLocationText:"Abfrage nach aktuellem Kartenauscchnitt",queryByAttributesText:"Attributabfrage",queryMsg:"Abfrage wird ausgef\u00fchrt",
cancelButtonText:"Abbrechen",noFeaturesTitle:"keine \u00dcbereinstimmung",noFeaturesMessage:"Ihre Abfrage liefert keine Resultate."},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"Layer l\u00f6schen",removeActionTip:"Layer l\u00f6schen"},"gxp.plugins.Styler.prototype":{menuText:"Style bearbeiten",tooltip:"Layer Styles verwalten"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Objektinformation",infoActionTip:"Objektinformation abfragen",popupTitle:"Objektinformation"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom Box",
zoomInMenuText:"Vergr\u00f6ssern",zoomOutMenuText:"Verkleinern",zoomTooltip:"Box aufziehen zum Zoomen",zoomInTooltip:"Vergr\u00f6ssern",zoomOutTooltip:"Verkleinern"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"Maximale Ausdehnung",tooltip:"Maximale Ausdehnung anzeigen"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"Auf Layer zoomen",tooltip:"Auf Layer zoomen"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"Auf Layer zoomen",tooltip:"Auf Layer zoomen"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"Auf selektierte Objekte zoomen",
tooltip:"Auf selektierte Objekte zoomen"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"\u00c4nderung speichern?",closeMsg:"Ungespeicherte \u00c4nderungen. M\u00f6chten Sie die \u00c4nderungen speichern?",deleteMsgTitle:"Objekt l\u00f6schen?",deleteMsg:"Sind Sie sicher, dass Sie dieses Objekt l\u00f6schen m\u00f6chten?",editButtonText:"Bearbeiten",editButtonTooltip:"Objekt editieren",deleteButtonText:"L\u00f6schen",deleteButtonTooltip:"Objekt l\u00f6schen",cancelButtonText:"Abbrechen",cancelButtonTooltip:"Bearbeitung beenden, \u00c4nderungen verwerfen.",
saveButtonText:"Speichern",saveButtonTooltip:"\u00c4nderungen speichern"},"gxp.FillSymbolizer.prototype":{fillText:"F\u00fcllung",colorText:"Farbe",opacityText:"Transparenz"},"gxp.FilterBuilder.prototype":{builderTypeNames:["beliebige","alle","keine","nicht alle"],preComboText:"Match",postComboText:"der folgenden:",addConditionText:"Bedingung hinzuf\u00fcgen",addGroupText:"Gruppe hinzuf\u00fcgen",removeConditionText:"Bedingung entfernen"},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"Name",
titleHeaderText:"Titel",queryableHeaderText:"abfragbar",layerSelectionLabel:"Verf\u00fcgbare Daten anzeigen von:",layerAdditionLabel:"oder neuen Server hinzuf\u00fcgen.",expanderTemplateText:"<p><b>Kurzbeschreibung:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"Kreis",graphicSquareText:"Rechteck",graphicTriangleText:"Dreieck",graphicStarText:"Stern",graphicCrossText:"Kreuz",graphicXText:"x",graphicExternalText:"extern",urlText:"URL",opacityText:"Transparenz",symbolText:"Symbol",
sizeText:"Gr\u00f6sse",rotationText:"Rotation"},"gxp.QueryPanel.prototype":{queryByLocationText:"lagebezogene Abfrage",currentTextText:"aktuelle Ausdehnung",queryByAttributesText:"Attributabfrage",layerText:"Layer"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} Massstab 1:{scale}",labelFeaturesText:"Objekte beschriften",labelsText:"Beschriftung",basicText:"Basic",advancedText:"Erweitert",limitByScaleText:"Massstabsbeschr\u00e4nkung",limitByConditionText:"Einschr\u00e4nkung durch Bedingung",
symbolText:"Symbol",nameText:"Name"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} Massstab 1:{scale}",minScaleLimitText:"Minimale Massstabsgrenze",maxScaleLimitText:"Maximale Massstabsgrenze"},"gxp.StrokeSymbolizer.prototype":{solidStrokeName:"ausgezogen",dashStrokeName:"gestrichelt",dotStrokeName:"gepunktet",titleText:"Linie",styleText:"Style",colorText:"Farbe",widthText:"Breite",opacityText:"Transparenz"},"gxp.StylePropertiesDialog.prototype":{titleText:"Allgemein",nameFieldText:"Name",
titleFieldText:"Titel",abstractFieldText:"Kurzbeschreibung"},"gxp.TextSymbolizer.prototype":{labelValuesText:"Label values",haloText:"Halo",sizeText:"Gr\u00f6sse"},"gxp.WMSLayerPanel.prototype":{attributionText:"Attribution",aboutText:"\u00dcber",titleText:"Titel",nameText:"Name",descriptionText:"Beschreibung",displayText:"Anzeige",opacityText:"Transparenz",formatText:"Format",transparentText:"transparent",cacheText:"Cache",cacheFieldText:"Version aus dem Cache ben\u00fctzen",stylesText:"Verf\u00fcgbare Styles",
infoFormatText:"Info Format",infoFormatEmptyText:"Format ausw\u00e4hlen",displayOptionsText:"Display options",queryText:"Limit with filters",scaleText:"Limit by scale",minScaleText:"Min scale",maxScaleText:"Max scale",switchToFilterBuilderText:"Switch back to filter builder",cqlPrefixText:"or ",cqlText:"use CQL filter instead",singleTileText:"Single tile",singleTileFieldText:"Use a single tile"},"gxp.EmbedMapDialog.prototype":{publishMessage:"Ihre Karte ist f\u00fcr die Publikation im Web bereit. Kopieren Sie einfach den folgenden HTML-Code, um die Karte in Ihre Webseite einzubinden:",
heightLabel:"H\u00f6he",widthLabel:"Breite",mapSizeLabel:"Kartengr\u00f6sse",miniSizeLabel:"Mini",smallSizeLabel:"Klein",premiumSizeLabel:"Premium",largeSizeLabel:"Gross"},"gxp.WMSStylesDialog.prototype":{addStyleText:"Hinzuf\u00fcgen",addStyleTip:"neuen Style hinzuf\u00fcgen",chooseStyleText:"Style ausw\u00e4hlen",deleteStyleText:"L\u00f6schen",deleteStyleTip:"selektierten Style l\u00f6schen",editStyleText:"Bearbeiten",editStyleTip:"selektierten Style bearbeiten",duplicateStyleText:"Duplizieren",
duplicateStyleTip:"selektierten Style duplizieren",addRuleText:"Hinzuf\u00fcgen",addRuleTip:"neue Regel hinzuf\u00fcgen",newRuleText:"neue Regel",deleteRuleText:"Entfernen",deleteRuleTip:"selektierte Regel l\u00f6schen",editRuleText:"Bearbeiten",editRuleTip:"selektierte Regel bearbeiten",duplicateRuleText:"Duplizieren",duplicateRuleTip:"selektierte Regel duplizieren",cancelText:"Abbrechen",saveText:"Speichern",styleWindowTitle:"User Style: {0}",ruleWindowTitle:"Style Regel: {0}",stylesFieldsetTitle:"Styles",
rulesFieldsetTitle:"Regeln"},"gxp.LayerUploadPanel.prototype":{titleLabel:"Titel",titleEmptyText:"Layertitel",abstractLabel:"Beschreibung",abstractEmptyText:"Layerbeschreibung",fileLabel:"Daten",fieldEmptyText:"Datenarchiv durchsuchen...",uploadText:"Hochladen",uploadFailedText:"Hochladen fehlgeschlagen",processingUploadText:"Upload wird bearbeitet",waitMsgText:"Ihre Daten werden hochgeladen...",invalidFileExtensionText:"Dateierweiterung muss eine sein von: ",optionsText:"Optionen",workspaceLabel:"Workspace",
workspaceEmptyText:"Standard Workspace",dataStoreLabel:"Store",dataStoreEmptyText:"Neuen Store erzeugen",defaultDataStoreEmptyText:"Default Datastore"},"gxp.NewSourceDialog.prototype":{title:"neuen Server hinzuf\u00fcgen...",cancelText:"Abbrechen",addServerText:"Server hinzuf\u00fcgen",invalidURLText:"F\u00fcgen Sie eine g\u00fcltige URL zu einem WMS ein (z.B. http://example.com/geoserver/wms)",contactingServerText:"Server wird kontaktiert..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"Zoomstufe"},
"gxp.Viewer.prototype":{saveErrorText:"Beim Speichern ist ein Problem aufgetreten: "},"gxp.FeedSourceDialog.prototype":{feedTypeText:"Source",addPicasaText:"Picasa Fotos",addYouTubeText:"YouTube Videos",addRSSText:"Andere GeoRSS Feed",addFeedText:"zur Karte hinzuf\u00fcgen",addTitleText:"Titel",keywordText:"Keyword",doneText:"Fertig",titleText:"Add-Feeds",maxResultsText:"Max Items"}});
GeoExt.Lang.add("el",{"gxp.menu.LayerMenu.prototype":{layerText:"\u0395\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b1"},"gxp.plugins.AddLayers.prototype":{addActionMenuText:"\u03a0\u03c1\u03bf\u03c3\u03b8\u03ad\u03c3\u03c4\u03b5 \u03b5\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b5\u03c2",addActionTip:"\u03a0\u03c1\u03bf\u03c3\u03b8\u03ad\u03c3\u03c4\u03b5 \u03b5\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b5\u03c2",addServerText:"\u03a0\u03c1\u03bf\u03c3\u03b8\u03ad\u03c3\u03c4\u03b5 \u03ad\u03bd\u03b1 \u039d\u03ad\u03bf \u0394\u03b9\u03b1\u03ba\u03bf\u03bc\u03b9\u03c3\u03c4\u03ae",
addButtonText:"\u03a0\u03c1\u03bf\u03c3\u03b8\u03ad\u03c3\u03c4\u03b5 \u03b5\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b5\u03c2",untitledText:"\u03a7\u03c9\u03c1\u03af\u03c2 \u03c4\u03af\u03c4\u03bb\u03bf",addLayerSourceErrorText:"\u03a3\u03c6\u03ac\u03bb\u03bc\u03b1 \u03c3\u03c4\u03b7\u03bd \u03b1\u03bd\u03ac\u03ba\u03c4\u03b7\u03c3\u03b7 \u03b4\u03c5\u03bd\u03b1\u03c4\u03bf\u03c4\u03ae\u03c4\u03c9\u03bd WMS ({msg}).\n\u03a0\u03b1\u03c1\u03b1\u03ba\u03b1\u03bb\u03ce \u03b5\u03bb\u03ad\u03b3\u03be\u03c4\u03b5 \u03c4\u03bf url \u03ba\u03b1\u03b9 \u03b4\u03bf\u03ba\u03b9\u03bc\u03ac\u03c3\u03c4\u03b5 \u03be\u03b1\u03bd\u03ac.",
availableLayersText:"\u0394\u03b9\u03b1\u03b8\u03ad\u03c3\u03b9\u03bc\u03b5\u03c2 \u0395\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b5\u03c2",expanderTemplateText:"<p><b>\u03a0\u03b5\u03c1\u03af\u03bb\u03b7\u03c8\u03b7:</b> {abstract}</p>",panelTitleText:"\u03a4\u03af\u03c4\u03bb\u03bf\u03c2",layerSelectionText:"\u0394\u03b5\u03af\u03c4\u03b5 \u03b4\u03b9\u03b1\u03b8\u03ad\u03c3\u03b9\u03bc\u03b1 \u03b4\u03b5\u03b4\u03bf\u03bc\u03ad\u03bd\u03b1 \u03b1\u03c0\u03cc:",doneText:"\u039f\u03bb\u03bf\u03ba\u03bb\u03b7\u03c1\u03ce\u03b8\u03b7\u03ba\u03b5",
uploadText:"\u0391\u03bd\u03b5\u03b2\u03ac\u03c3\u03c4\u03b5 \u0394\u03b5\u03b4\u03bf\u03bc\u03ad\u03bd\u03b1",addFeedActionMenuText:"Add feeds",searchText:"Search for layers"},"gxp.plugins.BingSource.prototype":{title:"\u0395\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b5\u03c2 Bing",roadTitle:"\u0394\u03c1\u03cc\u03bc\u03bf\u03b9 Bing",aerialTitle:"\u0395\u03bd\u03b1\u03ad\u03c1\u03b9\u03b5\u03c2 Bing",labeledAerialTitle:"\u0395\u03bd\u03b1\u03ad\u03c1\u03b9\u03b5\u03c2 Bing \u03bc\u03b5 \u0395\u03c4\u03b9\u03ba\u03ad\u03c4\u03b5\u03c2"},
"gxp.plugins.FeatureEditor.prototype":{splitButtonText:"Edit",createFeatureActionText:"Create",editFeatureActionText:"Modify",createFeatureActionTip:"\u0394\u03b7\u03bc\u03b9\u03bf\u03c5\u03c1\u03b3\u03ae\u03c3\u03c4\u03b5 \u03ad\u03bd\u03b1 \u03bd\u03ad\u03bf \u03c7\u03b1\u03c1\u03b1\u03ba\u03c4\u03b7\u03c1\u03b9\u03c3\u03c4\u03b9\u03ba\u03cc",editFeatureActionTip:"\u03a4\u03c1\u03bf\u03c0\u03bf\u03c0\u03bf\u03b9\u03ae\u03c3\u03c4\u03b5 \u03c5\u03c0\u03ac\u03c1\u03c7\u03bf\u03bd \u03c7\u03b1\u03c1\u03b1\u03ba\u03c4\u03b7\u03c1\u03b9\u03c3\u03c4\u03b9\u03ba\u03cc",
commitTitle:"Commit message",commitText:"Please enter a commit message for this edit:"},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"\u03a0\u03c1\u03bf\u03b2\u03bf\u03bb\u03ae \u03c3\u03c4\u03bf\u03bd \u03c7\u03ac\u03c1\u03c4\u03b7",firstPageTip:"\u03a0\u03c1\u03ce\u03c4\u03b7 \u03c3\u03b5\u03bb\u03af\u03b4\u03b1",previousPageTip:"\u03a0\u03c1\u03bf\u03b7\u03b3\u03bf\u03cd\u03bc\u03b5\u03bd\u03b7 \u03c3\u03b5\u03bb\u03af\u03b4\u03b1",zoomPageExtentTip:"\u0396\u03bf\u03c5\u03bc \u03c3\u03c4\u03bf \u03b5\u03cd\u03c1\u03bf\u03c2 \u03c4\u03b7\u03c2 \u03c3\u03b5\u03bb\u03af\u03b4\u03b1\u03c2",
nextPageTip:"\u0395\u03c0\u03cc\u03bc\u03b5\u03bd\u03b7 \u03c3\u03b5\u03bb\u03af\u03b4\u03b1",nextPageTip:"\u03a4\u03b5\u03bb\u03b5\u03c5\u03c4\u03b1\u03af\u03b1 \u03c3\u03b5\u03bb\u03af\u03b4\u03b1",totalMsg:"Features {1} to {2} of {0}"},"gxp.plugins.GoogleEarth.prototype":{apiKeyPrompt:"\u03a0\u03b1\u03c1\u03b1\u03ba\u03b1\u03bb\u03ce \u03b5\u03b9\u03c3\u03ac\u03b3\u03b5\u03c4\u03b5 \u03c4\u03bf Google API \u03ba\u03bb\u03b5\u03b9\u03b4\u03af \u03b3\u03b9\u03b1 ",menuText:"3D \u03a0\u03c1\u03bf\u03b2\u03bf\u03bb\u03ae",
tooltip:"\u0391\u03bb\u03bb\u03ac\u03be\u03c4\u03b5 \u03c3\u03b5 3D \u03a0\u03c1\u03bf\u03b2\u03bf\u03bb\u03ae"},"gxp.plugins.GoogleSource.prototype":{title:"\u0395\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b5\u03c2 Google",roadmapAbstract:"\u03a0\u03c1\u03bf\u03b2\u03bf\u03bb\u03ae \u03bf\u03b4\u03b9\u03ba\u03bf\u03cd \u03c7\u03ac\u03c1\u03c4\u03b7",satelliteAbstract:"\u03a0\u03c1\u03bf\u03b2\u03bf\u03bb\u03ae \u03b5\u03b9\u03ba\u03cc\u03bd\u03c9\u03bd \u03b1\u03c0\u03cc \u03b4\u03bf\u03c1\u03c5\u03c6\u03cc\u03c1\u03bf",
hybridAbstract:"\u03a0\u03c1\u03bf\u03b2\u03bf\u03bb\u03ae \u03b5\u03b9\u03ba\u03cc\u03bd\u03c9\u03bd \u03bc\u03b5 \u03bf\u03bd\u03cc\u03bc\u03b1\u03c4\u03b1 \u03bf\u03b4\u03ce\u03bd",terrainAbstract:"\u03a0\u03c1\u03bf\u03b2\u03bf\u03bb\u03ae \u03bf\u03b4\u03b9\u03ba\u03bf\u03cd \u03c7\u03ac\u03c1\u03c4\u03b7 \u03bc\u03b5 \u03b1\u03bd\u03ac\u03b3\u03bb\u03c5\u03c6\u03bf \u03b5\u03b4\u03ac\u03c6\u03bf\u03c5\u03c2"},"gxp.plugins.LayerProperties.prototype":{menuText:"\u0395\u03c0\u03b9\u03bb\u03bf\u03b3\u03ad\u03c2 \u0395\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b1\u03c2",
toolTip:"\u0395\u03c0\u03b9\u03bb\u03bf\u03b3\u03ad\u03c2 \u0395\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b1\u03c2"},"gxp.plugins.LayerTree.prototype":{rootNodeText:"\u0395\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b5\u03c2",overlayNodeText:"\u0395\u03c0\u03b9\u03c3\u03c4\u03c1\u03ce\u03bc\u03b1\u03c4\u03b1",baseNodeText:"\u03a5\u03c0\u03cc\u03b2\u03b1\u03b8\u03c1\u03b1"},"gxp.plugins.Legend.prototype":{menuText:"\u03a0\u03c1\u03bf\u03b2\u03bf\u03bb\u03ae \u03a5\u03c0\u03bf\u03bc\u03bd\u03ae\u03bc\u03b1\u03c4\u03bf\u03c2",
tooltip:"\u03a0\u03c1\u03bf\u03b2\u03bf\u03bb\u03ae \u03a5\u03c0\u03bf\u03bc\u03bd\u03ae\u03bc\u03b1\u03c4\u03bf\u03c2"},"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:"\u03a6\u03cc\u03c1\u03c4\u03c9\u03c3\u03b7 \u03a7\u03ac\u03c1\u03c4\u03b7..."},"gxp.plugins.MapBoxSource.prototype":{title:"MapBox Layers",blueMarbleTopoBathyJanTitle:"Blue Marble Topography & Bathymetry (January)",blueMarbleTopoBathyJulTitle:"Blue Marble Topography & Bathymetry (July)",blueMarbleTopoJanTitle:"Blue Marble Topography (January)",
blueMarbleTopoJulTitle:"Blue Marble Topography (July)",controlRoomTitle:"Control Room",geographyClassTitle:"Geography Class",naturalEarthHypsoTitle:"Natural Earth Hypsometric",naturalEarthHypsoBathyTitle:"Natural Earth Hypsometric & Bathymetry",naturalEarth1Title:"Natural Earth I",naturalEarth2Title:"Natural Earth II",worldDarkTitle:"World Dark",worldLightTitle:"World Light",worldPrintTitle:"World Print"},"gxp.plugins.Measure.prototype":{buttonText:"\u039c\u03ad\u03c4\u03c1\u03bf",lengthMenuText:"\u0391\u03c0\u03cc\u03c3\u03c4\u03b1\u03c3\u03b7",
areaMenuText:"\u0395\u03bc\u03b2\u03b1\u03b4\u03cc\u03bd",lengthTooltip:"\u03a5\u03c0\u03bf\u03bb\u03bf\u03b3\u03af\u03c3\u03c4\u03b5 \u03b1\u03c0\u03cc\u03c3\u03c4\u03b1\u03c3\u03b7",areaTooltip:"\u03a5\u03c0\u03bf\u03bb\u03bf\u03b3\u03af\u03c3\u03c4\u03b5 \u03b5\u03bc\u03b2\u03b1\u03b4\u03cc\u03bd",measureTooltip:"\u039c\u03ad\u03c4\u03c1\u03bf"},"gxp.plugins.Navigation.prototype":{menuText:"\u039c\u03b5\u03c4\u03b1\u03ba\u03b9\u03bd\u03ae\u03c3\u03c4\u03b5 \u03a7\u03ac\u03c1\u03c4\u03b7",tooltip:"\u039c\u03b5\u03c4\u03b1\u03ba\u03b9\u03bd\u03ae\u03c3\u03c4\u03b5 \u03a7\u03ac\u03c1\u03c4\u03b7"},
"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"\u0396\u03bf\u03c5\u03bc \u03a3\u03c4\u03bf \u03a0\u03c1\u03bf\u03b7\u03b3\u03bf\u03cd\u03bc\u03b5\u03bd\u03bf \u0395\u03c0\u03af\u03c0\u03b5\u03b4\u03bf",nextMenuText:"\u0396\u03bf\u03c5\u03bc \u03a3\u03c4\u03bf \u0395\u03c0\u03cc\u03bc\u03b5\u03bd\u03bf \u0395\u03c0\u03af\u03c0\u03b5\u03b4\u03bf",previousTooltip:"\u0396\u03bf\u03c5\u03bc \u03a3\u03c4\u03bf \u03a0\u03c1\u03bf\u03b7\u03b3\u03bf\u03cd\u03bc\u03b5\u03bd\u03bf \u0395\u03c0\u03af\u03c0\u03b5\u03b4\u03bf",
nextTooltip:"\u0396\u03bf\u03c5\u03bc \u03a3\u03c4\u03bf \u0395\u03c0\u03cc\u03bc\u03b5\u03bd\u03bf \u0395\u03c0\u03af\u03c0\u03b5\u03b4\u03bf"},"gxp.plugins.OSMSource.prototype":{title:"\u0395\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b5\u03c2 OpenStreetMap",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"\u0394\u03b5\u03b4\u03bf\u03bc\u03ad\u03bd\u03b1 CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},
"gxp.plugins.Print.prototype":{buttonText:"\u0395\u03ba\u03c4\u03cd\u03c0\u03c9\u03c3\u03b7",menuText:"\u0395\u03ba\u03c4\u03cd\u03c0\u03c9\u03c3\u03b7 \u03a7\u03ac\u03c1\u03c4\u03b7",tooltip:"\u0395\u03ba\u03c4\u03cd\u03c0\u03c9\u03c3\u03b7 \u03a7\u03ac\u03c1\u03c4\u03b7",previewText:"\u03a0\u03c1\u03bf\u03b5\u03c0\u03b9\u03c3\u03ba\u03cc\u03c0\u03b7\u03c3\u03b7 \u0395\u03ba\u03c4\u03cd\u03c0\u03c9\u03c3\u03b7\u03c2",notAllNotPrintableText:"\u0394\u03b5\u03bd \u039c\u03c0\u03bf\u03c1\u03bf\u03cd\u03bd \u039d\u03b1 \u0395\u03ba\u03c4\u03c5\u03c0\u03c9\u03b8\u03bf\u03cd\u03bd \u038c\u03bb\u03b5\u03c2 \u039f\u03b9 \u0395\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b5\u03c2",
nonePrintableText:"\u039a\u03b1\u03bc\u03af\u03b1 \u03b1\u03c0\u03cc \u03c4\u03b9\u03c2 \u03b5\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b5\u03c2 \u03c4\u03bf\u03c5 \u03c4\u03c1\u03ad\u03c7\u03bf\u03bd\u03c4\u03bf\u03c2 \u03c7\u03ac\u03c1\u03c4\u03b7 \u03b4\u03b5\u03bd \u03bc\u03c0\u03bf\u03c1\u03b5\u03af \u03bd\u03b1 \u03b5\u03ba\u03c4\u03c5\u03c0\u03c9\u03b8\u03b5\u03af"},"gxp.plugins.MapQuestSource.prototype":{title:"\u0395\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b5\u03c2 MapQuest",osmAttribution:"\u03a0\u03bb\u03b1\u03ba\u03af\u03b4\u03b9\u03b1 \u03a0\u03c1\u03bf\u03c3\u03c6\u03bf\u03c1\u03ac \u03a4\u03c9\u03bd <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",
osmTitle:"MapQuest OpenStreetMap",naipAttribution:"\u03a0\u03bb\u03b1\u03ba\u03af\u03b4\u03b9\u03b1 \u03a0\u03c1\u03bf\u03c3\u03c6\u03bf\u03c1\u03ac \u03a4\u03c9\u03bd of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:"\u0395\u03b9\u03ba\u03cc\u03bd\u03b5\u03c2 MapQuest"},"gxp.plugins.QueryForm.prototype":{queryActionText:"\u0395\u03c0\u03b5\u03c1\u03ce\u03c4\u03b7\u03c3\u03b7",queryMenuText:"\u0395\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b1 \u03b5\u03c0\u03b5\u03c1\u03ce\u03c4\u03b7\u03c3\u03b7\u03c2",
queryActionTip:"\u039a\u03ac\u03bd\u03c4\u03b5 \u03b5\u03c0\u03b5\u03c1\u03ce\u03c4\u03b7\u03c3\u03b7 \u03c3\u03c4\u03b7\u03bd \u03b5\u03c0\u03b9\u03bb\u03b5\u03b3\u03bc\u03ad\u03bd\u03b7 \u03b5\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b1",queryByLocationText:"Query by current map extent",queryByAttributesText:"\u0395\u03c0\u03b5\u03c1\u03ce\u03c4\u03b7\u03c3\u03b7 \u03b2\u03ac\u03c3\u03b5\u03b9 \u03c7\u03b1\u03c1\u03b1\u03ba\u03c4\u03b7\u03c1\u03b9\u03c3\u03c4\u03b9\u03ba\u03ce\u03bd",queryMsg:"\u0393\u03af\u03bd\u03b5\u03c4\u03b1\u03b9 \u03b5\u03c0\u03b5\u03c1\u03ce\u03c4\u03b7\u03c3\u03b7...",
cancelButtonText:"\u0391\u03ba\u03cd\u03c1\u03c9\u03c3\u03b7",noFeaturesTitle:"\u039a\u03b1\u03bd\u03ad\u03bd\u03b1 \u0391\u03c0\u03bf\u03c4\u03ad\u03bb\u03b5\u03c3\u03bc\u03b1",noFeaturesMessage:"\u0397 \u03b5\u03c0\u03b5\u03c1\u03ce\u03c4\u03b7\u03c3\u03b7 \u03c3\u03b1\u03c2 \u03b4\u03b5\u03bd \u03b5\u03c0\u03ad\u03c3\u03c4\u03c1\u03b5\u03c8\u03b5 \u03b1\u03c0\u03bf\u03c4\u03b5\u03bb\u03ad\u03c3\u03bc\u03b1\u03c4\u03b1."},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"\u039a\u03b1\u03c4\u03ac\u03c1\u03b3\u03b7\u03c3\u03b7 \u03b5\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b1\u03c2",
removeActionTip:"\u039a\u03b1\u03c4\u03ac\u03c1\u03b3\u03b7\u03c3\u03b7 \u03b5\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b1\u03c2"},"gxp.plugins.Styler.prototype":{menuText:"\u0395\u03c0\u03b5\u03be\u03b5\u03c1\u03b3\u03b1\u03c3\u03af\u03b1 \u03a3\u03c4\u03c5\u03bb",tooltip:"\u0395\u03c0\u03b5\u03be\u03b5\u03c1\u03b3\u03b1\u03c3\u03af\u03b1 \u03c3\u03c4\u03c5\u03bb \u03b5\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b1\u03c2"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Identify",infoActionTip:"\u03a0\u03ac\u03c1\u03c4\u03b5 \u03a0\u03bb\u03b7\u03c1\u03bf\u03c6\u03bf\u03c1\u03af\u03b5\u03c2 \u03a7\u03b1\u03c1\u03b1\u03ba\u03c4\u03b7\u03c1\u03b9\u03c3\u03c4\u03b9\u03ba\u03bf\u03cd",
popupTitle:"\u03a0\u03bb\u03b7\u03c1\u03bf\u03c6\u03bf\u03c1\u03af\u03b5\u03c2 \u03a7\u03b1\u03c1\u03b1\u03ba\u03c4\u03b7\u03c1\u03b9\u03c3\u03c4\u03b9\u03ba\u03bf\u03cd"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom Box",zoomInMenuText:"\u0396\u03bf\u03c5\u03bc \u039c\u03ad\u03c3\u03b1",zoomOutMenuText:"\u0396\u03bf\u03c5\u03bc \u0388\u03be\u03c9",zoomTooltip:"Zoom by dragging a box",zoomInTooltip:"\u0396\u03bf\u03c5\u03bc \u039c\u03ad\u03c3\u03b1",zoomOutTooltip:"\u0396\u03bf\u03c5\u03bc \u0388\u03be\u03c9"},
"gxp.plugins.ZoomToExtent.prototype":{menuText:"\u0396\u03bf\u03c5\u03bc \u03a3\u03c4\u03bf \u039c\u03ad\u03b3\u03b9\u03c3\u03c4\u03bf \u0395\u03cd\u03c1\u03bf\u03c2",tooltip:"\u0396\u03bf\u03c5\u03bc \u03a3\u03c4\u03bf \u039c\u03ad\u03b3\u03b9\u03c3\u03c4\u03bf \u0395\u03cd\u03c1\u03bf\u03c2"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"\u0396\u03bf\u03c5\u03bc \u03c3\u03c4\u03bf \u03b5\u03cd\u03c1\u03bf\u03c2 \u03b5\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b1\u03c2",tooltip:"\u0396\u03bf\u03c5\u03bc \u03c3\u03c4\u03bf \u03b5\u03cd\u03c1\u03bf\u03c2 \u03b5\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b1\u03c2"},
"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"\u0396\u03bf\u03c5\u03bc \u03c3\u03c4\u03bf \u03b5\u03cd\u03c1\u03bf\u03c2 \u03b5\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b1\u03c2",tooltip:"\u0396\u03bf\u03c5\u03bc \u03c3\u03c4\u03bf \u03b5\u03cd\u03c1\u03bf\u03c2 \u03b5\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b1\u03c2"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"\u0396\u03bf\u03c5\u03bc \u03c3\u03c4\u03b1 \u03c3\u03c5\u03b3\u03ba\u03b5\u03ba\u03c1\u03b9\u03bc\u03ad\u03bd\u03b1 \u03c7\u03b1\u03c1\u03b1\u03ba\u03c4\u03b7\u03c1\u03b9\u03c3\u03c4\u03b9\u03ba\u03ac",
tooltip:"\u0396\u03bf\u03c5\u03bc \u03c3\u03c4\u03b1 \u03c3\u03c5\u03b3\u03ba\u03b5\u03ba\u03c1\u03b9\u03bc\u03ad\u03bd\u03b1 \u03c7\u03b1\u03c1\u03b1\u03ba\u03c4\u03b7\u03c1\u03b9\u03c3\u03c4\u03b9\u03ba\u03ac"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"\u0391\u03c0\u03bf\u03b8\u03ae\u03ba\u03b5\u03c5\u03c3\u03b7 \u0391\u03bb\u03bb\u03b1\u03b3\u03ce\u03bd;",closeMsg:"\u0391\u03c5\u03c4\u03cc \u03c4\u03bf \u03c7\u03b1\u03c1\u03b1\u03ba\u03c4\u03b7\u03c1\u03b9\u03c3\u03c4\u03b9\u03ba\u03cc \u03ad\u03c7\u03b5\u03b9 \u03c4\u03c1\u03bf\u03c0\u03bf\u03c0\u03bf\u03b9\u03ae\u03c3\u03b5\u03b9\u03c2 \u03c0\u03bf\u03c5 \u03b4\u03b5\u03bd \u03ad\u03c7\u03bf\u03c5\u03bd \u03b1\u03c0\u03bf\u03b8\u03b7\u03ba\u03b5\u03c5\u03c4\u03b5\u03af. \u0398\u03ad\u03bb\u03b5\u03c4\u03b5 \u03bd\u03b1 \u03c6\u03c5\u03bb\u03ac\u03be\u03b5\u03c4\u03b5 \u03c4\u03b9\u03c2 \u03b1\u03bb\u03bb\u03b1\u03b3\u03ad\u03c2 \u03c3\u03b1\u03c2;",
deleteMsgTitle:"\u0394\u03b9\u03b1\u03b3\u03c1\u03b1\u03c6\u03ae \u03a7\u03b1\u03c1\u03b1\u03ba\u03c4\u03b7\u03c1\u03b9\u03c3\u03c4\u03b9\u03ba\u03bf\u03cd",deleteMsg:"\u0395\u03af\u03c3\u03c4\u03b5 \u03c3\u03af\u03b3\u03bf\u03c5\u03c1\u03bf\u03b9 \u03bf\u03c4\u03b9 \u03b8\u03ad\u03bb\u03b5\u03c4\u03b5 \u03bd\u03b1 \u03b4\u03b9\u03b1\u03b3\u03c1\u03ac\u03c8\u03b5\u03c4\u03b5 \u03c4\u03bf \u03c3\u03c5\u03b3\u03ba\u03b5\u03ba\u03c1\u03b9\u03bc\u03ad\u03bd\u03bf \u03c7\u03b1\u03c1\u03b1\u03ba\u03c4\u03b7\u03c1\u03b9\u03c3\u03c4\u03b9\u03ba\u03cc",
editButtonText:"\u03a4\u03c1\u03bf\u03c0\u03bf\u03c0\u03bf\u03af\u03b7\u03c3\u03b7",editButtonTooltip:"\u039a\u03ac\u03bd\u03c4\u03b5 \u03b1\u03c5\u03c4\u03cc \u03c4\u03bf \u03c7\u03b1\u03c1\u03b1\u03ba\u03c4\u03b7\u03c1\u03b9\u03c3\u03c4\u03b9\u03ba\u03cc \u03c4\u03c1\u03bf\u03c0\u03bf\u03c0\u03bf\u03b9\u03ae\u03c3\u03b9\u03bc\u03bf",deleteButtonText:"\u0394\u03b9\u03b1\u03b3\u03c1\u03b1\u03c6\u03ae",deleteButtonTooltip:"\u0394\u03b9\u03b1\u03b3\u03c1\u03ac\u03c8\u03c4\u03b5 \u03b1\u03c5\u03c4\u03cc \u03c4\u03bf \u03c7\u03b1\u03c1\u03b1\u03ba\u03c4\u03b7\u03c1\u03b9\u03c3\u03c4\u03b9\u03ba\u03cc",
cancelButtonText:"\u0391\u03ba\u03cd\u03c1\u03c9\u03c3\u03b7",cancelButtonTooltip:"\u03a3\u03c4\u03b1\u03bc\u03b1\u03c4\u03ae\u03c3\u03c4\u03b5 \u03c4\u03b7\u03bd \u03c4\u03c1\u03bf\u03c0\u03bf\u03c0\u03bf\u03af\u03b7\u03c3\u03b7, \u03b1\u03c0\u03bf\u03c1\u03c1\u03af\u03c0\u03c4\u03bf\u03bd\u03c4\u03b1\u03c2 \u03bf\u03c0\u03bf\u03b9\u03b5\u03c3\u03b4\u03ae\u03c0\u03bf\u03c4\u03b5 \u03b1\u03bb\u03bb\u03b1\u03b3\u03ad\u03c2",saveButtonText:"\u0391\u03c0\u03bf\u03b8\u03ae\u03ba\u03b5\u03c5\u03c3\u03b7",
saveButtonTooltip:"\u0391\u03c0\u03bf\u03b8\u03ae\u03ba\u03b5\u03c5\u03c3\u03b7 \u03b1\u03bb\u03bb\u03b1\u03b3\u03ce\u03bd"},"gxp.FillSymbolizer.prototype":{fillText:"\u0393\u03ad\u03bc\u03b9\u03c3\u03bc\u03b1",colorText:"\u03a7\u03c1\u03ce\u03bc\u03b1",opacityText:"\u0391\u03b4\u03b9\u03b1\u03c6\u03ac\u03bd\u03b5\u03b9\u03b1"},"gxp.FilterBuilder.prototype":{builderTypeNames:["\u03bf\u03c0\u03bf\u03b9\u03bf\u03b4\u03ae\u03c0\u03bf\u03c4\u03b5","\u03cc\u03bb\u03b1","\u03ba\u03b1\u03bd\u03ad\u03bd\u03b1",
"\u03cc\u03c7\u03b9 \u03cc\u03bb\u03b1"],preComboText:"\u03a4\u03b1\u03cd\u03c4\u03b9\u03c3\u03b7",postComboText:"\u03c4\u03c9\u03bd \u03b1\u03ba\u03cc\u03bb\u03bf\u03c5\u03b8\u03c9\u03bd:",addConditionText:"\u03c0\u03c1\u03bf\u03c3\u03b8\u03ae\u03ba\u03b7 \u03c3\u03c5\u03bd\u03b8\u03ae\u03ba\u03b7\u03c2",addGroupText:"\u03c0\u03c1\u03bf\u03c3\u03b8\u03ae\u03ba\u03b7 \u03bf\u03bc\u03ac\u03b4\u03b1\u03c2",removeConditionText:"\u03ba\u03b1\u03c4\u03ac\u03c1\u03b3\u03b7\u03c3\u03b7 \u03c3\u03c5\u03bd\u03b8\u03ae\u03ba\u03b7\u03c2"},
"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"\u038c\u03bd\u03bf\u03bc\u03b1",titleHeaderText:"\u03a4\u03af\u03c4\u03bb\u03bf\u03c2",queryableHeaderText:"\u039c\u03c0\u03bf\u03c1\u03bf\u03cd\u03bd \u03bd\u03b1 \u03b3\u03af\u03bd\u03bf\u03c5\u03bd \u03b5\u03c0\u03b5\u03c1\u03c9\u03c4\u03ae\u03c3\u03b5\u03b9\u03c2",layerSelectionLabel:"\u0394\u03b5\u03af\u03c4\u03b5 \u03b4\u03b9\u03b1\u03b8\u03ad\u03c3\u03b9\u03bc\u03b1 \u03b4\u03b5\u03b4\u03bf\u03bc\u03ad\u03bd\u03b1 \u03b1\u03c0\u03cc:",
layerAdditionLabel:"\u03ae \u03c0\u03c1\u03bf\u03c3\u03b8\u03ad\u03c3\u03c4\u03b5 \u03bd\u03ad\u03bf \u03b4\u03b9\u03b1\u03ba\u03bf\u03bc\u03b9\u03c3\u03c4\u03ae.",expanderTemplateText:"<p><b>\u03a0\u03b5\u03c1\u03b9\u03b3\u03c1\u03b1\u03c6\u03ae:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"\u03ba\u03cd\u03ba\u03bb\u03bf\u03c2",graphicSquareText:"\u03c4\u03b5\u03c4\u03c1\u03ac\u03b3\u03c9\u03bd\u03bf",graphicTriangleText:"\u03c4\u03c1\u03af\u03b3\u03c9\u03bd\u03bf",graphicStarText:"\u03b1\u03c3\u03c4\u03ad\u03c1\u03b9",
graphicCrossText:"\u03c3\u03c4\u03b1\u03c5\u03c1\u03cc\u03c2",graphicXText:"\u03c7",graphicExternalText:"\u03b5\u03be\u03c9\u03c4\u03b5\u03c1\u03b9\u03ba\u03cc",urlText:"URL",opacityText:"\u03b1\u03b4\u03b9\u03b1\u03c6\u03ac\u03bd\u03b5\u03b9\u03b1",symbolText:"\u03a3\u03cd\u03bc\u03b2\u03bf\u03bb\u03bf",sizeText:"\u0395\u03cd\u03c1\u03bf\u03c2",rotationText:"\u03a0\u03b5\u03c1\u03b9\u03c3\u03c4\u03c1\u03bf\u03c6\u03ae"},"gxp.QueryPanel.prototype":{queryByLocationText:"\u0395\u03c0\u03b5\u03c1\u03ce\u03c4\u03b7\u03c3\u03b7 \u03b2\u03ac\u03c3\u03b5\u03b9 \u03c4\u03bf\u03c0\u03bf\u03b8\u03b5\u03c3\u03af\u03b1\u03c2",
currentTextText:"\u03a4\u03c1\u03ad\u03c7\u03bf\u03bd \u03b5\u03cd\u03c1\u03bf\u03c2",queryByAttributesText:"\u0395\u03c0\u03b5\u03c1\u03ce\u03c4\u03b7\u03c3\u03b7 \u03b2\u03ac\u03c3\u03b5\u03b9 \u03c7\u03b1\u03c1\u03b1\u03ba\u03c4\u03b7\u03c1\u03b9\u03c3\u03c4\u03b9\u03ba\u03ce\u03bd",layerText:"\u0395\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b1"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} \u039a\u03bb\u03af\u03bc\u03b1\u03ba\u03b1 1:{scale}",labelFeaturesText:"\u03a7\u03b1\u03c1\u03b1\u03ba\u03c4\u03b7\u03c1\u03b9\u03c3\u03c4\u03b9\u03ba\u03ac \u0395\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b1\u03c2",
labelsText:"\u0395\u03c4\u03b9\u03ba\u03ad\u03c4\u03b5\u03c2",basicText:"\u0391\u03c0\u03bb\u03ae",advancedText:"\u03a0\u03c1\u03bf\u03b7\u03b3\u03bc\u03ad\u03bd\u03b7",limitByScaleText:"\u03a0\u03b5\u03c1\u03b9\u03bf\u03c1\u03b9\u03c3\u03bc\u03cc\u03c2 \u03b2\u03ac\u03c3\u03b5\u03b9 \u03ba\u03bb\u03af\u03bc\u03b1\u03ba\u03b1\u03c2",limitByConditionText:"\u03a0\u03b5\u03c1\u03b9\u03bf\u03c1\u03b9\u03c3\u03bc\u03cc\u03c2 \u03b2\u03ac\u03c3\u03b5\u03b9 \u03c3\u03c5\u03bd\u03b8\u03ae\u03ba\u03b7\u03c2",
symbolText:"\u03a3\u03cd\u03bc\u03b2\u03bf\u03bb\u03bf",nameText:"\u038c\u03bd\u03bf\u03bc\u03b1"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} \u039a\u03bb\u03af\u03bc\u03b1\u03ba\u03b1 1:{scale}",minScaleLimitText:"\u038c\u03c1\u03b9\u03bf \u03b5\u03bb\u03ac\u03c7\u03b9\u03c3\u03c4\u03b7\u03c2 \u03ba\u03bb\u03af\u03bc\u03b1\u03ba\u03b1\u03c2",maxScaleLimitText:"\u038c\u03c1\u03b9\u03bf \u03bc\u03ad\u03b3\u03b9\u03c3\u03c4\u03b7\u03c2 \u03ba\u03bb\u03af\u03bc\u03b1\u03ba\u03b1\u03c2"},
"gxp.StrokeSymbolizer.prototype":{solidStrokeName:"\u03c3\u03c5\u03bc\u03c0\u03b1\u03b3\u03ae\u03c2",dashStrokeName:"\u03bc\u03b5 \u03c0\u03b1\u03cd\u03bb\u03b5\u03c2",dotStrokeName:"\u03bc\u03b5 \u03ba\u03bf\u03c5\u03ba\u03af\u03b4\u03b5\u03c2",titleText:"\u03a0\u03ad\u03c1\u03b1\u03c3\u03bc\u03b1",styleText:"\u03a3\u03c4\u03cd\u03bb\u03bf",colorText:"\u03a7\u03c1\u03ce\u03bc\u03b1",widthText:"\u03a0\u03bb\u03ac\u03c4\u03bf\u03c2",opacityText:"\u0391\u03b4\u03b9\u03b1\u03c6\u03ac\u03bd\u03b5\u03b9\u03b1"},
"gxp.StylePropertiesDialog.prototype":{titleText:"\u0393\u03b5\u03bd\u03b9\u03ba\u03ac",nameFieldText:"\u038c\u03bd\u03bf\u03bc\u03b1",titleFieldText:"\u03a4\u03af\u03c4\u03bb\u03bf\u03c2",abstractFieldText:"\u03a0\u03b5\u03c1\u03af\u03bb\u03b7\u03c8\u03b7"},"gxp.TextSymbolizer.prototype":{labelValuesText:"\u03a4\u03b9\u03bc\u03ad\u03c2 \u03b5\u03c4\u03b9\u03ba\u03ad\u03c4\u03b1\u03c2",haloText:"\u03a6\u03c9\u03c4\u03bf\u03c3\u03c4\u03ad\u03c6\u03b1\u03bd\u03bf",sizeText:"\u039c\u03ad\u03b3\u03b5\u03b8\u03bf\u03c2"},
"gxp.WMSLayerPanel.prototype":{aboutText:"\u03a3\u03c7\u03b5\u03c4\u03b9\u03ba\u03ac \u03bc\u03b5",titleText:"\u03a4\u03af\u03c4\u03bb\u03bf\u03c2",nameText:"\u038c\u03bd\u03bf\u03bc\u03b1",descriptionText:"\u03a0\u03b5\u03c1\u03b9\u03b3\u03c1\u03b1\u03c6\u03ae",displayText:"\u03a0\u03c1\u03bf\u03b2\u03bf\u03bb\u03ae",opacityText:"\u0391\u03b4\u03b9\u03b1\u03c6\u03ac\u03bd\u03b5\u03b9\u03b1",formatText:"\u03a4\u03cd\u03c0\u03bf\u03c2",transparentText:"\u0394\u03b9\u03b1\u03c6\u03b1\u03bd\u03ad\u03c2",
cacheText:"Cache",cacheFieldText:"\u03a7\u03c1\u03b7\u03c3\u03b9\u03bc\u03bf\u03c0\u03bf\u03af\u03b7\u03c3\u03b5 \u03c4\u03b7\u03bd cached \u03ad\u03ba\u03b4\u03bf\u03c3\u03b7",stylesText:"\u0394\u03b9\u03b1\u03b8\u03ad\u03c3\u03b9\u03bc\u03b5\u03c2 \u03a3\u03c4\u03c5\u03bb",infoFormatText:"Info format",infoFormatEmptyText:"Select a format",displayOptionsText:"Display options",queryText:"Limit with filters",scaleText:"Limit by scale",minScaleText:"Min scale",maxScaleText:"Max scale",switchToFilterBuilderText:"Switch back to filter builder",
cqlPrefixText:"or ",cqlText:"use CQL filter instead",singleTileText:"Single tile",singleTileFieldText:"Use a single tile"},"gxp.EmbedMapDialog.prototype":{publishMessage:"\u039f \u03c7\u03ac\u03c1\u03c4\u03b7\u03c2 \u03c3\u03b1\u03c2 \u03b5\u03af\u03bd\u03b1\u03b9 \u03ad\u03c4\u03bf\u03b9\u03bc\u03bf\u03c2 \u03bd\u03b1 \u03b4\u03b7\u03bc\u03bf\u03c3\u03b9\u03b5\u03c5\u03c4\u03b5\u03af \u03c3\u03c4\u03bf \u03b4\u03b9\u03b1\u03b4\u03af\u03ba\u03c4\u03c5\u03bf! \u0391\u03c0\u03bb\u03ac \u03b1\u03bd\u03c4\u03b9\u03b3\u03c1\u03ac\u03c8\u03c4\u03b5 \u03c4\u03bf\u03bd \u03b1\u03ba\u03cc\u03bb\u03bf\u03c5\u03b8\u03bf HTML \u03ba\u03ce\u03b4\u03b9\u03ba\u03b1 \u03b3\u03b9\u03b1 \u03bd\u03b1 \u03b5\u03bd\u03c3\u03c9\u03bc\u03b1\u03c4\u03ce\u03c3\u03b5\u03c4\u03b5 \u03c4\u03bf\u03bd \u03c7\u03ac\u03c1\u03c4\u03b7 \u03c3\u03c4\u03b7\u03bd \u03b9\u03c3\u03c4\u03bf\u03c3\u03b5\u03bb\u03af\u03b4\u03b1 \u03c3\u03b1\u03c2:",
heightLabel:"\u038e\u03c8\u03bf\u03c2",widthLabel:"\u03a0\u03bb\u03ac\u03c4\u03bf\u03c2",mapSizeLabel:"\u039c\u03ad\u03b3\u03b5\u03b8\u03bf\u03c2 \u03a7\u03ac\u03c1\u03c4\u03b7",miniSizeLabel:"\u039c\u03b9\u03ba\u03c1\u03bf\u03b3\u03c1\u03b1\u03c6\u03af\u03b1",smallSizeLabel:"\u039c\u03b9\u03ba\u03c1\u03cc",premiumSizeLabel:"\u0395\u03be\u03b1\u03b9\u03c1\u03b5\u03c4\u03b9\u03ba\u03ac \u03c0\u03bf\u03b9\u03bf\u03c4\u03b9\u03ba\u03cc",largeSizeLabel:"\u039c\u03b5\u03b3\u03ac\u03bb\u03bf\u03c2"},"gxp.WMSStylesDialog.prototype":{addStyleText:"\u03a0\u03c1\u03bf\u03c3\u03b8\u03ae\u03ba\u03b7",
addStyleTip:"\u03a0\u03c1\u03bf\u03c3\u03b8\u03ae\u03ba\u03b7 \u03bd\u03ad\u03bf\u03c5 \u03c3\u03c4\u03c5\u03bb",chooseStyleText:"\u0395\u03c0\u03b9\u03bb\u03bf\u03b3\u03ae \u03c3\u03c4\u03c5\u03bb",deleteStyleText:"\u0391\u03c6\u03b1\u03af\u03c1\u03b5\u03c3\u03b7",deleteStyleTip:"\u0394\u03b9\u03b1\u03b3\u03c1\u03b1\u03c6\u03ae \u03c4\u03bf\u03c5 \u03b5\u03c0\u03b9\u03bb\u03b5\u03b3\u03bc\u03ad\u03bd\u03bf\u03c5 \u03c3\u03c4\u03c5\u03bb",editStyleText:"\u0395\u03c0\u03b5\u03be\u03b5\u03c1\u03b3\u03b1\u03c3\u03af\u03b1",
editStyleTip:"\u0395\u03c0\u03b5\u03be\u03b5\u03c1\u03b3\u03b1\u03c3\u03af\u03b1 \u03c4\u03bf\u03c5 \u03b5\u03c0\u03b9\u03bb\u03b5\u03b3\u03bc\u03ad\u03bd\u03bf\u03c5 \u03c3\u03c4\u03c5\u03bb",duplicateStyleText:"\u0394\u03b9\u03c0\u03bb\u03cc\u03c4\u03c5\u03c0\u03bf",duplicateStyleTip:"\u03a6\u03c4\u03b9\u03ac\u03be\u03c4\u03b5 \u03b4\u03b9\u03c0\u03bb\u03cc\u03c4\u03c5\u03c0\u03bf \u03c4\u03bf\u03c5 \u03b5\u03c0\u03b9\u03bb\u03b5\u03b3\u03bc\u03ad\u03bd\u03bf\u03c5 \u03c3\u03c4\u03cd\u03bb",addRuleText:"\u03a0\u03c1\u03bf\u03c3\u03b8\u03ae\u03ba\u03b7",
addRuleTip:"\u03a0\u03c1\u03bf\u03c3\u03b8\u03ae\u03ba\u03b7 \u03bd\u03ad\u03bf\u03c5 \u03ba\u03b1\u03bd\u03cc\u03bd\u03b1",newRuleText:"\u039d\u03ad\u03bf\u03c2 \u039a\u03b1\u03bd\u03cc\u03bd\u03b1\u03c2",deleteRuleText:"\u0391\u03c6\u03b1\u03af\u03c1\u03b5\u03c3\u03b7",deleteRuleTip:"\u0394\u03b9\u03b1\u03b3\u03c1\u03ac\u03c8\u03c4\u03b5 \u03c4\u03bf\u03bd \u03b5\u03c0\u03b9\u03bb\u03b5\u03b3\u03bc\u03ad\u03bd\u03bf \u03ba\u03b1\u03bd\u03cc\u03bd\u03b1",editRuleText:"\u0395\u03c0\u03b5\u03be\u03b5\u03c1\u03b3\u03b1\u03c3\u03af\u03b1",
editRuleTip:"\u0395\u03c0\u03b5\u03be\u03b5\u03c1\u03b3\u03b1\u03c3\u03c4\u03b5\u03af\u03c4\u03b5 \u03c4\u03bf\u03bd \u03b5\u03c0\u03b9\u03bb\u03b5\u03b3\u03bc\u03ad\u03bd\u03bf \u03ba\u03b1\u03bd\u03cc\u03bd\u03b1",duplicateRuleText:"\u0394\u03b9\u03c0\u03bb\u03cc\u03c4\u03c5\u03c0\u03bf",duplicateRuleTip:"\u03a6\u03c4\u03b9\u03ac\u03be\u03c4\u03b5 \u03b4\u03b9\u03c0\u03bb\u03cc\u03c4\u03c5\u03c0\u03bf \u03c4\u03bf\u03c5 \u03b5\u03c0\u03b9\u03bb\u03b5\u03b3\u03bc\u03ad\u03bd\u03bf\u03c5 \u03ba\u03b1\u03bd\u03cc\u03bd\u03b1",
cancelText:"\u0391\u03ba\u03cd\u03c1\u03c9\u03c3\u03b7",saveText:"\u0391\u03c0\u03bf\u03b8\u03ae\u03ba\u03b5\u03c5\u03c3\u03b7",styleWindowTitle:"\u03a3\u03c4\u03c5\u03bb \u03a7\u03c1\u03ae\u03c3\u03c4\u03b7: {0}",ruleWindowTitle:"\u039a\u03b1\u03bd\u03cc\u03bd\u03b5\u03c2 \u03a3\u03c4\u03c5\u03bb: {0}",stylesFieldsetTitle:"\u03a3\u03c4\u03c5\u03bb",rulesFieldsetTitle:"\u039a\u03b1\u03bd\u03cc\u03bd\u03b5\u03c2"},"gxp.LayerUploadPanel.prototype":{titleLabel:"\u03a4\u03af\u03c4\u03bb\u03bf\u03c2",
titleEmptyText:"\u03a4\u03af\u03c4\u03bb\u03bf\u03c2 \u03b5\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b1\u03c2",abstractLabel:"\u03a0\u03b5\u03c1\u03b9\u03b3\u03c1\u03b1\u03c6\u03ae",abstractEmptyText:"\u03a0\u03b5\u03c1\u03b9\u03b3\u03c1\u03b1\u03c6\u03ae \u03b5\u03c0\u03b9\u03c6\u03ac\u03bd\u03b5\u03b9\u03b1\u03c2",fileLabel:"\u0394\u03b5\u03b4\u03bf\u03bc\u03ad\u03bd\u03b1",fieldEmptyText:"\u0392\u03c1\u03b5\u03af\u03c4\u03b5 \u03c4\u03bf \u03bc\u03bf\u03bd\u03bf\u03c0\u03ac\u03c4\u03b9 \u03b3\u03b9\u03b1 \u03ad\u03bd\u03b1 \u03b1\u03c1\u03c7\u03b5\u03af\u03bf \u03b4\u03b5\u03b4\u03bf\u03bc\u03ad\u03bd\u03c9\u03bd...",
uploadText:"\u0391\u03bd\u03ad\u03b2\u03b1\u03c3\u03bc\u03b1",uploadFailedText:"Upload failed",processingUploadText:"Processing upload...",waitMsgText:"\u03a4\u03b1 \u03b4\u03b5\u03b4\u03bf\u03bc\u03ad\u03bd\u03b1 \u03c3\u03b1\u03c2 \u03b1\u03bd\u03b5\u03b2\u03b1\u03af\u03bd\u03bf\u03c5\u03bd...",invalidFileExtensionText:"\u039f \u03c4\u03cd\u03c0\u03bf\u03c2 \u03b1\u03c1\u03c7\u03b5\u03af\u03bf\u03c5 \u03c0\u03c1\u03ad\u03c0\u03b5\u03b9 \u03bd\u03b1 \u03b5\u03af\u03bd\u03b1\u03b9 \u03ad\u03bd\u03b1\u03c2 \u03b1\u03c0\u03cc \u03c4\u03bf\u03c5\u03c2: ",
optionsText:"\u0395\u03c0\u03b9\u03bb\u03bf\u03b3\u03ad\u03c2",workspaceLabel:"\u03a7\u03ce\u03c1\u03bf\u03c2 \u03b5\u03c1\u03b3\u03b1\u03c3\u03af\u03b1\u03c2",workspaceEmptyText:"\u03a0\u03c1\u03bf\u03b5\u03c0\u03b9\u03bb\u03b5\u03b3\u03bc\u03ad\u03bd\u03bf\u03c2 \u03c7\u03ce\u03c1\u03bf\u03c2 \u03b5\u03c1\u03b3\u03b1\u03c3\u03af\u03b1\u03c2",dataStoreLabel:"\u0391\u03c0\u03bf\u03b8\u03ae\u03ba\u03b7",dataStoreEmptyText:"Create new store",defaultDataStoreEmptyText:"\u03a0\u03c1\u03bf\u03b5\u03c0\u03b9\u03bb\u03b5\u03b3\u03bc\u03ad\u03bd\u03b7 \u03b1\u03c0\u03bf\u03b8\u03ae\u03ba\u03b7"},
"gxp.NewSourceWindow.prototype":{title:"\u03a0\u03c1\u03bf\u03c3\u03b8\u03ae\u03ba\u03b7 \u039d\u03ad\u03bf\u03c5 \u0394\u03b9\u03b1\u03ba\u03bf\u03bc\u03b9\u03c3\u03c4\u03ae...",cancelText:"\u0391\u03ba\u03cd\u03c1\u03c9\u03c3\u03b7",addServerText:"\u03a0\u03c1\u03bf\u03c3\u03b8\u03ae\u03ba\u03b7 \u0394\u03b9\u03b1\u03ba\u03bf\u03bc\u03b9\u03c3\u03c4\u03ae",invalidURLText:"\u0395\u03af\u03c3\u03b1\u03b3\u03b5\u03c4\u03b5 \u03ad\u03bd\u03b1 \u03ad\u03b3\u03ba\u03c5\u03c1\u03bf URL \u03b3\u03b9\u03b1 \u03ad\u03bd\u03b1 WMS endpoint (e.g. http://example.com/geoserver/wms)",
contactingServerText:"\u0395\u03c0\u03b9\u03ba\u03bf\u03b9\u03bd\u03c9\u03bd\u03af\u03b1 \u03bc\u03b5 \u0394\u03b9\u03b1\u03ba\u03bf\u03bc\u03b9\u03c3\u03c4\u03ae..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"\u0395\u03c0\u03af\u03c0\u03b5\u03b4\u03bf \u03b6\u03bf\u03c5\u03bc"},"gxp.Viewer.prototype":{saveErrorText:"Trouble saving: "},"gxp.FeedSourceDialog.prototype":{feedTypeText:"\u03a0\u03b7\u03b3\u03ae",addPicasaText:"\u03a6\u03c9\u03c4\u03bf\u03b3\u03c1\u03b1\u03c6\u03af\u03b5\u03c2 Picasa",
addYouTubeText:"YouTube \u03b2\u03af\u03bd\u03c4\u03b5\u03bf",addRSSText:"\u0386\u03bb\u03bb\u03b1 Feed GeoRSS",addFeedText:"\u03a0\u03c1\u03bf\u03c3\u03b8\u03ae\u03ba\u03b7 \u03c3\u03c4\u03bf \u03c7\u03ac\u03c1\u03c4\u03b7",addTitleText:"\u03a4\u03af\u03c4\u03bb\u03bf\u03c2",keywordText:"\u039b\u03ad\u03be\u03b7-\u03ba\u03bb\u03b5\u03b9\u03b4\u03af",doneText:"Done",titleText:"\u03a0\u03c1\u03bf\u03c3\u03b8\u03ae\u03ba\u03b7 \u03c1\u03bf\u03ae\u03c2",maxResultsText:"Max \u0395\u03af\u03b4\u03b7"}});
GeoExt.Lang.add("en",{"gxp.menu.LayerMenu.prototype":{layerText:"Layer"},"gxp.plugins.AddLayers.prototype":{addActionMenuText:"Add layers",addActionTip:"Add layers",addServerText:"Add a New Server",addButtonText:"Add layers",untitledText:"Untitled",addLayerSourceErrorText:"Error getting WMS capabilities ({msg}).\nPlease check the url and try again.",availableLayersText:"Available Layers",expanderTemplateText:"<p><b>Abstract:</b> {abstract}</p>",panelTitleText:"Title",layerSelectionText:"View available data from:",
doneText:"Done",uploadText:"Upload layers",addFeedActionMenuText:"Add feeds",searchText:"Search for layers"},"gxp.plugins.BingSource.prototype":{title:"Bing Layers",roadTitle:"Bing Roads",aerialTitle:"Bing Aerial",labeledAerialTitle:"Bing Aerial With Labels"},"gxp.plugins.FeatureEditor.prototype":{splitButtonText:"Edit",createFeatureActionText:"Create",editFeatureActionText:"Modify",createFeatureActionTip:"Create a new feature",editFeatureActionTip:"Edit existing feature",commitTitle:"Commit message",
commitText:"Please enter a commit message for this edit:"},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"Display on map",firstPageTip:"First page",previousPageTip:"Previous page",zoomPageExtentTip:"Zoom to page extent",nextPageTip:"Next page",lastPageTip:"Last page",totalMsg:"Features {1} to {2} of {0}"},"gxp.plugins.GoogleEarth.prototype":{menuText:"3D Viewer",tooltip:"Switch to 3D Viewer"},"gxp.plugins.GoogleSource.prototype":{title:"Google Layers",roadmapAbstract:"Show street map",satelliteAbstract:"Show satellite imagery",
hybridAbstract:"Show imagery with street names",terrainAbstract:"Show street map with terrain"},"gxp.plugins.LayerProperties.prototype":{menuText:"Layer Properties",toolTip:"Layer Properties"},"gxp.plugins.LayerTree.prototype":{shortTitle:"Layers",rootNodeText:"Layers",overlayNodeText:"Overlays",baseNodeText:"Base Layers"},"gxp.plugins.LayerManager.prototype":{baseNodeText:"Base Maps"},"gxp.plugins.Legend.prototype":{menuText:"Show legend",tooltip:"Show legend"},"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:"Loading map..."},
"gxp.plugins.MapBoxSource.prototype":{title:"MapBox Layers",blueMarbleTopoBathyJanTitle:"Blue Marble Topography & Bathymetry (January)",blueMarbleTopoBathyJulTitle:"Blue Marble Topography & Bathymetry (July)",blueMarbleTopoJanTitle:"Blue Marble Topography (January)",blueMarbleTopoJulTitle:"Blue Marble Topography (July)",controlRoomTitle:"Control Room",geographyClassTitle:"Geography Class",naturalEarthHypsoTitle:"Natural Earth Hypsometric",naturalEarthHypsoBathyTitle:"Natural Earth Hypsometric & Bathymetry",
naturalEarth1Title:"Natural Earth I",naturalEarth2Title:"Natural Earth II",worldDarkTitle:"World Dark",worldLightTitle:"World Light",worldPrintTitle:"World Print"},"gxp.plugins.Measure.prototype":{buttonText:"Measure",lengthMenuText:"Length",areaMenuText:"Area",lengthTooltip:"Measure length",areaTooltip:"Measure area",measureTooltip:"Measure"},"gxp.plugins.Navigation.prototype":{menuText:"Pan map",tooltip:"Pan map"},"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"Zoom to previous extent",
nextMenuText:"Zoom to next extent",previousTooltip:"Zoom to previous extent",nextTooltip:"Zoom to next extent"},"gxp.plugins.OSMSource.prototype":{title:"OpenStreetMap Layers",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},"gxp.plugins.Print.prototype":{buttonText:"Print",menuText:"Print map",tooltip:"Print map",previewText:"Print Preview",notAllNotPrintableText:"Not All Layers Can Be Printed",
nonePrintableText:"None of your current map layers can be printed"},"gxp.plugins.MapQuestSource.prototype":{title:"MapQuest Layers",osmAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",
naipTitle:"MapQuest Imagery"},"gxp.plugins.QueryForm.prototype":{queryActionText:"Query",queryMenuText:"Query layer",queryActionTip:"Query the selected layer",queryByLocationText:"Query by current map extent",queryByAttributesText:"Query by attributes",queryMsg:"Querying...",cancelButtonText:"Cancel",noFeaturesTitle:"No Match",noFeaturesMessage:"Your query did not return any results."},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"Remove layer",removeActionTip:"Remove layer"},"gxp.plugins.Styler.prototype":{menuText:"Layer Styles",
tooltip:"Layer Styles"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Identify",infoActionTip:"Get Feature Info",popupTitle:"Feature Info"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom box",zoomInMenuText:"Zoom in",zoomOutMenuText:"Zoom out",zoomTooltip:"Zoom by dragging a box",zoomInTooltip:"Zoom in",zoomOutTooltip:"Zoom out"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"Zoom to max extent",tooltip:"Zoom to max extent"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"Zoom to layer extent",
tooltip:"Zoom to layer extent"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"Zoom to layer extent",tooltip:"Zoom to layer extent"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"Zoom to selected features",tooltip:"Zoom to selected features"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"Save Changes?",closeMsg:"This feature has unsaved changes. Would you like to save your changes?",deleteMsgTitle:"Delete Feature?",deleteMsg:"Are you sure you want to delete this feature?",editButtonText:"Edit",
editButtonTooltip:"Make this feature editable",deleteButtonText:"Delete",deleteButtonTooltip:"Delete this feature",cancelButtonText:"Cancel",cancelButtonTooltip:"Stop editing, discard changes",saveButtonText:"Save",saveButtonTooltip:"Save changes"},"gxp.FillSymbolizer.prototype":{fillText:"Fill",colorText:"Color",opacityText:"Opacity"},"gxp.FilterBuilder.prototype":{builderTypeNames:["any","all","none","not all"],preComboText:"Match",postComboText:"of the following:",addConditionText:"add condition",
addGroupText:"add group",removeConditionText:"remove condition"},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"Name",titleHeaderText:"Title",queryableHeaderText:"Queryable",layerSelectionLabel:"View available data from:",layerAdditionLabel:"or add a new server.",expanderTemplateText:"<p><b>Abstract:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"Circle",graphicSquareText:"Square",graphicTriangleText:"Triangle",graphicStarText:"Star",graphicCrossText:"Cross",graphicXText:"X",
graphicExternalText:"External",urlText:"URL",opacityText:"Opacity",symbolText:"Symbol",sizeText:"Size",rotationText:"Rotation"},"gxp.QueryPanel.prototype":{queryByLocationText:"Query by location",currentTextText:"Current extent",queryByAttributesText:"Query by attributes",layerText:"Layer"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} Scale 1:{scale}",labelFeaturesText:"Label Features",labelsText:"Labels",basicText:"Basic",advancedText:"Advanced",limitByScaleText:"Limit by scale",limitByConditionText:"Limit by condition",
symbolText:"Symbol",nameText:"Name"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} Scale 1:{scale}",minScaleLimitText:"Min scale limit",maxScaleLimitText:"Max scale limit"},"gxp.StrokeSymbolizer.prototype":{solidStrokeName:"Solid",dashStrokeName:"Dash",dotStrokeName:"Dot",titleText:"Stroke",styleText:"Style",colorText:"Color",widthText:"Width (px)",opacityText:"Opacity"},"gxp.StylePropertiesDialog.prototype":{titleText:"General",nameFieldText:"Name",titleFieldText:"Title",abstractFieldText:"Abstract"},
"gxp.TextSymbolizer.prototype":{labelValuesText:"Label values",haloText:"Halo",sizeText:"Size"},"gxp.WMSLayerPanel.prototype":{attributionText:"Attribution",aboutText:"About",titleText:"Title",nameText:"Name",descriptionText:"Description",displayText:"Display",opacityText:"Opacity",formatText:"Format",transparentText:"Transparent",cacheText:"Cache",cacheFieldText:"Use cached version",stylesText:"Available Styles",infoFormatText:"Info format",infoFormatEmptyText:"Select a format",displayOptionsText:"Display options",
queryText:"Limit with filters",scaleText:"Limit by scale",minScaleText:"Min scale",maxScaleText:"Max scale",switchToFilterBuilderText:"Switch back to filter builder",cqlPrefixText:"or ",cqlText:"use CQL filter instead",singleTileText:"Single tile",singleTileFieldText:"Use a single tile"},"gxp.EmbedMapDialog.prototype":{publishMessage:"Your map is ready to be published to the web! Simply copy the following HTML to embed the map in your website:",heightLabel:"Height",widthLabel:"Width",mapSizeLabel:"Map Size",
miniSizeLabel:"Mini",smallSizeLabel:"Small",premiumSizeLabel:"Premium",largeSizeLabel:"Large"},"gxp.StylesDialog.prototype":{addStyleText:"Add",addStyleTip:"Add a new style",chooseStyleText:"Choose style",deleteStyleText:"Remove",deleteStyleTip:"Delete the selected style",editStyleText:"Edit",editStyleTip:"Edit the selected style",duplicateStyleText:"Duplicate",duplicateStyleTip:"Duplicate the selected style",addRuleText:"Add",addRuleTip:"Add a new rule",newRuleText:"New Rule",deleteRuleText:"Remove",
deleteRuleTip:"Delete the selected rule",editRuleText:"Edit",editRuleTip:"Edit the selected rule",duplicateRuleText:"Duplicate",duplicateRuleTip:"Duplicate the selected rule",cancelText:"Cancel",saveText:"Save",styleWindowTitle:"User Style: {0}",ruleWindowTitle:"Style Rule: {0}",stylesFieldsetTitle:"Styles",rulesFieldsetTitle:"Rules"},"gxp.LayerUploadPanel.prototype":{titleLabel:"Title",titleEmptyText:"Layer title",abstractLabel:"Description",abstractEmptyText:"Layer description",fileLabel:"Data",
fieldEmptyText:"Browse for data archive...",uploadText:"Upload",uploadFailedText:"Upload failed",processingUploadText:"Processing upload...",waitMsgText:"Uploading your data...",invalidFileExtensionText:"File extension must be one of: ",optionsText:"Options",workspaceLabel:"Workspace",workspaceEmptyText:"Default workspace",dataStoreLabel:"Store",dataStoreEmptyText:"Choose a store",dataStoreNewText:"Create new store",crsLabel:"CRS",crsEmptyText:"Coordinate Reference System ID",invalidCrsText:"CRS identifier should be an EPSG code (e.g. EPSG:4326)"},
"gxp.NewSourceDialog.prototype":{title:"Add new server...",cancelText:"Cancel",addServerText:"Add Server",invalidURLText:"Enter a valid URL to a WMS endpoint (e.g. http://example.com/geoserver/wms)",contactingServerText:"Contacting Server..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"Zoom level"},"gxp.Viewer.prototype":{saveErrorText:"Trouble saving: "},"gxp.FeedSourceDialog.prototype":{feedTypeText:"Source",addPicasaText:"Picasa Photos",addYouTubeText:"YouTube Videos",addRSSText:"Other GeoRSS Feed",
addFeedText:"Add to Map",addTitleText:"Title",keywordText:"Keyword",doneText:"Done",titleText:"Add Feeds",maxResultsText:"Max Items"}});
GeoExt.Lang.add("es",{"gxp.menu.LayerMenu.prototype":{layerText:"Capa"},"gxp.plugins.AddLayers.prototype":{addActionMenuText:"A\u00f1adir Capas",addActionTip:"A\u00f1adir Capas",addServerText:"A\u00f1adir servidor",addButtonText:"A\u00f1adir Capas",untitledText:"Sin T\u00edtulo",addLayerSourceErrorText:"Error obteniendo capabilities de WMS ({msg}).\nPor favor, compruebe la URL y vuelva a intentarlo.",availableLayersText:"Capas disponibles",expanderTemplateText:"<p><b>Resumen:</b> {abstract}</p>",
panelTitleText:"T\u00edtulo",layerSelectionText:"Ver datos disponibles de:",doneText:"Hecho",uploadText:"Subir Datos",addFeedActionMenuText:"Add feeds",searchText:"Search for layers"},"gxp.plugins.BingSource.prototype":{title:"Capas Bing",roadTitle:"Bing Carreteras",aerialTitle:"Bing Foto A\u00e9rea",labeledAerialTitle:"Bing H\u00edbrido"},"gxp.plugins.FeatureEditor.prototype":{splitButtonText:"Edit",createFeatureActionText:"Create",editFeatureActionText:"Modify",createFeatureActionTip:"Crear nuevo elemento",
editFeatureActionTip:"Editar elemento existente",commitTitle:"Commit message",commitText:"Please enter a commit message for this edit:"},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"Mostrar en el mapa",firstPageTip:"Primera p\u00e1gina",previousPageTip:"P\u00e1gina anterior",zoomPageExtentTip:"Zoom a la extensi\u00f3n de la p\u00e1gina",nextPageTip:"P\u00e1gina siguiente",lastPageTip:"\u00daltima p\u00e1gina",totalMsg:"Features {1} to {2} of {0}"},"gxp.plugins.GoogleEarth.prototype":{menuText:"Vista 3D",
tooltip:"Vista 3D"},"gxp.plugins.GoogleSource.prototype":{title:"Capas Google",roadmapAbstract:"Mostrar Callejero",satelliteAbstract:"Mostrar im\u00e1genes a\u00e9reas",hybridAbstract:"Mostrar im\u00e1genes con nombres de calle",terrainAbstract:"Mostrar callejero con terreno"},"gxp.plugins.LayerProperties.prototype":{menuText:"Propiedades de la capa",toolTip:"Propiedades de la capa"},"gxp.plugins.LayerTree.prototype":{shortTitle:"Capas",rootNodeText:"Capas",overlayNodeText:"Capas superpuestas",baseNodeText:"Capa base"},
"gxp.plugins.LayerManager.prototype":{baseNodeText:"Capa base"},"gxp.plugins.Legend.prototype":{menuText:"Leyenda",tooltip:"Leyenda"},"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:"Loading Map..."},"gxp.plugins.MapBoxSource.prototype":{title:"MapBox Layers",blueMarbleTopoBathyJanTitle:"Blue Marble Topography & Bathymetry (January)",blueMarbleTopoBathyJulTitle:"Blue Marble Topography & Bathymetry (July)",blueMarbleTopoJanTitle:"Blue Marble Topography (January)",blueMarbleTopoJulTitle:"Blue Marble Topography (July)",
controlRoomTitle:"Control Room",geographyClassTitle:"Geography Class",naturalEarthHypsoTitle:"Natural Earth Hypsometric",naturalEarthHypsoBathyTitle:"Natural Earth Hypsometric & Bathymetry",naturalEarth1Title:"Natural Earth I",naturalEarth2Title:"Natural Earth II",worldDarkTitle:"World Dark",worldLightTitle:"World Light",worldPrintTitle:"World Print"},"gxp.plugins.Measure.prototype":{buttonText:"Medir",lengthMenuText:"Longitud",areaMenuText:"\u00c1rea",lengthTooltip:"Medir Longitud",areaTooltip:"Medir \u00c1rea",
measureTooltip:"Medir"},"gxp.plugins.Navigation.prototype":{menuText:"Desplazar mapa",tooltip:"Desplazar mapa"},"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"Vista anterior",nextMenuText:"Vista siguiente",previousTooltip:"Vista anterior",nextTooltip:"Vista siguiente"},"gxp.plugins.OSMSource.prototype":{title:"Capas OpenStreetMap",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Datos CC-By-SA de <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},
"gxp.plugins.Print.prototype":{buttonText:"Imprimir",menuText:"Imprimir mapa",tooltip:"Imprimir mapa",previewText:"Vista previa",notAllNotPrintableText:"No se pueden imprimir todas las capas",nonePrintableText:"No se puede imprimir ninguna de las capas del mapa"},"gxp.plugins.MapQuestSource.prototype":{title:"Capas MapQuest",osmAttribution:"Teselas cortes\u00eda de <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",
osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Teselas cortes\u00eda de <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:"MapQuest Im\u00e1genes"},"gxp.plugins.QueryForm.prototype":{queryActionText:"Consultar",queryMenuText:"Consultar capa",queryActionTip:"Consultar la capa seleccionada",queryByLocationText:"Query by current map extent",queryByAttributesText:"Consultar por atributos",queryMsg:"Consultando...",
cancelButtonText:"Cancelar",noFeaturesTitle:"Sin coincidencias",noFeaturesMessage:"Su consulta no produjo resultados."},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"Eliminar Capa",removeActionTip:"Eliminar Capa"},"gxp.plugins.Styler.prototype":{menuText:"Editar estilos",tooltip:"Gestionar estilos de capa"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Identify",infoActionTip:"Consultar elementos",popupTitle:"Informaci\u00f3n de elementos"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom Box",
zoomInMenuText:"Acercar",zoomOutMenuText:"Alejar",zoomTooltip:"Zoom by dragging a box",zoomInTooltip:"Acercar",zoomOutTooltip:"Alejar"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"Ver extensi\u00f3n total",tooltip:"Ver extensi\u00f3n total"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"Ver toda la capa",tooltip:"Ver toda la capa"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"Ver toda la la capa",tooltip:"Ver toda la capa"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"Ver los elementos seleccionados",
tooltip:"Ver los elementos seleccionados"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"\u00bfDesea guardar los cambios?",closeMsg:"Los cambios en este elemento no se han guardado. \u00bfDesea guardar los cambios?",deleteMsgTitle:"\u00bfDesea borrar el elemento?",deleteMsg:"\u00bfEst\u00e1 seguro de querer borrar este elemento?",editButtonText:"Editar",editButtonTooltip:"Hacer editable este elemento",deleteButtonText:"Borrar",deleteButtonTooltip:"Borrar este elemento",cancelButtonText:"Cancelar",
cancelButtonTooltip:"Dejar de editar, descartar cambios",saveButtonText:"Guardar",saveButtonTooltip:"Guardar cambios"},"gxp.FillSymbolizer.prototype":{fillText:"Relleno",colorText:"Color",opacityText:"Opacidad"},"gxp.FilterBuilder.prototype":{builderTypeNames:["cualquiera de","todas","ninguna de","no todas"],preComboText:"Cumplir",postComboText:"las condiciones siguientes:",addConditionText:"a\u00f1adir condici\u00f3n",addGroupText:"a\u00f1adir grupo",removeConditionText:"eliminar condici\u00f3n"},
"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"Nombre",titleHeaderText:"T\u00edtulo",queryableHeaderText:"Consultable",layerSelectionLabel:"Ver datos disponibles de:",layerAdditionLabel:"o a\u00f1adir otro servidor.",expanderTemplateText:"<p><b>Resumen:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"c\u00edrculo",graphicSquareText:"cuadrado",graphicTriangleText:"tri\u00e1ngulo",graphicStarText:"estrella",graphicCrossText:"cruz",graphicXText:"x",graphicExternalText:"externo",
urlText:"URL",opacityText:"opacidad",symbolText:"S\u00edmbolo",sizeText:"Tama\u00f1o",rotationText:"Giro"},"gxp.QueryPanel.prototype":{queryByLocationText:"Consultar por localizaci\u00f3n",currentTextText:"Extensi\u00f3n actual",queryByAttributesText:"Consultar por atributo",layerText:"Capa"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} Escala 1:{scale}",labelFeaturesText:"Etiquetado de elementos",labelsText:"Etiquetas",basicText:"B\u00e1sico",advancedText:"Advanzado",limitByScaleText:"Limitar por escala",
limitByConditionText:"Limitar por condici\u00f3n",symbolText:"S\u00edmbolo",nameText:"Nombre"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} Escala 1:{scale}",minScaleLimitText:"Escala m\u00ednima",maxScaleLimitText:"Escala m\u00e1xima"},"gxp.StrokeSymbolizer.prototype":{solidStrokeName:"continuo",dashStrokeName:"guiones",dotStrokeName:"puntos",titleText:"Trazo",styleText:"Estilo",colorText:"Color",widthText:"Ancho",opacityText:"Opacidad"},"gxp.StylePropertiesDialog.prototype":{titleText:"General",
nameFieldText:"Nombre",titleFieldText:"T\u00edtulo",abstractFieldText:"Resumen"},"gxp.TextSymbolizer.prototype":{labelValuesText:"Etiquetado",haloText:"Halo",sizeText:"Tama\u00f1o"},"gxp.WMSLayerPanel.prototype":{attributionText:"Attribution",aboutText:"Acerca de",titleText:"T\u00edtulo",nameText:"Nombre",descriptionText:"Descripci\u00f3n",displayText:"Mostrar",opacityText:"Opacidad",formatText:"Formato",transparentText:"Transparente",cacheText:"Cach\u00e9",cacheFieldText:"Usar la versi\u00f3n en cach\u00e9",
stylesText:"Estilos disponibles",infoFormatText:"Info format",infoFormatEmptyText:"Select a format",displayOptionsText:"Display options",queryText:"Limit with filters",scaleText:"Limit by scale",minScaleText:"Min scale",maxScaleText:"Max scale",switchToFilterBuilderText:"Switch back to filter builder",cqlPrefixText:"or ",cqlText:"use CQL filter instead",singleTileText:"Single tile",singleTileFieldText:"Use a single tile"},"gxp.EmbedMapDialog.prototype":{publishMessage:"\u00a1Ya puede publicar su mapa en otras webs! Simplemente copie el siguiente c\u00f3digo HTML en el lugar donde desee incrustarlo:",
heightLabel:"Alto",widthLabel:"Ancho",mapSizeLabel:"Tama\u00f1o",miniSizeLabel:"M\u00ednimo",smallSizeLabel:"Peque\u00f1o",premiumSizeLabel:"Premium",largeSizeLabel:"Grande"},"gxp.WMSStylesDialog.prototype":{addStyleText:"A\u00f1adir",addStyleTip:"A\u00f1adir un estilo",chooseStyleText:"Escoger estilo",deleteStyleText:"Quitar",deleteStyleTip:"Borrar el estilo seleccionado",editStyleText:"Cambiar",editStyleTip:"Editar el estilo seleccionado",duplicateStyleText:"Clonar",duplicateStyleTip:"Duplicar el estilo seleccionado",
addRuleText:"A\u00f1adir",addRuleTip:"A\u00f1adir una regla",newRuleText:"Nueva regla",deleteRuleText:"Quitar",deleteRuleTip:"Borrar la regla seleccionada",editRuleText:"Cambiar",editRuleTip:"Editar la regla seleccionada",duplicateRuleText:"Duplicar",duplicateRuleTip:"Duplicar la regla seleccionada",cancelText:"Cancelar",saveText:"Guardar",styleWindowTitle:"Estilo: {0}",ruleWindowTitle:"Regla: {0}",stylesFieldsetTitle:"Estilos",rulesFieldsetTitle:"Reglas"},"gxp.LayerUploadPanel.prototype":{titleLabel:"T\u00edtulo",
titleEmptyText:"T\u00edtulo de la capa",abstractLabel:"Descripci\u00f3n",abstractEmptyText:"Descripci\u00f3n de la capa",fileLabel:"Datos",fieldEmptyText:"Navegue por los datos...",uploadText:"Subir",uploadFailedText:"Upload failed",processingUploadText:"Processing upload...",waitMsgText:"Suba sus datos data...",invalidFileExtensionText:"El fichero debe tener alguna de estas extensiones: ",optionsText:"Opciones",workspaceLabel:"Espacio de trabajo",workspaceEmptyText:"Espacio de trabajo por defecto",
dataStoreLabel:"Almac\u00e9n de datos",dataStoreEmptyText:"Create new store",defaultDataStoreEmptyText:"Almac\u00e9n de datos por defecto"},"gxp.NewSourceDialog.prototype":{title:"A\u00f1adir Servidor...",cancelText:"Cancelar",addServerText:"A\u00f1adir Servidor",invalidURLText:"Enter a valid URL to a WMS endpoint (e.g. http://example.com/geoserver/wms)",contactingServerText:"Conectando con el Servidor..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"Escala"},"gxp.Viewer.prototype":{saveErrorText:"Problemas guardando: "},
"gxp.FeedSourceDialog.prototype":{feedTypeText:"Fuente",addPicasaText:"Picasa fotos",addYouTubeText:"YouTube Videos",addRSSText:"Feed GeoRSS Otro",addFeedText:"Agregar al Mapa",addTitleText:"T\u00edtulo",keywordText:"Palabra clave",doneText:"Hecho",titleText:"Agregar Feeds",maxResultsText:"Productos Max"}});
GeoExt.Lang.add("fr",{"gxp.plugins.AddLayers.prototype":{addActionMenuText:"Ajouter des calques",addActionTip:"Ajouter des calques",addServerText:"Ajouter un nouveau serveur",untitledText:"Sans titre",addLayerSourceErrorText:"Impossible d'obtenir les capacit\u00e9s WMS ({msg}).\nVeuillez v\u00e9rifier l'URL et essayez \u00e0 nouveau.",availableLayersText:"Couches disponibles",doneText:"Termin\u00e9",uploadText:"T\u00e9l\u00e9charger des donn\u00e9es",addFeedActionMenuText:"Add feeds",searchText:"Search for layers"},
"gxp.plugins.BingSource.prototype":{title:"Calques Bing",roadTitle:"Bing routes",aerialTitle:"Bing images a\u00e9riennes",labeledAerialTitle:"Bing images a\u00e9riennes avec \u00e9tiquettes"},"gxp.plugins.FeatureEditor.prototype":{splitButtonText:"Edit",createFeatureActionText:"Create",editFeatureActionText:"Modify",createFeatureActionTip:"Cr\u00e9er un nouvel objet",editFeatureActionTip:"Modifier un objet existant",commitTitle:"Commit message",commitText:"Please enter a commit message for this edit:"},
"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"Afficher sur la carte",firstPageTip:"Premi\u00e8re page",previousPageTip:"Page pr\u00e9c\u00e9dente",zoomPageExtentTip:"Zoom sur la page",nextPageTip:"Page suivante",lastPageTip:"Derni\u00e8re page",totalMsg:"Features {1} to {2} of {0}"},"gxp.plugins.GoogleEarth.prototype":{menuText:"Passer \u00e0 la visionneuse 3D",tooltip:"Passer \u00e0 la visionneuse 3D"},"gxp.plugins.GoogleSource.prototype":{title:"Calques Google",roadmapAbstract:"Carte routi\u00e8re",
satelliteAbstract:"Images satellite",hybridAbstract:"Images avec routes",terrainAbstract:"Carte routi\u00e8re avec le terrain"},"gxp.plugins.LayerProperties.prototype":{menuText:"Propri\u00e9t\u00e9s de la couche",toolTip:"Afficher les propri\u00e9t\u00e9s de la couche"},"gxp.plugins.LayerTree.prototype":{shortTitle:"Layers",rootNodeText:"Layers",overlayNodeText:"Surimpressions",baseNodeText:"Couches"},"gxp.plugins.LayerManager.prototype":{baseNodeText:"Couche"},"gxp.plugins.Legend.prototype":{menuText:"L\u00e9gende",
tooltip:"Afficher la l\u00e9gende"},"gxp.plugins.Measure.prototype":{buttonText:"Mesure",lengthMenuText:"Longueur",areaMenuText:"Surface",lengthTooltip:"Mesurer une longueur",areaTooltip:"Mesurer une surface",measureTooltip:"Mesurer"},"gxp.plugins.Navigation.prototype":{menuText:"Panner",tooltip:"Faire glisser la carte"},"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"Position pr\u00e9c\u00e9dente",nextMenuText:"Position suivante",previousTooltip:"Retourner \u00e0 la position pr\u00e9c\u00e9dente",
nextTooltip:"Aller \u00e0 la position suivante"},"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:"Chargement de la carte..."},"gxp.plugins.MapBoxSource.prototype":{title:"MapBox Layers",blueMarbleTopoBathyJanTitle:"Blue Marble Topography & Bathymetry (January)",blueMarbleTopoBathyJulTitle:"Blue Marble Topography & Bathymetry (July)",blueMarbleTopoJanTitle:"Blue Marble Topography (January)",blueMarbleTopoJulTitle:"Blue Marble Topography (July)",controlRoomTitle:"Control Room",geographyClassTitle:"Geography Class",
naturalEarthHypsoTitle:"Natural Earth Hypsometric",naturalEarthHypsoBathyTitle:"Natural Earth Hypsometric & Bathymetry",naturalEarth1Title:"Natural Earth I",naturalEarth2Title:"Natural Earth II",worldDarkTitle:"World Dark",worldLightTitle:"World Light",worldPrintTitle:"World Print"},"gxp.plugins.OSMSource.prototype":{title:"Calques OpenStreetMap",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Donn\u00e9es CC-By-SA par <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},
"gxp.plugins.Print.prototype":{buttonText:"Imprimer",menuText:"Imprimer la carte",tooltip:"Imprimer la carte",previewText:"Aper\u00e7u avant impression",notAllNotPrintableText:"Non, toutes les couches peuvent \u00eatre imprim\u00e9es",nonePrintableText:"Aucune de vos couches ne peut \u00eatre imprim\u00e9e"},"gxp.plugins.MapQuestSource.prototype":{title:"MapQuest Layers",osmAttribution:"Avec la permission de tuiles <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",
osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Avec la permission de tuiles <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:"MapQuest Imagery"},"gxp.plugins.QueryForm.prototype":{queryActionText:"Interrogation",queryMenuText:"Couche de requ\u00eates",queryActionTip:"Interroger la couche s\u00e9lectionn\u00e9e",queryByLocationText:"Query by current map extent",queryByAttributesText:"Requ\u00eate par attributs"},
"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"Enlever la couche",removeActionTip:"Enlever la couche"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Identify",infoActionTip:"Get Feature Info",popupTitle:"Info sur l'objet"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom Box",zoomInMenuText:"Zoom avant",zoomOutMenuText:"Zoom arri\u00e8re",zoomTooltip:"Zoomer en dessinant un rectangle",zoomInTooltip:"Zoomer",zoomOutTooltip:"D\u00e9zoomer"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"Zoomer sur la carte max",
tooltip:"Zoomer sur la carte max"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"Zoomer sur la couche",tooltip:"Zoomer sur la couche"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"Zoomer sur la couche",tooltip:"Zoomer sur la couche"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"Zoomer sur les objets s\u00e9lectionn\u00e9s",tooltip:"Zoomer sur les objets s\u00e9lectionn\u00e9s"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"Enregistrer les modifications ?",closeMsg:"Cet objet a des modifications non enregistr\u00e9es. Voulez-vous enregistrer vos modifications ?",
deleteMsgTitle:"Supprimer l'objet ?",deleteMsg:"Etes-vous s\u00fbr de vouloir supprimer cet objet ?",editButtonText:"Modifier",editButtonTooltip:"Modifier cet objet",deleteButtonText:"Supprimer",deleteButtonTooltip:"Supprimer cet objet",cancelButtonText:"Annuler",cancelButtonTooltip:"Arr\u00eater de modifier, annuler les modifications",saveButtonText:"Enregistrer",saveButtonTooltip:"Enregistrer les modifications"},"gxp.FillSymbolizer.prototype":{fillText:"Remplir",colorText:"Couleur",opacityText:"Opacit\u00e9"},
"gxp.FilterBuilder.prototype":{builderTypeNames:["Tout","tous","aucun","pas tout"],preComboText:"Match",postComboText:"de ce qui suit:",addConditionText:"Ajouter la condition",addGroupText:"Ajouter un groupe",removeConditionText:"Supprimer la condition"},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"Nom",titleHeaderText:"Titre",queryableHeaderText:"Interrogeable",layerSelectionLabel:"Voir les donn\u00e9es disponibles \u00e0 partir de :",layerAdditionLabel:"ou ajouter un nouveau serveur.",
expanderTemplateText:"<p><b>R\u00e9sum\u00e9:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"Cercle",graphicSquareText:"Carr\u00e9",graphicTriangleText:"Triangle",graphicStarText:"\u00c9toile",graphicCrossText:"Croix",graphicXText:"x",graphicExternalText:"Externe",urlText:"URL",opacityText:"Opacit\u00e9",symbolText:"Symbole",sizeText:"Taille",rotationText:"Rotation"},"gxp.QueryPanel.prototype":{queryByLocationText:"Interrogation selon le lieu",currentTextText:"Mesure actuelle",
queryByAttributesText:"Requ\u00eate par attributs",layerText:"Calque"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} \u00e9chelle 1:{scale}",labelFeaturesText:"Label Caract\u00e9ristiques",advancedText:"Avanc\u00e9",limitByScaleText:"Limiter par l'\u00e9chelle",limitByConditionText:"Limiter par condition",symbolText:"Symbole",nameText:"Nom"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} \u00e9chelle 1:{scale}",maxScaleLimitText:"\u00c9chelle maximale"},"gxp.TextSymbolizer.prototype":{labelValuesText:"Label valeurs",
haloText:"Halo",sizeText:"Taille"},"gxp.WMSLayerPanel.prototype":{attributionText:"Attribution",aboutText:"A propos",titleText:"Titre",nameText:"Nom",descriptionText:"Description",displayText:"Affichage",opacityText:"Opacit\u00e9",formatText:"Format",transparentText:"Transparent",cacheText:"Cache",cacheFieldText:"Utiliser la version mise en cache",stylesText:"Available styles",infoFormatText:"Info format",infoFormatEmptyText:"Choisissez un format",displayOptionsText:"Display options",queryText:"Limit with filters",
scaleText:"Limit by scale",minScaleText:"Min scale",maxScaleText:"Max scale",switchToFilterBuilderText:"Switch back to filter builder",cqlPrefixText:"or ",cqlText:"use CQL filter instead",singleTileText:"Single tile",singleTileFieldText:"Use a single tile"},"gxp.EmbedMapDialog.prototype":{publishMessage:"Votre carte est pr\u00eate \u00e0 \u00eatre publi\u00e9e sur le web. Il suffit de copier le code HTML suivant pour int\u00e9grer la carte dans votre site Web :",heightLabel:"Hauteur",widthLabel:"Largeur",
mapSizeLabel:"Taille de la carte",miniSizeLabel:"Mini",smallSizeLabel:"Petit",premiumSizeLabel:"Premium",largeSizeLabel:"Large"},"gxp.LayerUploadPanel.prototype":{titleLabel:"Titre",titleEmptyText:"Titre de la couche",abstractLabel:"Description",abstractEmptyText:"Description couche",fileLabel:"Donn\u00e9es",fieldEmptyText:"Parcourir pour ...",uploadText:"Upload",uploadFailedText:"Upload failed",processingUploadText:"Processing upload...",waitMsgText:"Transfert de vos donn\u00e9es ...",invalidFileExtensionText:"L'extension du fichier doit \u00eatre : ",
optionsText:"Options",workspaceLabel:"Espace de travail",workspaceEmptyText:"Espace de travail par d\u00e9faut",dataStoreLabel:"Magasin de donn\u00e9es",dataStoreEmptyText:"Create new store",defaultDataStoreEmptyText:"Magasin de donn\u00e9es par d\u00e9faut"},"gxp.NewSourceDialog.prototype":{title:"Ajouter un nouveau serveur...",cancelText:"Annuler",addServerText:"Ajouter un serveur",invalidURLText:"Indiquez l'URL valide d'un serveur WMS (e.g. http://example.com/geoserver/wms)",contactingServerText:"Interrogation du serveur..."},
"gxp.ScaleOverlay.prototype":{zoomLevelText:"Niveau de zoom"},"gxp.Viewer.prototype":{saveErrorText:"Sauver Trouble: "},"gxp.FeedSourceDialog.prototype":{feedTypeText:"Source",addPicasaText:"Picasa Photos",addYouTubeText:"YouTube Vid\u00e9os",addRSSText:"GeoRSS Autre",addFeedText:"Ajouter \u00e0 la carte",addTitleText:"Titre",keywordText:"Mot-cl\u00e9",doneText:"Termin\u00e9",titletext:"Ajouter RSS",maxResultsText:"Articles Max"}});
GeoExt.Lang.add("hu",{"gxp.menu.LayerMenu.prototype":{layerText:"R\u00e9teg"},"gxp.plugins.AddLayers.prototype":{addActionMenuText:"R\u00e9tegek hozz\u00e1ad\u00e1sa",addActionTip:"R\u00e9tegek hozz\u00e1ad\u00e1sa",addServerText:"\u00daj Szerver hozz\u00e1ad\u00e1sa",addButtonText:"R\u00e9tegek hozz\u00e1ad\u00e1sa",untitledText:"N\u00e9vtelen",addLayerSourceErrorText:"Hiba t\u00f6rt\u00e9nt a WMS capabilities lek\u00e9rdez\u00e9sekor ({msg}).\nEllen\u0151rizze az el\u00e9r\u00e9si c\u00edmet.",
availableLayersText:"El\u00e9rhet\u0151 r\u00e9tegek",expanderTemplateText:"<p><b>Abstractt:</b> {abstract}</p>",panelTitleText:"C\u00edm",layerSelectionText:"Rendelkez\u00e9sre \u00e1ll\u00f3 adat megtekint\u00e9se innen:",doneText:"K\u00e9sz",uploadText:"R\u00e9tegek felt\u00f6lt\u00e9se",addFeedActionMenuText:"Feed hozz\u00e1ad\u00e1sa",searchText:"R\u00e9tegek keres\u00e9se"},"gxp.plugins.BingSource.prototype":{title:"Bing R\u00e9tegek",roadTitle:"Bing Roads",aerialTitle:"Bing Aerial",labeledAerialTitle:"Bing Aerial Feliratokkal"},
"gxp.plugins.FeatureEditor.prototype":{splitButtonText:"Szerkeszt",createFeatureActionText:"L\u00e9trehoz",editFeatureActionText:"M\u00f3dos\u00edt",createFeatureActionTip:"\u00daj elem l\u00e9trehoz\u00e1sa",editFeatureActionTip:"L\u00e9tez\u0151 elem m\u00f3dos\u00edt\u00e1sa",commitTitle:"Commit message",commitText:"Please enter a commit message for this edit:"},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"T\u00e9rk\u00e9pen mutat",firstPageTip:"Els\u0151 oldal",previousPageTip:"El\u0151z\u0151 oldal",
zoomPageExtentTip:"Lap kiterjed\u00e9s\u00e9re nagy\u00edt",nextPageTip:"K\u00f6vetkez\u0151 lap",lastPageTip:"Utols\u00f3 lap",totalMsg:"Features {1} to {2} of {0}"},"gxp.plugins.GoogleEarth.prototype":{menuText:"3D N\u00e9zet",tooltip:"3D n\u00e9zetbe v\u00e1lt\u00e1s"},"gxp.plugins.GoogleSource.prototype":{title:"Google R\u00e9tegek",roadmapAbstract:"Show street map",satelliteAbstract:"Show satellite imagery",hybridAbstract:"Show imagery with street names",terrainAbstract:"Show street map with terrain"},
"gxp.plugins.LayerProperties.prototype":{menuText:"R\u00e9teg tulajdons\u00e1gok",toolTip:"R\u00e9teg tulajdons\u00e1gok"},"gxp.plugins.LayerTree.prototype":{shortTitle:"R\u00e9tegek",rootNodeText:"R\u00e9tegek",overlayNodeText:"Fedv\u00e9nyek",baseNodeText:"Alapt\u00e9rk\u00e9pek"},"gxp.plugins.LayerManager.prototype":{baseNodeText:"Alapt\u00e9rk\u00e9pek"},"gxp.plugins.Legend.prototype":{menuText:"Jelmagyar\u00e1zatot mutat",tooltip:"Jelmagyar\u00e1zatot mutat"},"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:"T\u00e9rk\u00e9p bet\u00f6lt\u00e9se..."},
"gxp.plugins.MapBoxSource.prototype":{title:"MapBox Layers",blueMarbleTopoBathyJanTitle:"Blue Marble Topography & Bathymetry (January)",blueMarbleTopoBathyJulTitle:"Blue Marble Topography & Bathymetry (July)",blueMarbleTopoJanTitle:"Blue Marble Topography (January)",blueMarbleTopoJulTitle:"Blue Marble Topography (July)",controlRoomTitle:"Control Room",geographyClassTitle:"Geography Class",naturalEarthHypsoTitle:"Natural Earth Hypsometric",naturalEarthHypsoBathyTitle:"Natural Earth Hypsometric & Bathymetry",
naturalEarth1Title:"Natural Earth I",naturalEarth2Title:"Natural Earth II",worldDarkTitle:"World Dark",worldLightTitle:"World Light",worldPrintTitle:"World Print"},"gxp.plugins.Measure.prototype":{buttonText:"M\u00e9r\u00e9s",lengthMenuText:"Hossz",areaMenuText:"Ter\u00fclet",lengthTooltip:"Hosszm\u00e9r\u00e9s",areaTooltip:"Ter\u00fcletm\u00e9r\u00e9s",measureTooltip:"M\u00e9r\u00e9s"},"gxp.plugins.Navigation.prototype":{menuText:"T\u00e9rk\u00e9p eltol\u00e1s",tooltip:"T\u00e9rk\u00e9p eltol\u00e1s"},
"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"El\u0151z\u0151 n\u00e9zetre nagy\u00edt",nextMenuText:"K\u00f6vetkez\u0151 n\u00e9zetre nagy\u00edt",previousTooltip:"El\u0151z\u0151 n\u00e9zetre nagy\u00edt",nextTooltip:"K\u00f6vetkez\u0151 n\u00e9zetre nagy\u00edt"},"gxp.plugins.OSMSource.prototype":{title:"OpenStreetMap R\u00e9tegek",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},
"gxp.plugins.Print.prototype":{buttonText:"Nyomtat",menuText:"T\u00e9rk\u00e9p nyomtat\u00e1sa",tooltip:"T\u00e9rk\u00e9p nyomtat\u00e1sa",previewText:"T\u00e9rk\u00e9p el\u0151n\u00e9zet",notAllNotPrintableText:"Nem nyomtathat\u00f3 minden r\u00e9teg",nonePrintableText:"Nem nyomtathat\u00f3 minden r\u00e9teg"},"gxp.plugins.MapQuestSource.prototype":{title:"MapQuest R\u00e9tegek",osmAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",
osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:"MapQuest Imagery"},"gxp.plugins.QueryForm.prototype":{queryActionText:"Lek\u00e9rdez\u00e9s",queryMenuText:"R\u00e9teg lek\u00e9rdez\u00e9s",queryActionTip:"A kiv\u00e1lasztott r\u00e9teg lek\u00e9rdez\u00e9se",queryByLocationText:"Keres\u00e9s t\u00e9rbeli helyzet alapj\u00e1n",
queryByAttributesText:"Keres\u00e9s attrib\u00fatumok alapj\u00e1n",queryMsg:"Keres\u00e9s...",cancelButtonText:"M\u00e9gsem",noFeaturesTitle:"Nincs tal\u00e1lat",noFeaturesMessage:"A keres\u00e9s nem hozott eredm\u00e9nyt."},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"R\u00e9teg elt\u00e1vol\u00edt\u00e1sa",removeActionTip:"R\u00e9teg elt\u00e1vol\u00edt\u00e1sa"},"gxp.plugins.Styler.prototype":{menuText:"R\u00e9teg st\u00edlusok",tooltip:"R\u00e9teg st\u00edlusok"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Aonos\u00edt",
infoActionTip:"Elem azonos\u00edt\u00e1s (Get Feature Info)",popupTitle:"Elem azonos\u00edt\u00e1s (Feature Info)"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom box",zoomInMenuText:"Nagy\u00edt",zoomOutMenuText:"Kicsiny\u00edt",zoomTooltip:"Zoom by dragging a box",zoomInTooltip:"Nagy\u00edt",zoomOutTooltip:"Kicsiny\u00edt"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"Teljes kiterjed\u00e9sre nagy\u00edt",tooltip:"Teljes kiterjed\u00e9sre nagy\u00edt"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"R\u00e9teg kiterjed\u00e9sre nagy\u00edt",
tooltip:"R\u00e9teg kiterjed\u00e9sre nagy\u00edt"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"R\u00e9teg kiterjed\u00e9sre nagy\u00edt",tooltip:"R\u00e9teg kiterjed\u00e9sre nagy\u00edt"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"Kiv\u00e1lasztott elemekre nagy\u00edt",tooltip:"Kiv\u00e1lasztott elemekre nagy\u00edt"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"Menti a v\u00e1ltoztat\u00e1sokat?",closeMsg:"This feature has unsaved changes. Would you like to save your changes?",
deleteMsgTitle:"T\u00f6rli az elemet?",deleteMsg:"Biztos benne, hogy t\u00f6rli az elemet?",editButtonText:"Szerkeszt",editButtonTooltip:"Elem szerkeszthet\u0151v\u00e9 t\u00e9tele",deleteButtonText:"T\u00f6rl\u00e9s",deleteButtonTooltip:"Elem t\u00f6rl\u00e9se",cancelButtonText:"M\u00e9gsem",cancelButtonTooltip:"Szerkeszt\u00e9s befejez\u00e9se, v\u00e1ltoztat\u00e1sok elvet\u00e9se",saveButtonText:"Ment\u00e9s",saveButtonTooltip:"V\u00e1ltoztat\u00e1sok ment\u00e9se"},"gxp.FillSymbolizer.prototype":{fillText:"Kit\u00f6lt\u00e9s",
colorText:"Sz\u00edn",opacityText:"\u00c1tl\u00e1tsz\u00f3s\u00e1g"},"gxp.FilterBuilder.prototype":{builderTypeNames:["b\u00e1rmelyik","mindegyik","egyik sem","nem mindegyik"],preComboText:"Teljes\u00fclj\u00f6n",postComboText:"a k\u00f6vetkez\u0151kb\u0151l:",addConditionText:"felt\u00e9tel hozz\u00e1ad\u00e1sa",addGroupText:"csoport hozz\u00e1ad\u00e1sa",removeConditionText:"felt\u00e9tel t\u00f6rl\u00e9se"},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"N\u00e9v",titleHeaderText:"C\u00edm",
queryableHeaderText:"Kereshet\u0151",layerSelectionLabel:"View available data from:",layerAdditionLabel:"or add a new server.",expanderTemplateText:"<p><b>Abstract:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"k\u00f6r",graphicSquareText:"n\u00e9gyzet",graphicTriangleText:"h\u00e1romsz\u00f6g",graphicStarText:"csillag",graphicCrossText:"kereszt",graphicXText:"x",graphicExternalText:"k\u00fcls\u0151",urlText:"URL",opacityText:"\u00e1tl\u00e1tsz\u00f3s\u00e1g",symbolText:"Szimb\u00f3lum",
sizeText:"M\u00e9ret",rotationText:"Elforgat\u00e1s"},"gxp.QueryPanel.prototype":{queryByLocationText:"Keres\u00e9s t\u00e9rbeli helyzet alapj\u00e1n",currentTextText:"Aktu\u00e1lis kiterjed\u00e9s",queryByAttributesText:"Keres\u00e9s attrib\u00fatumok alapj\u00e1n",layerText:"R\u00e9teg"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} M\u00e9retar\u00e1ny 1:{scale}",labelFeaturesText:"Elemek c\u00edmk\u00e9z\u00e9se",labelsText:"C\u00edmk\u00e9k",basicText:"Alapbe\u00e1ll\u00edt\u00e1sok",
advancedText:"Halad\u00f3",limitByScaleText:"Sz\u0171r\u00e9s m\u00e9retar\u00e1ny szerint",limitByConditionText:"Sz\u0171r\u00e9s felt\u00e9tel szerint",symbolText:"Szimb\u00f3lum",nameText:"N\u00e9v"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} L\u00e9pt\u00e9k 1:{scale}",minScaleLimitText:"Min l\u00e9pt\u00e9k",maxScaleLimitText:"Max l\u00e9pt\u00e9k"},"gxp.StrokeSymbolizer.prototype":{solidStrokeName:"t\u00f6m\u00f6r",dashStrokeName:"szaggatott",dotStrokeName:"pontozott",
titleText:"K\u00f6rvonal",styleText:"St\u00edlus",colorText:"Sz\u00edn",widthText:"Sz\u00e9less\u00e9g",opacityText:"\u00c1tl\u00e1tsz\u00f3s\u00e1g"},"gxp.StylePropertiesDialog.prototype":{titleText:"\u00c1ltal\u00e1nos",nameFieldText:"N\u00e9v",titleFieldText:"C\u00edm",abstractFieldText:"Abstract"},"gxp.TextSymbolizer.prototype":{labelValuesText:"C\u00edmke mez\u0151",haloText:"K\u00f6rvonal (maszk)",sizeText:"M\u00e9ret",fontColorTitle:"Bet\u0171 sz\u00edn \u00e9s \u00e1tl\u00e1tsz\u00f3s\u00e1g"},
"gxp.WMSLayerPanel.prototype":{attributionText:"Attribution",aboutText:"About",titleText:"Title",nameText:"Name",descriptionText:"Description",displayText:"Display",opacityText:"Opacity",formatText:"Format",transparentText:"Transparent",cacheText:"Cache",cacheFieldText:"Use cached version",stylesText:"Available Styles",infoFormatText:"Info format",infoFormatEmptyText:"Select a format",displayOptionsText:"Display options",queryText:"Limit with filters",scaleText:"Limit by scale",minScaleText:"Min scale",
maxScaleText:"Max scale",switchToFilterBuilderText:"Switch back to filter builder",cqlPrefixText:"or ",cqlText:"use CQL filter instead",singleTileText:"Single tile",singleTileFieldText:"Use a single tile"},"gxp.EmbedMapDialog.prototype":{publishMessage:"Az \u00d6n t\u00e9rk\u00e9pe k\u00e9szen \u00e1ll a publik\u00e1l\u00e1sra. M\u00e1solja be a k\u00f6vetkez\u0151 HTML-t a honlapj\u00e1ra",heightLabel:"Magass\u00e1g",widthLabel:"Sz\u00e9less\u00e9g",mapSizeLabel:"T\u00e9rk\u00e9p m\u00e9rete",miniSizeLabel:"Mini",
smallSizeLabel:"Kicsi",premiumSizeLabel:"Pr\u00e9mium",largeSizeLabel:"Nagy"},"gxp.WMSStylesDialog.prototype":{addStyleText:"Hozz\u00e1ad",addStyleTip:"\u00daj st\u00edlus hozz\u00e1ad\u00e1sa",chooseStyleText:"V\u00e1lasszon st\u00edlust",deleteStyleText:"T\u00f6r\u00f6l",deleteStyleTip:"A kiv\u00e1lasztott st\u00edlus t\u00f6rl\u00e9se",editStyleText:"Szerkeszt",editStyleTip:"A kiv\u00e1lasztott st\u00edlus szerkeszt\u00e9se",duplicateStyleText:"Duplik\u00e1l",duplicateStyleTip:"A kiv\u00e1lasztott st\u00edlus duplik\u00e1l\u00e1sa",
addRuleText:"Hozz\u00e1ad",addRuleTip:"\u00daj szab\u00e1ly hozz\u00e1ad\u00e1sa",newRuleText:"\u00daj szab\u00e1ly",deleteRuleText:"T\u00f6r\u00f6l",deleteRuleTip:"A kiv\u00e1lasztott szab\u00e1ly t\u00f6rl\u00e9se",editRuleText:"Szerkeszt",editRuleTip:"A kiv\u00e1lasztott szab\u00e1ly szerkeszt\u00e9se",duplicateRuleText:"Duplik\u00e1l",duplicateRuleTip:"A kiv\u00e1lasztott szab\u00e1ly duplik\u00e1l\u00e1sa",cancelText:"M\u00e9gsem",saveText:"Ment\u00e9s",styleWindowTitle:"Felhaszn\u00e1l\u00f3i st\u00edlus: {0}",
ruleWindowTitle:"St\u00edlusszab\u00e1ly: {0}",stylesFieldsetTitle:"St\u00edlusok",rulesFieldsetTitle:"Szab\u00e1lyok"},"gxp.LayerUploadPanel.prototype":{titleLabel:"C\u00edm",titleEmptyText:"R\u00e9teg neve",abstractLabel:"Le\u00edr\u00e1s",abstractEmptyText:"R\u00e9teg le\u00edr\u00e1s",fileLabel:"Adat",fieldEmptyText:"Browse for data archive...",uploadText:"Felt\u00f6lt\u00e9s",uploadFailedText:"Felt\u00f6lt\u00e9s sikertelen",processingUploadText:"Felt\u00f6lt\u00e9s folyamatban...",waitMsgText:"Adat felt\u00f6lt\u00e9se...",
invalidFileExtensionText:"File extension must be one of: ",optionsText:"Options",workspaceLabel:"Munkater\u00fclet",workspaceEmptyText:"Alap\u00e9rtelmezett munkater\u00fclet",dataStoreLabel:"Store",dataStoreEmptyText:"Create new store",defaultDataStoreEmptyText:"Default data store"},"gxp.NewSourceDialog.prototype":{title:"\u00daj szerver hozz\u00e1ad\u00e1sa...",cancelText:"M\u00e9gsem",addServerText:"Szerver hozz\u00e1ad\u00e1sa",invalidURLText:"Adjon meg helyes URL-t a WMS h\u00edv\u00e1shoz (pl. http://example.com/geoserver/wms)",
contactingServerText:"Kapcsol\u00f3d\u00e1s a szerverhez..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"Zoom szint"},"gxp.Viewer.prototype":{saveErrorText:"Probl\u00e9ma a ment\u00e9s sor\u00e1n: "},"gxp.FeedSourceDialog.prototype":{feedTypeText:"Source",addPicasaText:"Picasa Photos",addYouTubeText:"YouTube Videos",addRSSText:"Other GeoRSS Feed",addFeedText:"Add to Map",addTitleText:"C\u00edm",keywordText:"Kulcssz\u00f3",doneText:"K\u00e9sz",titleText:"Add Feeds",maxResultsText:"Max Items"},"gxp.StylesDialog.prototype":{cancelText:"M\u00e9gsem",
saveText:"Ment\u00e9s",addStyleText:"Hozz\u00e1ad",addStyleTip:"\u00daj st\u00edlus hozz\u00e1ad\u00e1sa",chooseStyleText:"V\u00e1lasszon st\u00edlust",deleteStyleText:"Elt\u00e1vol\u00edt",deleteStyleTip:"Kiv\u00e1lasztott st\u00edlus t\u00f6rl\u00e9se",editStyleText:"Szerkeszt",editStyleTip:"Kiv\u00e1lasztott st\u00edlus szerkeszt\u00e9se",duplicateStyleText:"Duplik\u00e1l",duplicateStyleTip:"Kiv\u00e1lasztott st\u00edlus duplik\u00e1l\u00e1sa",addRuleText:"Hozz\u00e1ad",addRuleTip:"\u00daj szab\u00e1ly hozz\u00e1ad\u00e1sa",
newRuleText:"\u00daj szab\u00e1ly",deleteRuleText:"Elt\u00e1vol\u00edt",deleteRuleTip:"Kiv\u00e1lasztott szab\u00e1ly t\u00f6rl\u00e9se",editRuleText:"Szerkeszt",editRuleTip:"Kiv\u00e1lasztott szab\u00e1ly szerkeszt\u00e9se",duplicateRuleText:"Duplik\u00e1l",duplicateRuleTip:"Kiv\u00e1lasztott szab\u00e1ly duplik\u00e1l\u00e1sa",styleWindowTitle:"Felhaszn\u00e1l\u00f3i st\u00edlus: {0}",ruleWindowTitle:"St\u00edlusszab\u00e1ly: {0}",stylesFieldsetTitle:"St\u00edlusok",rulesFieldsetTitle:"Szab\u00e1lyok",
errorTitle:"Hiba t\u00f6rt\u00e9nt a st\u00edlus ment\u00e9se sor\u00e1n",errorMsg:"Hiba t\u00f6rt\u00e9nt a st\u00edlus szerverre t\u00f6rt\u00e9n\u0151 ment\u00e9se sor\u00e1n."}});
GeoExt.Lang.add("id",{"gxp.menu.LayerMenu.prototype":{layerText:"Layer"},"gxp.plugins.AddLayers.prototype":{addActionMenuText:"Tambahkan layer",addActionTip:"Tambahkan layer",addServerText:"Tambahkan server baru",addButtonText:"Add layers",untitledText:"Untitled",addLayerSourceErrorText:"Kesalahan mendapatkan kemampuan WMS ({msg}). \nSilakan cek url dan coba lagi.",availableLayersText:"Layer tersedia",expanderTemplateText:"<p><b>Abstract:</b> {abstract}</p>",panelTitleText:"Title",layerSelectionText:"View available data from:",
doneText:"Selesai",uploadText:"Unggah data",addFeedActionMenuText:"Add feeds",searchText:"Search for layers"},"gxp.plugins.BingSource.prototype":{title:"Layers Bing",roadTitle:"Jalan Bing",aerialTitle:"Udara Bing",labeledAerialTitle:"Udara Bing dengan label"},"gxp.plugins.FeatureEditor.prototype":{splitButtonText:"Edit",createFeatureActionText:"Create",editFeatureActionText:"Modify",createFeatureActionTip:"Membuat sebuah fitur",editFeatureActionTip:"Edit fitur",commitTitle:"Commit message",commitText:"Please enter a commit message for this edit:"},
"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"Tampilkan pada peta",firstPageTip:"Halaman pertama",previousPageTip:"Halaman sebelumnya",zoomPageExtentTip:"Zoom sampai batas halaman",nextPageTip:"Halaman berikut",lastPageTip:"Halaman terakhir",totalMsg:"Features {1} to {2} of {0}"},"gxp.plugins.GoogleEarth.prototype":{menuText:"3D Viewer",tooltip:"Switch to 3D Viewer"},"gxp.plugins.GoogleSource.prototype":{title:"Google Layers",roadmapAbstract:"Tampilkan peta jalan",satelliteAbstract:"Tampilkan citra satelit",
hybridAbstract:"Tampilkan citra dengan nama jalan",terrainAbstract:"Tampilkan peta jalan dengan peta medan"},"gxp.plugins.LayerProperties.prototype":{menuText:"Properti layer",toolTip:"Properti layer"},"gxp.plugins.LayerTree.prototype":{shortTitle:"Layer-layer",rootNodeText:"Layer-layer",overlayNodeText:"Superimposisi",baseNodeText:"Layer dasar"},"gxp.plugins.LayerManager.prototype":{baseNodeText:"Layer dasar"},"gxp.plugins.Legend.prototype":{menuText:"Tampilkan legend",tooltip:"Tampilkan legend"},
"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:"Loading Map..."},"gxp.plugins.MapBoxSource.prototype":{title:"MapBox Layers",blueMarbleTopoBathyJanTitle:"Blue Marble Topography & Bathymetry (January)",blueMarbleTopoBathyJulTitle:"Blue Marble Topography & Bathymetry (July)",blueMarbleTopoJanTitle:"Blue Marble Topography (January)",blueMarbleTopoJulTitle:"Blue Marble Topography (July)",controlRoomTitle:"Control Room",geographyClassTitle:"Geography Class",naturalEarthHypsoTitle:"Natural Earth Hypsometric",
naturalEarthHypsoBathyTitle:"Natural Earth Hypsometric & Bathymetry",naturalEarth1Title:"Natural Earth I",naturalEarth2Title:"Natural Earth II",worldDarkTitle:"World Dark",worldLightTitle:"World Light",worldPrintTitle:"World Print"},"gxp.plugins.Measure.prototype":{buttonText:"Pengukuran",lengthMenuText:"Panjang",areaMenuText:"Luas",lengthTooltip:"Pengukuran panjang",areaTooltip:"Pengukuran luas",measureTooltip:"Pengukuran"},"gxp.plugins.Navigation.prototype":{menuText:"Pan peta",tooltip:"Pan peta"},
"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"Zoom ke luas sebelumnya",nextMenuText:"Zoom ke luas setelahnya",previousTooltip:"Zoom ke luas sebelumnya",nextTooltip:"Zoom ke luas setelahnya"},"gxp.plugins.OSMSource.prototype":{title:"OpenStreetMap Layers",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},"gxp.plugins.Print.prototype":{buttonText:"Cetak",
menuText:"Cetak peta",tooltip:"Cetak peta",previewText:"Preview cetak",notAllNotPrintableText:"Tidak semua layer dapat dicetak",nonePrintableText:"Tidak ada peta yang dapat dicetak"},"gxp.plugins.MapQuestSource.prototype":{title:"MapQuest Layers",osmAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",
naipTitle:"Citra MapQuest"},"gxp.plugins.QueryForm.prototype":{queryActionText:"Query",queryMenuText:"Queryable Layer",queryActionTip:"Query layer yang dipilih",queryByLocationText:"Query by current map extent",queryByAttributesText:"Query atribut",queryMsg:"Querying...",cancelButtonText:"Batal",noFeaturesTitle:"Tidak sesuai",noFeaturesMessage:"Permintaan anda tidak berhasil."},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"Hapus layer",removeActionTip:"Hapus layer"},"gxp.plugins.Styler.prototype":{menuText:"Edit Styles",
tooltip:"Manage layer styles"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Identify",infoActionTip:"Get Feature Info",popupTitle:"Info fitur"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom Box",zoomInMenuText:"Memperbesar",zoomOutMenuText:"Memperkecil",zoomTooltip:"Zoom by dragging a box",zoomInTooltip:"Memperbesar",zoomOutTooltip:"Memperkecil"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"Pembesaran maksimum",tooltip:"Pembesaran maksimum"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"Pembesaran batas layer",
tooltip:"Pembesaran batas layer"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"Pembesaran batas layer",tooltip:"Pembesaran batas layer"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"Pembesaran pada fitur terpilih",tooltip:"Pembesaran pada fitur terpilih"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"Simpan update?",closeMsg:"Fitur belum di simpan. Apakah ingin disimpan?",deleteMsgTitle:"Hapus Fitur?",deleteMsg:"Anda yakin untuk menghapus fitur ini?",editButtonText:"Edit",
editButtonTooltip:"Jadikan fitur dapat diedit",deleteButtonText:"Hapus",deleteButtonTooltip:"Hapus fitur ini",cancelButtonText:"Batal",cancelButtonTooltip:"Berhenti mengedit, batalkan perubahan",saveButtonText:"Simpan",saveButtonTooltip:"Simpan Update"},"gxp.FillSymbolizer.prototype":{fillText:"Isikan warna",colorText:"Warna",opacityText:"Kepekatan"},"gxp.FilterBuilder.prototype":{builderTypeNames:["any","all","none","not all"],preComboText:"Sesuai",postComboText:"of the following:",addConditionText:"tambahkan kondisi",
addGroupText:"tambahkan grup",removeConditionText:"Hilangkan kondisi"},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"Nama",titleHeaderText:"Judul",queryableHeaderText:"Queryable",layerSelectionLabel:"Melihat data dari:",layerAdditionLabel:"atau tambahkan sebagai server baru.",expanderTemplateText:"<p><b>Abstract:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"Lingkaran",graphicSquareText:"square",graphicTriangleText:"Segitiga",graphicStarText:"Bintang",graphicCrossText:"Silang",
graphicXText:"x",graphicExternalText:"dari luar",urlText:"URL",opacityText:"Kepekatan",symbolText:"Simbol",sizeText:"Ukuran",rotationText:"Rotasi"},"gxp.QueryPanel.prototype":{queryByLocationText:"Query lokasi",currentTextText:"Sejauh ini",queryByAttributesText:"Query atribut",layerText:"Layer"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} Scale 1:{scale}",labelFeaturesText:"Label Fitur",labelsText:"Labels",basicText:"Basic",advancedText:"Tingkat lanjut",limitByScaleText:"Batasan oleh skala",
limitByConditionText:"Batasan oleh kondisi",symbolText:"Simbol",nameText:"Nama"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} Scale 1:{scale}",minScaleLimitText:"Min scale limit",maxScaleLimitText:"Batas skala maksimum"},"gxp.StrokeSymbolizer.prototype":{solidStrokeName:"solid",dashStrokeName:"dash",dotStrokeName:"dot",titleText:"Stroke",styleText:"Style",colorText:"Color",widthText:"Width",opacityText:"Opacity"},"gxp.StylePropertiesDialog.prototype":{titleText:"General",nameFieldText:"Name",
titleFieldText:"Title",abstractFieldText:"Abstract"},"gxp.TextSymbolizer.prototype":{labelValuesText:"Label nilai",haloText:"Halo",sizeText:"Ukuran"},"gxp.WMSLayerPanel.prototype":{attributionText:"Attribution",aboutText:"Tentang Program",titleText:"Judul",nameText:"Nama",descriptionText:"Deskripsi",displayText:"Tampilan",opacityText:"Kecerahan",formatText:"Format",transparentText:"Transparent",cacheText:"Cache",cacheFieldText:"Menggunakan versi cached",stylesText:"Styles tersedia",infoFormatText:"Info format",
infoFormatEmptyText:"Select a format",displayOptionsText:"Display options",queryText:"Limit with filters",scaleText:"Limit by scale",minScaleText:"Min scale",maxScaleText:"Max scale",switchToFilterBuilderText:"Switch back to filter builder",cqlPrefixText:"or ",cqlText:"use CQL filter instead",singleTileText:"Single tile",singleTileFieldText:"Use a single tile"},"gxp.EmbedMapDialog.prototype":{publishMessage:"Peta anda siap dipublikasikan melalui web! Cukup salin HTML berikut untuk meletakkan peta dalam situs web Anda:",
heightLabel:"Tinggi",widthLabel:"Lebar",mapSizeLabel:"Ukuran peta",miniSizeLabel:"Mini",smallSizeLabel:"Kecil",premiumSizeLabel:"Premium",largeSizeLabel:"Besar"},"gxp.WMSStylesDialog.prototype":{addStyleText:"Tambah",addStyleTip:"Tambah style baru",chooseStyleText:"Choose style",deleteStyleText:"Hilangkan",deleteStyleTip:"Hapus style yang dipilih",editStyleText:"Edit",editStyleTip:"Edit style yang dipilih",duplicateStyleText:"Duplikat",duplicateStyleTip:"Duplikat style yang dipilih",addRuleText:"Tambah",
addRuleTip:"Tambah Rule baru",newRuleText:"New Rule",deleteRuleText:"Hilangkan",deleteRuleTip:"Hapus Rule yang dipilih",editRuleText:"Edit",editRuleTip:"Edit ule yang dipilih",duplicateRuleText:"Duplikat",duplicateRuleTip:"Duplikat style yang dipilih",cancelText:"Batal",saveText:"Save",styleWindowTitle:"User Style: {0}",ruleWindowTitle:"Style Rule: {0}",stylesFieldsetTitle:"Styles",rulesFieldsetTitle:"Rules"},"gxp.LayerUploadPanel.prototype":{titleLabel:"Judul",titleEmptyText:"Judul Layer",abstractLabel:"Deskripsi",
abstractEmptyText:"Deskripsi Layer",fileLabel:"Data",fieldEmptyText:"Pencarian arsip data...",uploadText:"Pengisian",uploadFailedText:"Upload failed",processingUploadText:"Processing upload...",waitMsgText:"Mengisi Data anda...",invalidFileExtensionText:"Ekstensi file harus salah satu: ",optionsText:"Pilihan",workspaceLabel:"Ruang Kerja",workspaceEmptyText:"Ruang kerja Default",dataStoreLabel:"Penyimpanan",dataStoreEmptyText:"Create new store",defaultDataStoreEmptyText:"Penyimpanan data Default"},
"gxp.NewSourceDialog.prototype":{title:"Add New Server...",cancelText:"Cancel",addServerText:"Add Server",invalidURLText:"Enter a valid URL to a WMS endpoint (e.g. http://example.com/geoserver/wms)",contactingServerText:"Contacting Server..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"Zoom level"},"gxp.Viewer.prototype":{saveErrorText:"Trouble saving: "},"gxp.FeedSourceDialog.prototype":{feedTypeText:"Sumber",addPicasaText:"Picasa Foto",addYouTubeText:"YouTube Video",addRSSText:"GeoRSS Pakan lain",
addFeedText:"Tambah ke Peta",addTitleText:"Judul",keywordText:"Kata Kunci",doneText:"Selesai",titleText:"Tambah Blog",maxResultsText:"Produk Max"}});
GeoExt.Lang.add("nl",{"gxp.plugins.AddLayers.prototype":{addActionMenuText:"Voeg kaartlagen toe",addActionTip:"Voeg kaartlagen toe",addServerText:"Voeg service toe",untitledText:"Onbekend",addLayerSourceErrorText:"Probleem bij het ophalen van de Error WMS GetCapabilities ({msg}).\nControleer de URL en probeer opnieuw.",availableLayersText:"Beschikbare kaartlagen",doneText:"Klaar",addFeedActionMenuText:"Add feeds",searchText:"Zoek naar kaartlagen"},"gxp.plugins.BingSource.prototype":{title:"Bing kaartlagen",
roadTitle:"Bing wegen",aerialTitle:"Bing luchtfoto's",labeledAerialTitle:"Bing luchtfoto's met labels"},"gxp.plugins.FeatureEditor.prototype":{createFeatureActionTip:"Maak een nieuw object",editFeatureActionTip:"Wijzig een bestand object",commitTitle:"Wijzingsbeschrijving",commitText:"Voor a.u.b. een beschrijving in voor de wijziging:"},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"Toon op kaart",firstPageTip:"Eerste pagina",previousPageTip:"Vorige pagina",zoomPageExtentTip:"Zoom naar de uitsnede van de pagina",
nextPageTip:"Volgende pagina",lastPageTip:"Laatste pagina",totalMsg:"Features {1} to {2} of {0}"},"gxp.plugins.GoogleEarth.prototype":{menuText:"3D weergave",tooltip:"Bekijk kaart in 3D"},"gxp.plugins.GoogleSource.prototype":{title:"Google Maps kaartlagen",roadmapAbstract:"Toon stratenkaart",satelliteAbstract:"Toon satellietbeeld",hybridAbstract:"Toon rasterbeelden met labels",terrainAbstract:"Toon stratenkaart met terrein"},"gxp.plugins.LayerProperties.prototype":{menuText:"Kaartlaag eigenschappen",
toolTip:"Kaartlaag eigenschappen"},"gxp.plugins.LayerTree.prototype":{shortTitle:"Kaartlagen",rootNodeText:"Kaartlagen",overlayNodeText:"Kaart overlays",baseNodeText:"Basis Kaarten"},"gxp.plugins.LayerManager.prototype":{baseNodeText:"Basis Kaart"},"gxp.plugins.Legend.prototype":{menuText:"Toon legenda",tooltip:"Toon legenda"},"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:"Laden van de kaart..."},"gxp.plugins.MapBoxSource.prototype":{title:"MapBox Layers",blueMarbleTopoBathyJanTitle:"Blue Marble Topography & Bathymetry (January)",
blueMarbleTopoBathyJulTitle:"Blue Marble Topography & Bathymetry (July)",blueMarbleTopoJanTitle:"Blue Marble Topography (January)",blueMarbleTopoJulTitle:"Blue Marble Topography (July)",controlRoomTitle:"Control Room",geographyClassTitle:"Geography Class",naturalEarthHypsoTitle:"Natural Earth Hypsometric",naturalEarthHypsoBathyTitle:"Natural Earth Hypsometric & Bathymetry",naturalEarth1Title:"Natural Earth I",naturalEarth2Title:"Natural Earth II",worldDarkTitle:"World Dark",worldLightTitle:"World Light",
worldPrintTitle:"World Print"},"gxp.plugins.Measure.prototype":{splitButtonText:"Edit",createFeatureActionText:"Create",editFeatureActionText:"Modify",buttonText:"Meten",lengthMenuText:"Lengte",areaMenuText:"Oppervlakte",lengthTooltip:"Meet lengte",areaTooltip:"Meet oppervlakte",measureTooltip:"Meten"},"gxp.plugins.Navigation.prototype":{menuText:"Verschuif kaart",tooltip:"Verschuif kaart"},"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"Zoom naar de vorige uitsnede",nextMenuText:"Zoom naar de volgende uitsnede",
previousTooltip:"Zoom naar de vorige uitsnede",nextTooltip:"Zoom naar de volgende uitsnede"},"gxp.plugins.OSMSource.prototype":{title:"OpenStreetMap kaartlagen",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},"gxp.plugins.Print.prototype":{buttonText:"Afdrukken",menuText:"Afdrukken kaart",tooltip:"Afdrukken kaart",previewText:"Voorvertoning",notAllNotPrintableText:"Niet alle lagen kunnen worden afgedrukt",
nonePrintableText:"Geen van de huidige lagen kunnen worden afgedrukt"},"gxp.plugins.MapQuestSource.prototype":{title:"MapQuest kaartlagen",osmAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",
naipTitle:"MapQuest Rasterbeelden"},"gxp.plugins.QueryForm.prototype":{queryActionText:"Bevraag",queryMenuText:"Bevraag kaartlaag",queryActionTip:"Bevraag de geselecteerde kaartlaag",queryByLocationText:"Query by current map extent",queryByAttributesText:"Bevraag middels attributen",queryMsg:"Bevragen...",cancelButtonText:"Annuleren",noFeaturesTitle:"Niks gevonden",noFeaturesMessage:"De bevraging heeft geen resultaten opgeleverd."},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"Verwijder kaartlaag",
removeActionTip:"Verwijder kaartlaag"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Identify",infoActionTip:"Attribuut-informatie",popupTitle:"Attribuut-informatie"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom Box",zoomInMenuText:"Inzoomen",zoomOutMenuText:"Uitzoomen",zoomTooltip:"Zoom by dragging a box",zoomInTooltip:"Inzoomen",zoomOutTooltip:"Uitzoomen"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"Zoom naar de maximale uitsnede",tooltip:"Zoom naar de maximale uitsnede"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"Zoom naar de uitsnede van de kaartlaag",
tooltip:"Zoom naar de uitsnede van de kaartlaag"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"Zoom naar de uitsnede van de kaartlaag",tooltip:"Zoom naar de uitsnede van de kaartlaag"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"Zoom naar de geselecteerde objecten",tooltip:"Zoom naar de geselecteerde objecten"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"Wijzigingen opslaan?",closeMsg:"Het object is gewijzigd. Wilt u de wijzigingen opslaan?",deleteMsgTitle:"Verwijder object?",
deleteMsg:"Weet u zeker dat u dit object wilt verwijderen?",editButtonText:"Wijzigen",editButtonTooltip:"Wijzig dit object",deleteButtonText:"Verwijderen",deleteButtonTooltip:"Verwijder dit object",cancelButtonText:"Annuleren",cancelButtonTooltip:"Stop met wijzigen, wijzigingen worden ongedaan gemaakt",saveButtonText:"Opslaan",saveButtonTooltip:"Wijzigingen opslaan"},"gxp.FillSymbolizer.prototype":{fillText:"Opvulling",colorText:"Kleur",opacityText:"Opaciteit"},"gxp.FilterBuilder.prototype":{builderTypeNames:["om het even welk",
"alle","geen","niet alle"],preComboText:"Overeenkomst",postComboText:"van de volgende:",addConditionText:"voeg voorwaarde toe",addGroupText:"voeg groep toe",removeConditionText:"verwijder voorwaarde"},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"Naam",titleHeaderText:"Titel",queryableHeaderText:"Bevraagbaar",layerSelectionLabel:"Bekijk beschikbare data van:",layerAdditionLabel:"of voeg een nieuwe server toe.",expanderTemplateText:"<p><b>Samenvatting:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"cirkel",
graphicSquareText:"vierkant",graphicTriangleText:"driehoek",graphicStarText:"ster",graphicCrossText:"kruis",graphicXText:"x",graphicExternalText:"extern",urlText:"URL",opacityText:"opaciteit",symbolText:"Symbool",sizeText:"Grootte",rotationText:"Rotatie"},"gxp.QueryPanel.prototype":{queryByLocationText:"Bevraag middels locatie",currentTextText:"Huidige uitsnede",queryByAttributesText:"Bevraag middels attributen",layerText:"Kaartlaag"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} Schaal 1:{scale}",
labelFeaturesText:"Label objecten",advancedText:"Geavanceerd",limitByScaleText:"Beperk middels schaal",limitByConditionText:"Beperk middels voorwaarde",symbolText:"Symbool",nameText:"Naam"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} Schaal 1:{scale}",maxScaleLimitText:"Maximale schaal"},"gxp.TextSymbolizer.prototype":{labelValuesText:"Label waardes",haloText:"Halo",sizeText:"Grootte"},"gxp.WMSLayerPanel.prototype":{attributionText:"Bronvermelding",aboutText:"Informatie",titleText:"Titel",
nameText:"Naam",descriptionText:"Omschrijving",displayText:"Toon",opacityText:"Opaciteit",formatText:"Formaat",transparentText:"Transparant",cacheText:"Cache",cacheFieldText:"Gebruik de versie vanuit de cache",stylesText:"Beschikbare Stijlen",infoFormatText:"Info formaat",infoFormatEmptyText:"Selecteer een formaat",displayOptionsText:"Weergave opties",queryText:"Begrens d.m.v. query",scaleText:"Bregens d.m.v. schaal",minScaleText:"Minimum schaal",maxScaleText:"Maximum schaal",switchToFilterBuilderText:"Terug naar de querybuilder",
cqlPrefixText:"of ",cqlText:"gebruik een CQL filter",singleTileText:"Enkele kaarttegel",singleTileFieldText:"Gebruik 1 kaarttegel"},"gxp.EmbedMapDialog.prototype":{publishMessage:"Uw map is klaar voor publicatie! Kopieer de volgende HTML in uw website om de kaart in te voegen:",heightLabel:"Hoogte",widthLabel:"Breedte",mapSizeLabel:"Kaartgrootte",miniSizeLabel:"Mini",smallSizeLabel:"Klein",premiumSizeLabel:"Extra groot",largeSizeLabel:"Groot"},"gxp.StylesDialog.prototype":{addStyleText:"Voeg toe",
addStyleTip:"Voeg een nieuwe stijl toe",deleteStyleText:"Verwijder",deleteStyleTip:"Verwijder de geselecteerde stijl",editStyleText:"Wijzig",editStyleTip:"Wijzig de geselecteerde stijl",duplicateStyleText:"Dupliceer",duplicateStyleTip:"Dupliceer de geselecteerde stijl",addRuleText:"Voeg toe",addRuleTip:"Voeg een nieuwe klasse toe",deleteRuleText:"Verwijder",deleteRuleTip:"Verwijder de geselecteerde klasse",editRuleText:"Wijzig",editRuleTip:"Wijzig de geselecteerde klasse",duplicateRuleText:"Dupliceer",
duplicateRuleTip:"Dupliceer de geselecteerde klasse",cancelText:"Annuleer",styleWindowTitle:"Kaartstijl: {0}",ruleWindowTitle:"Klasse: {0}",stylesFieldsetTitle:"Kaartstijlen",rulesFieldsetTitle:"Klassen"},"gxp.LayerUploadPanel.prototype":{titleLabel:"Titel",titleEmptyText:"Kaartlaag titel",abstractLabel:"Omschrijving",abstractEmptyText:"Kaartlaag omschrijving",fileLabel:"Data",fieldEmptyText:"Kies data archief...",uploadText:"Upload",uploadFailedText:"Upload failed",processingUploadText:"Processing upload...",
waitMsgText:"Bezig met uploaden van de data...",invalidFileExtensionText:"Bestandsextensie is een van: ",optionsText:"Opties",workspaceLabel:"Werkruimte",workspaceEmptyText:"Standaard werkruimte",dataStoreLabel:"Archief",dataStoreEmptyText:"Create new store",defaultDataStoreEmptyText:"Standaard archief"},"gxp.NewSourceDialog.prototype":{title:"Add New Server...",cancelText:"Cancel",addServerText:"Add Server",invalidURLText:"Enter a valid URL to a WMS endpoint (e.g. http://example.com/geoserver/wms)",
contactingServerText:"Contacting Server..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"Zoom niveau"},"gxp.Viewer.prototype":{saveErrorText:"Problemen bij het opslaan: "},"gxp.FeedSourceDialog.prototype":{feedTypeText:"Bron",addPicasaText:"Picasa Foto's",addYouTubeText:"YouTube video's",addRSSText:"Andere GeoRSS Feed",addFeedText:"Voeg toe aan Map",addTitleText:"Titel",keywordText:"Trefwoord",doneText:"Klaar",titleText:"Voeg Feeds",maxResultsText:"Max Items"}});
GeoExt.Lang.add("no",{"gxp.menu.LayerMenu.prototype":{layerText:"Kartlag"},"gxp.plugins.AddLayers.prototype":{addActionMenuText:"Legg til kartlag",addActionTip:"Legg til kartlag",addServerText:"Legg til en ny server",addButtonText:"Legg til kartlag",untitledText:"Uten titel",addLayerSourceErrorText:"Feil ved henting av WMS capabilities ({msg}).\nSjekk urlen og pr\u00f8v igjen.",availableLayersText:"Tilgjengelige kartlag",expanderTemplateText:"<p><b>Abstrakt:</b> {abstract}</p>",panelTitleText:"Titel",
layerSelectionText:"Vis tilgjengelige data fra:",doneText:"Ferdig",uploadText:"Last opp kartlag",addFeedActionMenuText:"Legg til feeds",searchText:"S\u00f8k etter kartlag"},"gxp.plugins.BingSource.prototype":{title:"Bing kartlag",roadTitle:"Bing Roads",aerialTitle:"Bing Aerial",labeledAerialTitle:"Bing Aerial med Etikett"},"gxp.plugins.FeatureEditor.prototype":{splitButtonText:"Editer",createFeatureActionText:"Lag",editFeatureActionText:"Modifiser",createFeatureActionTip:"Lag en ny feature",editFeatureActionTip:"Editer eksisterende feature",
commitTitle:"Sjekk inn melding",commitText:"Skriv in en innsjekkingsmelding for denne editeringen:"},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"Vis p\u00e5 kart",firstPageTip:"F\u00f8rste side",previousPageTip:"Neste side",zoomPageExtentTip:"Zoom til side utstrekning",nextPageTip:"Neste side",lastPageTip:"Siste side",totalMsg:"Features {1} til {2} av {0}"},"gxp.plugins.GoogleEarth.prototype":{menuText:"3D Visning",tooltip:"Bytt til 3D Visning"},"gxp.plugins.GoogleSource.prototype":{title:"Google kartlag",
roadmapAbstract:"Vis street map",satelliteAbstract:"Vis satelitt bilder",hybridAbstract:"Vis bilder med gatenavn",terrainAbstract:"Vis street map med terreng"},"gxp.plugins.LayerProperties.prototype":{menuText:"Kartlag Egenskaper",toolTip:"Kartlag Egenskaper"},"gxp.plugins.LayerTree.prototype":{shortTitle:"kartlag",rootNodeText:"Kartlag",overlayNodeText:"Kartlag",baseNodeText:"Bakgrunnskart"},"gxp.plugins.LayerManager.prototype":{baseNodeText:"Bakgrunnskart"},"gxp.plugins.Legend.prototype":{menuText:"Vis tegnforklaring",
tooltip:"Vis tegnforklaring"},"gxp.plugins.LoadingIndicator.prototype":{loadingMapMessage:"Laster kart..."},"gxp.plugins.MapBoxSource.prototype":{title:"MapBox kartlag",blueMarbleTopoBathyJanTitle:"Blue Marble Topografi & Batymetri (januar)",blueMarbleTopoBathyJulTitle:"Blue Marble Topografi & Batymetri (Juli)",blueMarbleTopoJanTitle:"Blue Marble Topografi (januar)",blueMarbleTopoJulTitle:"Blue Marble Topografi (Juli)",controlRoomTitle:"Kontrollrom",geographyClassTitle:"Geografi Klasse",naturalEarthHypsoTitle:"Naturlig Jordklode Hypsometri",
naturalEarthHypsoBathyTitle:"Naturlig Jordklode  Hypsometri & Batymetri",naturalEarth1Title:"Naturlig Jordklode I",naturalEarth2Title:"Naturlig Jordklode II",worldDarkTitle:"Verden M\u00f8rk",worldLightTitle:"Verden Lys",worldPrintTitle:"Verden utskrift"},"gxp.plugins.Measure.prototype":{buttonText:"M\u00e5l",lengthMenuText:"Lengde",areaMenuText:"Areal",lengthTooltip:"M\u00e5l lengde",areaTooltip:"M\u00e5l areal",measureTooltip:"M\u00e5l"},"gxp.plugins.Navigation.prototype":{menuText:"Panorer kart",
tooltip:"Panorer kart"},"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"Zoom til forrige utstrekning",nextMenuText:"Zoom til neste utstrekning",previousTooltip:"Zoom til forrige utstrekning",nextTooltip:"Zoom til neste utstrekning"},"gxp.plugins.OSMSource.prototype":{title:"OpenStreetMap Kartlag",mapnikAttribution:"&kopier; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> bidragsytere",osmarenderAttribution:"Data CC-By-SA av <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},
"gxp.plugins.Print.prototype":{buttonText:"Skriv ut",menuText:"Skriv ut kart",tooltip:"Skriv ut kart",previewText:"Forh\u00e5ndsvinsning av utskrift",notAllNotPrintableText:"Ikke alle kartlag kan skrives ut",nonePrintableText:"Ingen av dine valgte kartlag kan skrives ut"},"gxp.plugins.MapQuestSource.prototype":{title:"MapQuest Kartlag",osmAttribution:"Titler levert av <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",
osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Tutker levert av <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:"MapQuest bilder"},"gxp.plugins.QueryForm.prototype":{queryActionText:"Sp\u00f8r",queryMenuText:"Sp\u00f8r kartlag",queryActionTip:"Sp\u00f8r det valgte kartlaget",queryByLocationText:"Sp\u00f8r ved valgt kartlags utstrekning",queryByAttributesText:"Sp\u00f8r ved attributter",queryMsg:"Sp\u00f8rring...",
cancelButtonText:"Kanseler",noFeaturesTitle:"Ingen treff",noFeaturesMessage:"Din sp\u00f8rring gav ingen treff."},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"Fjern kartlag",removeActionTip:"Fjern kartlag"},"gxp.plugins.Styler.prototype":{menuText:"Kartlag Stiler",tooltip:"Kartlag Stiler"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Identifiser",infoActionTip:"Hent Feature Info",popupTitle:"Feature Info"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom firkant",zoomInMenuText:"Zoom inn",
zoomOutMenuText:"Zoom ut",zoomTooltip:"Zoom ved \u00e5 tegne en firkant",zoomInTooltip:"Zoom inn",zoomOutTooltip:"Zoom ut"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"Zoom til maks utstrekning",tooltip:"Zoom til maks utstrekning"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"Zoom til kartlagets utstrekning",tooltip:"Zoom til kartlagets utstrekning"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"Zoom til kartlagets utstrekning",tooltip:"Zoom til kartlagets utstrekning"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"Zoom til valgte features",
tooltip:"Zoom til valgte features"},"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"Lagre Endringer?",closeMsg:"Denne featuren har nye endringer som ikke er lagret. Vill du lagre endringene?",deleteMsgTitle:"Slett Feature?",deleteMsg:"Er du sikker p\u00e5 at du vil slette denne featuren?",editButtonText:"Editer",editButtonTooltip:"Gj\u00f8r denne featuren editerbar",deleteButtonText:"Slett",deleteButtonTooltip:"Slett denne featuren",cancelButtonText:"Kanseler",cancelButtonTooltip:"Stopp editering, forkast endringer",
saveButtonText:"Lagre",saveButtonTooltip:"Lagre endringer"},"gxp.FillSymbolizer.prototype":{fillText:"Fyll ut",colorText:"Farge",opacityText:"Gjennomskinnelighet"},"gxp.FilterBuilder.prototype":{builderTypeNames:["en","alle","ingen","ikke alle"],preComboText:"Treff",postComboText:"av f\u00f8lgende:",addConditionText:"legg til betingelse",addGroupText:"Legg til gruppe",removeConditionText:"fjern betingelse"},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"Navn",titleHeaderText:"Tittel",queryableHeaderText:"Mulig \u00e5 sp\u00f8rre",
layerSelectionLabel:"Vis tilgjengelig data fra:",layerAdditionLabel:"eller legg til en ny server.",expanderTemplateText:"<p><b>Abstrakt:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"sirkel",graphicSquareText:"firkant",graphicTriangleText:"triangel",graphicStarText:"stjerne",graphicCrossText:"kryss",graphicXText:"x",graphicExternalText:"ekstern",urlText:"URL",opacityText:"gjennomskinnelighet",symbolText:"Symbol",sizeText:"St\u00f8rrelse",rotationText:"Rotasjon"},"gxp.QueryPanel.prototype":{queryByLocationText:"Sp\u00f8r etter plassering",
currentTextText:"N\u00e5v\u00e6rende utstrekning",queryByAttributesText:"Sp\u00f8r etter attributter",layerText:"Kartlag"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} M\u00e5lestokk 1:{scale}",labelFeaturesText:"Etikett Features",labelsText:"Etiketter",basicText:"Grunnleggende",advancedText:"Avansert",limitByScaleText:"M\u00e5lestokksbegrensning",limitByConditionText:"Begrensning p\u00e5 tilstand",symbolText:"Symbol",nameText:"Navn"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} M\u00e5lestokk 1:{scale}",
minScaleLimitText:"Minimum m\u00e5lestokksgrense",maxScaleLimitText:"Maximum m\u00e5lestokksgrense"},"gxp.StrokeSymbolizer.prototype":{solidStrokeName:"solid",dashStrokeName:"dash",dotStrokeName:"dot",titleText:"Strek",styleText:"Stil",colorText:"Farge",widthText:"Bredde",opacityText:"gjennomskinnelighet"},"gxp.StylePropertiesDialog.prototype":{titleText:"Generel",nameFieldText:"Navn",titleFieldText:"Tittel",abstractFieldText:"Abstrakt"},"gxp.TextSymbolizer.prototype":{labelValuesText:"Etikett verdier",
haloText:"Halo",sizeText:"St\u00f8rrelse"},"gxp.WMSLayerPanel.prototype":{attributionText:"Tilskrivende",aboutText:"Om",titleText:"Tittel",nameText:"Navn",descriptionText:"Beskrivelse",displayText:"Visning",opacityText:"Gjennomskinnelighet",formatText:"Format",transparentText:"Gjennomskinnelighet",cacheText:"Cache",cacheFieldText:"Bruk cachet versjon",stylesText:"Tilgjengelige Stiler",infoFormatText:"Info format",infoFormatEmptyText:"Velg et format",displayOptionsText:"Visningsvalg",queryText:"Begrensning ved filter",
scaleText:"Begrensning ved m\u00e5lestokk",minScaleText:"Minimum m\u00e5lestokk",maxScaleText:"Maximum m\u00e5lestokk",switchToFilterBuilderText:"Bytt tilbake til filter bygger",cqlPrefixText:"eller ",cqlText:"bruk CQL filter istedenfor",singleTileText:"Enkel tile",singleTileFieldText:"Bruk enkel tile"},"gxp.EmbedMapDialog.prototype":{publishMessage:"Ditt kartlag kan publisers til web!! Kopier f\u00f8lgende HTML for \u00e5 legge ditt kartlag til din webside:",heightLabel:"H\u00f8yde",widthLabel:"Bredde",
mapSizeLabel:"Kart st\u00f8rrelse",miniSizeLabel:"Mini",smallSizeLabel:"Liten",premiumSizeLabel:"Premium",largeSizeLabel:"Stor"},"gxp.WMSStylesDialog.prototype":{addStyleText:"Legg til",addStyleTip:"Legg til en ny stil",chooseStyleText:"Velg en stil",deleteStyleText:"Fjern",deleteStyleTip:"Slett den valgte stilen",editStyleText:"Editer",editStyleTip:"Editer den valgte stilen",duplicateStyleText:"Reproduser",duplicateStyleTip:"Reproduser den valgte stilen",addRuleText:"Legg til",addRuleTip:"Legg til ny regel",
newRuleText:"Ny Regel",deleteRuleText:"Fjern",deleteRuleTip:"Slett den valgte regelen",editRuleText:"Editer",editRuleTip:"Editer den valgte regelen",duplicateRuleText:"Reproduser",duplicateRuleTip:"Reproduser den valgte regelen",cancelText:"Kanseler",saveText:"Lagre",styleWindowTitle:"Bruker Stil: {0}",ruleWindowTitle:"Stil regel: {0}",stylesFieldsetTitle:"Stiler",rulesFieldsetTitle:"Regler"},"gxp.LayerUploadPanel.prototype":{titleLabel:"Titel",titleEmptyText:"Kartlags titel",abstractLabel:"Beskrivelse",
abstractEmptyText:"Kartlag beskrivelse",fileLabel:"Data",fieldEmptyText:"Bla igjennom data arkiv...",uploadText:"Last opp",uploadFailedText:"Opplasting feilet",processingUploadText:"Prosesserer opplasting...",waitMsgText:"Laster opp dataene...",invalidFileExtensionText:"Filtype m\u00e5 v\u00e6re en av: ",optionsText:"Valt",workspaceLabel:"arbeidsomr\u00e5de",workspaceEmptyText:"standard arbeidsomr\u00e5de",dataStoreLabel:"Lagre",dataStoreEmptyText:"Velg et lagringsmedium",dataStoreNewText:"Velg et nytt lagringsmedium",
crsLabel:"KRS",crsEmptyText:"Koordinat Referanse System ID",invalidCrsText:"KRS identifikatorer m\u00e5 v\u00e6re en EPSG kode (e.g. EPSG:4326)"},"gxp.NewSourceDialog.prototype":{title:"Legg til ny Server...",cancelText:"Kanseler",addServerText:"Legg til Server",invalidURLText:"Skriv inn en gyldig URL til et WMS endepunkt (f.eks. http://example.com/geoserver/wms)",contactingServerText:"Kontakter Server..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"Zoom niv\u00e5"},"gxp.Viewer.prototype":{saveErrorText:"Problemer med \u00e5 lagre: "},
"gxp.FeedSourceDialog.prototype":{feedTypeText:"Kilde",addPicasaText:"Picasa Foto",addYouTubeText:"YouTube Videoer",addRSSText:"Andre GeoRSS Feed",addFeedText:"Legg til Kart",addTitleText:"Tittel",keywordText:"N\u00f8kkelord",doneText:"Ferdig",titleText:"Legg til Feeds",maxResultsText:"Max elementer"}});
GeoExt.Lang.add("pl",{"gxp.menu.LayerMenu.prototype":{layerText:"Warstwa"},"gxp.plugins.AddLayers.prototype":{addMenuText:"Dodaj warstwy",addActionTip:"Dodaj warstwy",addServerText:"Dodaj serwer",addButtonText:"Dodaj warstwy",untitledText:"Bez tytu\u0142u",addLayerSourceErrorText:"B\u0142\u0105d w czasie pobierania parametr\u00f3w serwera WMS ({msg}).\nProsz\u0119 sprawdzi\u0107 adres.",availableLayersText:"Dost\u0119pne warstwy",expanderTemplateText:"<p><b>Opis:</b> {abstract}</p>",panelTitleText:"Tytu\u0142",
layerSelectionText:"Poka\u017c dost\u0119pne warstwy z:",doneText:"Gotowe",uploadText:"Wy\u015blij dane",addFeedActionMenuText:"Add feeds",searchText:"Search for layers"},"gxp.plugins.BingSource.prototype":{title:"Bing Maps",roadTitle:"Bing - drogi",aerialTitle:"Bing - ortofoto",labeledAerialTitle:"Bing - ortofoto z etykietami"},"gxp.plugins.FeatureEditor.prototype":{splitButtonText:"Edit",createFeatureActionText:"Create",editFeatureActionText:"Modify",createFeatureActionTip:"Utw\u00f3rz nowy obiekt",
editFeatureActionTip:"Edytuj istniej\u0105cy obiekt",commitTitle:"Commit message",commitText:"Please enter a commit message for this edit:"},"gxp.plugins.FeatureGrid.prototype":{displayFeatureText:"Poka\u017c na mapie",firstPageTip:"Pierwsza strona",previousPageTip:"Poprzednia strona",zoomPageExtentTip:"Powi\u0119ksz do zasi\u0119gu strony",nextPageTip:"Nast\u0119pna strona",lastPageTip:"Ostatnia strona",totalMsg:"Features {1} to {2} of {0}"},"gxp.plugins.GoogleEarth.prototype":{menuText:"Przegl\u0105darka 3D",
tooltip:"Prze\u0142\u0105cz do widoku 3D"},"gxp.plugins.GoogleSource.prototype":{title:"Google Maps",roadmapAbstract:"Mapa drogowa",satelliteAbstract:"Zdj\u0119cia satelitarne",hybridAbstract:"Zdj\u0119cia satelitarne z etykietami",terrainAbstract:"Mapa terenowa z etykietami"},"gxp.plugins.LayerProperties.prototype":{menuText:"W\u0142a\u015bciwo\u015bci",toolTip:"W\u0142a\u015bciwo\u015bci"},"gxp.plugins.LayerTree.prototype":{shortTitle:"Mapa",rootNodeText:"Mapa",overlayNodeText:"Warstwy",baseNodeText:"Mapa referencyjna"},
"gxp.plugins.LayerManager.prototype":{baseNodeText:"Mapa referencyjna"},"gxp.plugins.Legend.prototype":{menuText:"Legenda mapy",tooltip:"Legenda mapy"},"gxp.plugins.Measure.prototype":{buttonText:"Pomiary",lengthMenuText:"D\u0142ugo\u015b\u0107",areaMenuText:"Powierzchnia",lengthTooltip:"Pomiar odleg\u0142o\u015bci",areaTooltip:"Pomiar powierzchni",measureTooltip:"Pomiary"},"gxp.plugins.Navigation.prototype":{menuText:"Przesu\u0144 map\u0119",tooltip:"Przesu\u0144 map\u0119"},"gxp.plugins.NavigationHistory.prototype":{previousMenuText:"Poprzedni widok",
nextMenuText:"Kolejny widok",previousTooltip:"Poprzedni widok",nextTooltip:"Kolejny widok"},"gxp.plugins.OSMSource.prototype":{title:"OpenStreetMap",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>"},"gxp.plugins.Print.prototype":{buttonText:"Drukuj",menuText:"Drukuj",tooltip:"Drukuj",previewText:"Podgl\u0105d wydruku",notAllNotPrintableText:"Nie wszystkie warstwy mog\u0105 by\u0107 wydrukowane",
nonePrintableText:"\u017badna z warstw nie mo\u017ce byc wydrukowana"},"gxp.plugins.MapQuestSource.prototype":{title:"MapQuest",osmAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",
naipTitle:"MapQuest Imagery"},"gxp.plugins.QueryForm.prototype":{queryActionText:"Wyszukaj",queryMenuText:"Przeszukaj warstw\u0119",queryActionTip:"Przeszukaj zaznaczon\u0105 warstw\u0119",queryByLocationText:"Query by current map extent",queryByAttributesText:"Przeszukaj po atrybutach",queryMsg:"Przeszukiwanie...",cancelButtonText:"Anuluj",noFeaturesTitle:"Brak danych",noFeaturesMessage:"Przeszukanie nie zwr\u00f3ci\u0142o \u017cadnych danych."},"gxp.plugins.RemoveLayer.prototype":{removeMenuText:"Usu\u0144 warstw\u0119",
removeActionTip:"Usu\u0144 warstw\u0119"},"gxp.plugins.Styler.prototype":{menuText:"Eycja styli",tooltip:"Zarz\u0105dzanie stylami warstwy"},"gxp.plugins.WMSGetFeatureInfo.prototype":{buttonText:"Identify",infoActionTip:"Info o obiekcie",popupTitle:"Info o obiekcie"},"gxp.plugins.Zoom.prototype":{zoomMenuText:"Zoom Box",zoomInMenuText:"Powi\u0119ksz",zoomOutMenuText:"Pomniejsz",zoomTooltip:"Zoom by dragging a box",zoomInTooltip:"Powi\u0119ksz",zoomOutTooltip:"Pomniejsz"},"gxp.plugins.ZoomToExtent.prototype":{menuText:"Ca\u0142a mapa",
tooltip:"Ca\u0142a mapa"},"gxp.plugins.ZoomToDataExtent.prototype":{menuText:"Powi\u0119ksz do zasi\u0119gu ca\u0142ej warstwy",tooltip:"Powi\u0119ksz do zasi\u0119gu ca\u0142ej warstwy"},"gxp.plugins.ZoomToLayerExtent.prototype":{menuText:"Powi\u0119ksz do zasi\u0119gu ca\u0142ej warstwy",tooltip:"Powi\u0119ksz do zasi\u0119gu ca\u0142ej warstwy"},"gxp.plugins.ZoomToSelectedFeatures.prototype":{menuText:"Powi\u0119ksz do wybranych obiekt\u00f3w",tooltip:"Powi\u0119ksz do wybranych obiekt\u00f3w"},
"gxp.FeatureEditPopup.prototype":{closeMsgTitle:"Zapisa\u0107 zmiany?",closeMsg:"Istniej\u0105 nie zapisane zmiany. Chcesz je zapisa\u0107?",deleteMsgTitle:"Usun\u0105\u0107 obiekt?",deleteMsg:"Jeste\u015b pewien \u017ce chcesz usun\u0105\u0107 ten obiekt?",editButtonText:"Edytuj",editButtonTooltip:"Edytuj ten obiekt",deleteButtonText:"Usu\u0144",deleteButtonTooltip:"Usu\u0144 ten obiekt",cancelButtonText:"Anuluj",cancelButtonTooltip:"Anuluj edycj\u0119 i nie zapisuj zmian",saveButtonText:"Zapisz",
saveButtonTooltip:"Zapisz zmiany"},"gxp.FillSymbolizer.prototype":{fillText:"Wype\u0142nienie",colorText:"Kolor",opacityText:"Prze\u015bwit"},"gxp.FilterBuilder.prototype":{builderTypeNames:["dowolny","wszystkie","\u017caden","odwrotno\u015b\u0107"],preComboText:"Dopasuj",postComboText:"sposr\u00f3d:",addConditionText:"dodaj warunek",addGroupText:"dodaj grup\u0119",removeConditionText:"usu\u0144 warunek"},"gxp.grid.CapabilitiesGrid.prototype":{nameHeaderText:"Nazwa",titleHeaderText:"Tytu\u0142",queryableHeaderText:"Przeszukiwalna",
layerSelectionLabel:"Zobacz dost\u0119pne dane z:",layerAdditionLabel:"lub dodaj serwer.",expanderTemplateText:"<p><b>Opis:</b> {abstract}</p>"},"gxp.PointSymbolizer.prototype":{graphicCircleText:"ko\u0142o",graphicSquareText:"kwadrat",graphicTriangleText:"tr\u00f3jk\u0105t",graphicStarText:"gwiazda",graphicCrossText:"krzy\u017c",graphicXText:"x",graphicExternalText:"inny",urlText:"URL",opacityText:"Prze\u015bwit",symbolText:"Symbol",sizeText:"Rozmiar",rotationText:"Obr\u00f3t"},"gxp.QueryPanel.prototype":{queryByLocationText:"Zapytanie przestrzenne",
currentTextText:"Aktualne powi\u0119kszenie",queryByAttributesText:"Zapytanie atrybutowe",layerText:"Warstwa"},"gxp.RulePanel.prototype":{scaleSliderTemplate:"{scaleType} Skala 1:{scale}",labelFeaturesText:"Etykiety obiekt\u00f3w",labelsText:"Etykiety",basicText:"Podstawowa",advancedText:"Zaawansowana",limitByScaleText:"Ograniczenie skalowe",limitByConditionText:"Ograniczenie warunkowe",symbolText:"Symbol",nameText:"Nazwa"},"gxp.ScaleLimitPanel.prototype":{scaleSliderTemplate:"{scaleType} Skala 1:{scale}",
minScaleLimitText:"Skala min.",maxScaleLimitText:"Skala max"},"gxp.StrokeSymbolizer.prototype":{solidStrokeName:"ci\u0105g\u0142y",dashStrokeName:"kreskowany",dotStrokeName:"kropkowany",titleText:"Obrys",styleText:"Styl",colorText:"Kolor",widthText:"Grubo\u015b\u0107",opacityText:"Prze\u015bwit"},"gxp.StylePropertiesDialog.prototype":{titleText:"Og\u00f3lny",nameFieldText:"Nazwa",titleFieldText:"Tytu\u0142",abstractFieldText:"Opis"},"gxp.TextSymbolizer.prototype":{labelValuesText:"Warto\u015bci etykiet",
haloText:"Efekt Halo",sizeText:"Rozmiar"},"gxp.WMSLayerPanel.prototype":{attributionText:"Attribution",aboutText:"O",titleText:"Tytu\u0142",nameText:"Nazwa",descriptionText:"Opis",displayText:"Wy\u015bwietlanie",opacityText:"Prze\u015bwit",formatText:"Format",transparentText:"Prze\u017ar.",cacheText:"Cache",cacheFieldText:"U\u017cyj wersji cache",stylesText:"Dost\u0119pne Style",infoFormatText:"Info format",infoFormatEmptyText:"Select a format",displayOptionsText:"Display options",queryText:"Limit with filters",
scaleText:"Limit by scale",minScaleText:"Min scale",maxScaleText:"Max scale",switchToFilterBuilderText:"Switch back to filter builder",cqlPrefixText:"or ",cqlText:"use CQL filter instead",singleTileText:"Single tile",singleTileFieldText:"Use a single tile"},"gxp.EmbedMapDialog.prototype":{publishMessage:"Twoja mapa jest gotowa do publikacji! Po prostu wklej poni\u017cszy kod na swojej witrynie:",heightLabel:"Wysoko\u015b\u0107",widthLabel:"Szeroko\u015b\u0107",mapSizeLabel:"Rozmiar mapy",miniSizeLabel:"Mini",
smallSizeLabel:"Ma\u0142y",premiumSizeLabel:"\u015aredni",largeSizeLabel:"Du\u017cy"},"gxp.WMSStylesDialog.prototype":{addStyleText:"Dodaj",addStyleTip:"Dodaj nowy styl",chooseStyleText:"Wybierz styl",deleteStyleText:"Usu\u0144",deleteStyleTip:"Usu\u0144 styl",editStyleText:"Edytuj",editStyleTip:"Edytuj wybrany styl",duplicateStyleText:"Stw\u00f3rz kopi\u0119",duplicateStyleTip:"Stw\u00f3rz kopi\u0119 wybranego stylu",addRuleText:"Dodaj",addRuleTip:"Dodaj now\u0105 regu\u0142\u0119",newRuleText:"Nowa regu\u0142a",
deleteRuleText:"Usu\u0144",deleteRuleTip:"Usu\u0144 wybran\u0105 regu\u0142\u0119",editRuleText:"Edytuj",editRuleTip:"Edytuj wybran\u0105 regu\u0142\u0119",duplicateRuleText:"Stw\u00f3rz kopi\u0119",duplicateRuleTip:"Skopiuj wybran\u0105 regu\u0142\u0119",cancelText:"Anuluj",saveText:"Zapisz",styleWindowTitle:"Styl u\u017cytkownika: {0}",ruleWindowTitle:"Regu\u0142a stylu: {0}",stylesFieldsetTitle:"Style",rulesFieldsetTitle:"Regu\u0142y"},"gxp.LayerUploadPanel.prototype":{titleLabel:"Tytu\u0142",
titleEmptyText:"Tytu\u0142 warstwy",abstractLabel:"Opis",abstractEmptyText:"Opis warstwy",fileLabel:"Dane",fieldEmptyText:"Wska\u017c lokalizacj\u0119 danych...",uploadText:"Prze\u015blij",uploadFailedText:"Upload failed",processingUploadText:"Processing upload...",importText:"Importing upload...",waitMsgText:"Przesy\u0142anie danych...",invalidFileExtensionText:"Typ pliku musi by\u0107 jednym z poni\u017cszych: ",optionsText:"Opcje",workspaceLabel:"Obszar roboczy",workspaceEmptyText:"Domy\u015blny obszar roboczy",
dataStoreLabel:"Magazyn danych",dataStoreEmptyText:"Create new store",defaultDataStoreEmptyText:"Domy\u015blny magazyn danych"},"gxp.NewSourceDialog.prototype":{title:"Dodaj serwer...",cancelText:"Anuluj",addServerText:"Dodaj serwer",invalidURLText:"Podaj prawid\u0142owy adres URL us\u0142ugi WMS (n.p. http://example.com/geoserver/wms)",contactingServerText:"\u0141\u0105czenie z serwerem..."},"gxp.ScaleOverlay.prototype":{zoomLevelText:"Poziom powi\u0119kszenia"},"gxp.Viewer.prototype":{saveErrorText:"Trouble saving: "},
"gxp.FeedSourceDialog.prototype":{feedTypeText:"\u0179r\u00f3d\u0142o",addPicasaText:"Picasa zdj\u0119cia",addYouTubeText:"YouTube Videos",addRSSText:"Inne GeoRSS",addFeedText:"Dodaj do mapy",addTitleText:"Tytu\u0142",keywordText:"S\u0142owo",doneText:"Gotowe",titleText:"Dodaj kana\u0142y",maxResultsText:"Rzeczy Max"}});Ext.namespace("gxp.menu");
gxp.menu.LayerMenu=Ext.extend(Ext.menu.Menu,{layerText:"Layer",layers:null,initComponent:function(){gxp.menu.LayerMenu.superclass.initComponent.apply(this,arguments);this.layers.on("add",this.onLayerAdd,this);this.onLayerAdd()},onRender:function(a,b){gxp.menu.LayerMenu.superclass.onRender.apply(this,arguments)},beforeDestroy:function(){this.layers&&this.layers.on&&this.layers.un("add",this.onLayerAdd,this);delete this.layers;gxp.menu.LayerMenu.superclass.beforeDestroy.apply(this,arguments)},onLayerAdd:function(){this.removeAll();
this.add({iconCls:"gxp-layer-visibility",text:this.layerText,canActivate:!1},"-");this.layers.each(function(a){if(a.getLayer().displayInLayerSwitcher){var b=new Ext.menu.CheckItem({text:a.get("title"),checked:a.getLayer().getVisibility(),group:a.get("group"),listeners:{checkchange:function(b,d){a.getLayer().setVisibility(d)}}});2<this.items.getCount()?this.insert(2,b):this.add(b)}},this)}});Ext.reg("gxp_layermenu",gxp.menu.LayerMenu);Ext.namespace("gxp.form");
gxp.form.FilterField=Ext.extend(Ext.form.CompositeField,{lowerBoundaryTip:"lower boundary",upperBoundaryTip:"upper boundary",caseInsensitiveMatch:!1,filter:null,attributes:null,attributesComboConfig:null,initComponent:function(){if(!this.filter)this.filter=this.createDefaultFilter();var a="remote",b=new GeoExt.data.AttributeStore;if(this.attributes)0!=this.attributes.getCount()?(a="local",this.attributes.each(function(a){/gml:((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry)).*/.exec(a.get("type"))||
b.add([a])})):b=this.attributes;a={xtype:"combo",store:b,editable:"local"==a,typeAhead:!0,forceSelection:!0,mode:a,triggerAction:"all",ref:"property",allowBlank:this.allowBlank,displayField:"name",valueField:"name",value:this.filter.property,listeners:{select:function(a,b){this.items.get(1).enable();this.filter.property=b.get("name");this.fireEvent("change",this.filter,this)},blur:function(a){var b=a.store.findExact("name",a.getValue());-1!=b?a.fireEvent("select",a,a.store.getAt(b)):null!=a.startValue&&
a.setValue(a.startValue)},scope:this},width:120};this.attributesComboConfig=this.attributesComboConfig||{};Ext.applyIf(this.attributesComboConfig,a);this.items=this.createFilterItems();this.addEvents("change");gxp.form.FilterField.superclass.initComponent.call(this)},validateValue:function(){return this.filter.type===OpenLayers.Filter.Comparison.BETWEEN?null!==this.filter.property&&null!==this.filter.upperBoundary&&null!==this.filter.lowerBoundary:null!==this.filter.property&&null!==this.filter.value&&
null!==this.filter.type},createDefaultFilter:function(){return new OpenLayers.Filter.Comparison({matchCase:!this.caseInsensitiveMatch})},createFilterItems:function(){var a=this.filter.type===OpenLayers.Filter.Comparison.BETWEEN;return[this.attributesComboConfig,Ext.applyIf({xtype:"gxp_comparisoncombo",ref:"type",disabled:null==this.filter.property,allowBlank:this.allowBlank,value:this.filter.type,listeners:{select:function(a,c){this.items.get(2).enable();this.items.get(3).enable();this.items.get(4).enable();
this.setFilterType(c.get("value"));this.fireEvent("change",this.filter,this)},scope:this}},this.comparisonComboConfig),{xtype:"textfield",disabled:null==this.filter.type,hidden:a,ref:"value",value:this.filter.value,width:50,grow:!0,growMin:50,anchor:"100%",allowBlank:this.allowBlank,listeners:{change:function(a,c){this.filter.value=c;this.fireEvent("change",this.filter,this)},scope:this}},{xtype:"textfield",disabled:null==this.filter.type,hidden:!a,value:this.filter.lowerBoundary,tooltip:this.lowerBoundaryTip,
grow:!0,growMin:30,ref:"lowerBoundary",anchor:"100%",allowBlank:this.allowBlank,listeners:{change:function(a,c){this.filter.lowerBoundary=c;this.fireEvent("change",this.filter,this)},render:function(a){Ext.QuickTips.register({target:a.getEl(),text:this.lowerBoundaryTip})},autosize:function(a,c){a.setWidth(c);a.ownerCt.doLayout()},scope:this}},{xtype:"textfield",disabled:null==this.filter.type,hidden:!a,grow:!0,growMin:30,ref:"upperBoundary",value:this.filter.upperBoundary,allowBlank:this.allowBlank,
listeners:{change:function(a,c){this.filter.upperBoundary=c;this.fireEvent("change",this.filter,this)},render:function(a){Ext.QuickTips.register({target:a.getEl(),text:this.upperBoundaryTip})},scope:this}}]},setFilterType:function(a){this.filter.type=a;a===OpenLayers.Filter.Comparison.BETWEEN?(this.items.get(2).hide(),this.items.get(3).show(),this.items.get(4).show()):(this.items.get(2).show(),this.items.get(3).hide(),this.items.get(4).hide());this.doLayout()},setFilter:function(a){var b=this.filter.type;
this.filter=a;b!==a.type&&this.setFilterType(a.type);this.property.setValue(a.property);this.type.setValue(a.type);a.type===OpenLayers.Filter.Comparison.BETWEEN?(this.lowerBoundary.setValue(a.lowerBoundary),this.upperBoundary.setValue(a.upperBoundary)):this.value.setValue(a.value);this.fireEvent("change",this.filter,this)}});Ext.reg("gxp_filterfield",gxp.form.FilterField);Ext.namespace("gxp.menu");
gxp.menu.TimelineMenu=Ext.extend(Ext.menu.Menu,{filterLabel:"Filter",attributeLabel:"Label",showNotesText:"Show notes",layers:null,subMenuSize:[350,60],initComponent:function(){gxp.menu.TimelineMenu.superclass.initComponent.apply(this,arguments);this.timelinePanel=this.timelineTool&&this.timelineTool.getTimelinePanel();this.layers.on("add",this.onLayerAddOrRemove,this);this.layers.on("remove",this.onLayerAddOrRemove,this);this.onLayerAddOrRemove()},onRender:function(a,b){gxp.menu.TimelineMenu.superclass.onRender.apply(this,
arguments)},beforeDestroy:function(){this.layers&&this.layers.on&&(this.layers.un("add",this.onLayerAddOrRemove,this),this.layers.un("remove",this.onLayerAddOrRemove,this));delete this.layers;gxp.menu.TimelineMenu.superclass.beforeDestroy.apply(this,arguments)},onLayerAddOrRemove:function(){this.removeAll();if(this.timelinePanel.annotationsRecord){var a=this.timelinePanel.annotationsRecord,b=this.timelinePanel.getKey(a);this.add(new Ext.menu.CheckItem({text:this.showNotesText,checked:this.timelinePanel.layerLookup[b]&&
this.timelinePanel.layerLookup[b].visible||!0,listeners:{checkchange:function(b,d){this.timelinePanel.setLayerVisibility(b,d,a,!1)},scope:this}}))}this.layers.each(function(a){var b=a.getLayer();if(b.displayInLayerSwitcher&&b.dimensions&&b.dimensions.time){var b=this.timelinePanel.getKey(a),e=this.timelinePanel.schemaCache[b];this.add(new Ext.menu.CheckItem({text:a.get("title"),checked:this.timelinePanel.layerLookup[b]&&this.timelinePanel.layerLookup[b].visible||!1,menu:new Ext.menu.Menu({plain:!0,
style:{overflow:"visible"},showSeparator:!1,items:[{xtype:"container",width:this.subMenuSize[0],height:this.subMenuSize[1],layout:"vbox",defaults:{border:!1},layoutConfig:{align:"stretch",pack:"start"},items:[{xtype:"form",labelWidth:75,height:30,items:[{xtype:"combo",forceSelection:!0,getListParent:function(){return this.el.up(".x-menu")},store:e,mode:"local",triggerAction:"all",value:this.timelinePanel.layerLookup[b]?this.timelinePanel.layerLookup[b].titleAttr:null,listeners:{select:function(b){this.timelinePanel.setTitleAttribute(a,
b.getValue())},scope:this},displayField:"name",valueField:"name",fieldLabel:this.attributeLabel}]},{xtype:"container",layout:"hbox",id:"gxp_timemenufilter",layoutConfig:{align:"stretch",pack:"start"},defaults:{border:!1},items:[{width:25,xtype:"form",layout:"fit",items:[{xtype:"checkbox",checked:this.timelinePanel.layerLookup[b]&&void 0!==this.timelinePanel.layerLookup[b].clientSideFilter,ref:"../applyFilter",listeners:{check:function(b,d){var e=Ext.getCmp("gxp_timemenufilter").filter;e.isValid()&&
this.timelinePanel.applyFilter(a,e.filter,d)},scope:this}}]},{flex:1,xtype:"form",labelWidth:75,items:[{xtype:"gxp_filterfield",ref:"../filter",filter:this.timelinePanel.layerLookup[b]?this.timelinePanel.layerLookup[b].clientSideFilter:null,listeners:{change:function(b,d){d.isValid()&&this.timelinePanel.applyFilter(a,b,Ext.getCmp("gxp_timemenufilter").applyFilter.getValue())},scope:this},attributesComboConfig:{getListParent:function(){return this.el.up(".x-menu")}},comparisonComboConfig:{getListParent:function(){return this.el.up(".x-menu")}},
fieldLabel:this.filterLabel,attributes:e}]}],height:30}]}]}),listeners:{checkchange:function(b,d){this.timelinePanel.setLayerVisibility(b,d,a)},scope:this}}))}},this)}});Ext.reg("gxp_timelinemenu",gxp.menu.TimelineMenu);(function(){Ext.util.Observable.observeClass(Ext.form.TextField);Ext.form.TextField.on("specialkey",function(a,b){a.hasFocus&&b.getKey()===b.ENTER&&a.blur.defer(10,a)})})();Ext.namespace("gxp.plugins");
gxp.plugins.Tool=Ext.extend(Ext.util.Observable,{ptype:"gxp_tool",autoActivate:!0,actionTarget:"map.tbar",showButtonText:!1,output:null,constructor:function(a){this.initialConfig=a||{};this.active=!1;Ext.apply(this,a);if(!this.id)this.id=Ext.id();this.output=[];this.addEvents("activate","deactivate");gxp.plugins.Tool.superclass.constructor.apply(this,arguments)},init:function(a){a.tools[this.id]=this;this.target=a;this.autoActivate&&this.activate();this.target.on("portalready",this.addActions,this)},
activate:function(){if(!1===this.active)return this.active=!0,this.fireEvent("activate",this),!0},deactivate:function(){if(!0===this.active)return this.active=!1,this.fireEvent("deactivate",this),!0},getContainer:function(a){var b,c;b=a.split(".");if(c=b[0])if("map"==c)a=this.target.mapPanel;else{if(a=Ext.getCmp(c)||this.target.portal[c],!a)throw Error("Can't find component with id: "+c);}else a=this.target.portal;if(b=1<b.length&&b[1])a=(c={tbar:"getTopToolbar",bbar:"getBottomToolbar",fbar:"getFooterToolbar"}[b])?
a[c]():a[b];return a},addActions:function(a){a=a||this.actions;if(!a||null===this.actionTarget)this.addOutput();else{var b=this.actionTarget instanceof Array?this.actionTarget:[this.actionTarget],a=a instanceof Array?a:[a],c,d,e,f,g,h,j=null;for(e=b.length-1;0<=e;--e){if(c=b[e]){if(c instanceof Object)j=c.index,c=c.target;h=this.getContainer(c)}for(f=0,g=a.length;f<g;++f){if(!(a[f]instanceof Ext.Action||a[f]instanceof Ext.Component))if((d=Ext.getCmp(a[f]))&&(a[f]=d),"string"!=typeof a[f]){if(f==this.defaultAction)a[f].pressed=
!0;a[f]=new Ext.Action(a[f])}c=a[f];if(f==this.defaultAction&&c instanceof GeoExt.Action)c.isDisabled()?c.activateOnEnable=!0:c.control.activate();if(h){this.showButtonText&&c.setText(c.initialConfig.buttonText);h instanceof Ext.menu.Menu?c=Ext.apply(new Ext.menu.CheckItem(c),{text:c.initialConfig.menuText,group:c.initialConfig.toggleGroup,groupClass:null}):h instanceof Ext.Toolbar||(c=new Ext.Button(c));var k=null===j?h.add(c):h.insert(j,c);c=c instanceof Ext.Button?c:k;null!==j&&(j+=1);if(null!=
this.outputAction&&f==this.outputAction)c.on("click",function(){d?this.outputTarget?d.show():d.ownerCt.ownerCt.show():d=this.addOutput()},this)}}h&&(h.isVisible()?h.doLayout():h instanceof Ext.menu.Menu||h.show())}return this.actions=a}},addOutput:function(a){if(a||this.outputConfig){var a=a||{},b=this.outputTarget;b?(b=this.getContainer(b),a instanceof Ext.Component||Ext.apply(a,this.outputConfig)):(b=this.outputConfig||{},b=(new Ext.Window(Ext.apply({hideBorders:!0,shadow:!1,closeAction:"hide",
autoHeight:!b.height,layout:b.height?"fit":void 0,items:[{defaults:Ext.applyIf({autoHeight:!b.height&&!(b.defaults&&b.defaults.height)},b.defaults)}]},b))).show().items.get(0));if(b)return a=b.add(a),a.on("removed",function(a){this.output.remove(a)},this,{single:!0}),a instanceof Ext.Window?a.show():b.doLayout(),this.output.push(a),a;a=this.ptype;window.console&&console.error("Failed to create output for plugin with ptype: "+a)}},removeOutput:function(){for(var a,b=this.output.length-1;0<=b;--b)if(a=
this.output[b],this.outputTarget)if(a.ownerCt){if(a.ownerCt.remove(a),a.ownerCt instanceof Ext.Window)a.ownerCt[a.ownerCt.closeAction]()}else a.remove();else a.findParentBy(function(a){return a instanceof Ext.Window}).close();this.output=[]},getState:function(){return Ext.apply({},this.initialConfig)}});Ext.preg(gxp.plugins.Tool.prototype.ptype,gxp.plugins.Tool);Ext.namespace("gxp");
gxp.NewSourceDialog=Ext.extend(Ext.Panel,{title:"Add New Server...",cancelText:"Cancel",addServerText:"Add Server",invalidURLText:"Enter a valid URL to a WMS/WFS/TMS/REST endpoint (e.g. http://example.com/geoserver/wms)",contactingServerText:"Contacting Server...",bodyStyle:"padding: 0px",error:null,initComponent:function(){this.addEvents("urlselected");this.urlTextField=new Ext.form.TextField({fieldLabel:"URL",allowBlank:!1,width:240,msgTarget:"under",validator:this.urlValidator.createDelegate(this),
listeners:{specialkey:function(a,b){b.getKey()===b.ENTER&&this.addServer()},scope:this}});this.form=new Ext.form.FormPanel({items:[{xtype:"combo",width:240,name:"type",fieldLabel:"Type",value:"WMS",mode:"local",triggerAction:"all",store:[["WMS","Web Map Service (WMS)"],["WFS","Web Feature Service (WFS)"],["TMS","Tiled Map Service (TMS)"],["REST","ArcGIS REST Service (REST)"]]},this.urlTextField],border:!1,labelWidth:30,bodyStyle:"padding: 5px",autoWidth:!0,autoHeight:!0,listeners:{afterrender:function(){this.urlTextField.focus(!1,
!0)},scope:this}});this.bbar=[new Ext.Button({text:this.cancelText,handler:this.hide,scope:this}),new Ext.Toolbar.Fill,new Ext.Button({text:this.addServerText,iconCls:"add",handler:this.addServer,scope:this})];this.items=this.form;gxp.NewSourceDialog.superclass.initComponent.call(this);this.form.on("render",function(){this.loadMask=new Ext.LoadMask(this.form.getEl(),{msg:this.contactingServerText})},this);this.on({hide:this.reset,removed:this.reset,scope:this});this.on("urlselected",function(a,b){this.setLoading();
this.addSource(b,this.hide,function(){this.setError(this.sourceLoadFailureMessage)},this)},this)},addServer:function(){this.error=null;this.urlTextField.validate()&&this.fireEvent("urlselected",this,this.urlTextField.getValue(),this.form.getForm().findField("type").getValue())},reset:function(){this.error=null;this.urlTextField.reset();this.loadMask.hide()},urlRegExp:/^(http(s)?:)?\/\/([\w%]+:[\w%]+@)?([^@\/:]+)(:\d+)?\//i,urlValidator:function(a){a=this.urlRegExp.test(a)?!this.error||this.error:
this.invalidURLText;this.error=null;return a},setLoading:function(){this.loadMask.show()},setError:function(a){this.loadMask.hide();this.error=a;this.urlTextField.validate()},addSource:function(){}});Ext.reg("gxp_newsourcedialog",gxp.NewSourceDialog);Ext.namespace("gxp.plugins");
gxp.plugins.LayerSource=Ext.extend(Ext.util.Observable,{store:null,lazy:!1,hidden:!1,title:"",serviceTitle:"",constructor:function(a){this.initialConfig=a;Ext.apply(this,a);this.serviceTitle=this.title;this.addEvents("ready","failure");gxp.plugins.LayerSource.superclass.constructor.apply(this,arguments)},init:function(a){this.target=a;this.createStore()},getMapProjection:function(){var a=this.target.mapPanel.map.projection;return this.target.mapPanel.map.getProjectionObject()||a&&new OpenLayers.Projection(a)||
new OpenLayers.Projection("EPSG:4326")},getProjection:function(a){var a=a.getLayer(),b=this.getMapProjection();return(a.projection?a.projection instanceof OpenLayers.Projection?a.projection:new OpenLayers.Projection(a.projection):b).equals(b)?b:null},createStore:function(){this.fireEvent("ready",this)},createLayerRecord:function(){},getConfigForRecord:function(a){var b=a.getLayer();return{source:a.get("source"),name:a.get("name"),title:a.get("title"),visibility:b.getVisibility(),opacity:b.opacity||
void 0,group:a.get("group"),fixed:a.get("fixed"),selected:a.get("selected")}},getPreviewImageURL:function(){return null},getState:function(){return Ext.apply({},this.initialConfig)}});Ext.namespace("gxp.plugins");
gxp.plugins.FeedGetFeatureInfo=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_getfeedfeatureinfo",init:function(a){gxp.plugins.FeedGetFeatureInfo.superclass.init.apply(this,arguments);this.target.mapPanel.layers.on({add:this.addLayer,remove:this.removeLayer,scope:this})},addLayer:function(a,b){for(var c=0,d=b.length;c<d;++c){var e=b[c],f=this.target.getSource(e),e=e.getLayer();if(f instanceof gxp.plugins.FeedSource)null==this.target.selectControl?(this.target.selectControl=new OpenLayers.Control.SelectFeature(e,
{clickout:!0,listeners:{clickoutFeature:function(){}},scope:this}),this.target.mapPanel.map.addControl(this.target.selectControl)):(f=this.target.selectControl.layers?this.target.selectControl.layers:this.target.selectControl.layer?[this.target.selectControl.layer]:[],f.push(e),this.target.selectControl.setLayer(f))}this.target.selectControl&&this.target.selectControl.activate()},removeLayer:function(a,b){b.length||(b=[b]);for(var c=0,d=b.length;c<d;++c){var e=b[c].getLayer(),f=this.target.selectControl;
if(null!=f)if(f.layers)for(var g=0;g<f.layers.length;g++){var h=f.layers;f.layers[g].id===e.id&&(h.splice(g,1),f.setLayer(h))}else null!=f.layer&&e.id===f.layer.id&&f.setLayer([])}}});Ext.preg(gxp.plugins.FeedGetFeatureInfo.prototype.ptype,gxp.plugins.FeedGetFeatureInfo);Ext.namespace("gxp.plugins");
gxp.plugins.FeedSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_feedsource",title:"Feed Source",format:"OpenLayers.Format.GeoRSS",popupTemplate:'<a target="_blank" href="{link}">{description}</a>',fixed:!0,createLayerRecord:function(a){var b=new OpenLayers.Layer.Vector(a.name,{projection:"projection"in a?a.projection:"EPSG:4326",visibility:"visibility"in a?a.visibility:!0,strategies:[this.fixed?new OpenLayers.Strategy.Fixed:new OpenLayers.Strategy.BBOX({resFactor:1,ratio:1})],protocol:new OpenLayers.Protocol.HTTP({url:this.url,
params:a.params,format:this.getFormat(a)}),styleMap:this.getStyleMap(a)});this.configureInfoPopup(b);var c=GeoExt.data.LayerRecord.create([{name:"name",type:"string"},{name:"source",type:"string"},{name:"group",type:"string"},{name:"fixed",type:"boolean"},{name:"selected",type:"boolean"},{name:"visibility",type:"boolean"},{name:"format",type:"string"},{name:"defaultStyle"},{name:"selectStyle"},{name:"params"}]),d="format"in a?a.format:this.format;return new c({layer:b,name:a.name,source:a.source,
group:a.group,fixed:"fixed"in a?a.fixed:!1,selected:"selected"in a?a.selected:!1,params:"params"in a?a.params:{},visibility:"visibility"in a?a.visibility:!1,format:d instanceof String?d:null,defaultStyle:"defaultStyle"in a?a.defaultStyle:{},selectStyle:"selectStyle"in a?a.selectStyle:{}},b.id)},getConfigForRecord:function(a){var b=gxp.plugins.FeedSource.superclass.getConfigForRecord.apply(this,arguments);return Ext.apply(b,{name:a.get("name"),group:a.get("group"),fixed:a.get("fixed"),selected:a.get("selected"),
params:a.get("params"),visibility:a.getLayer().getVisibility(),format:a.get("format"),defaultStyle:a.getLayer().styleMap.styles["default"].defaultStyle,selectStyle:a.getLayer().styleMap.styles.select.defaultStyle})},getFormat:function(a){var b=window,a="format"in a?a.format:this.format;if("string"==typeof a||a instanceof String){for(var a=a.split("."),c=0,d=a.length;c<d&&!(b=b[a[c]],!b);++c);if(b&&b.prototype&&b.prototype.initialize)return a=function(){b.prototype.initialize.apply(this)},a.prototype=
b.prototype,new a}else return a},configureInfoPopup:function(a){var b=new Ext.XTemplate(this.popupTemplate);a.events.on({featureselected:function(a){a=a.feature;if(this.target.selectControl)this.target.selectControl.popup&&this.target.selectControl.popup.close(),this.target.selectControl.popup=new GeoExt.Popup({title:a.attributes.title,closeAction:"destroy",location:a,html:b.apply(a.attributes)}),this.target.selectControl.popup.show()},featureunselected:function(){this.target.selectControl&&this.target.selectControl.popup&&
this.target.selectControl.popup.close()},scope:this})},getStyleMap:function(a){return new OpenLayers.StyleMap({"default":new OpenLayers.Style("defaultStyle"in a?a.defaultStyle:{graphicName:"circle",pointRadius:5,fillOpacity:0.7,fillColor:"Red"},{title:a.name}),select:new OpenLayers.Style("selectStyle"in a?a.selectStyle:{graphicName:"circle",pointRadius:10,fillOpacity:1,fillColor:"Yellow"})})}});Ext.preg(gxp.plugins.FeedSource.prototype.ptype,gxp.plugins.FeedSource);Ext.namespace("gxp.plugins");
gxp.plugins.PicasaFeedSource=Ext.extend(gxp.plugins.FeedSource,{ptype:"gxp_picasasource",url:"http://picasaweb.google.com/data/feed/base/all?thumbsize=160c&",format:"OpenLayers.Format.Picasa",title:"Picasa Photos",pointRadius:14,popupTemplate:'<tpl for="."><a target="_blank" href="{link}"><img  title="{title}" src="{thumbnail}"/></a></tpl>',fixed:!1,createLayerRecord:function(a){Ext.isEmpty(a.params["max-results"])&&(a.params["max-results"]=50);a.url=this.url;this.format=new OpenLayers.Format.GeoRSS({createFeatureFromItem:function(a){var b=
OpenLayers.Format.GeoRSS.prototype.createFeatureFromItem.apply(this,arguments);b.attributes.thumbnail=this.getElementsByTagNameNS(a,"http://search.yahoo.com/mrss/","thumbnail")[0].getAttribute("url");b.attributes.content=OpenLayers.Util.getXmlNodeValue(this.getElementsByTagNameNS(a,"*","summary")[0]);return b}});var b=gxp.plugins.PicasaFeedSource.superclass.createLayerRecord.apply(this,arguments);b.getLayer().protocol.filterToParams=function(a,b){if(a.type===OpenLayers.Filter.Spatial.BBOX){var e=
a.value.toArray();b.bbox=[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]}return b};return b},configureInfoPopup:function(a){var b=new Ext.XTemplate(this.popupTemplate);a.events.on({featureselected:function(a){a=a.feature;null!=this.target.selectControl.popup&&this.target.selectControl.popup.close();var d=document.createElement("div");d.innerHTML=a.attributes.content;d={link:d.getElementsByTagName("a")[0].getAttribute("href"),title:a.attributes.title,thumbnail:a.attributes.thumbnail};
this.target.selectControl.popup=new GeoExt.Popup({title:a.attributes.title,closeAction:"destroy",location:a,width:175,height:200,html:b.apply(d)});this.target.selectControl.popup.show()},featureunselected:function(){this.target.selectControl&&this.target.selectControl.popup&&this.target.selectControl.popup.close()},scope:this})},getStyleMap:function(){return new OpenLayers.StyleMap({"default":new OpenLayers.Style({externalGraphic:"${thumbnail}",pointRadius:this.pointRadius},{title:this.title}),select:new OpenLayers.Style({pointRadius:this.pointRadius+
5})})}});Ext.preg(gxp.plugins.PicasaFeedSource.prototype.ptype,gxp.plugins.PicasaFeedSource);Ext.namespace("gxp.plugins");
gxp.plugins.YouTubeFeedSource=Ext.extend(gxp.plugins.FeedSource,{ptype:"gxp_youtubesource",url:"http://gdata.youtube.com/feeds/api/videos?v=2&prettyprint=true&",format:"OpenLayers.Format.YouTube",title:"Youtube Videos",pointRadius:24,popupTemplate:'<tpl for="."><a target="_blank" href="{link}"><img height="180"  width="240" title="{title}" src="{thumbnail}"/></a></tpl>',fixed:!1,createLayerRecord:function(a){a.params["max-results"]=Ext.isEmpty(a.params["max-results"])?50:Math.min(a.params["max-results"],
50);a.url=this.url;this.format=new OpenLayers.Format.GeoRSS({createFeatureFromItem:function(a){var b=OpenLayers.Format.GeoRSS.prototype.createFeatureFromItem.apply(this,arguments);b.attributes.thumbnail=this.getElementsByTagNameNS(a,"http://search.yahoo.com/mrss/","thumbnail")[4].getAttribute("url");b.attributes.content=OpenLayers.Util.getXmlNodeValue(this.getElementsByTagNameNS(a,"*","summary")[0]);return b}});var b=gxp.plugins.YouTubeFeedSource.superclass.createLayerRecord.apply(this,arguments);
b.getLayer().protocol.filterToParams=function(a,b){if(a.type===OpenLayers.Filter.Spatial.BBOX){var e=a.value,f=e.getCenterLonLat(),e=Math.min(2*((6378.137*e.right/180/3.1415926-6378.137*e.left/180/3.1415926)/2),1E3);Ext.apply(b,{location:""+f.lat+","+f.lon,"location-radius":e+"km"})}return b};return b},configureInfoPopup:function(a){var b=new Ext.XTemplate(this.popupTemplate);a.events.on({featureselected:function(a){a=a.feature;null!=this.target.selectControl.popup&&this.target.selectControl.popup.close();
this.target.selectControl.popup=new GeoExt.Popup({title:a.attributes.title,location:a,width:240,height:220,closeAction:"destroy",html:b.apply(a.attributes)});this.target.selectControl.popup.show()},featureunselected:function(){this.target.selectControl&&this.target.selectControl.popup&&this.target.selectControl.popup.close()},scope:this})},getStyleMap:function(){return new OpenLayers.StyleMap({"default":new OpenLayers.Style({externalGraphic:"${thumbnail}",pointRadius:24},{title:this.title}),select:new OpenLayers.Style({pointRadius:this.pointRadius+
5})})}});Ext.preg(gxp.plugins.YouTubeFeedSource.prototype.ptype,gxp.plugins.YouTubeFeedSource);Ext.namespace("gxp");
gxp.PointSymbolizer=Ext.extend(Ext.Panel,{symbolizer:null,graphicCircleText:"Circle",graphicSquareText:"Square",graphicTriangleText:"Triangle",graphicStarText:"Star",graphicCrossText:"Cross",graphicXText:"X",graphicExternalText:"External",urlText:"URL",opacityText:"opacity",symbolText:"Symbol",sizeText:"Size",rotationText:"Rotation",pointGraphics:null,colorManager:null,external:null,layout:"form",initComponent:function(){if(!this.symbolizer)this.symbolizer={};this.symbolizer.graphicName||(this.symbolizer.graphicName=
"circle");this.symbolizer.rotation||(this.symbolizer.rotation=0);if(!this.pointGraphics)this.pointGraphics=[{display:this.graphicCircleText,value:"circle",mark:!0},{display:this.graphicSquareText,value:"square",mark:!0},{display:this.graphicTriangleText,value:"triangle",mark:!0},{display:this.graphicStarText,value:"star",mark:!0},{display:this.graphicCrossText,value:"cross",mark:!0},{display:this.graphicXText,value:"x",mark:!0},{display:this.graphicExternalText}];this.external=!!this.symbolizer.externalGraphic;
this.markPanel=new Ext.Panel({border:!1,collapsed:this.external,layout:"form",items:[{xtype:"gxp_fillsymbolizer",symbolizer:this.symbolizer,labelWidth:this.labelWidth,labelAlign:this.labelAlign,colorManager:this.colorManager,listeners:{change:function(){this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"gxp_strokesymbolizer",symbolizer:this.symbolizer,labelWidth:this.labelWidth,labelAlign:this.labelAlign,colorManager:this.colorManager,listeners:{change:function(){this.fireEvent("change",
this.symbolizer)},scope:this}}]});this.urlField=new Ext.form.TextField({name:"url",fieldLabel:this.urlText,value:this.symbolizer.externalGraphic,hidden:!this.external,listeners:{change:function(a,b){this.symbolizer.externalGraphic=b;this.fireEvent("change",this.symbolizer)},scope:this},width:100});this.graphicPanel=new Ext.Panel({border:!1,collapsed:!this.external,layout:"form",items:[this.urlField,{xtype:"slider",name:"opacity",fieldLabel:this.opacityText,value:[null==this.symbolizer.graphicOpacity?
100:100*this.symbolizer.graphicOpacity],isFormField:!0,listeners:{changecomplete:function(a,b){this.symbolizer.graphicOpacity=b/100;this.fireEvent("change",this.symbolizer)},scope:this},plugins:[new GeoExt.SliderTip({getText:function(a){return a.value+"%"}})],width:100}]});this.items=[{xtype:"combo",name:"mark",fieldLabel:this.symbolText,store:new Ext.data.JsonStore({data:{root:this.pointGraphics},root:"root",fields:["value","display","preview",{name:"mark",type:"boolean"}]}),value:this.external?
0:this.symbolizer.graphicName,displayField:"display",valueField:"value",tpl:new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item gx-pointsymbolizer-mark-item"><tpl if="preview"><img src="{preview}" alt="{display}"/></tpl><span>{display}</span></div></tpl>'),mode:"local",allowBlank:!1,triggerAction:"all",editable:!1,listeners:{select:function(a,b){var c=b.get("mark"),d=b.get("value");if(c){if(this.external)this.external=!1,delete this.symbolizer.externalGraphic,this.updateGraphicDisplay();
this.symbolizer.graphicName=d}else if(d?(this.urlField.hide(),this.symbolizer.externalGraphic=d):this.urlField.show(),!this.external)this.external=!0,c=this.urlField.getValue(),Ext.isEmpty(c)||(this.symbolizer.externalGraphic=c),delete this.symbolizer.graphicName,this.updateGraphicDisplay();this.fireEvent("change",this.symbolizer)},scope:this},width:100},{xtype:"textfield",name:"size",fieldLabel:this.sizeText,value:this.symbolizer.pointRadius&&2*this.symbolizer.pointRadius,listeners:{change:function(a,
b){this.symbolizer.pointRadius=b/2;this.fireEvent("change",this.symbolizer)},scope:this},width:100},{xtype:"textfield",name:"rotation",fieldLabel:this.rotationText,value:this.symbolizer.rotation,listeners:{change:function(a,b){this.symbolizer.rotation=b;this.fireEvent("change",this.symbolizer)},scope:this},width:100},this.markPanel,this.graphicPanel];this.addEvents("change");gxp.PointSymbolizer.superclass.initComponent.call(this)},updateGraphicDisplay:function(){this.external?(this.markPanel.collapse(),
this.graphicPanel.expand()):(this.graphicPanel.collapse(),this.markPanel.expand())}});Ext.reg("gxp_pointsymbolizer",gxp.PointSymbolizer);Ext.namespace("gxp");
gxp.FeedSourceDialog=Ext.extend(Ext.Container,{feedTypeText:"Source",addPicasaText:"Picasa Photos",addYouTubeText:"YouTube Videos",addRSSText:"GeoRSS Feed",addFeedText:"Add to Map",addTitleText:"Title",keywordText:"Keyword",doneText:"Done",titleText:"Add Feeds",maxResultsText:"Max Items",width:300,autoHeight:!0,closeAction:"destroy",initComponent:function(){this.addEvents("addfeed");if(!this.feedTypes)this.feedTypes=[[gxp.plugins.PicasaFeedSource.ptype,this.addPicasaText],[gxp.plugins.YouTubeFeedSource.ptype,
this.addYouTubeText],[gxp.plugins.FeedSource.ptype,this.addRSSText]];var a=new Ext.data.ArrayStore({fields:["type","name"],data:this.feedTypes}),b=new Ext.form.ComboBox({store:a,fieldLabel:this.feedTypeText,displayField:"name",valueField:"type",typeAhead:!0,width:180,mode:"local",triggerAction:"all",emptyText:"Select a feed source...",selectOnFocus:!0,listeners:{select:function(a){a.value==gxp.plugins.FeedSource.ptype?(c.show(),d.hide(),f.hide(),g.show()):(c.hide(),d.show(),f.show(),g.hide());h.setDisabled(null==
a.value)},scope:this}}),c=new Ext.form.TextField({fieldLabel:"URL",allowBlank:!1,width:180,msgTarget:"right",validator:this.urlValidator.createDelegate(this)}),d=new Ext.form.TextField({fieldLabel:this.keywordText,allowBlank:!0,hidden:!0,width:180,msgTarget:"right"}),e=new Ext.form.TextField({fieldLabel:this.addTitleText,allowBlank:!0,width:180,msgTarget:"right"}),f=new Ext.form.ComboBox({fieldLabel:this.maxResultsText,hidden:!0,hiddenName:"max-results",store:new Ext.data.ArrayStore({fields:["max-results"],
data:[[10],[25],[50],[100]]}),displayField:"max-results",mode:"local",triggerAction:"all",emptyText:"Choose number...",labelWidth:70,width:180,defaults:{labelWidth:70,width:180}}),g=new gxp.PointSymbolizer({bodyStyle:{padding:"10px"},width:280,border:!1,hidden:!0,labelWidth:70,defaults:{labelWidth:70},symbolizer:{pointGraphics:"circle",pointRadius:"5"}});g.find("name","rotation")[0].hidden=!0;if("Point"===this.symbolType&&this.pointGraphics)cfg.pointGraphics=this.pointGraphics;var h=new Ext.Button({text:this.addFeedText,
iconCls:"gxp-icon-addlayers",disabled:!0,handler:function(){var a=b.getValue(),h={name:e.getValue()};if("gxp_feedsource"!=a)h.params={q:d.getValue(),"max-results":f.getValue()};else{h.url=c.getValue();var l=g.symbolizer;h.defaultStyle={};h.selectStyle={};Ext.apply(h.defaultStyle,l);Ext.apply(h.selectStyle,l);Ext.apply(h.selectStyle,{fillColor:"Yellow",pointRadius:parseInt(l.pointRadius)+2})}this.fireEvent("addfeed",a,h)},scope:this}),a=["->",h,new Ext.Button({text:this.doneText,handler:function(){this.hide()},
scope:this})];this.items=this.panel=new Ext.Panel({bbar:a,autoScroll:!0,items:[b,e,c,d,f,g],layout:"form",border:!1,labelWidth:100,bodyStyle:"padding: 5px",autoWidth:!0,autoHeight:!0});gxp.FeedSourceDialog.superclass.initComponent.call(this)},urlRegExp:/^(http(s)?:)?\/\/([\w%]+:[\w%]+@)?([^@\/:]+)(:\d+)?\//i,urlValidator:function(a){a=this.urlRegExp.test(a)?!this.error||this.error:this.invalidURLText;this.error=null;return a}});Ext.reg("gxp_feedsourcedialog",gxp.FeedSourceDialog);Ext.namespace("gxp");
gxp.util={_uniqueNames:{},getOGCExceptionText:function(a){var b;a&&a.exceptions?(b=[],Ext.each(a.exceptions,function(a){Ext.each(a.texts,function(a){b.push(a)})}),b=b.join("\n")):b="Unknown error (no exception report).";return b},dispatch:function(a,b,c){function d(){++g;g===f&&b.call(c,h)}function e(b){window.setTimeout(function(){a[b].apply(c,[d,h])})}for(var b=b||Ext.emptyFn,c=c||this,f=a.length,g=0,h={},j=0;j<f;++j)e(j)},uniqueName:function(a,b){var b=b||" ",c=RegExp(b+"[0-9]*$"),d=a.replace(c,
""),c=c.exec(a),c=void 0!==this._uniqueNames[d]?this._uniqueNames[d]:c instanceof Array?Number(c[0]):void 0,e=d;void 0!==c&&(c++,e+=b+c);this._uniqueNames[d]=c||0;return e},getAbsoluteUrl:function(a){var b;Ext.isIE6||Ext.isIE7||Ext.isIE8?(b=document.createElement("<a href='"+a+"'/>"),b.style.display="none",document.body.appendChild(b),b.href=b.href,document.body.removeChild(b)):(b=document.createElement("a"),b.href=a);return b.href},throttle:function(){var a=function(a,c,d){var e,f,g,h,j=function(){a.apply(d||
this,g);e=(new Date).getTime()};return function(){f=(new Date).getTime()-e;g=arguments;clearTimeout(h);!e||f>=c?j():h=setTimeout(j,c-f)}};return function(b,c,d){return a(b,c,d)}}(),md5:function(){function a(a){return String.fromCharCode(a&255)+String.fromCharCode(a>>>8&255)+String.fromCharCode(a>>>16&255)+String.fromCharCode(a>>>24&255)}function b(a){for(;0>a;)a+=4294967296;for(;4294967295<a;)a-=4294967296;return a}var c=[0,3614090360,3905402710,606105819,3250441966,4118548399,1200080426,2821735955,
4249261313,1770035416,2336552879,4294925233,2304563134,1804603682,4254626195,2792965006,1236535329,4129170786,3225465664,643717713,3921069994,3593408605,38016083,3634488961,3889429448,568446438,3275163606,4107603335,1163531501,2850285829,4243563512,1735328473,2368359562,4294588738,2272392833,1839030562,4259657740,2763975236,1272893353,4139469664,3200236656,681279174,3936430074,3572445317,76029189,3654602809,3873151461,530742520,3299628645,4096336452,1126891415,2878612391,4237533241,1700485571,2399980690,
4293915773,2240044497,1873313359,4264355552,2734768916,1309151649,4149444226,3174756917,718787259,3951481745],d=[[function(a,b,c){return a&b|~a&c},[[0,7,1],[1,12,2],[2,17,3],[3,22,4],[4,7,5],[5,12,6],[6,17,7],[7,22,8],[8,7,9],[9,12,10],[10,17,11],[11,22,12],[12,7,13],[13,12,14],[14,17,15],[15,22,16]]],[function(a,b,c){return a&c|b&~c},[[1,5,17],[6,9,18],[11,14,19],[0,20,20],[5,5,21],[10,9,22],[15,14,23],[4,20,24],[9,5,25],[14,9,26],[3,14,27],[8,20,28],[13,5,29],[2,9,30],[7,14,31],[12,20,32]]],[function(a,
b,c){return a^b^c},[[5,4,33],[8,11,34],[11,16,35],[14,23,36],[1,4,37],[4,11,38],[7,16,39],[10,23,40],[13,4,41],[0,11,42],[3,16,43],[6,23,44],[9,4,45],[12,11,46],[15,16,47],[2,23,48]]],[function(a,b,c){return b^(a|~c)},[[0,6,49],[7,10,50],[14,15,51],[5,21,52],[12,6,53],[3,10,54],[10,15,55],[1,21,56],[8,6,57],[15,10,58],[6,15,59],[13,21,60],[4,6,61],[11,10,62],[2,15,63],[9,21,64]]]];return function(e){var f,g,h,j,k,l,n,m,o,q,r;f=[1732584193,4023233417,2562383102,271733878];g=e.length;h=g&63;j=56>h?
56-h:120-h;if(0<j){e+="\u0080";for(h=0;h<j-1;h++)e+="\x00"}e+=a(8*g);e+=a(0);g+=j+8;j=[0,1,2,3];k=[16];l=[4];for(q=0;q<g;q+=64){for(h=0,o=q;16>h;h++,o+=4)k[h]=e.charCodeAt(o)|e.charCodeAt(o+1)<<8|e.charCodeAt(o+2)<<16|e.charCodeAt(o+3)<<24;for(h=0;4>h;h++)l[h]=f[h];for(h=0;4>h;h++){n=d[h][0];m=d[h][1];for(o=0;16>o;o++){r=k;var s=l,u=m[o],w=void 0,x=void 0,v=void 0,z=void 0,t=void 0,y=void 0,A=void 0,v=t=void 0,w=j[0],x=j[1],v=j[2],z=j[3],t=u[0],y=u[1],A=u[2],v=n(s[x],s[v],s[z]),t=s[w]+v+r[t]+c[A],
t=b(t),t=t<<y|t>>>32-y,t=t+s[x];s[w]=b(t);r=j[0];j[0]=j[3];j[3]=j[2];j[2]=j[1];j[1]=r}}for(h=0;4>h;h++)f[h]+=l[h],f[h]=b(f[h])}h=a(f[0])+a(f[1])+a(f[2])+a(f[3]);f="";for(e=0;16>e;e++)g=h.charCodeAt(e),f+="0123456789abcdef".charAt(g>>4&15),f+="0123456789abcdef".charAt(g&15);return f}}()};
(function(){function a(a){var c=this.meta.format;if("string"===typeof a||a.nodeType){var a=c.read(a),d=c.read;c.read=function(){c.read=d;return a}}this.raw=a}Ext.intercept(GeoExt.data.WMSCapabilitiesReader.prototype,"readRecords",a);GeoExt.data.AttributeReader&&Ext.intercept(GeoExt.data.AttributeReader.prototype,"readRecords",a)})();Ext.namespace("gxp.plugins");
gxp.plugins.WMSSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_wmssource",baseParams:null,format:null,describeLayerStore:null,describedLayers:null,schemaCache:null,ready:!1,version:"1.1.1",requiredProperties:["title","bbox"],owsPreviewStrategies:["attributionlogo","getlegendgraphic"],constructor:function(a){if(a&&!0===a.forceLazy)a.requiredProperties=[],delete a.forceLazy,window.console&&console.warn("Deprecated config option 'forceLazy: true' for layer source '"+a.id+"'. Use 'requiredProperties: []' instead.");
gxp.plugins.WMSSource.superclass.constructor.apply(this,arguments);if(!this.format)this.format=new OpenLayers.Format.WMSCapabilities({keepData:!0})},init:function(a){gxp.plugins.WMSSource.superclass.init.apply(this,arguments);this.target.on("authorizationchange",this.onAuthorizationChange,this)},getPreviewImageURL:function(a,b,c){var d;a.data.scalePreviewImage=!1;if(0<=this.owsPreviewStrategies.indexOf("attributionlogo")&&a.data.attribution&&a.data.attribution.logo&&a.data.attribution.logo.href)d=
a.data.attribution.logo.href,a.data.scalePreviewImage=!0;!d&&0<=this.owsPreviewStrategies.indexOf("getlegendgraphic")&&(d=a.data.layer.url+"REQUEST=GetLegendGraphic&VERSION=1.1.1&FORMAT=image/png&WIDTH="+b+"&HEIGHT="+c+"&LAYER="+a.data.name);return d},onAuthorizationChange:function(){if(this.store&&"/"===this.url.charAt(0)){var a=this.store.lastOptions||{params:{}};Ext.apply(a.params,{_dc:Math.random()});this.store.reload(a)}},destroy:function(){this.target.un("authorizationchange",this.onAuthorizationChange,
this);gxp.plugins.WMSSource.superclass.destroy.apply(this,arguments)},isLazy:function(){var a=!0,b=this.target.initialConfig.map;if(b&&b.layers)for(var c,d=0,e=b.layers.length;d<e&&!(c=b.layers[d],c.source===this.id&&(a=this.layerConfigComplete(c),!1===a));++d);return a},layerConfigComplete:function(a){var b=!0;if(!Ext.isObject(a.capability))for(var c=this.requiredProperties,d=c.length-1;0<=d&&!(b=!!a[c[d]],!1===b);--d);return b},createStore:function(){var a=this.baseParams||{SERVICE:"WMS",REQUEST:"GetCapabilities"};
if(this.version)a.VERSION=this.version;this.store=new GeoExt.data.WMSCapabilitiesStore({url:this.trimUrl(this.url,a),baseParams:a,format:this.format,autoLoad:!0,layerParams:{exceptions:null},listeners:{load:function(){if(!this.store.reader.raw||!this.store.reader.raw.service)this.fireEvent("failure",this,"Invalid capabilities document.");else{this.serviceTitle=this.store.reader.raw.service.title;if(!this.title||0==this.title.length)this.title=this.serviceTitle;this.ready?this.lazy=!1:(this.ready=
!0,this.fireEvent("ready",this))}delete this.format.data},exception:function(a,c,d,e,f,g){delete this.store;a="";"response"===c?"string"==typeof g?c=g:(c="Invalid response from server.",(a=this.format&&this.format.data)&&a.parseError&&(c+="  "+a.parseError.reason+" - line: "+a.parseError.line),f=f.status,a=200<=f&&300>f?gxp.util.getOGCExceptionText(g&&g.arg&&g.arg.exceptionReport):"Status: "+f):(c="Trouble creating layer store from response.",a="Unable to handle response.");this.fireEvent("failure",
this,c+"\n"+a);delete this.format.data},scope:this}})},trimUrl:function(a,b){var c=OpenLayers.Util.getParameters(a),b=OpenLayers.Util.upperCaseObject(b),d=0,e;for(e in c)++d,e.toUpperCase()in b&&(--d,delete c[e]);return a.split("?").shift()+(d?"?"+OpenLayers.Util.getParameterString(c):"")},createLazyLayerRecord:function(a){var a=Ext.apply({},a),b=a.srs||this.target.map.projection;a.srs={};a.srs[b]=!0;var c=a.bbox||this.target.map.maxExtent||OpenLayers.Projection.defaults[b].maxExtent;a.bbox={};a.bbox[b]=
{bbox:c};c=this.store&&this.store instanceof GeoExt.data.WMSCapabilitiesStore?new this.store.recordType(a):new GeoExt.data.LayerRecord(a);c.setLayer(new OpenLayers.Layer.WMS(a.title||a.name,a.url||this.url,{layers:a.name,transparent:"transparent"in a?a.transparent:!0,cql_filter:a.cql_filter,format:a.format},{projection:b,eventListeners:{tileloaded:this.countAlive,tileerror:this.countAlive,scope:this}}));c.json=a;return c},countAlive:function(a){if(!("_alive"in a.object.metadata))a.object.metadata._alive=
0,a.object.events.register("loadend",this,this.removeDeadLayer);a.object.metadata._alive+="tileerror"==a.type?-1:1},removeDeadLayer:function(a){a.object.events.un({tileloaded:this.countAlive,tileerror:this.countAlive,loadend:this.removeDeadLayer,scope:this});0===a.object.metadata._alive&&(this.target.mapPanel.map.removeLayer(a.object),window.console&&console.debug("Unavailable layer "+a.object.name+" removed."));delete a.object.metadata._alive},createLayerRecord:function(a){var b,c,d=this.store.findExact("name",
a.name);-1<d?c=this.store.getAt(d):Ext.isObject(a.capability)?c=this.store.reader.readRecords({capability:{request:{getmap:{href:this.trimUrl(this.url,this.baseParams)}},layers:[a.capability]}}).records[0]:this.layerConfigComplete(a)&&(c=this.createLazyLayerRecord(a));if(c){b=c.getLayer().clone();var d=this.getMapProjection(),e=this.getProjection(c);e&&b.addOptions({projection:e});var e=(e||d).getCode(),f=c.get("bbox"),g;if(f&&f[e])g=OpenLayers.Bounds.fromArray(f[e].bbox,b.reverseAxisOrder());else if(e=
c.get("llbbox"))e[0]=Math.max(e[0],-180),e[1]=Math.max(e[1],-90),e[2]=Math.min(e[2],180),e[3]=Math.min(e[3],90),g=OpenLayers.Bounds.fromArray(e).transform("EPSG:4326",d);b.mergeNewParams({STYLES:a.styles,FORMAT:a.format,TRANSPARENT:a.transparent,CQL_FILTER:a.cql_filter});d=!0;"tiled"in a&&(d=!a.tiled);b.setName(a.title||b.name);b.addOptions({attribution:b.attribution||a.attribution,maxExtent:g,restrictedExtent:g,singleTile:d,ratio:a.ratio||1,visibility:"visibility"in a?a.visibility:!0,opacity:"opacity"in
a?a.opacity:1,buffer:"buffer"in a?a.buffer:1,dimensions:c.data.dimensions,transitionEffect:d?"resize":null,minScale:a.minscale,maxScale:a.maxscale,queryable:c.get("queryable")});g=Ext.applyIf({title:b.name,group:a.group,infoFormat:a.infoFormat,getFeatureInfo:a.getFeatureInfo,source:a.source,properties:"gxp_wmslayerpanel",fixed:a.fixed,selected:"selected"in a?a.selected:!1,restUrl:this.restUrl,layer:b},c.data);var h=[{name:"source",type:"string"},{name:"group",type:"string"},{name:"properties",type:"string"},
{name:"fixed",type:"boolean"},{name:"selected",type:"boolean"},{name:"restUrl",type:"string"},{name:"infoFormat",type:"string"},{name:"getFeatureInfo"}];c.fields.each(function(a){h.push(a)});b=new (GeoExt.data.LayerRecord.create(h))(g,b.id);b.json=a}else window.console&&0<this.store.getCount()&&void 0!==a.name&&console.warn("Could not create layer record for layer '"+a.name+"'. Check if the layer is found in the WMS GetCapabilities response.");return b},getProjection:function(a){var b=this.getMapProjection(),
c=b,a=a.get("srs");if(!a[b.getCode()]){var c=null,d,e;for(e in a)if((d=new OpenLayers.Projection(e)).equals(b)){c=d;break}}return c},initDescribeLayerStore:function(){var a=this.store.reader.raw;this.lazy&&(a={capability:{request:{describelayer:{href:this.url}}},version:this.version||"1.1.1"});var b=a.capability.request.describelayer;if(b)a=a.version,1.1<parseFloat(a)&&(a="1.1.1"),a={SERVICE:"WMS",VERSION:a,REQUEST:"DescribeLayer"},this.describeLayerStore=new GeoExt.data.WMSDescribeLayerStore({url:this.trimUrl(b.href,
a),baseParams:a})},describeLayer:function(a,b,c){function d(a){window.setTimeout(function(){b.call(c,a)},0)}this.describeLayerStore||this.initDescribeLayerStore();if(this.describeLayerStore){if(!this.describedLayers)this.describedLayers={};var e=a.getLayer().params.LAYERS,a=function(){for(var a=Ext.isArray(arguments[1])?arguments[1]:arguments[0],d,g,l=a.length-1;0<=l;l--){d=a[l];g=d.get("layerName");if(g==e){this.describeLayerStore.un("load",arguments.callee,this);this.describedLayers[g]=!0;b.call(c,
d);return}"function"==typeof this.describedLayers[g]&&(d=this.describedLayers[g],this.describeLayerStore.un("load",d,this),d.apply(this,arguments))}delete f[e];b.call(c,!1)},f=this.describedLayers,g;if(f[e])if(-1==(g=this.describeLayerStore.findExact("layerName",e)))this.describeLayerStore.on("load",a,this);else d(this.describeLayerStore.getAt(g));else f[e]=a,this.describeLayerStore.load({params:{LAYERS:e},add:!0,callback:a,scope:this})}else d(!1)},fetchSchema:function(a,b,c,d){var e=this.schemaCache[b];
if(e)if(0==e.getCount())e.on("load",function(){c.call(d,e)},this,{single:!0});else c.call(d,e);else e=new GeoExt.data.AttributeStore({url:a,baseParams:{SERVICE:"WFS",VERSION:"1.1.0",REQUEST:"DescribeFeatureType",TYPENAME:b},autoLoad:!0,listeners:{load:function(){c.call(d,e)},scope:this}}),this.schemaCache[b]=e},getSchema:function(a,b,c){if(!this.schemaCache)this.schemaCache={};this.describeLayer(a,function(d){if(d&&"WFS"==d.get("owsType")){var e=d.get("typeName");this.fetchSchema(d.get("owsURL"),
e,b,c)}else d?b.call(c,!1):this.fetchSchema(this.url,a.get("name"),b,c)},this)},getWFSProtocol:function(a,b,c){this.getSchema(a,function(d){var e=!1;if(d){var f,g=/gml:((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry)).*/;d.each(function(a){g.exec(a.get("type"))&&(f=a.get("name"))},this);e=new OpenLayers.Protocol.WFS({version:"1.1.0",srsName:a.getLayer().projection.getCode(),url:d.url,featureType:d.reader.raw.featureTypes[0].typeName,featureNS:d.reader.raw.targetNamespace,geometryName:f})}b.call(c,
e,d,a)},this)},getConfigForRecord:function(a){var b=Ext.applyIf(gxp.plugins.WMSSource.superclass.getConfigForRecord.apply(this,arguments),a.json),c=a.getLayer(),d=c.params,e=c.options,f=b.name,g=this.store.reader.raw;if(g)for(var g=g.capability.layers,h=g.length-1;0<=h;--h)if(g[h].name===f){b.capability=Ext.apply({},g[h]);f={};f[c.projection.getCode()]=!0;b.capability.srs=f;break}if(!b.capability){if(c.maxExtent)b.bbox=c.maxExtent.toArray();b.srs=c.projection.getCode()}return Ext.apply(b,{format:d.FORMAT,
styles:d.STYLES,tiled:!e.singleTile,transparent:d.TRANSPARENT,cql_filter:d.CQL_FILTER,minscale:e.minScale,maxscale:e.maxScale,infoFormat:a.get("infoFormat"),attribution:c.attribution})},getState:function(){var a=gxp.plugins.WMSSource.superclass.getState.apply(this,arguments);return Ext.applyIf(a,{title:this.title})}});Ext.preg(gxp.plugins.WMSSource.prototype.ptype,gxp.plugins.WMSSource);Ext.namespace("gxp.plugins");
gxp.plugins.CatalogueSource=Ext.extend(gxp.plugins.WMSSource,{url:null,yx:null,title:null,lazy:!0,hidden:!0,proxyOptions:null,describeLayer:function(a,b,c){a=new (Ext.data.Record.create([{name:"owsType",type:"string"},{name:"owsURL",type:"string"},{name:"typeName",type:"string"}]))({owsType:"WFS",owsURL:a.get("url"),typeName:a.get("name")});b.call(c,a)},destroy:function(){this.store&&this.store.destroy();this.store=null;gxp.plugins.CatalogueSource.superclass.destroy.apply(this,arguments)}});Ext.namespace("gxp.plugins");
gxp.plugins.GeoNodeCatalogueSource=Ext.extend(gxp.plugins.CatalogueSource,{ptype:"gxp_geonodecataloguesource",rootProperty:"results",baseParams:null,fields:[{name:"title",convert:function(a){return[a]}},{name:"abstract",mapping:"description"},{name:"bounds",mapping:"bbox",convert:function(a){return{left:a.minx,right:a.maxx,bottom:a.miny,top:a.maxy}}},{name:"URI",mapping:"links",convert:function(a){var b=[],c;for(c in a)b.push({value:a[c].url});return b}}],createStore:function(){this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy(Ext.apply({url:this.url,
method:"GET"},this.proxyOptions||{})),baseParams:Ext.apply({type:"layer"},this.baseParams),reader:new Ext.data.JsonReader({root:this.rootProperty},this.fields)});gxp.plugins.LayerSource.prototype.createStore.apply(this,arguments)},getPagingStart:function(){return 0},getPagingParamNames:function(){return{start:"startIndex",limit:"limit"}},filter:function(a){var b=void 0;if(void 0!==a.filters)for(var c=0,d=a.filters.length;c<d;++c){var e=a.filters[c];if(e instanceof OpenLayers.Filter.Spatial){b=e.value.toBBOX();
break}}Ext.apply(this.store.baseParams,{q:a.queryString});void 0!==a.limit&&Ext.apply(this.store.baseParams,{limit:a.limit});void 0!==b?Ext.apply(this.store.baseParams,{bbox:b}):delete this.store.baseParams.bbox;this.store.load()},createLayerRecord:function(a){a.restUrl=this.restUrl;a.queryable=!0;return gxp.plugins.GeoNodeCatalogueSource.superclass.createLayerRecord.apply(this,arguments)}});Ext.preg(gxp.plugins.GeoNodeCatalogueSource.prototype.ptype,gxp.plugins.GeoNodeCatalogueSource);Ext.namespace("gxp.form");
gxp.form.CSWFilterField=Ext.extend(Ext.form.CompositeField,{clearTooltip:"Clear the filter for this category",emptyText:"Select filter",property:null,map:null,type:OpenLayers.Filter.Comparison.EQUAL_TO,name:null,comboFieldLabel:null,comboStoreData:null,target:null,getFilter:function(){return"BoundingBox"===this.property?new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:this.property,projection:"EPSG:4326",value:this.map.getExtent().transform(this.map.getProjectionObject(),
new OpenLayers.Projection("EPSG:4326"))}):new OpenLayers.Filter.Comparison({type:this.type,property:this.property,value:this.combo.getValue()})},initComponent:function(){this.items=[{ref:"combo",xtype:"combo",fieldLabel:this.comboFieldLabel,store:new Ext.data.ArrayStore({fields:["id","value"],data:this.comboStoreData}),displayField:"value",valueField:"id",mode:"local",listeners:{select:function(){this.filter&&this.target.removeFilter(this.filter);this.filter=this.getFilter();this.target.addFilter(this.filter);
return!1},scope:this},emptyText:this.emptyText,triggerAction:"all"},{xtype:"button",iconCls:"gxp-icon-removelayers",tooltip:this.clearTooltip,handler:function(){this.target.removeFilter(this.filter);this.hide()},scope:this}];this.hidden=!0;gxp.form.CSWFilterField.superclass.initComponent.apply(this,arguments)},destroy:function(){this.map=this.target=this.filter=null;gxp.form.CSWFilterField.superclass.destroy.call(this)}});Ext.reg("gxp_cswfilterfield",gxp.form.CSWFilterField);Ext.namespace("gxp");
gxp.CatalogueSearchPanel=Ext.extend(Ext.Panel,{border:!1,maxRecords:10,map:null,selectedSource:null,sources:null,searchFieldEmptyText:"Search",searchButtonText:"Search",addTooltip:"Create filter",addMapTooltip:"Add to map",advancedTitle:"Advanced",datatypeLabel:"Data type",extentLabel:"Spatial extent",categoryLabel:"Category",datasourceLabel:"Data source",filterLabel:"Filter search by",removeSourceTooltip:"Switch back to original source",initComponent:function(){var a=this;this.addEvents("addlayer");
this.filters=[];var b=[],c;for(c in this.sources)b.push([c,this.sources[c].title]);if(1<=b.length)this.selectedSource=b[0][0];c=[["datatype","data type"],["extent","spatial extent"],["category","category"]];1<b.length&&c.push(["csw","data source"]);this.sources[this.selectedSource].store.on("loadexception",function(a,b,c,g){c.success()&&Ext.Msg.show({title:g.message,msg:gxp.util.getOGCExceptionText(g.arg.exceptionReport),icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK})});this.items=[{xtype:"form",
border:!1,ref:"form",hideLabels:!0,autoHeight:!0,style:"margin-left: 5px; margin-right: 5px; margin-bottom: 5px; margin-top: 5px",items:[{xtype:"compositefield",items:[{xtype:"textfield",emptyText:this.searchFieldEmptyText,ref:"../../search",name:"search",listeners:{specialkey:function(a,b){b.getKey()==b.ENTER&&this.performQuery()},scope:this},width:250},{xtype:"button",text:this.searchButtonText,handler:this.performQuery,scope:this}]},{xtype:"fieldset",collapsible:!0,collapsed:!0,hideLabels:!1,hidden:!0,
title:this.advancedTitle,items:[{xtype:"gxp_cswfilterfield",name:"datatype",property:"apiso:Type",comboFieldLabel:this.datatypeLabel,comboStoreData:[["dataset","Dataset"],["datasetcollection","Dataset collection"],["application","Application"],["service","Service"]],target:this},{xtype:"gxp_cswfilterfield",name:"extent",property:"BoundingBox",map:this.map,comboFieldLabel:this.extentLabel,comboStoreData:[["map","spatial extent of the map"]],target:this},{xtype:"gxp_cswfilterfield",name:"category",
property:"apiso:TopicCategory",comboFieldLabel:this.categoryLabel,comboStoreData:[["farming","Farming"],["biota","Biota"],["boundaries","Boundaries"],["climatologyMeteorologyAtmosphere","Climatology/Meteorology/Atmosphere"],["economy","Economy"],["elevation","Elevation"],["environment","Environment"],["geoscientificinformation","Geoscientific Information"],["health","Health"],["imageryBaseMapsEarthCover","Imagery/Base Maps/Earth Cover"],["intelligenceMilitary","Intelligence/Military"],["inlandWaters",
"Inland Waters"],["location","Location"],["oceans","Oceans"],["planningCadastre","Planning Cadastre"],["society","Society"],["structure","Structure"],["transportation","Transportation"],["utilitiesCommunications","Utilities/Communications"]],target:this},{xtype:"compositefield",id:"csw",ref:"../../cswCompositeField",hidden:!0,items:[{xtype:"combo",ref:"../../../sourceCombo",fieldLabel:this.datasourceLabel,store:new Ext.data.ArrayStore({fields:["id","value"],data:b}),displayField:"value",valueField:"id",
mode:"local",listeners:{select:function(a){this.setSource(a.getValue())},render:function(){this.sourceCombo.setValue(this.selectedSource)},scope:this},triggerAction:"all"},{xtype:"button",iconCls:"gxp-icon-removelayers",tooltip:this.removeSourceTooltip,handler:function(){this.setSource(this.initialConfig.selectedSource);this.sourceCombo.setValue(this.initialConfig.selectedSource);this.cswCompositeField.hide()},scope:this}]},{xtype:"compositefield",items:[{xtype:"combo",fieldLabel:this.filterLabel,
store:new Ext.data.ArrayStore({fields:["id","value"],data:c}),displayField:"value",valueField:"id",mode:"local",triggerAction:"all"},{xtype:"button",iconCls:"gxp-icon-addlayers",tooltip:this.addTooltip,handler:function(a){a.ownerCt.items.each(function(a){if("combo"===a.getXType()){var b=a.getValue();a.clearValue();(a=this.form.getForm().findField(b))&&a.show()}},this)},scope:this}]}]},{xtype:"grid",width:"100%",anchor:"99%",viewConfig:{scrollOffset:0,forceFit:!0},border:!1,ref:"../grid",bbar:new Ext.PagingToolbar({listeners:{beforechange:function(b,
c){var f=a.sources[a.selectedSource].getPagingStart();c.startPosition&&(c.startPosition+=f)}},onLoad:function(b,c,f){var g=a.sources[a.selectedSource].getPagingStart();this.rendered?(b=this.getParams(),this.cursor=f.params&&f.params[b.start]?f.params[b.start]-g:0,f=this.getPageData(),g=f.activePage,b=f.pages,this.afterTextItem.setText(String.format(this.afterPageText,f.pages)),this.inputItem.setValue(g),this.first.setDisabled(1==g),this.prev.setDisabled(1==g),this.next.setDisabled(g==b),this.last.setDisabled(g==
b),this.refresh.enable(),this.updateInfo(),this.fireEvent("change",this,f)):this.dsLoaded=[b,c,f]},paramNames:this.sources[this.selectedSource].getPagingParamNames(),store:this.sources[this.selectedSource].store,pageSize:this.maxRecords}),loadMask:!0,hideHeaders:!0,store:this.sources[this.selectedSource].store,columns:[{id:"title",xtype:"templatecolumn",tpl:new Ext.XTemplate("<b>{title}</b><br/>{abstract}"),sortable:!0},{xtype:"actioncolumn",width:30,items:[{getClass:function(a,b,c){if(!1!==this.findWMS(c.get("URI"))||
!1!==this.findWMS(c.get("references")))return"gxp-icon-addlayers"},tooltip:this.addMapTooltip,handler:function(a,b){this.addLayer(this.grid.store.getAt(b))},scope:this}]}],autoExpandColumn:"title",autoHeight:!0}]}];gxp.CatalogueSearchPanel.superclass.initComponent.apply(this,arguments)},destroy:function(){this.map=this.sources=null;gxp.CatalogueSearchPanel.superclass.destroy.call(this)},setSource:function(a){this.selectedSource=a;a=this.sources[a].store;this.grid.reconfigure(a,this.grid.getColumnModel());
this.grid.getBottomToolbar().bindStore(a)},performQuery:function(){this.sources[this.selectedSource].filter({queryString:this.search.getValue(),limit:this.maxRecords,filters:this.filters})},addFilter:function(a){this.filters.push(a)},removeFilter:function(a){this.filters.remove(a)},findWMS:function(a){var b=["OGC:WMS-1.1.1-HTTP-GET-MAP","OGC:WMS"],c=null,d=null,e,f,g;for(e=0,f=a.length;e<f;++e)if(g=a[e],g.protocol&&-1!==b.indexOf(g.protocol.toUpperCase())&&g.value&&g.name){c=g.value;d=g.name;break}if(null===
c)for(e=0,f=a.length;e<f;++e)if(g=a[e],b=g.value?g.value:g,0<b.toLowerCase().indexOf("service=wms")){a=OpenLayers.Util.createUrlObject(b);c=a.protocol+"//"+a.host+":"+a.port+a.pathname;d=a.args.layers;break}return null!==c&&null!==d?{url:c,name:d}:!1},addLayer:function(a){var b=a.get("URI"),c=a.get("bounds"),d=c.left,e=c.right,f=c.bottom,g=c.top,c=Math.min(d,e),d=Math.max(d,e),e=Math.min(f,g),f=Math.max(f,g),b=this.findWMS(b);!1===b&&(b=this.findWMS(a.get("references")));!1!==b&&this.fireEvent("addlayer",
this,this.selectedSource,Ext.apply({title:a.get("title")[0],bbox:[c,e,d,f],srs:"EPSG:4326",projection:a.get("projection")},b))}});Ext.reg("gxp_cataloguesearchpanel",gxp.CatalogueSearchPanel);Ext.ns("gxp.data","gxp.plugins");
gxp.data.TMSCapabilitiesReader=Ext.extend(Ext.data.DataReader,{constructor:function(a,b){a=a||{};if(!a.format)a.format=new OpenLayers.Format.TMSCapabilities;"function"!==typeof b&&(b=GeoExt.data.LayerRecord.create(b||a.fields||[{name:"name",type:"string"},{name:"title",type:"string"},{name:"abstract",type:"string"},{name:"tileMapUrl",type:"string"},{name:"group",type:"string"}]));gxp.data.TMSCapabilitiesReader.superclass.constructor.call(this,a,b)},read:function(a){var b=a.responseXML;if(!b||!b.documentElement)b=
a.responseText;return this.readRecords(b)},readRecords:function(a){var b=[],c,d,e;if("string"===typeof a||a.nodeType){this.raw=a=this.meta.format.read(a);var f=a["abstract"];if(a.tileMaps)for(c=0,d=a.tileMaps.length;c<d;++c){var g=a.tileMaps[c];e=new OpenLayers.Projection(g.srs);if(this.meta.mapProjection.equals(e)){e=g.href;var h=e.substring(e.indexOf(this.meta.version+"/")+6);b.push(new this.recordType({layer:new OpenLayers.Layer.TMS(g.title,-1!==this.meta.baseUrl.indexOf(this.meta.version)?this.meta.baseUrl.replace(this.meta.version+
"/",""):this.meta.baseUrl,{layername:h,isBaseLayer:this.meta.isBaseLayer}),title:g.title,name:g.title,"abstract":f,tileMapUrl:e,scalePreviewImage:!0,group:this.meta.group}))}}else if(a.tileSets&&(e=new OpenLayers.Projection(a.srs),this.meta.mapProjection.equals(e))){g=[];for(c=0,d=a.tileSets.length;c<d;++c)g.push(a.tileSets[c].unitsPerPixel);e=this.meta.baseUrl;c=e.substring(e.indexOf(this.meta.version)+this.meta.version.length+1,e.lastIndexOf("/"));b.push(new this.recordType({layer:new OpenLayers.Layer.TMS(a.title,
a.tileMapService.replace("/"+this.meta.version,""),{serverResolutions:g,type:a.tileFormat.extension,layername:c,isBaseLayer:this.meta.isBaseLayer}),title:a.title,name:a.title,"abstract":f,tileMapUrl:this.meta.baseUrl,scalePreviewImage:!0,group:this.meta.group}))}}if(0==b.length)this.error="No compatible layers found. Mismatched coordinate system.";return{totalRecords:b.length,success:!0,records:b}}});
gxp.plugins.TMSSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_tmssource",version:"1.0.0",defaultGroup:"background",constructor:function(a){a.group=a.group?a.group:this.defaultGroup;a.isBaseLayer=void 0===a.isBaseLayer?!0:a.isBaseLayer;gxp.plugins.TMSSource.superclass.constructor.apply(this,arguments);this.format=new OpenLayers.Format.TMSCapabilities;"/"!==this.url.slice(-1)&&(this.url+="/")},createStore:function(){this.store=new Ext.data.Store({autoLoad:!0,listeners:{load:function(){this.title=
this.store.reader.raw.title;this.store.reader.error?this.fireEvent("failure",this,this.store.reader.error):this.fireEvent("ready",this)},exception:function(){this.fireEvent("failure",this,"Trouble creating TMS layer store from response.","Unable to handle response.")},scope:this},proxy:new Ext.data.HttpProxy({url:-1===this.url.indexOf(this.version)?this.url+this.version:this.url,disableCaching:!1,method:"GET"}),reader:new gxp.data.TMSCapabilitiesReader({baseUrl:this.url,version:this.version,group:this.initialConfig.group,
isBaseLayer:this.initialConfig.isBaseLayer,mapProjection:this.getMapProjection()})})},createLayerRecord:function(a,b,c){var d=this.store.findExact("name",a.name);if(-1<d){var d=this.store.getAt(d),e=d.getLayer();if(null!==e.serverResolutions)return d;Ext.Ajax.request({url:d.get("tileMapUrl"),success:function(d){for(var g=[],d=this.format.read(d.responseText),h=0,j=d.tileSets.length;h<j;++h)g.push(d.tileSets[h].unitsPerPixel);e.addOptions({serverResolutions:g,type:d.tileFormat.extension});this.target.createLayerRecord({source:this.id,
name:a.name,scalePreviewImage:!0},b,c)},scope:this})}},getPreviewImageURL:function(a){return a.data.tileMapUrl+"/0/0/0.png"}});Ext.preg(gxp.plugins.TMSSource.prototype.ptype,gxp.plugins.TMSSource);Ext.namespace("gxp.plugins");
gxp.plugins.ArcRestSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_arcrestsource",requiredProperties:["name"],constructor:function(a){this.config=a;gxp.plugins.ArcRestSource.superclass.constructor.apply(this,arguments)},createStore:function(){var a=this.url.split("?")[0],b=this,c=function(c){var f=Ext.decode(c.responseText),g=b.getArcProjection(f.spatialReference.wkid),h=[];if(null!=g)for(c=0;c<f.layers.length;c++){var j=f.layers[c];h.push(new OpenLayers.Layer.ArcGIS93Rest(j.name,a+"/export",
{layers:"show:"+j.id,TRANSPARENT:!0},{isBaseLayer:!1,ratio:1,displayInLayerSwitcher:!0,visibility:!0,projection:g,queryable:f.capabilities&&f.capabilities.Identify}))}else d(c);b.title=f.documentInfo.Title;b.store=new GeoExt.data.LayerStore({layers:h,fields:[{name:"source",type:"string"},{name:"name",type:"string",mapping:"name"},{name:"layerid",type:"string"},{name:"group",type:"string",defaultValue:this.title},{name:"fixed",type:"boolean",defaultValue:!0},{name:"tiled",type:"boolean",defaultValue:!0},
{name:"queryable",type:"boolean",defaultValue:!0},{name:"selected",type:"boolean"}]});b.fireEvent("ready",b)},d=function(){Ext.Msg.alert("No ArcGIS Layers","Could not find any compatible layers  at "+b.config.url);b.fireEvent("failure",b)};(this.lazy=this.isLazy())?this.fireEvent("ready"):Ext.Ajax.request({url:a,params:{f:"json",pretty:"false",keepPostParams:"true"},method:"POST",success:c,failure:d})},isLazy:function(){var a=!0,b=!1,c=this.target.initialConfig.map;if(c&&c.layers)for(var d,e=0,f=
c.layers.length;e<f&&!(d=c.layers[e],d.source===this.id&&(b=!0,a=this.layerConfigComplete(d),!1===a));++e);return a&&b},layerConfigComplete:function(a){for(var b=!0,c=this.requiredProperties,d=c.length-1;0<=d&&!(b=!!a[c[d]],!1===b);--d);return b},createLayerRecord:function(a){var b,c;c=function(b){return b.get("name")===a.name};var d=this.lazy||this.store&&-1<this.store.findBy(c);if(-1==this.target.mapPanel.layers.findBy(c)&&d){b=!this.lazy&&-1<this.store.findBy(c)?this.store.getAt(this.store.findBy(c)).clone():
this.createLazyLayerRecord(a);c=b.getLayer();a.title&&(c.setName(a.title),b.set("title",a.title));if("visibility"in a)c.visibility=a.visibility;if("opacity"in a)c.opacity=a.opacity;if("format"in a)c.params.FORMAT=a.format,b.set("format",a.format);c=!1;"tiled"in a&&(c=!a.tiled);b.set("tiled",!c);b.set("selected",a.selected||!1);b.set("queryable",a.queryable||!0);b.set("source",a.source);b.set("name",a.name);b.set("layerid",a.layerid);b.set("properties","gxp_wmslayerpanel");"group"in a&&b.set("group",
a.group);b.commit()}return b},getArcProjection:function(a){var b=this.getMapProjection(),c=b,a="EPSG:"+a+"";if(a!==b.getCode()&&(c=null,(p=new OpenLayers.Projection(a)).equals(b)))c=p;return c},createLazyLayerRecord:function(a){var b=a.srs||this.target.map.projection;a.srs={};a.srs[b]=!0;var c=a.bbox||this.target.map.maxExtent||OpenLayers.Projection.defaults[b].maxExtent;a.bbox={};a.bbox[b]={bbox:c};c=new GeoExt.data.LayerRecord(a);c.set("name",a.name);c.set("layerid",a.layerid||"show:0");c.set("format",
a.format||"png");c.set("tiled","tiled"in a?a.tiled:!0);c.setLayer(new OpenLayers.Layer.ArcGIS93Rest(a.name,this.url.split("?")[0]+"/export",{layers:a.layerid,TRANSPARENT:!0,FORMAT:"format"in a?a.format:"png"},{isBaseLayer:!1,displayInLayerSwitcher:!0,projection:b,singleTile:"tiled"in a?!a.tiled:!1,queryable:"queryable"in a?a.queryable:!1}));return c},getConfigForRecord:function(a){var b=a.getLayer();return{source:a.get("source"),name:a.get("name"),title:a.get("title"),tiled:a.get("tiled"),visibility:b.getVisibility(),
layerid:b.params.LAYERS,format:b.params.FORMAT,opacity:b.opacity||void 0,group:a.get("group"),fixed:a.get("fixed"),selected:a.get("selected")}}});Ext.preg(gxp.plugins.ArcRestSource.prototype.ptype,gxp.plugins.ArcRestSource);Ext.namespace("gxp.plugins");
gxp.plugins.AddLayers=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_addlayers",addActionMenuText:"Add layers",findActionMenuText:"Find layers",addFeedActionMenuText:"Add feeds",addActionTip:"Add layers",addServerText:"Add a New Server",addButtonText:"Add layers",untitledText:"Untitled",addLayerSourceErrorText:"Error getting {type} capabilities ({msg}).\nPlease check the url and try again.",availableLayersText:"Available Layers",searchText:"Search for layers",expanderTemplateText:"<p><b>Abstract:</b> {abstract}</p>",
panelTitleText:"Title",layerSelectionText:"View available data from:",doneText:"Done",layerNameText:"Name",layerAbstractText:"Abstract",layerQueryableText:"Queryable",searchLayersEmptyText:"Search layers",searchLayersSearchText:"Search",sortLayersText:"Sort alphabetically",uploadRoles:["ROLE_ADMINISTRATOR"],uploadText:"Upload layers",relativeUploadOnly:!0,startSourceId:null,catalogSourceKey:null,catalogPanelWidth:440,catalogPanelHeight:300,templatedLayerGrid:!1,layerGridWidth:315,layerGridHeight:300,
layerPreviewWidth:20,layerPreviewHeight:20,owsPreviewStrategies:["attributionlogo","getlegendgraphic","randomcolor"],minTextSearchLength:2,textSearchQueryDelay:500,selectedSource:null,addServerId:null,constructor:function(a){this.addEvents("sourceselected");gxp.plugins.AddLayers.superclass.constructor.apply(this,arguments)},addActions:function(){var a={tooltip:this.addActionTip,text:this.addActionText,menuText:this.addActionMenuText,disabled:!0,iconCls:"gxp-icon-addlayers"},b;if(this.initialConfig.search||
this.uploadSource){var c=[new Ext.menu.Item({iconCls:"gxp-icon-addlayers",text:this.addActionMenuText,handler:this.showCapabilitiesGrid,scope:this})];if(this.initialConfig.search&&this.initialConfig.search.selectedSource&&this.target.sources[this.initialConfig.search.selectedSource]){var d=new Ext.menu.Item({iconCls:"gxp-icon-addlayers",text:this.findActionMenuText,handler:this.showCatalogueSearch,scope:this});c.push(d);Ext.Ajax.request({method:"GET",url:this.target.sources[this.initialConfig.search.selectedSource].url,
callback:function(a,b){!1===b&&d.hide()}})}this.initialConfig.feeds&&c.push(new Ext.menu.Item({iconCls:"gxp-icon-addlayers",text:this.addFeedActionMenuText,handler:this.showFeedDialog,scope:this}));this.uploadSource&&(b=this.createUploadButton(Ext.menu.Item))&&c.push(b);a=Ext.apply(a,{menu:new Ext.menu.Menu({items:c})})}else a=Ext.apply(a,{handler:this.showCapabilitiesGrid,scope:this});var e=gxp.plugins.AddLayers.superclass.addActions.apply(this,[a]);this.target.on("ready",function(){if(this.uploadSource){var a=
this.target.layerSources[this.uploadSource];a?this.setSelectedSource(a):(delete this.uploadSource,b&&b.hide())}e[0].enable()},this);return e},showCatalogueSearch:function(){var a=this.initialConfig.search.selectedSource,b={},c=!1,d;for(d in this.target.layerSources){var e=this.target.layerSources[d];e instanceof gxp.plugins.CatalogueSource&&(c={},c[d]=e,Ext.apply(b,c),c=!0)}if(!1===c)window.console&&window.console.debug("No catalogue source specified");else return a=gxp.plugins.AddLayers.superclass.addOutput.apply(this,
[{sources:b,title:this.searchText,height:this.catalogPanelHeight,width:this.catalogPanelWidth,selectedSource:a,xtype:"gxp_cataloguesearchpanel",map:this.target.mapPanel.map}]),a.on({addlayer:function(a,b,c){var a=this.target.layerSources[b],d=OpenLayers.Bounds.fromArray(c.bbox,a.yx&&!0===a.yx[c.projection]),e=this.target.mapPanel.map.getProjection(),d=d.transform(c.srs,e);c.srs=e;c.bbox=d.toArray();c.source=null!==this.initialConfig.catalogSourceKey?this.initialConfig.catalogSourceKey:b;this.target.mapPanel.layers.add(a.createLayerRecord(c));
d&&this.target.mapPanel.map.zoomToExtent(d)},scope:this}),(b=a.findParentByType("window"))&&b.center(),a},showCapabilitiesGrid:function(){this.capGrid?this.capGrid instanceof Ext.Window||this.addOutput(this.capGrid):this.initCapGrid();this.capGrid.show()},showFeedDialog:function(){if(!this.feedDialog){var a=this.outputTarget?Ext.Panel:Ext.Window;this.feedDialog=new a(Ext.apply({closeAction:"hide",autoScroll:!0,title:this.addFeedActionMenuText,items:[{xtype:"gxp_feedsourcedialog",target:this.target,
listeners:{addfeed:function(a,c){var d={config:{ptype:a}};if(c.url)d.config.url=c.url;d=this.target.addLayerSource(d);c.source=d.id;this.target.mapPanel.layers.add([d.createLayerRecord(c)]);this.feedDialog.hide()},scope:this}}]},this.initialConfig.outputConfig));a===Ext.Panel&&this.addOutput(this.feedDialog)}this.feedDialog instanceof Ext.Window||this.addOutput(this.feedDialog);this.feedDialog.show()},createColumnModel:function(){var a=this.layerPreviewWidth,b=this.layerPreviewHeight,c=this,d='<div class="layercard"><div class="meta_title">{title}<\!-- <div class="btn_info" id="{id}" title="Show metadata for this Layer"><table cellspacing="0" class="x-btn x-btn-text-icon" style="width: auto;"><tbody class="x-btn-small x-btn-icon-small-left"><tr><td class="x-btn-tl"><i>&nbsp;</i></td><td class="x-btn-tc"></td><td class="x-btn-tr"><i>&nbsp;</i></td></tr><tr><td class="x-btn-ml"><i>&nbsp;</i></td><td class="x-btn-mc"><em class=" x-unselectable" unselectable="on"><button type="button" id="mb-{id}" class=" x-btn-text gxp-icon-metadata">Metadata</button></em></td><td class="x-btn-mr"><i>&nbsp;</i></td></tr><tr><td class="x-btn-bl"><i>&nbsp;</i></td><td class="x-btn-bc"></td><td class="x-btn-br"><i>&nbsp;</i></td></tr></tbody></table></div> --\></div><table cellspacing="2" cellpadding="2"><tr><td style="vertical-align:middle;">{previewImage}</td><td style="vertical-align:top; white-space: normal!important;"><p style="margin-top:4px;"><strong>'+
this.layerNameText+": </strong>{name}<br/><strong>"+this.layerAbstractText+": </strong>{abstract}<br/><strong>"+this.layerQueryableText+': </strong>{queryable}</p></td></tr></table><div class="btn_add" title="Add this layer to the map"><table name="addlayer" cellspacing="0" class="x-btn  x-btn-text-icon" style="width: auto;"><tbody class="x-btn-small x-btn-icon-small-left"><tr><td class="x-btn-tl"><i>&nbsp;</i></td><td class="x-btn-tc"></td><td class="x-btn-tr"><i>&nbsp;</i></td></tr><tr><td class="x-btn-ml"><i>&nbsp;</i></td><td class="x-btn-mc"><em class=" x-selectable"><button name="addlayer" type="button" id="but-{id}-{rowIndex}" class=" x-btn-text gxp-icon-addlayers">Add layer</button></em></td><td class="x-btn-mr"><i>&nbsp;</i></td></tr><tr><td class="x-btn-bl"><i>&nbsp;</i></td><td class="x-btn-bc"></td><td class="x-btn-br"><i>&nbsp;</i></td></tr></tbody></table></div></div>',
d=new Ext.XTemplate(d);d.compile();return new Ext.grid.ColumnModel([{id:"title",dataIndex:"title",sortable:!0,renderer:function(e,f,g,h){e=g.data;e.id=g.id;f=c.target.layerSources[g.store.sourceId].getPreviewImageURL(g,a,b);e.previewImage=f?'<div style="width:'+a+"px; height:"+b+"px; background-image: url('"+f+"'); "+(!0===g.data.scalePreviewImage?"background-size:"+a+"px "+b+"px;":" ")+' background-repeat: repeat;" >&nbsp;</div>':'<div style="width:'+b+"px; height:"+b+'px" class="preview-notavailable">&nbsp;</div>';
e.rowIndex=h;return d.apply(e)}}])},initCapGrid:function(){function a(){function a(b){d&&d.push(b);e--;0===e&&this.addLayers(d)}for(var b=this.selectedSource,c=h.getSelectionModel().getSelections(),d=[],e=c.length,f=0,g=c.length;f<g;++f){var j=b.createLayerRecord({name:c[f].get("name"),source:b.id},a,this);j&&a.call(this,j)}}var b,c=[],d=this.target,e;for(e in d.layerSources)if(b=d.layerSources[e],b.store&&!b.hidden)b.store.sourceId=e,c.push([e,b.title||e,b.url]);var f=new Ext.data.ArrayStore({fields:["id",
"title","url"],data:c});e=this.createExpander();var g=0;null!==this.startSourceId&&f.each(function(a){a.get("id")===this.startSourceId&&(g=f.indexOf(a))},this);b=this.target.layerSources[c[g][0]];var h,j=this;h=this.templatedLayerGrid?new Ext.grid.GridPanel({store:b.store,autoScroll:!0,autoExpandColumn:"title",hideHeaders:!0,bodyCssClass:"layercardgrid",stripeRows:!1,loadMask:!0,colModel:this.createColumnModel(),listeners:{click:function(b){b=b.getTarget();if("addlayer"==b.name)b=b.id.slice(b.id.lastIndexOf("-")+
1),h.getSelectionModel().selectRow(b),b=h.getSelectionModel().getSelections()[0],j.selectedSource=j.target.layerSources[b.store.sourceId],a.apply(this)},scope:this}}):new Ext.grid.GridPanel({store:b.store,autoScroll:!0,autoExpandColumn:"title",plugins:[e],loadMask:!0,colModel:new Ext.grid.ColumnModel([e,{id:"title",header:this.panelTitleText,dataIndex:"title",sortable:!0},{header:"Id",dataIndex:"name",width:120,sortable:!0}]),listeners:{rowdblclick:a,scope:this}});var k=new Ext.form.ComboBox({ref:"../sourceComboBox",
width:240,store:f,valueField:"id",displayField:"title",tpl:'<tpl for="."><div ext:qtip="{url}" class="x-combo-list-item">{title}</div></tpl>',triggerAction:"all",editable:!1,allowBlank:!1,forceSelection:!0,mode:"local",value:c[g][0],listeners:{select:function(a,b){var c=b.get("id");if(c===this.addServerId)n.outputTarget?n.addOutput(l):(new Ext.Window({title:gxp.NewSourceDialog.prototype.title,modal:!0,hideBorders:!0,width:300,items:l})).show(),k.reset();else{var d=this.target.layerSources[c];d.store.sourceId=
c;h.reconfigure(d.store,h.getColumnModel());h.getView().focusRow(0);this.setSelectedSource(d);(function(){a.triggerBlur();a.el.blur()}).defer(100)}},focus:function(a){d.proxy&&a.reset()},scope:this}});e=[{xtype:"tbspacer",width:14},{id:"txtSearch",xtype:"textfield",emptyText:this.searchLayersEmptyText,selectOnFocus:!0,minWidth:180,enableKeyEvents:!0,listeners:{scope:this,keyup:function(){var a=Ext.getDom("txtSearch").value;if(!(a&&a.length<this.minTextSearchLength)){if(!this.dqTask)this.dqTask=new Ext.util.DelayedTask(this.sourceTextSearch,
this);this.dqTask.delay(this.textSearchQueryDelay,null,null,[a])}}}},{xtype:"tbfill"},{id:"btnList",xtype:"button",iconCls:"gxp-icon-book-open",text:this.sortLayersText,tooltip:{text:"Sort the layers alphabetically by title. Toggle to sort asc/descending.",width:360},handler:function(){this.sourceSort()},scope:this},{xtype:"tbspacer",width:16}];b=null;if(this.target.proxy||1<c.length)b=[new Ext.Toolbar.TextItem({text:this.layerSelectionText}),k];if(this.target.proxy)this.addServerId=Ext.id(),f.loadData([[this.addServerId,
this.addServerText+"..."]],!0);var l={xtype:"gxp_newsourcedialog",header:!1,listeners:{hide:function(a){this.outputTarget||a.ownerCt.hide()},urlselected:function(a,b,c){a.setLoading();b={url:b};switch(c){case "TMS":b.ptype="gxp_tmssource";break;case "REST":b.ptype="gxp_arcrestsource";break;case "WMS":b.ptype="gxp_wmssource";b.owsPreviewStrategies=this.owsPreviewStrategies;break;case "WFS":b.ptype="gxp_wfssource";b.owsPreviewStrategies=this.owsPreviewStrategies;if(void 0!==this.defaultSrs)b.defaultSrs=
this.defaultSrs;break;default:b.ptype="gxp_wmscsource"}this.target.addLayerSource({config:b,callback:function(b){var d=this.target.layerSources[b];d.error?a.setError((new Ext.Template(this.addLayerSourceErrorText)).apply({type:c,msg:d.error})):(b=new f.recordType({id:b,title:d.title||this.untitledText}),f.insert(0,[b]),k.onSelect(b,0),a.hide())},fallback:function(b,d){a.setError((new Ext.Template(this.addLayerSourceErrorText)).apply({type:c,msg:d}))},scope:this})},scope:this}},n=this,m=[];m.push(h);
e=[{xtype:"box",region:"north",height:24,autoWidth:!0,tpl:new Ext.Template('<div style="margin-left:6px; margin-top:2px; margin-bottom: 2px"><span style="font-weight: bold">{serverTitle}</span><br><span style="color: #aaaaaa">{serverUrl}</span></div>'),listeners:{afterrender:function(){var a=this;if(f){var b=f.getAt(0);a.update({serverTitle:b.data.title,serverUrl:b.data.url})}k.on("select",function(){a.update({serverTitle:j.selectedSource.serviceTitle?j.selectedSource.serviceTitle:j.selectedSource.title,
serverUrl:j.selectedSource.url})})}}},{xtype:"panel",region:"center",layout:"fit",hideBorders:!0,border:!1,margins:{top:8},tbar:e,items:m}];this.instructionsText&&e.items.push({xtype:"box",autoHeight:!0,autoEl:{tag:"p",cls:"x-form-item",style:"padding-left: 5px; padding-right: 5px"},html:this.instructionsText});m=null;this.templatedLayerGrid||(m=["->",new Ext.Button({text:this.addButtonText,iconCls:"gxp-icon-addlayers",handler:a,scope:this}),new Ext.Button({text:this.doneText,handler:function(){this.capGrid.hide()},
scope:this})]);var o;this.uploadSource||(o=this.createUploadButton())&&m.unshift(o);o=this.outputTarget?Ext.Panel:Ext.Window;this.capGrid=new o(Ext.apply({title:this.availableLayersText,closeAction:"hide",layout:"border",height:this.layerGridHeight,width:this.layerGridWidth,modal:!0,items:e,tbar:b,bbar:m,listeners:{destroy:function(){if(this.dqTask)this.dqTask.cancel(),this.dqTask=null},hide:function(){if(this.dqTask)this.dqTask.cancel(),this.dqTask=null;h.getSelectionModel().clearSelections()},show:function(){null===
this.selectedSource?this.setSelectedSource(this.target.layerSources[c[g][0]]):this.setSelectedSource(this.selectedSource)},scope:this}},this.initialConfig.outputConfig));o===Ext.Panel&&this.addOutput(this.capGrid)},sourceSort:function(){!this.selectedSource||!this.selectedSource.store?alert("No source active"):this.selectedSource.store.sort("title")},sourceTextSearch:function(a){if(!this.selectedSource||!this.selectedSource.store)alert("No source active");else{var b=this.selectedSource.store;if(!a||
""==a||a==this.searchLayersEmptyText)b.clearFilter(!1);else{b.clearFilter(!0);var c=["name","title","abstract","attribution"];b.filter([{fn:function(b){for(var e=!1,f,g=a.toLowerCase(),h=0;h<c.length&&!e;h++)if((f=b.get(c[h]))&&""!=f&&("string"===typeof f||f instanceof String))e=-1<f.toLowerCase().indexOf(g);return e},scope:this}]);b.lastSearchText=a}}},addLayers:function(a,b){for(var c=this.selectedSource,d=this.target.mapPanel.layers,e,f,g,h,j=0,k=a.length;j<k;++j)if(f=c.createLayerRecord({name:a[j].get("name"),
source:c.id})||a[j])g=f.getLayer(),h=g.getVisibility(),g.maxExtent&&(e?e.extend(f.getLayer().maxExtent):e=f.getLayer().maxExtent.clone()),"background"===f.get("group")?d.insert(1,[f]):d.add([f]);e&&h&&this.target.mapPanel.map.zoomToExtent(e);if(1===a.length&&f&&(this.target.selectLayer(f),b&&this.postUploadAction)){var l,c=this.postUploadAction;if(!Ext.isString(c))l=c.outputConfig,c=c.plugin;this.target.tools[c].addOutput(l)}},setSelectedSource:function(a){this.selectedSource=a;this.fireEvent("sourceselected",
this,a);this.capGrid&&a.lazy&&a.store.load({callback:function(){var a=this.capGrid.sourceComboBox,c=a.store,d=a.valueField,e=c.findExact(d,a.getValue()),e=c.getAt(e),f=this.target.layerSources[e.get("id")];f?f.title!==e.get("title")&&!Ext.isEmpty(f.title)&&(e.set("title",f.title),a.setValue(e.get(d))):c.remove(e)}.createDelegate(this)})},createUploadButton:function(a){var a=a||Ext.Button,b,c=this.initialConfig.upload||!!this.initialConfig.uploadSource,d;if(c){"boolean"===typeof c&&(c={});b=new a({text:this.uploadText,
iconCls:"gxp-icon-filebrowse",hidden:!this.uploadSource,handler:function(){this.target.doAuthorized(this.uploadRoles,function(){var a=new gxp.LayerUploadPanel(Ext.apply({title:this.outputTarget?this.uploadText:void 0,url:d,width:300,border:!1,bodyStyle:"padding: 10px 10px 0 10px;",labelWidth:65,autoScroll:!0,defaults:{anchor:"99%",allowBlank:!1,msgTarget:"side"},listeners:{uploadcomplete:function(a,c){for(var d=c["import"].tasks,e,f={},g=0,q=d.length;g<q;++g){e=d[g];if("ERROR"===e.state){Ext.Msg.alert(e.layer.originalName,
e.errorMessage);return}var r;if(e.target.dataStore)r=e.target.dataStore.workspace.name;else if(e.target.coverageStore)r=e.target.coverageStore.workspace.name;f[r+":"+e.layer.name]=!0}this.selectedSource.store.load({params:{_dc:Math.random()},callback:function(){var a,b;this.capGrid&&this.capGrid.isVisible()&&(a=this.capGrid.get(0).get(0),b=a.getSelectionModel(),b.clearSelections());var c=[],d=0;this.selectedSource.store.each(function(a,b){a.get("name")in f&&(d=b,c.push(a))});a?window.setTimeout(function(){b.selectRecords(c);
a.getView().focusRow(d)},100):this.addLayers(c,!0)},scope:this});this.outputTarget?a.hide():b.close()},scope:this}},c)),b;this.outputTarget?this.addOutput(a):(b=new Ext.Window({title:this.uploadText,modal:!0,resizable:!1,items:[a]}),b.show())},this)},scope:this});var e={},f=function(a,b,c){a in e?window.setTimeout(function(){b.call(c,e[a])},0):Ext.Ajax.request({url:a,disableCaching:!1,callback:function(d,f,n){d=n.status;e[a]=d;b.call(c,d)}})};this.on({sourceselected:function(a,c){b[this.uploadSource?
"show":"hide"]();this.isEligibleForUpload(c)&&(d=this.getGeoServerRestUrl(c.url),this.target.isAuthorized()&&f(d+"/imports",function(a){b.setVisible(200===a)},this))},scope:this})}return b},getGeoServerRestUrl:function(a){a=a.split("/");a.pop();a.push("rest");return a.join("/")},isEligibleForUpload:function(a){return a.url&&(this.relativeUploadOnly?"/"===a.url.charAt(0):!0)&&-1===(this.nonUploadSources||[]).indexOf(a.id)},createExpander:function(){return new Ext.grid.RowExpander({tpl:new Ext.Template(this.expanderTemplateText)})}});
Ext.preg(gxp.plugins.AddLayers.prototype.ptype,gxp.plugins.AddLayers);Ext.namespace("gxp.plugins");
gxp.plugins.BingSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_bingsource",title:"Bing Layers",roadTitle:"Bing Roads",aerialTitle:"Bing Aerial",labeledAerialTitle:"Bing Aerial With Labels",apiKey:"AqTGBsziZHIJYYxgivLBf0hVdrAk9mWO5cQcb8Yux8sW5M8c8opEC2lZqKR1ZZXf",createStore:function(){var a=[new OpenLayers.Layer.Bing({key:this.apiKey,name:this.roadTitle,type:"Road",buffer:1,transitionEffect:"resize"}),new OpenLayers.Layer.Bing({key:this.apiKey,name:this.aerialTitle,type:"Aerial",buffer:1,transitionEffect:"resize"}),
new OpenLayers.Layer.Bing({key:this.apiKey,name:this.labeledAerialTitle,type:"AerialWithLabels",buffer:1,transitionEffect:"resize"})];this.store=new GeoExt.data.LayerStore({layers:a,fields:[{name:"source",type:"string"},{name:"name",type:"string",mapping:"type"},{name:"abstract",type:"string",mapping:"attribution"},{name:"group",type:"string",defaultValue:"background"},{name:"fixed",type:"boolean",defaultValue:!0},{name:"selected",type:"boolean"}]});this.store.each(function(a){a.set("group","background")});
this.fireEvent("ready",this)},createLayerRecord:function(a){var b,c=this.store.findExact("name",a.name);if(-1<c){b=this.store.getAt(c).copy(Ext.data.Record.id({}));c=b.getLayer().clone();a.title&&(c.setName(a.title),b.set("title",a.title));if("visibility"in a)c.visibility=a.visibility;b.set("selected",a.selected||!1);b.set("source",a.source);b.set("name",a.name);"group"in a&&b.set("group",a.group);b.data.layer=c;b.commit()}return b}});Ext.preg(gxp.plugins.BingSource.prototype.ptype,gxp.plugins.BingSource);
Ext.namespace("gxp.plugins");
gxp.plugins.ClickableFeatures=Ext.extend(gxp.plugins.Tool,{featureManager:null,autoLoadFeature:!1,autoLoadedFeature:null,toleranceParameters:["BUFFER","RADIUS"],constructor:function(a){if(a&&"autoLoadFeatures"in a)a.autoLoadFeature=a.autoLoadFeatures,delete a.autoLoadFeatures,window.console&&console.warn("Deprecated config option 'autoLoadFeatures' for ptype: '"+a.ptype+"'. Use 'autoLoadFeature' instead.");gxp.plugins.ClickableFeatures.superclass.constructor.apply(this,[a])},noFeatureClick:function(a){if(!this.selectControl)this.selectControl=
new OpenLayers.Control.SelectFeature(this.target.tools[this.featureManager].featureLayer,this.initialConfig.controlOptions);var b=this.target.mapPanel.map.getLonLatFromPixel(a.xy),c=this.target.tools[this.featureManager],d=c.page;if(!("all"==c.visible()&&c.paging&&d&&d.extent.containsLonLat(b))&&(b=c.layerRecord&&c.layerRecord.getLayer())){var e=this.target.mapPanel.map,d=e.getSize(),d=Ext.applyIf({REQUEST:"GetFeatureInfo",BBOX:e.getExtent().toBBOX(),WIDTH:d.w,HEIGHT:d.h,X:parseInt(a.xy.x),Y:parseInt(a.xy.y),
QUERY_LAYERS:b.params.LAYERS,INFO_FORMAT:"application/vnd.ogc.gml",EXCEPTIONS:"application/vnd.ogc.se_xml",FEATURE_COUNT:1},b.params);if("number"===typeof this.tolerance)for(var f=0,g=this.toleranceParameters.length;f<g;++f)d[this.toleranceParameters[f]]=this.tolerance;e=e.getProjectionObject();(f=b.projection)&&f.equals(e)&&(e=f);1.3<=parseFloat(b.params.VERSION)?d.CRS=e.getCode():d.SRS=e.getCode();new GeoExt.data.FeatureStore({fields:{},proxy:new GeoExt.data.ProtocolProxy({protocol:new OpenLayers.Protocol.HTTP({url:"string"===
typeof b.url?b.url:b.url[0],params:d,format:new OpenLayers.Format.WMSGetFeatureInfo})}),autoLoad:!0,listeners:{load:function(b,d){if(0<d.length){var e=d[0].get("fid"),f=new OpenLayers.Filter.FeatureId({fids:[e]}),g=function(){c.loadFeatures(f,function(a){if(a.length)this.autoLoadedFeature=a[0],this.select(a[0])},this)}.createDelegate(this),m=c.featureLayer.getFeatureByFid(e);m?this.select(m):c.paging&&c.pagingType===gxp.plugins.FeatureManager.QUADTREE_PAGING?(m=this.target.mapPanel.map.getLonLatFromPixel(a.xy),
c.setPage({lonLat:m},function(){var a=c.featureLayer.getFeatureByFid(e);a?this.select(a):!0===this.autoLoadFeature&&g()},this)):g()}},scope:this}})}},select:function(a){this.selectControl.unselectAll();this.selectControl.select(a)}});Ext.namespace("gxp.plugins");
gxp.plugins.CSWCatalogueSource=Ext.extend(gxp.plugins.CatalogueSource,{ptype:"gxp_cataloguesource",createStore:function(){this.store=new Ext.data.Store({proxy:new GeoExt.data.ProtocolProxy(Ext.apply({setParamsAsOptions:!0,protocol:new OpenLayers.Protocol.CSW({url:this.url})},this.proxyOptions||{})),reader:new GeoExt.data.CSWRecordsReader({fields:"title,abstract,URI,bounds,projection,references".split(",")})});gxp.plugins.LayerSource.prototype.createStore.apply(this,arguments)},getPagingStart:function(){return 1},
getPagingParamNames:function(){return{start:"startPosition",limit:"maxRecords"}},getFullFilter:function(a,b){var c=[];void 0!==a&&c.push(a);c=c.concat(b);return 1>=c.length?c[0]:new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:c})},filter:function(a){var b=void 0;""!==a.queryString&&(b=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,matchCase:!1,property:"csw:AnyText",value:"*"+a.queryString+"*"}));var c={resultType:"results",maxRecords:a.limit,Query:{typeNames:"gmd:MD_Metadata",
ElementSetName:{value:"full"}}},a=this.getFullFilter(b,a.filters);void 0!==a&&Ext.apply(c.Query,{Constraint:{version:"1.1.0",Filter:a}});Ext.apply(this.store.baseParams,c);this.store.load()}});Ext.preg(gxp.plugins.CSWCatalogueSource.prototype.ptype,gxp.plugins.CSWCatalogueSource);Ext.namespace("gxp.plugins");
gxp.plugins.DeleteSelectedFeatures=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_deleteselectedfeatures",deleteMsgTitle:"Delete",deleteFeaturesMsg:"Are you sure you want to delete {0} selected features?",deleteFeatureMsg:"Are you sure you want to delete the selected feature?",menuText:"Delete selected features",tooltip:"Delete the currently selected features",iconCls:"delete",addActions:function(){var a=gxp.plugins.DeleteSelectedFeatures.superclass.addActions.apply(this,[{text:this.buttonText,menuText:this.menuText,
iconCls:this.iconCls,tooltip:this.tooltip,handler:this.deleteFeatures,scope:this}]);a[0].disable();var b=this.target.tools[this.featureManager].featureLayer;b.events.on({featureselected:function(){a[0].isDisabled()&&a[0].enable()},featureunselected:function(){0==b.selectedFeatures.length&&a[0].disable()}});return a},deleteFeatures:function(){var a=this.target.tools[this.featureManager],b=a.featureLayer.selectedFeatures;Ext.Msg.show({title:this.deleteMsgTitle,msg:1<b.length?String.format(this.deleteFeaturesMsg,
b.length):this.deleteFeatureMsg,buttons:Ext.Msg.YESNO,fn:function(c){if("yes"===c){for(var c=a.featureStore,d,e=b.length-1;0<=e;--e){d=b[e];d.layer.selectedFeatures.remove(d);d.layer.events.triggerEvent("featureunselected",{feature:d});if(d.state!==OpenLayers.State.INSERT)d.state=OpenLayers.State.DELETE,c._removing=!0;c.remove(c.getRecordFromFeature(d));delete c._removing}c.save()}},scope:this,icon:Ext.MessageBox.QUESTION})}});Ext.preg(gxp.plugins.DeleteSelectedFeatures.prototype.ptype,gxp.plugins.DeleteSelectedFeatures);
Ext.namespace("gxp.plugins");gxp.plugins.SchemaAnnotations={getAnnotationsFromSchema:function(a){var b=null,a=a.get("annotation");if(void 0!==a){var b={},c=GeoExt.Lang.locale.split("-").shift(),d,e;for(d=0,e=a.appinfo.length;d<e;++d){var f=Ext.decode(a.appinfo[d]);if(f.title&&f.title[c]){b.label=f.title[c];break}}for(d=0,e=a.documentation.length;d<e;++d)if(a.documentation[d].lang===c){b.helpText=a.documentation[d].textContent;break}}return b}};Ext.namespace("gxp.plugins");
gxp.plugins.FeatureEditorGrid=Ext.extend(Ext.grid.PropertyGrid,{ptype:"gxp_editorgrid",xtype:"gxp_editorgrid",feature:null,schema:null,fields:null,excludeFields:null,propertyNames:null,readOnly:null,border:!1,initComponent:function(){if(!this.dateFormat)this.dateFormat=Ext.form.DateField.prototype.format;if(!this.timeFormat)this.timeFormat=Ext.form.TimeField.prototype.format;this.customRenderers=this.customRenderers||{};this.customEditors=this.customEditors||{};var a=this.feature,b;if(this.fields){b=
{};for(var c=0,d=this.fields.length;c<d;++c)b[this.fields[c]]=a.attributes[this.fields[c]]}else b=a.attributes;if(!this.excludeFields)this.excludeFields=[];if(this.schema){var e=this.fields?this.fields.join(",").toUpperCase().split(","):[];this.schema.each(function(c){var d=c.get("type");if(!d.match(/^[^:]*:?((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry))/)){var f=c.get("name");this.fields&&-1==e.indexOf(f.toUpperCase())&&this.excludeFields.push(f);var k=a.attributes[f],l=GeoExt.form.recordToField(c);
if((c=this.getAnnotationsFromSchema(c))&&c.label)this.propertyNames=this.propertyNames||{},this.propertyNames[f]=c.label;var n;if("string"==typeof k){var m;switch(d.split(":").pop()){case "date":m=this.dateFormat;l.editable=!1;break;case "dateTime":if(!m)m=this.dateFormat+" "+this.timeFormat,l.editable=!0;l.format=m;n={startedit:function(a,b){if(!(b instanceof Date)){var c=Date.parseDate(b.replace(/Z$/,""),"c");c&&this.setValue(c)}}};this.customRenderers[f]=function(){return function(a){var b=a;"string"==
typeof a&&(b=Date.parseDate(a.replace(/Z$/,""),"c"));return b?b.format(m):a}}();break;case "boolean":n={startedit:function(a,b){this.setValue(Boolean(b))}}}}this.customEditors[f]=new Ext.grid.GridEditor({field:Ext.create(l),listeners:n});b[f]=k}},this);a.attributes=b}this.source=b;var f=this.excludeFields.length?this.excludeFields.join(",").toUpperCase().split(","):[];this.viewConfig={forceFit:!0,getRowClass:function(a){if(-1!==f.indexOf(a.get("name").toUpperCase()))return"x-hide-nosize"}};this.listeners=
{beforeedit:function(){return this.featureEditor&&this.featureEditor.editing},propertychange:function(){this.featureEditor&&this.featureEditor.setFeatureState(this.featureEditor.getDirtyState())},scope:this};c=Ext.data.Store.prototype.sort;Ext.data.Store.prototype.sort=function(){};gxp.plugins.FeatureEditorGrid.superclass.initComponent.apply(this,arguments);Ext.data.Store.prototype.sort=c;this.propStore.isEditableValue=function(){return!0}},init:function(a){this.featureEditor=a;this.featureEditor.on("canceledit",
this.onCancelEdit,this);this.featureEditor.add(this);this.featureEditor.doLayout()},destroy:function(){if(this.featureEditor)this.featureEditor.un("canceledit",this.onCancelEdit,this),this.featureEditor=null;gxp.plugins.FeatureEditorGrid.superclass.destroy.call(this)},onCancelEdit:function(a,b){b&&this.setSource(b.attributes)}});Ext.override(gxp.plugins.FeatureEditorGrid,gxp.plugins.SchemaAnnotations);Ext.preg(gxp.plugins.FeatureEditorGrid.prototype.ptype,gxp.plugins.FeatureEditorGrid);
Ext.reg(gxp.plugins.FeatureEditorGrid.prototype.xtype,gxp.plugins.FeatureEditorGrid);Ext.namespace("gxp");
gxp.FeatureEditPopup=Ext.extend(GeoExt.Popup,{closeMsgTitle:"Save Changes?",closeMsg:"This feature has unsaved changes. Would you like to save your changes?",deleteMsgTitle:"Delete Feature?",deleteMsg:"Are you sure you want to delete this feature?",editButtonText:"Edit",editButtonTooltip:"Make this feature editable",deleteButtonText:"Delete",deleteButtonTooltip:"Delete this feature",cancelButtonText:"Cancel",cancelButtonTooltip:"Stop editing, discard changes",saveButtonText:"Save",saveButtonTooltip:"Save changes",
layout:"fit",feature:null,schema:null,readOnly:!1,allowDelete:!1,editing:!1,editorPluginConfig:{ptype:"gxp_editorgrid"},modifyControl:null,geometry:null,attributes:null,cancelButton:null,saveButton:null,editButton:null,deleteButton:null,initComponent:function(){var b;this.addEvents("startedit","stopedit","beforefeaturemodified","featuremodified","canceledit","cancelclose");var a=this.feature;if(a instanceof GeoExt.data.FeatureRecord)b=this.feature=a.getFeature(),a=b;if(!this.location)this.location=
a;this.anchored=!this.editing;if(!this.title&&a.fid)this.title=a.fid;this.editButton=new Ext.Button({text:this.editButtonText,tooltip:this.editButtonTooltip,iconCls:"edit",handler:this.startEditing,scope:this});this.deleteButton=new Ext.Button({text:this.deleteButtonText,tooltip:this.deleteButtonTooltip,iconCls:"delete",hidden:!this.allowDelete,handler:this.deleteFeature,scope:this});this.cancelButton=new Ext.Button({text:this.cancelButtonText,tooltip:this.cancelButtonTooltip,iconCls:"cancel",hidden:!0,
handler:function(){this.stopEditing(!1)},scope:this});this.saveButton=new Ext.Button({text:this.saveButtonText,tooltip:this.saveButtonTooltip,iconCls:"save",hidden:!0,handler:function(){this.stopEditing(!0)},scope:this});this.plugins=[Ext.apply({feature:a,schema:this.schema,fields:this.fields,excludeFields:this.excludeFields,propertyNames:this.propertyNames,readOnly:this.readOnly},this.editorPluginConfig)];this.bbar=new Ext.Toolbar({hidden:this.readOnly,items:[this.editButton,this.deleteButton,this.saveButton,
this.cancelButton]});gxp.FeatureEditPopup.superclass.initComponent.call(this);this.on({show:function(){if(this.editing)this.editing=null,this.startEditing()},beforeclose:function(){if(this.editing){if(this.feature.state===this.getDirtyState())return Ext.Msg.show({title:this.closeMsgTitle,msg:this.closeMsg,buttons:Ext.Msg.YESNOCANCEL,fn:function(a){a&&"cancel"!==a?(this.stopEditing("yes"===a),this.close()):this.fireEvent("cancelclose",this)},scope:this,icon:Ext.MessageBox.QUESTION,animEl:this.getEl()}),
!1;this.stopEditing(!1)}},scope:this})},getDirtyState:function(){return this.feature.state===OpenLayers.State.INSERT?this.feature.state:OpenLayers.State.UPDATE},startEditing:function(){if(!this.editing)this.fireEvent("startedit",this),this.editing=!0,this.anc&&this.unanchorPopup(),this.editButton.hide(),this.deleteButton.hide(),this.saveButton.show(),this.cancelButton.show(),this.geometry=this.feature.geometry&&this.feature.geometry.clone(),this.attributes=Ext.apply({},this.feature.attributes),this.modifyControl=
new OpenLayers.Control.ModifyFeature(this.feature.layer,{standalone:!0,vertexRenderIntent:this.vertexRenderIntent}),this.feature.layer.map.addControl(this.modifyControl),this.modifyControl.activate(),this.feature.geometry&&this.modifyControl.selectFeature(this.feature)},stopEditing:function(a){if(this.editing){this.fireEvent("stopedit",this);this.modifyControl.deactivate();this.modifyControl.destroy();var b=this.feature;if(b.state===this.getDirtyState())if(!0===a){this.fireEvent("beforefeaturemodified",
this,b);if(this.schema){var c,d;for(d in b.attributes)c=this.schema.getAt(this.schema.findExact("name",d)),a=b.attributes[d],a instanceof Date&&(c=c.get("type").split(":").pop(),b.attributes[d]=a.format("date"==c?"Y-m-d":"c"))}this.fireEvent("featuremodified",this,b)}else b.state===OpenLayers.State.INSERT?(this.editing=!1,b.layer&&b.layer.destroyFeatures([b]),this.fireEvent("canceledit",this,null),this.close()):(d=b.layer,d.drawFeature(b,{display:"none"}),b.geometry=this.geometry,b.attributes=this.attributes,
this.setFeatureState(null),d.drawFeature(b),this.fireEvent("canceledit",this,b));this.isDestroyed||(this.cancelButton.hide(),this.saveButton.hide(),this.editButton.show(),this.allowDelete&&this.deleteButton.show());this.editing=!1}},deleteFeature:function(){Ext.Msg.show({title:this.deleteMsgTitle,msg:this.deleteMsg,buttons:Ext.Msg.YESNO,fn:function(a){"yes"===a&&(this.setFeatureState(OpenLayers.State.DELETE),this.fireEvent("featuremodified",this,this.feature),this.close())},scope:this,icon:Ext.MessageBox.QUESTION,
animEl:this.getEl()})},setFeatureState:function(a){this.feature.state=a;(a=this.feature.layer)&&a.events.triggerEvent("featuremodified",{feature:this.feature})}});Ext.reg("gxp_featureeditpopup",gxp.FeatureEditPopup);Ext.namespace("gxp.plugins");
gxp.plugins.FeatureEditor=Ext.extend(gxp.plugins.ClickableFeatures,{ptype:"gxp_featureeditor",commitMessage:!1,splitButton:null,iconClsAdd:"gxp-icon-addfeature",closeOnSave:!1,supportAbstractGeometry:!1,supportNoGeometry:!1,iconClsEdit:"gxp-icon-editfeature",exceptionTitle:"Save Failed",exceptionText:"Trouble saving features",pointText:"Point",lineText:"Line",polygonText:"Polygon",noGeometryText:"Event",commitTitle:"Commit message",commitText:"Please enter a commit message for this edit:",createFeatureActionTip:"Create a new feature",
createFeatureActionText:"Create",editFeatureActionTip:"Edit existing feature",editFeatureActionText:"Modify",splitButtonText:"Edit",splitButtonTooltip:"Edit features on selected WMS layer",outputTarget:"map",snappingAgent:null,readOnly:!1,modifyOnly:!1,showSelectedOnly:!0,roles:["ROLE_ADMINISTRATOR"],createAction:null,editAction:null,activeIndex:0,drawControl:null,popup:null,schema:null,constructor:function(a){this.addEvents("layereditable","featureeditable");gxp.plugins.FeatureEditor.superclass.constructor.apply(this,
arguments)},init:function(a){gxp.plugins.FeatureEditor.superclass.init.apply(this,arguments);this.target.on("authorizationchange",this.onAuthorizationChange,this)},destroy:function(){this.target.un("authorizationchange",this.onAuthorizationChange,this);gxp.plugins.FeatureEditor.superclass.destroy.apply(this,arguments)},onAuthorizationChange:function(){this.target.isAuthorized(this.roles)||(this.selectControl.deactivate(),this.drawControl.deactivate());this.enableOrDisable()},addActions:function(){function a(a,
d){var f=Array.prototype.slice.call(arguments);f.splice(0,2);if(!e&&b&&!b.isDestroyed){if(b.editing){var g=function(){e=!0;h.call(this);"setLayer"===d?this.target.selectLayer(f[0]):"clearFeatures"===d?window.setTimeout(function(){a[d].call(a)}):a[d].apply(a,f)},h=function(){c.featureStore.un("write",g,this);b.un("canceledit",g,this);b.un("cancelclose",h,this)};c.featureStore.on("write",g,this);b.on({canceledit:g,cancelclose:h,scope:this});b.close()}return!b.editing}e=!1}var b,c=this.getFeatureManager(),
d=c.featureLayer,e=!1;c.on({beforequery:a.createDelegate(this,"loadFeatures",1),beforelayerchange:a.createDelegate(this,"setLayer",1),beforesetpage:a.createDelegate(this,"setPage",1),beforeclearfeatures:a.createDelegate(this,"clearFeatures",1),scope:this});this.drawControl=new OpenLayers.Control.DrawFeature(d,OpenLayers.Handler.Point,{eventListeners:{featureadded:function(a){if(!0===this.autoLoadFeature)this.autoLoadedFeature=a.feature},activate:function(){this.target.doAuthorized(this.roles,function(){c.showLayer(this.id,
this.showSelectedOnly&&"selected")},this)},deactivate:function(){c.hideLayer(this.id)},scope:this}});this.selectControl=new OpenLayers.Control.SelectFeature(d,{clickout:!1,multipleKey:"fakeKey",eventListeners:{activate:function(){this.target.doAuthorized(this.roles,function(){(!0===this.autoLoadFeature||c.paging)&&this.target.mapPanel.map.events.register("click",this,this.noFeatureClick);c.showLayer(this.id,this.showSelectedOnly&&"selected");this.selectControl.unselectAll(b&&b.editing&&{except:b.feature})},
this)},deactivate:function(){(!0===this.autoLoadFeature||c.paging)&&this.target.mapPanel.map.events.unregister("click",this,this.noFeatureClick);if(b){if(b.editing)b.on("cancelclose",function(){this.selectControl.activate()},this,{single:!0});b.on("close",function(){c.hideLayer(this.id)},this,{single:!0});b.close()}else c.hideLayer(this.id)},scope:this}});d.events.on({beforefeatureremoved:function(a){this.popup&&a.feature===this.popup.feature&&this.selectControl.unselect(a.feature)},featureunselected:function(a){(a=
a.feature)&&this.fireEvent("featureeditable",this,a,!1);a&&a.geometry&&b&&!b.hidden&&b.close()},beforefeatureselected:function(){if(b)return!b.editing},featureselected:function(a){var d=a.feature;d&&this.fireEvent("featureeditable",this,d,!0);var e=c.featureStore;if(!0===this._forcePopupForNoGeometry||this.selectControl.active&&null!==d.geometry)!1===this.readOnly&&(this.selectControl.deactivate(),c.showLayer(this.id,this.showSelectedOnly&&"selected")),b=this.addOutput({xtype:"gxp_featureeditpopup",
collapsible:!0,feature:e.getByFeature(d),vertexRenderIntent:"vertex",readOnly:this.readOnly,fields:this.fields,excludeFields:this.excludeFields,editing:d.state===OpenLayers.State.INSERT,schema:this.schema,allowDelete:!0,width:200,height:250}),b.on({close:function(){!1===this.readOnly&&this.selectControl.activate();d.layer&&-1!==d.layer.selectedFeatures.indexOf(d)&&this.selectControl.unselect(d);if(d===this.autoLoadedFeature)d.layer&&d.layer.removeFeatures([a.feature]),this.autoLoadedFeature=null},
featuremodified:function(a,b){e.on({beforewrite:{fn:function(a,b,c,d){if(!0===this.commitMessage)d.params.handle=this._commitMsg,delete this._commitMsg},single:!0},beforesave:{fn:function(){a&&a.isVisible()&&a.disable();if(!0===this.commitMessage&&!this._commitMsg){var b=arguments.callee;Ext.Msg.show({prompt:!0,title:this.commitTitle,msg:this.commitText,buttons:Ext.Msg.OK,fn:function(a,c){if("ok"===a)this._commitMsg=c,e.un("beforesave",b,this),e.save()},scope:this,multiline:!0});return!1}},single:!0!==
this.commitMessage},write:{fn:function(){a&&(a.isVisible()&&a.enable(),this.closeOnSave&&a.close());var b=c.layerRecord;this.target.fireEvent("featureedit",c,{name:b.get("name"),source:b.get("source")})},single:!0},exception:{fn:function(b,d,f,g,h,j){b=this.exceptionText;"remote"===d?h.exceptionReport&&(b=gxp.util.getOGCExceptionText(h.exceptionReport)):b="Status: "+h.status;c.fireEvent("exception",c,h.exceptionReport||{},b,j);!1===c.hasListener("exception")&&!1===e.hasListener("exception")&&Ext.Msg.show({title:this.exceptionTitle,
msg:b,icon:Ext.MessageBox.ERROR,buttons:{ok:!0}});a&&a.isVisible()&&(a.enable(),a.startEditing())},single:!0},scope:this});if(b.state===OpenLayers.State.DELETE)e._removing=!0,e.remove(e.getRecordFromFeature(b)),delete e._removing;e.save()},canceledit:function(){e.commitChanges()},scope:this}),this.popup=b},sketchcomplete:function(){c.featureLayer.events.register("featuresadded",this,function(a){c.featureLayer.events.unregister("featuresadded",this,arguments.callee);this.drawControl.deactivate();this.selectControl.activate();
this.selectControl.select(a.features[0])})},scope:this});var f=this.toggleGroup||Ext.id(),g=[],h={tooltip:this.createFeatureActionTip,menuText:this.initialConfig.createFeatureActionText,text:this.initialConfig.createFeatureActionText,iconCls:this.iconClsAdd,disabled:!0,hidden:this.modifyOnly||this.readOnly,toggleGroup:f,group:f,groupClass:null,enableToggle:!0,allowDepress:!0,control:this.drawControl,deactivateOnDisable:!0,map:this.target.mapPanel.map,listeners:{checkchange:this.onItemCheckchange,
scope:this}};if(!0===this.supportAbstractGeometry){var j=[];!0===this.supportNoGeometry&&j.push(new Ext.menu.CheckItem({text:this.noGeometryText,iconCls:"gxp-icon-event",groupClass:null,group:f,listeners:{checkchange:function(a,b){if(!0===b){var c=new OpenLayers.Feature.Vector(null);c.state=OpenLayers.State.INSERT;d.addFeatures([c]);this._forcePopupForNoGeometry=!0;d.events.triggerEvent("featureselected",{feature:c});delete this._forcePopupForNoGeometry}this.createAction.items[0]instanceof Ext.menu.CheckItem?
this.createAction.items[0].setChecked(!1):this.createAction.items[0].toggle(!1)},scope:this}}));var k=function(a,b,c){!0===b&&this.setHandler(c,!1);this.createAction.items[0]instanceof Ext.menu.CheckItem?this.createAction.items[0].setChecked(b):this.createAction.items[0].toggle(b)};j.push(new Ext.menu.CheckItem({groupClass:null,text:this.pointText,group:f,iconCls:"gxp-icon-point",listeners:{checkchange:k.createDelegate(this,[OpenLayers.Handler.Point],2)}}),new Ext.menu.CheckItem({groupClass:null,
text:this.lineText,group:f,iconCls:"gxp-icon-line",listeners:{checkchange:k.createDelegate(this,[OpenLayers.Handler.Path],2)}}),new Ext.menu.CheckItem({groupClass:null,text:this.polygonText,group:f,iconCls:"gxp-icon-polygon",listeners:{checkchange:k.createDelegate(this,[OpenLayers.Handler.Polygon],2)}}));g.push(new GeoExt.Action(Ext.apply(h,{menu:new Ext.menu.Menu({items:j})})))}else g.push(new GeoExt.Action(h));g.push(new GeoExt.Action({tooltip:this.editFeatureActionTip,text:this.initialConfig.editFeatureActionText,
menuText:this.initialConfig.editFeatureActionText,iconCls:this.iconClsEdit,disabled:!0,toggleGroup:f,group:f,groupClass:null,enableToggle:!0,allowDepress:!0,control:this.selectControl,deactivateOnDisable:!0,map:this.target.mapPanel.map,listeners:{checkchange:this.onItemCheckchange,scope:this}}));this.createAction=g[0];this.editAction=g[1];if(this.splitButton)this.splitButton=new Ext.SplitButton({menu:{items:[Ext.apply(new Ext.menu.CheckItem(g[0]),{text:this.createFeatureActionText}),Ext.apply(new Ext.menu.CheckItem(g[1]),
{text:this.editFeatureActionText})]},disabled:!0,buttonText:this.splitButtonText,tooltip:this.splitButtonTooltip,iconCls:this.iconClsAdd,enableToggle:!0,toggleGroup:this.toggleGroup,allowDepress:!0,handler:function(a){a.pressed&&a.menu.items.itemAt(this.activeIndex).setChecked(!0)},scope:this,listeners:{toggle:function(a,b){b||a.menu.items.each(function(a){a.setChecked(!1)})},render:function(a){Ext.ButtonToggleMgr.register(a)}}}),g=[this.splitButton];g=gxp.plugins.FeatureEditor.superclass.addActions.call(this,
g);c.on("layerchange",this.onLayerChange,this);(f=this.getSnappingAgent())&&f.registerEditor(this);return g},onItemCheckchange:function(a,b){if(this.splitButton)this.activeIndex=a.ownerCt.items.indexOf(a),this.splitButton.toggle(b),b&&this.splitButton.setIconClass(a.iconCls)},getFeatureManager:function(){var a=this.target.tools[this.featureManager];if(!a)throw Error("Unable to access feature manager by id: "+this.featureManager);return a},getSnappingAgent:function(){var a,b=this.snappingAgent;if(b&&
(a=this.target.tools[b],!a))throw Error("Unable to locate snapping agent with id: "+b);return a},setHandler:function(a,b){var c=this.drawControl,d=c.active;d&&c.deactivate();c.handler.destroy();c.handler=new a(c,c.callbacks,Ext.apply(c.handlerOptions,{multi:b}));d&&c.activate()},enableOrDisable:function(){var a=!this.schema;this.splitButton&&this.splitButton.setDisabled(a);this.createAction.setDisabled(a);this.editAction.setDisabled(a);return a},onLayerChange:function(a,b,c){this.schema=c;if(this.enableOrDisable())this.fireEvent("layereditable",
this,b,!1);else{var c=this.createAction,d={Point:OpenLayers.Handler.Point,Line:OpenLayers.Handler.Path,Curve:OpenLayers.Handler.Path,Polygon:OpenLayers.Handler.Polygon,Surface:OpenLayers.Handler.Polygon},e=a.geometryType&&a.geometryType.replace("Multi","");(d=e&&d[e])?(this.setHandler(d,e!=a.geometryType),c.enable()):!0===this.supportAbstractGeometry&&a.geometryType&&"Geometry"===a.geometryType?c.enable():c.disable();this.fireEvent("layereditable",this,b,!0)}},select:function(a){this.selectControl.unselectAll(this.popup&&
this.popup.editing&&{except:this.popup.feature});this.selectControl.select(a)}});Ext.preg(gxp.plugins.FeatureEditor.prototype.ptype,gxp.plugins.FeatureEditor);Ext.namespace("gxp.plugins");
gxp.plugins.FormFieldHelp=Ext.extend(Object,{ptype:"gxp_formfieldhelp",helpText:null,dismissDelay:5E3,constructor:function(a){Ext.apply(this,a)},init:function(a){this.target=a;a.on("render",this.showHelp,this)},showHelp:function(){var a;a=this.target.label?this.target.label:this.target.getEl();Ext.QuickTips.register({target:a,dismissDelay:this.dismissDelay,text:this.helpText})}});Ext.preg(gxp.plugins.FormFieldHelp.prototype.ptype,gxp.plugins.FormFieldHelp);Ext.namespace("gxp.plugins");
gxp.plugins.FeatureEditorForm=Ext.extend(Ext.FormPanel,{ptype:"gxp_editorform",xtype:"gxp_editorform",feature:null,schema:null,fieldConfig:null,fields:null,excludeFields:null,propertyNames:null,readOnly:null,monitorValid:!0,initComponent:function(){this.defaults=Ext.apply(this.defaults||{},{readOnly:!0});this.listeners={clientvalidation:function(a,b){b&&this.getForm().isDirty()&&(Ext.apply(this.feature.attributes,this.getForm().getFieldValues()),this.featureEditor.setFeatureState(this.featureEditor.getDirtyState()))},
scope:this};gxp.plugins.FeatureEditorForm.superclass.initComponent.call(this);if(!this.excludeFields)this.excludeFields=[];var a=[],b,c;for(b=0,c=this.excludeFields.length;b<c;++b)a[b]=this.excludeFields[b].toLowerCase();this.excludeFields=a;var d=this.fields?this.fields.join(",").toUpperCase().split(","):[],e={};if(this.schema)this.schema.each(function(a){var b=a.get("name"),c=b.toLowerCase();this.fields&&-1==d.indexOf(b.toUpperCase())&&this.excludeFields.push(c);if(-1==this.excludeFields.indexOf(c)&&
!a.get("type").match(/^[^:]*:?((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry))/)){var f=GeoExt.form.recordToField(a),a=this.getAnnotationsFromSchema(a);if(null!==a){if(a.helpText){if(!f.plugins)f.plugins=[];f.plugins.push({ptype:"gxp_formfieldhelp",helpText:a.helpText})}if(a.label)f.fieldLabel=a.label}f.fieldLabel=this.propertyNames?this.propertyNames[b]||f.fieldLabel:f.fieldLabel;this.fieldConfig&&this.fieldConfig[b]&&Ext.apply(f,this.fieldConfig[b]);if(void 0!==this.feature.attributes[b])f.value=
this.feature.attributes[b];if(f.value&&"checkbox"==f.xtype)f.checked=Ext.isBoolean(f.value)?f.value:"true"===f.value;if(f.value&&"gxp_datefield"==f.xtype)f.value=new Date(1E3*f.value);if(f.value&&"datefield"==f.xtype)f.format="Y-m-d",f.value=Date.parseDate(f.value.replace(/Z$/,""),"Y-m-d");"combo"===f.xtype&&Ext.applyIf(f,{store:new Ext.data.ArrayStore({fields:["id","value"],data:f.comboStoreData}),displayField:"value",valueField:"id",mode:"local",triggerAction:"all"});e[c]=f}},this);else{var e={},
f;for(f in this.feature.attributes)a=f.toLowerCase(),this.fields&&-1==d.indexOf(f.toUpperCase())&&this.excludeFields.push(a),-1===this.excludeFields.indexOf(a)&&(e[a]={xtype:"textfield",fieldLabel:this.propertyNames?this.propertyNames[f]||f:f,name:f,value:this.feature.attributes[f]})}this.add(this.reorderFields(e))},reorderFields:function(a){var b=[];if(this.fields)for(var c=0,d=this.fields.length;c<d;++c)a[this.fields[c].toLowerCase()]&&b.push(a[this.fields[c].toLowerCase()]);else for(c in a)b.push(a[c]);
return b},init:function(a){this.featureEditor=a;this.featureEditor.on("startedit",this.onStartEdit,this);this.featureEditor.on("stopedit",this.onStopEdit,this);this.featureEditor.on("canceledit",this.onCancelEdit,this);this.featureEditor.add(this);this.featureEditor.doLayout()},destroy:function(){this.featureEditor.un("startedit",this.onStartEdit,this);this.featureEditor.un("stopedit",this.onStopEdit,this);this.featureEditor.un("canceledit",this.onCancelEdit,this);this.featureEditor=null;gxp.plugins.FeatureEditorForm.superclass.destroy.call(this)},
onStartEdit:function(){this.getForm().items.each(function(a){!0!==this.readOnly&&a.setReadOnly(!1)},this)},onStopEdit:function(){this.getForm().items.each(function(a){a.setReadOnly(!0)})},onCancelEdit:function(a,b){if(b){var c=this.getForm(),d;for(d in b.attributes){var e=c.findField(d);e&&e.setValue(b.attributes[d])}}}});Ext.override(gxp.plugins.FeatureEditorForm,gxp.plugins.SchemaAnnotations);Ext.preg(gxp.plugins.FeatureEditorForm.prototype.ptype,gxp.plugins.FeatureEditorForm);
Ext.reg(gxp.plugins.FeatureEditorForm.prototype.xtype,gxp.plugins.FeatureEditorForm);Ext.namespace("gxp.grid");
gxp.grid.FeatureGrid=Ext.extend(Ext.grid.GridPanel,{map:null,ignoreFields:null,includeFields:null,layer:null,columnsSortable:!0,columnMenuDisabled:!1,initComponent:function(){this.ignoreFields=["feature","state","fid"].concat(this.ignoreFields);if(this.store){if(this.cm=this.createColumnModel(this.store),this.map)this.layer=new OpenLayers.Layer.Vector(this.id+"_layer"),this.map.addLayer(this.layer)}else this.store=new Ext.data.Store,this.cm=new Ext.grid.ColumnModel({columns:[]});if(this.layer)this.sm=
this.sm||new GeoExt.grid.FeatureSelectionModel({layerFromStore:!1,layer:this.layer}),this.store instanceof GeoExt.data.FeatureStore&&this.store.bind(this.layer);if(!this.dateFormat)this.dateFormat=Ext.form.DateField.prototype.format;if(!this.timeFormat)this.timeFormat=Ext.form.TimeField.prototype.format;gxp.grid.FeatureGrid.superclass.initComponent.call(this)},onDestroy:function(){this.initialConfig&&this.initialConfig.map&&!this.initialConfig.layer&&(this.layer.destroy(),delete this.layer);gxp.grid.FeatureGrid.superclass.onDestroy.apply(this,
arguments)},setStore:function(a,b){if(b)this.schema=b;a?(this.store instanceof GeoExt.data.FeatureStore&&this.store.unbind(),this.layer&&(this.layer.destroyFeatures(),a.bind(this.layer)),this.reconfigure(a,this.createColumnModel(a))):this.reconfigure(new Ext.data.Store,new Ext.grid.ColumnModel({columns:[]}))},getColumns:function(a){function b(a){return function(b){var c=b;"string"==typeof b&&(c=Date.parseDate(b.replace(/Z$/,""),"c"));return c?c.format(a):b}}var c=[],d=this.customEditors||{},e=this.customRenderers||
{},f,g,h,j,k;(this.schema||a.fields).each(function(a){if(this.schema)switch(f=a.get("name"),g=a.get("type").split(":").pop(),j=null,g){case "date":j=this.dateFormat;break;case "datetime":j=j?j:this.dateFormat+" "+this.timeFormat;h=void 0;k=b(j);break;case "boolean":h="booleancolumn";break;case "string":h="gridcolumn";break;default:h="numbercolumn"}else f=a.name;if(-1===this.ignoreFields.indexOf(f)&&(null===this.includeFields||0<=this.includeFields.indexOf(f)))c.push(Ext.apply({dataIndex:f,hidden:this.fieldVisibility?
!this.fieldVisibility[f]:!1,header:this.propertyNames?this.propertyNames[f]||f:f,sortable:this.columnsSortable,menuDisabled:this.columnMenuDisabled,xtype:h,editor:d[f]||{xtype:"textfield"},format:j,renderer:e[f]||(h?void 0:k)},this.columnConfig?this.columnConfig[f]:null))},this);return c},createColumnModel:function(a){a=this.getColumns(a);return new Ext.grid.ColumnModel(a)}});Ext.reg("gxp_featuregrid",gxp.grid.FeatureGrid);Ext.namespace("gxp.plugins");
gxp.plugins.FeatureGrid=Ext.extend(gxp.plugins.ClickableFeatures,{ptype:"gxp_featuregrid",schema:null,showTotalResults:!1,alwaysDisplayOnMap:!1,displayMode:"all",autoExpand:!1,autoCollapse:!1,selectOnMap:!1,displayFeatureText:"Display on map",firstPageTip:"First page",previousPageTip:"Previous page",zoomPageExtentTip:"Zoom to page extent",nextPageTip:"Next page",lastPageTip:"Last page",totalMsg:"Features {1} to {2} of {0}",displayTotalResults:function(){var a=this.target.tools[this.featureManager];
!0===this.showTotalResults&&this.displayItem.setText(null!==a.numberOfFeatures?String.format(this.totalMsg,a.numberOfFeatures,a.pageIndex*a.maxFeatures+Math.min(a.numberOfFeatures,1),Math.min((a.pageIndex+1)*a.maxFeatures,a.numberOfFeatures)):"")},addOutput:function(a){function b(){var a=c.schema,b=["feature","state","fid"];a&&a.each(function(a){0==a.get("type").indexOf("gml:")&&b.push(a.get("name"))});f.ignoreFields=b;f.setStore(c.featureStore,a);c.featureStore||(c.paging&&(f.lastPageButton.disable(),
f.nextPageButton.disable(),f.firstPageButton.disable(),f.prevPageButton.disable(),f.zoomToPageButton.disable()),this.displayTotalResults())}var c=this.target.tools[this.featureManager],d=this.target.mapPanel.map,e;this.selectControl=new OpenLayers.Control.SelectFeature(c.featureLayer,this.initialConfig.controlOptions);if(this.selectOnMap){if(this.autoLoadFeature||c.paging&&c.pagingType===gxp.plugins.FeatureManager.QUADTREE_PAGING)this.selectControl.events.on({activate:function(){d.events.register("click",
this,this.noFeatureClick)},deactivate:function(){d.events.unregister("click",this,this.noFeatureClick)},scope:this});d.addControl(this.selectControl);e={selectControl:this.selectControl}}else e={selectControl:this.selectControl,singleSelect:!1,autoActivateControl:!1,listeners:{beforerowselect:function(){if(window.event&&"contextmenu"==window.event.type||this.selectControl.active||c.featureStore.getModifiedRecords().length)return!1},scope:this}};this.displayItem=new Ext.Toolbar.TextItem({});var a=
Ext.apply({xtype:"gxp_featuregrid",border:!1,sm:new GeoExt.grid.FeatureSelectionModel(e),autoScroll:!0,columnMenuDisabled:!!c.paging,bbar:(c.paging?[{iconCls:"x-tbar-page-first",ref:"../firstPageButton",tooltip:this.firstPageTip,disabled:!0,handler:function(){c.setPage({index:0})}},{iconCls:"x-tbar-page-prev",ref:"../prevPageButton",tooltip:this.previousPageTip,disabled:!0,handler:function(){c.previousPage()}},{iconCls:"gxp-icon-zoom-to",ref:"../zoomToPageButton",tooltip:this.zoomPageExtentTip,disabled:!0,
hidden:c.pagingType!==gxp.plugins.FeatureManager.QUADTREE_PAGING||c.autoZoomPage,handler:function(){var a=c.getPageExtent();null!==a&&d.zoomToExtent(a)}},{iconCls:"x-tbar-page-next",ref:"../nextPageButton",tooltip:this.nextPageTip,disabled:!0,handler:function(){c.nextPage()}},{iconCls:"x-tbar-page-last",ref:"../lastPageButton",tooltip:this.lastPageTip,disabled:!0,handler:function(){c.setPage({index:"last"})}},{xtype:"tbspacer",width:10},this.displayItem]:[]).concat(["->"].concat(!this.alwaysDisplayOnMap?
[{text:this.displayFeatureText,enableToggle:!0,toggleHandler:function(a,b){this.selectOnMap&&this.selectControl[b?"activate":"deactivate"]();c[b?"showLayer":"hideLayer"](this.id,this.displayMode)},scope:this}]:[])),contextMenu:new Ext.menu.Menu({items:[]})},a||{}),f=gxp.plugins.FeatureGrid.superclass.addOutput.call(this,a);f.on({added:function(a,b){function d(){this.displayTotalResults();this.selectOnMap&&this.selectControl.deactivate();this.autoCollapse&&"function"==typeof b.collapse&&b.collapse()}
c.on({query:function(a,c){c&&c.getCount()?(this.displayTotalResults(),this.selectOnMap&&this.selectControl.activate(),this.autoExpand&&"function"==typeof b.expand&&b.expand()):d.call(this)},layerchange:d,clearfeatures:d,scope:this})},contextmenu:function(a){if(0<f.contextMenu.items.getCount()){var b=f.getView().findRowIndex(a.getTarget());!1!==b&&(f.getSelectionModel().selectRow(b),f.contextMenu.showAt(a.getXY()),a.stopEvent())}},scope:this});(this.alwaysDisplayOnMap||!0===this.selectOnMap&&"selected"===
this.displayMode)&&c.showLayer(this.id,this.displayMode);c.paging&&c.on({beforesetpage:function(){f.zoomToPageButton.disable()},setpage:function(a,b,c,d,e,n){a=0<n;f.zoomToPageButton.setDisabled(!a);b=a&&0!==e;f.firstPageButton.setDisabled(!b);f.prevPageButton.setDisabled(!b);e=a&&e!==n-1;f.lastPageButton.setDisabled(!e);f.nextPageButton.setDisabled(!e)},scope:this});c.featureStore&&b.call(this);c.on("layerchange",b,this);return f}});Ext.preg(gxp.plugins.FeatureGrid.prototype.ptype,gxp.plugins.FeatureGrid);
Ext.namespace("gxp.plugins");
gxp.plugins.FeatureManager=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_featuremanager",maxFeatures:100,paging:!0,pagingType:null,autoZoomPage:!1,autoSetLayer:!0,autoLoadFeatures:!1,layerRecord:null,featureStore:null,hitCountProtocol:null,featureLayer:null,schema:null,geometryType:null,toolsShowingLayer:null,selectStyle:null,style:null,pages:null,page:null,numberOfFeatures:null,numPages:null,pageIndex:null,constructor:function(a){this.addEvents("beforequery","query","beforelayerchange","layerchange","beforesetpage",
"setpage","beforeclearfeatures","clearfeatures","beforesave","exception");if(a&&!a.pagingType)this.pagingType=gxp.plugins.FeatureManager.QUADTREE_PAGING;if(a&&a.layer)this.autoSetLayer=!1;gxp.plugins.FeatureManager.superclass.constructor.apply(this,arguments)},init:function(a){gxp.plugins.FeatureManager.superclass.init.apply(this,arguments);this.toolsShowingLayer={};this.style={all:new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:this.initialConfig.symbolizer||{Point:{pointRadius:4,
graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:4,strokeOpacity:1,strokeColor:"#ff9933"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#ff6633",fillColor:"white",fillOpacity:0.3}}})]}),selected:new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{display:"none"}})]})};this.featureLayer=new OpenLayers.Layer.Vector(this.id,{displayInLayerSwitcher:!1,visibility:!1,styleMap:new OpenLayers.StyleMap({select:Ext.applyIf(Ext.apply({display:""},
this.selectStyle),OpenLayers.Feature.Vector.style.select),vertex:this.style.all},{extendDefault:!1})});this.target.on({ready:function(){this.target.mapPanel.map.addLayer(this.featureLayer)},scope:this});this.on({beforedestroy:function(){this.target.mapPanel.map.removeLayer(this.featureLayer)},scope:this})},activate:function(){if(gxp.plugins.FeatureManager.superclass.activate.apply(this,arguments)){if(this.autoSetLayer)this.target.on("beforelayerselectionchange",this.setLayer,this);this.layer&&this.target.createLayerRecord(Ext.apply({},
this.layer),this.setLayer,this);this.on("layerchange",this.setSchema,this);return!0}},deactivate:function(){if(gxp.plugins.FeatureManager.superclass.deactivate.apply(this,arguments))return this.autoSetLayer&&this.target.un("beforelayerselectionchange",this.setLayer,this),this.un("layerchange",this.setSchema,this),this.setLayer(),!0},getPageExtent:function(){return this.pagingType===gxp.plugins.FeatureManager.QUADTREE_PAGING?this.page.extent:this.featureStore.layer.getDataExtent()},setLayer:function(a){var b=
this.fireEvent("beforelayerchange",this,a);if(!1!==b){if(a)this.featureLayer.projection=a.getLayer().projection;if(a!==this.layerRecord)this.clearFeatureStore(),(this.layerRecord=a)?!0===this.autoLoadFeatures?this.loadFeatures():this.setFeatureStore():this.fireEvent("layerchange",this,null)}return b},setSchema:function(a,b,c){this.schema=c},showLayer:function(a,b){this.toolsShowingLayer[a]=b||"all";this.setLayerDisplay()},hideLayer:function(a){delete this.toolsShowingLayer[a];this.setLayerDisplay()},
setLayerDisplay:function(){var a=this.visible(),b=this.target.mapPanel.map;a?(a=this.style[a],a!==this.featureLayer.styleMap.styles["default"]&&(this.featureLayer.styleMap.styles["default"]=a,this.featureLayer.redraw()),this.featureLayer.setVisibility(!0),b.events.on({addlayer:this.raiseLayer,scope:this})):this.featureLayer.map&&(this.featureLayer.setVisibility(!1),b.events.un({addlayer:this.raiseLayer,scope:this}))},visible:function(){var a=!1,b;for(b in this.toolsShowingLayer)"all"!=a&&(a=this.toolsShowingLayer[b]);
return a},raiseLayer:function(){var a=this.featureLayer&&this.featureLayer.map;a&&a.setLayerIndex(this.featureLayer,a.layers.length)},loadFeatures:function(a,b,c){if(!1!==this.fireEvent("beforequery",this,a,b,c)){this.filter=a;this.pages=null;if(b){var d=this;d._activeQuery&&d.un("query",d._activeQuery);this.on("query",d._activeQuery=function(a,f){delete d._activeQuery;this.un("query",arguments.callee,this);f.getCount();0==f.getCount()?b.call(c,[]):this.featureLayer.events.register("featuresadded",
this,function(a){this.featureLayer.events.unregister("featuresadded",this,arguments.callee);b.call(c,a.features)})},this,{single:!0})}this.featureStore?(this.featureStore.setOgcFilter(a),this.paging?this.setPage():this.featureStore.load()):(this.paging&&this.on("layerchange",function(a,b,c){c&&(this.un("layerchange",arguments.callee,this),this.setPage())},this),this.setFeatureStore(a,!this.paging))}},clearFeatures:function(){var a=this.featureStore;if(a&&!1!==this.fireEvent("beforeclearfeatures",
this))a.removeAll(),this.fireEvent("clearfeatures",this),a=a.proxy,a.abortRequest(),a.protocol.response&&a.protocol.response.abort()},getProjection:function(a){var b=this.target.mapPanel.map.getProjectionObject();(a=a.getLayer().projection)&&a.equals(b)&&(b=a);return b},setFeatureStore:function(a,b){var c=this.layerRecord,d=this.target.getSource(c);d&&d instanceof gxp.plugins.WMSSource?d.getSchema(c,function(d){if(!1===d)this.clearFeatureStore();else{var f=[],g,h=/gml:((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry)).*/,
j={"xsd:boolean":"boolean","xsd:int":"int","xsd:integer":"int","xsd:short":"int","xsd:long":"int","xsd:date":"date","xsd:string":"string","xsd:float":"float","xsd:double":"float"};d.each(function(a){var b=h.exec(a.get("type"));if(b)g=a.get("name"),this.geometryType=b[1];else{b=j[a.get("type")];a={name:a.get("name"),type:j[b]};if("date"==b)a.dateFormat="Y-m-d\\Z";f.push(a)}},this);var k={srsName:this.getProjection(c).getCode(),url:d.url,featureType:d.reader.raw.featureTypes[0].typeName,featureNS:d.reader.raw.targetNamespace,
geometryName:g};this.hitCountProtocol=new OpenLayers.Protocol.WFS(Ext.apply({version:"1.1.0",readOptions:{output:"object"},resultType:"hits",filter:a},k));this.featureStore=new gxp.data.WFSFeatureStore(Ext.apply({fields:f,proxy:{protocol:{outputFormat:this.format,multi:this.multi}},maxFeatures:this.maxFeatures,layer:this.featureLayer,ogcFilter:a,autoLoad:b,autoSave:!1,listeners:{beforewrite:function(a,b,c,d){this.fireEvent("beforesave",this,a,d.params)},write:function(){this.redrawMatchingLayers(c)},
load:function(a){this.fireEvent("query",this,a,this.filter)},scope:this}},k))}this.fireEvent("layerchange",this,c,d)},this):(this.clearFeatureStore(),this.fireEvent("layerchange",this,c,!1))},redrawMatchingLayers:function(a){var b=a.get("name"),c=a.get("source");this.target.mapPanel.layers.each(function(a){a.get("source")===c&&a.get("name")===b&&a.getLayer().redraw(!0)})},clearFeatureStore:function(){if(this.featureStore)this.featureStore.removeAll(),this.featureStore.unbind(),this.featureStore.destroy(),
this.geometryType=this.featureStore=this.numberOfFeatures=null},processPage:function(a,b,c,d){var b=b||{},e=b.lonLat?null:b.index,f=b.next,g=this.pages,h=this.pages.indexOf(a);this.setPageFilter(a);var j=f?h==(g.indexOf(f)||g.length)-1:!0,k=b.lonLat?a.extent.containsLonLat(b.lonLat):!0;k&&a.numFeatures&&a.numFeatures<=this.maxFeatures?c.call(this,a):k&&(h==e||j)&&this.hitCountProtocol.read({callback:function(h){var j=e,k=b.lonLat;f&&(j=(g.indexOf(f)||g.length)-1);!j&&k&&a.extent.containsLonLat(k)&&
(j=g.indexOf(a));a.numFeatures=h.numberOfFeatures;this.page||(a.numFeatures>this.maxFeatures?this.createLeaf(a,Ext.applyIf({index:j,next:f},b),c,d):0==a.numFeatures&&1<g.length?(g.remove(a),!1===b.allowEmpty&&this.setPage({index:e%this.pages.length,allowEmpty:!1})):this.pages.indexOf(a)==j&&c.call(this,a))},scope:this})},createLeaf:function(a,b,c,d){b=b||{};this.layerRecord.getLayer();var e=this.pages.indexOf(a);this.pages.remove(a);for(var f=a.extent,g=f.getCenterLonLat(),a=[f.left,g.lon,f.left,
g.lon],h=[g.lat,g.lat,f.bottom,f.bottom],j=[g.lon,f.right,g.lon,f.right],f=[f.top,f.top,g.lat,g.lat],k,g=3;0<=g;--g)k={extent:new OpenLayers.Bounds(a[g],h[g],j[g],f[g])},this.pages.splice(e,0,k),this.processPage(k,b,c,d)},getPagingExtent:function(a){var b=this.layerRecord.getLayer(),c=this.getSpatialFilter();if((a=c?c.value:this.target.mapPanel.map[a]())&&b.maxExtent&&a.containsBounds(b.maxExtent))a=b.maxExtent;return a},getSpatialFilter:function(){var a;if(this.filter instanceof OpenLayers.Filter.Spatial&&
this.filter.type===OpenLayers.Filter.Spatial.BBOX)a=this.filter;else if(this.filter instanceof OpenLayers.Filter.Logical&&this.filter.type===OpenLayers.Filter.Logical.AND)for(var b,c=this.filter.filters.length-1;0<=c;--c)if(b=this.filter.filters[c],b instanceof OpenLayers.Filter.Spatial&&b.type===OpenLayers.Filter.Spatial.BBOX){a=b;break}return a},setPageFilter:function(a){a.extent?(a=new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:this.featureStore.geometryName,value:a.extent}),
a=this.filter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.filter,a]}):a):a=this.filter;this.featureStore.setOgcFilter(a);this.hitCountProtocol.filter=a;return this.hitCountProtocol.options.filter=a},nextPage:function(a,b){var c;this.pagingType===gxp.plugins.FeatureManager.QUADTREE_PAGING?(c=this.page,this.page=null,c=(this.pages.indexOf(c)+1)%this.pages.length):c=this.pageIndex+1%this.numPages;this.setPage({index:c,allowEmpty:!1},a,b)},previousPage:function(a){var b;
this.pagingType===gxp.plugins.FeatureManager.QUADTREE_PAGING?(b=this.pages.indexOf(this.page)-1,0>b&&(b=this.pages.length-1)):(b=this.pageIndex-1,0>b&&(b=this.numPages-1));this.setPage({index:b,allowEmpty:!1,next:this.page},a)},setPage:function(a,b,c){if(this.pagingType===gxp.plugins.FeatureManager.QUADTREE_PAGING)if(this.filter instanceof OpenLayers.Filter.FeatureId)this.featureStore.load({callback:function(){b&&b.call(c)}});else{if(!1!==this.fireEvent("beforesetpage",this,a,b,c)){if(!a){var d=this.getPagingExtent("getExtent"),
d=new OpenLayers.LonLat(d.left,d.top),e=this.target.mapPanel.map.getMaxExtent();e.containsLonLat(d,!0)||(d=new OpenLayers.LonLat(e.left,e.top));a={lonLat:d,allowEmpty:!1}}a.index=a.index||0;if("last"==a.index)a.index=this.pages.length-1,a.next=this.pages[0];this.page=null;if(this.pages){if(a.lonLat)for(d=this.pages.length-1;0<=d;--d)if(this.pages[d].extent.containsLonLat(a.lonLat)){a.index=d;break}}else this.layerRecord.getLayer(),this.pages=[{extent:this.getPagingExtent("getMaxExtent")}],a.index=
0;this.processPage(this.pages[a.index],a,function(d){var e=this.target.mapPanel.map;this.page=d;this.setPageFilter(d);this.autoZoomPage&&!e.getExtent().containsLonLat(d.extent.getCenterLonLat())&&e.zoomToExtent(d.extent);e=this.pages.indexOf(this.page);this.fireEvent("setpage",this,a,b,c,e,this.pages.length);this.featureStore.load({callback:function(){b&&b.call(c,d)}})},this)}}else if(!1!==this.fireEvent("beforesetpage",this,a,b,c))if(a){if(null!=a.index)this.pageIndex="last"===a.index?this.numPages-
1:"first"===a.index?0:a.index,d=this.pageIndex*this.maxFeatures,this.fireEvent("setpage",this,a,b,c,this.pageIndex,this.numPages),this.featureStore.load({startIndex:d,callback:function(){b&&b.call(c)}})}else this.hitCountProtocol.read({filter:this.filter,callback:function(d){this.numberOfFeatures=d.numberOfFeatures;this.numPages=Math.ceil(this.numberOfFeatures/this.maxFeatures);this.pageIndex=0;this.fireEvent("setpage",this,a,b,c,this.pageIndex,this.numPages);this.featureStore.load({output:"object",
callback:function(){b&&b.call(c)}})},scope:this})}});gxp.plugins.FeatureManager.QUADTREE_PAGING=0;gxp.plugins.FeatureManager.WFS_PAGING=1;Ext.preg(gxp.plugins.FeatureManager.prototype.ptype,gxp.plugins.FeatureManager);Ext.namespace("gxp.plugins");
gxp.plugins.FeatureToField=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_featuretofield",format:"GeoJSON",addActions:function(){var a=this.target.tools[this.featureManager],b,c=new OpenLayers.Format[this.format];a.featureLayer.events.on({featureselected:function(a){this.target.field.setValue(c.write(a.feature));b=a.feature},featureunselected:function(){this.target.field.setValue("");b=null},scope:this});a.on("layerchange",function(){a.featureStore&&a.featureStore.on("save",function(a,e,f){if(f.create)for(a=
f.create.length-1;0<=a;--a)e=f.create[a].feature,e==b&&this.target.field.setValue(c.write(e))},this)});return gxp.plugins.FeatureToField.superclass.addActions.apply(this,arguments)}});Ext.preg(gxp.plugins.FeatureToField.prototype.ptype,gxp.plugins.FeatureToField);Ext.ns("gxp.plugins");
gxp.plugins.GeoRowEditor=Ext.ux&&Ext.ux.grid&&Ext.ux.grid.RowEditor&&Ext.extend(Ext.ux.grid.RowEditor,{drawControl:null,modifyControl:null,addPointGeometryText:"Add point",addLineGeometryText:"Add line",addPolygonGeometryText:"Add polygon",modifyGeometryText:"Modify geometry",deleteGeometryText:"Delete geometry",deleteGeometryTooltip:"Delete the existing geometry",addGeometryTooltip:"Add a new geometry by clicking in the map",modifyGeometryTooltip:"Modify an existing geometry",beforedestroy:function(){this.geometry=
this.feature=this.modifyControl=this.drawControl=null;gxp.plugins.GeoRowEditor.superclass.beforedestroy.apply(this,arguments)},handleAddGeometry:function(a){this.feature=this.record.get("feature");if(null===this.drawControl)this.drawControl=new OpenLayers.Control.DrawFeature(new OpenLayers.Layer.Vector,a,{eventListeners:{featureadded:function(a){this.drawControl.deactivate();var b=this.feature;b.modified=Ext.apply(b.modified||{},{geometry:null});b.geometry=a.feature.geometry.clone();if(b.state!==
OpenLayers.State.INSERT)b.state=OpenLayers.State.UPDATE;this.record.set("state",b.state)},scope:this}}),this.feature.layer.map.addControl(this.drawControl);else{var b=this.drawControl;b.handler.destroy();b.handler=new a(b,b.callbacks,b.handlerOptions)}this.drawControl.activate()},handleAddPointGeometry:function(){this.handleAddGeometry(OpenLayers.Handler.Point)},handleAddLineGeometry:function(){this.handleAddGeometry(OpenLayers.Handler.Path)},handleAddPolygonGeometry:function(){this.handleAddGeometry(OpenLayers.Handler.Polygon)},
handleDeleteGeometry:function(){this.feature=this.record.get("feature");this.feature.layer.eraseFeatures([this.feature]);this.feature.geometry.destroy();this.feature.geometry=null;this.feature.state=OpenLayers.State.UPDATE;this.btns.items.get(2).show();this.btns.items.get(3).show();this.btns.items.get(4).show();this.btns.items.get(5).hide();this.btns.items.get(6).hide()},handleModifyGeometry:function(){this.feature=this.record.get("feature");if(null===this.modifyControl)this.modifyControl=new OpenLayers.Control.ModifyFeature(this.feature.layer,
{standalone:!0}),this.feature.layer.map.addControl(this.modifyControl);this.modifyControl.activate();this.modifyControl.selectFeature(this.feature)},stopEditing:function(a){this.editing=!1;if(this.isVisible())if(!1===a||!this.isValid())this.hide(),this.fireEvent("canceledit",this,!1===a);else{for(var a={},b=this.record,c=!1,d=this.grid.colModel,e=this.items.items,f=0,g=d.getColumnCount();f<g;f++)if(!d.isHidden(f)){var h=d.getDataIndex(f);if(!Ext.isEmpty(h)){var j=b.data[h],k=this.postEditValue(e[f].getValue(),
j,b,h);""+j!==""+k&&(a[h]=k,c=!0)}}if((c=c||this.feature&&this.feature.state===OpenLayers.State.UPDATE)&&!1!==this.fireEvent("validateedit",this,a,b,this.rowIndex))b.beginEdit(),Ext.iterate(a,function(a,c){b.set(a,c)}),b.endEdit(),this.fireEvent("afteredit",this,a,b,this.rowIndex);this.hide()}},init:function(a){gxp.plugins.GeoRowEditor.superclass.init.apply(this,arguments);this.on("afteredit",function(){this.grid.store.save();null!==this.modifyControl&&this.modifyControl.deactivate();null!==this.drawControl&&
this.drawControl.deactivate()},this);this.on("canceledit",function(){this.grid.store.rejectChanges();if(this.feature)this.feature.geometry&&this.feature.layer.eraseFeatures([this.feature]),this.feature.geometry=this.geometry,this.feature.layer.drawFeature(this.feature);null!==this.modifyControl&&this.modifyControl.deactivate();null!==this.drawControl&&this.drawControl.deactivate()},this);this.on("beforeedit",function(a,c){var d=this.grid;d.getView();d=d.store.getAt(c);this.geometry=d.get("feature").geometry&&
d.get("feature").geometry.clone();this.btns&&(null===d.get("feature").geometry?(this.btns.items.get(6).hide(),this.btns.items.get(5).hide(),this.btns.items.get(2).show(),this.btns.items.get(3).show(),this.btns.items.get(4).show()):(this.btns.items.get(2).hide(),this.btns.items.get(3).hide(),this.btns.items.get(4).hide(),this.btns.items.get(5).show(),this.btns.items.get(6).show()));return!0},this)},onRender:function(){Ext.ux.grid.RowEditor.superclass.onRender.apply(this,arguments);this.el.swallowEvent(["keydown",
"keyup","keypress"]);this.btns=new Ext.Panel({baseCls:"x-plain",cls:"x-btns",elements:"body",layout:"table",width:6*this.minButtonWidth+5*this.frameWidth+10*this.buttonPad,items:[{ref:"saveBtn",itemId:"saveBtn",xtype:"button",text:this.saveText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[!0])},{xtype:"button",text:this.cancelText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[!1])},{xtype:"button",text:this.addPointGeometryText,tooltip:this.addGeometryTooltip,
handler:this.handleAddPointGeometry,scope:this,hidden:null!==this.record.get("feature").geometry,width:1.5*this.minButtonWidth},{xtype:"button",text:this.addLineGeometryText,tooltip:this.addGeometryTooltip,handler:this.handleAddLineGeometry,scope:this,hidden:null!==this.record.get("feature").geometry,width:1.5*this.minButtonWidth},{xtype:"button",text:this.addPolygonGeometryText,tooltip:this.addGeometryTooltip,handler:this.handleAddPolygonGeometry,scope:this,hidden:null!==this.record.get("feature").geometry,
width:1.5*this.minButtonWidth},{xtype:"button",text:this.modifyGeometryText,tooltip:this.modifyGeometryTooltip,handler:this.handleModifyGeometry,scope:this,hidden:null===this.record.get("feature").geometry,width:1.5*this.minButtonWidth},{xtype:"button",text:this.deleteGeometryText,tooltip:this.deleteGeometryTooltip,handler:this.handleDeleteGeometry,scope:this,hidden:null===this.record.get("feature").geometry,width:1.5*this.minButtonWidth}]});this.fireEvent("buttonrender",this,this.btns);this.btns.render(this.bwrap)}});
gxp.plugins.GeoRowEditor&&Ext.preg("gxp_georoweditor",gxp.plugins.GeoRowEditor);Ext.namespace("gxp.plugins");
gxp.plugins.StyleWriter=Ext.extend(Ext.util.Observable,{deletedStyles:null,constructor:function(a){this.initialConfig=a;Ext.apply(this,a);this.deletedStyles=[];gxp.plugins.StyleWriter.superclass.constructor.apply(this,arguments)},init:function(a){this.target=a;a.stylesStore.on({remove:function(a,c){var d=c.get("name");c.get("name")===d&&this.deletedStyles.push(d)},scope:this});a.on({beforesaved:this.write,scope:this})},write:function(a){a.stylesStore.commitChanges();a.fireEvent("saved",a,a.selectedStyle.get("name"))}});
Ext.namespace("gxp.plugins");
gxp.plugins.GeoServerStyleWriter=Ext.extend(gxp.plugins.StyleWriter,{baseUrl:"/geoserver/rest",constructor:function(a){this.initialConfig=a;Ext.apply(this,a);gxp.plugins.GeoServerStyleWriter.superclass.constructor.apply(this,arguments)},write:function(a){delete this._failed;var a=a||{},b=[],c=this.target.stylesStore;c.each(function(a){(a.phantom||-1!==c.modified.indexOf(a))&&this.writeStyle(a,b)},this);var d=function(){var b=this.target;if(!0!==this._failed){this.deleteStyles();for(var c=this.target.stylesStore.getModifiedRecords(),
d=c.length-1;0<=d;--d)c[d].phantom=!1;b.stylesStore.commitChanges();a.success&&a.success.call(a.scope);b.fireEvent("saved",b,b.selectedStyle.get("name"))}else b.fireEvent("savefailed",b,b.selectedStyle.get("name"))};0<b.length?gxp.util.dispatch(b,function(){this.assignStyles(a.defaultStyle,d)},this):this.assignStyles(a.defaultStyle,d)},writeStyle:function(a,b){var c=a.get("userStyle").name;b.push(function(b){Ext.Ajax.request({method:!0===a.phantom?"POST":"PUT",url:this.baseUrl+"/styles"+(!0===a.phantom?
"":"/"+c+".xml"),headers:{"Content-Type":"application/vnd.ogc.sld+xml; charset=UTF-8"},xmlData:this.target.createSLD({userStyles:[c]}),failure:function(){this._failed=!0;b.call(this)},success:!0===a.phantom?function(){Ext.Ajax.request({method:"POST",url:this.baseUrl+"/layers/"+this.target.layerRecord.get("name")+"/styles.json",jsonData:{style:{name:c}},failure:function(){this._failed=!0;b.call(this)},success:b,scope:this})}:b,scope:this})})},assignStyles:function(a,b){var c=[];this.target.stylesStore.each(function(b){!a&&
!0===b.get("userStyle").isDefault&&(a=b.get("name"));b.get("name")!==a&&-1===this.deletedStyles.indexOf(b.id)&&c.push({name:b.get("name")})},this);Ext.Ajax.request({method:"PUT",url:this.baseUrl+"/layers/"+this.target.layerRecord.get("name")+".json",jsonData:{layer:{defaultStyle:{name:a},styles:0<c.length?{style:c}:{},enabled:!0}},success:b,failure:function(){this._failed=!0;b.call(this)},scope:this})},deleteStyles:function(){for(var a=0,b=this.deletedStyles.length;a<b;++a)Ext.Ajax.request({method:"DELETE",
url:this.baseUrl+"/styles/"+this.deletedStyles[a]+"?purge=true"});this.deletedStyles=[]}});Ext.preg("gxp_geoserverstylewriter",gxp.plugins.GeoServerStyleWriter);Ext.namespace("gxp.plugins");
gxp.plugins.GoogleEarth=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_googleearth",timeout:7E3,menuText:"3D Viewer",tooltip:"Switch to 3D Viewer",tooltipMap:"Switch back to normal map view",constructor:function(a){gxp.plugins.GoogleEarth.superclass.constructor.apply(this,arguments)},addActions:function(){return gxp.plugins.GoogleEarth.superclass.addActions.apply(this,[[{menuText:this.menuText,enableToggle:!0,iconCls:"gxp-icon-googleearth",tooltip:this.tooltip,toggleHandler:function(a,b){this.actions[0].each(function(a){a.toggle&&
a.toggle(!1,!0)});this.togglePanelDisplay(b)},scope:this}]])},togglePanelDisplay:function(a){var b=this.target.mapPanel.ownerCt,c=b&&b.getLayout();if(c&&c instanceof Ext.layout.CardLayout)if(!0===a)gxp.plugins.GoogleEarth.loader.onLoad({callback:function(){c.setActiveItem(1);this.actions[0].enable();this.actions[0].items[0].setTooltip(this.tooltipMap);this.actions[0].each(function(a){a.toggle&&a.toggle(!0,!0)})},scope:this});else c.setActiveItem(0),this.actions[0].items[0].setTooltip(this.tooltip)},
getHost:function(){return window.location.host.split(":").shift()+":"+(window.location.port||"80")}});
gxp.plugins.GoogleEarth.loader=new (Ext.extend(Ext.util.Observable,{ready:!(!window.google||!window.google.earth),loading:!1,constructor:function(){this.addEvents("ready","failure");return Ext.util.Observable.prototype.constructor.apply(this,arguments)},onScriptLoad:function(){var a=gxp.plugins.GoogleEarth.loader;if(!a.ready)a.ready=!0,a.loading=!1,a.fireEvent("ready")},onLoad:function(a){if(this.ready)window.setTimeout(function(){a.callback.call(a.scope)},0);else if(this.loading)this.on({ready:a.callback,
failure:a.errback||Ext.emptyFn,scope:a.scope});else this.loadScript(a)},loadScript:function(a){function b(){document.getElementsByTagName("head")[0].appendChild(d)}window.google&&delete google.loader;var c={autoload:Ext.encode({modules:[{name:"earth",version:"1",callback:"gxp.plugins.GoogleEarth.loader.onScriptLoad"}]})},d=document.createElement("script");d.src="//www.google.com/jsapi?"+Ext.urlEncode(c);c=a.timeout||gxp.plugins.GoogleSource.prototype.timeout;window.setTimeout(function(){gxp.plugins.GoogleEarth.loader.ready||
(this.fireEvent("failure"),this.unload())}.createDelegate(this),c);this.on({ready:a.callback,failure:a.errback||Ext.emptyFn,scope:a.scope});this.loading=!0;if(document.body)b();else Ext.onReady(b);this.script=d},unload:function(){this.purgeListeners();this.script&&(document.getElementsByTagName("head")[0].removeChild(this.script),delete this.script);this.ready=this.loading=!1;delete google.loader;delete google.earth}}));Ext.preg(gxp.plugins.GoogleEarth.prototype.ptype,gxp.plugins.GoogleEarth);Ext.namespace("gxp.form");
gxp.form.GoogleGeocoderComboBox=Ext.extend(Ext.form.ComboBox,{xtype:"gxp_googlegeocodercombo",queryDelay:100,valueField:"viewport",displayField:"address",initComponent:function(){this.disabled=!0;if(window.google&&google.maps)window.setTimeout(function(){this.prepGeocoder()}.createDelegate(this),0);else{if(!gxp.plugins||!gxp.plugins.GoogleSource)throw Error("The gxp.form.GoogleGeocoderComboBox requires the gxp.plugins.GoogleSource or the Google Maps V3 API to be loaded.");gxp.plugins.GoogleSource.loader.onLoad({otherParams:gxp.plugins.GoogleSource.prototype.otherParams,
callback:this.prepGeocoder,errback:function(){throw Error("The Google Maps script failed to load within the given timeout.");},scope:this})}this.store=new Ext.data.JsonStore({root:"results",fields:[{name:"address",type:"string"},{name:"location"},{name:"viewport"}],autoLoad:!1});this.on({focus:function(){this.clearValue()},scope:this});return gxp.form.GoogleGeocoderComboBox.superclass.initComponent.apply(this,arguments)},prepGeocoder:function(){var a=new google.maps.Geocoder,b={};b[Ext.data.Api.actions.read]=
!0;var b=new Ext.data.DataProxy({api:b}),c=this,d=function(){var a=this.bounds;a&&(a instanceof OpenLayers.Bounds&&(a=a.toArray()),a=new google.maps.LatLngBounds(new google.maps.LatLng(a[1],a[0]),new google.maps.LatLng(a[3],a[2])));return a}.createDelegate(this);b.doRequest=function(b,f,g,h,j,k,l){a.geocode({address:g.query,bounds:d()},function(a,d){var f;if(d===google.maps.GeocoderStatus.OK||d===google.maps.GeocoderStatus.ZERO_RESULTS)try{a=c.transformResults(a),f=h.readRecords({results:a})}catch(g){c.fireEvent("exception",
c,"response",b,l,d,g)}else c.fireEvent("exception",c,"remote",b,l,d,null);f?j.call(k,f,l,!0):j.call(k,null,l,!1)})};this.store.proxy=b;!0!=this.initialConfig.disabled&&this.enable()},transformResults:function(a){var b=a.length,c=Array(b),d,e,f,g;for(i=0;i<b;++i)d=a[i],e=d.geometry.location,f=d.geometry.viewport,g=f.getNorthEast(),f=f.getSouthWest(),c[i]={address:d.formatted_address,location:new OpenLayers.LonLat(e.lng(),e.lat()),viewport:new OpenLayers.Bounds(f.lng(),f.lat(),g.lng(),g.lat())};return c}});
Ext.reg(gxp.form.GoogleGeocoderComboBox.prototype.xtype,gxp.form.GoogleGeocoderComboBox);Ext.namespace("gxp.plugins");
gxp.plugins.GoogleGeocoder=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_googlegeocoder",updateField:"viewport",init:function(a){var b=new gxp.form.GoogleGeocoderComboBox(Ext.apply({listeners:{select:this.onComboSelect,scope:this}},this.outputConfig)),c=a.mapPanel.map.restrictedExtent;if(c&&!b.bounds)a.on({ready:function(){b.bounds=c.clone().transform(a.mapPanel.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326"))}});this.combo=b;return gxp.plugins.GoogleGeocoder.superclass.init.apply(this,
arguments)},addOutput:function(){return gxp.plugins.GoogleGeocoder.superclass.addOutput.call(this,this.combo)},onComboSelect:function(a,b){if(this.updateField){var c=this.target.mapPanel.map,d=b.get(this.updateField).clone().transform(new OpenLayers.Projection("EPSG:4326"),c.getProjectionObject());d instanceof OpenLayers.Bounds?c.zoomToExtent(d,!0):c.setCenter(d)}}});Ext.preg(gxp.plugins.GoogleGeocoder.prototype.ptype,gxp.plugins.GoogleGeocoder);Ext.namespace("gxp.plugins");
gxp.plugins.GoogleSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_googlesource",timeout:7E3,title:"Google Layers",roadmapAbstract:"Show street map",satelliteAbstract:"Show satellite imagery",hybridAbstract:"Show imagery with street names",terrainAbstract:"Show street map with terrain",otherParams:"sensor=false",constructor:function(a){this.config=a;gxp.plugins.GoogleSource.superclass.constructor.apply(this,arguments)},createStore:function(){gxp.plugins.GoogleSource.loader.onLoad({otherParams:this.otherParams,
timeout:this.timeout,callback:this.syncCreateStore,errback:function(){delete this.store;this.fireEvent("failure",this,"The Google Maps script failed to load within the provided timeout ("+this.timeout/1E3+" s).")},scope:this})},syncCreateStore:function(){var a={ROADMAP:{"abstract":this.roadmapAbstract,MAX_ZOOM_LEVEL:20},SATELLITE:{"abstract":this.satelliteAbstract},HYBRID:{"abstract":this.hybridAbstract},TERRAIN:{"abstract":this.terrainAbstract,MAX_ZOOM_LEVEL:15}},b=[],c,d;for(c in a)d=google.maps.MapTypeId[c],
b.push(new OpenLayers.Layer.Google("Google "+d.replace(/\w/,function(a){return a.toUpperCase()}),{type:d,typeName:c,MAX_ZOOM_LEVEL:a[c].MAX_ZOOM_LEVEL,maxExtent:new OpenLayers.Bounds(-2.003750834E7,-2.003750834E7,2.003750834E7,2.003750834E7),restrictedExtent:new OpenLayers.Bounds(-2.003750834E7,-2.003750834E7,2.003750834E7,2.003750834E7),projection:this.projection}));this.store=new GeoExt.data.LayerStore({layers:b,fields:[{name:"source",type:"string"},{name:"name",type:"string",mapping:"typeName"},
{name:"abstract",type:"string"},{name:"group",type:"string",defaultValue:"background"},{name:"fixed",type:"boolean",defaultValue:!0},{name:"selected",type:"boolean"}]});this.store.each(function(b){b.set("abstract",a[b.get("name")]["abstract"])});this.fireEvent("ready",this)},createLayerRecord:function(a){var b,c=function(b){return b.get("name")===a.name};if(-1==this.target.mapPanel.layers.findBy(c)){b=this.store.getAt(this.store.findBy(c)).clone();c=b.getLayer();a.title&&(c.setName(a.title),b.set("title",
a.title));if("visibility"in a)c.visibility=a.visibility;b.set("selected",a.selected||!1);b.set("source",a.source);b.set("name",a.name);"group"in a&&b.set("group",a.group);b.commit()}return b}});
gxp.plugins.GoogleSource.loader=new (Ext.extend(Ext.util.Observable,{ready:!(!window.google||!google.maps),loading:!1,constructor:function(){this.addEvents("ready","failure");return Ext.util.Observable.prototype.constructor.apply(this,arguments)},onScriptLoad:function(){var a=gxp.plugins.GoogleSource.loader;if(!a.ready)a.ready=!0,a.loading=!1,a.fireEvent("ready")},onLoad:function(a){if(this.ready)window.setTimeout(function(){a.callback.call(a.scope)},0);else if(this.loading)this.on({ready:a.callback,
failure:a.errback||Ext.emptyFn,scope:a.scope});else this.loadScript(a)},loadScript:function(a){function b(){document.getElementsByTagName("head")[0].appendChild(d)}var c={autoload:Ext.encode({modules:[{name:"maps",version:3.3,nocss:"true",callback:"gxp.plugins.GoogleSource.loader.onScriptLoad",other_params:a.otherParams}]})},d=document.createElement("script");d.src="http://www.google.com/jsapi?"+Ext.urlEncode(c);var e=a.errback||Ext.emptyFn,c=a.timeout||gxp.plugins.GoogleSource.prototype.timeout;
window.setTimeout(function(){if(!gxp.plugins.GoogleSource.loader.ready)this.ready=this.loading=!1,document.getElementsByTagName("head")[0].removeChild(d),e.call(a.scope),this.fireEvent("failure"),this.purgeListeners()}.createDelegate(this),c);this.on({ready:a.callback,scope:a.scope});this.loading=!0;if(document.body)b();else Ext.onReady(b)}}));Ext.preg(gxp.plugins.GoogleSource.prototype.ptype,gxp.plugins.GoogleSource);Ext.namespace("gxp.plugins");
gxp.plugins.LayerTree=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_layertree",shortTitle:"Layers",rootNodeText:"Layers",overlayNodeText:"Overlays",baseNodeText:"Base Layers",groups:null,defaultGroup:"default",treeNodeUI:null,constructor:function(a){gxp.plugins.LayerTree.superclass.constructor.apply(this,arguments);if(!this.groups)this.groups={"default":this.overlayNodeText,background:{title:this.baseNodeText,exclusive:!0}};if(!this.treeNodeUI)this.treeNodeUI=Ext.extend(GeoExt.tree.LayerNodeUI,new GeoExt.tree.TreeNodeUIEventMixin)},
addOutput:function(a){a=Ext.apply(this.createOutputConfig(),a||{});a=gxp.plugins.LayerTree.superclass.addOutput.call(this,a);a.on({contextmenu:this.handleTreeContextMenu,beforemovenode:this.handleBeforeMoveNode,scope:this});return a},createOutputConfig:function(){var a=new Ext.tree.TreeNode({text:this.rootNodeText,expanded:!0,isTarget:!1,allowDrop:!1}),b;if(this.initialConfig.loader&&this.initialConfig.loader.baseAttrs)b=this.initialConfig.loader.baseAttrs;var c=this.defaultGroup,d=this,e,f,g;for(g in this.groups)e=
"string"==typeof this.groups[g]?{title:this.groups[g]}:this.groups[g],f=e.exclusive,a.appendChild(new GeoExt.tree.LayerContainer(Ext.apply({text:e.title,iconCls:"gxp-folder",expanded:!0,group:g==this.defaultGroup?void 0:g,loader:new GeoExt.tree.LayerLoader({baseAttrs:f?Ext.apply({checkedGroup:Ext.isString(f)?f:g},b):b,store:this.target.mapPanel.layers,filter:function(a){return function(b){return(b.get("group")||c)==a&&!0==b.getLayer().displayInLayerSwitcher}}(g),createNode:function(a){d.configureLayerNode(this,
a);return GeoExt.tree.LayerLoader.prototype.createNode.apply(this,arguments)}}),singleClickExpand:!0,allowDrag:!1,listeners:{append:function(a,b){b.expand()}}},e)));return{xtype:"treepanel",root:a,rootVisible:!1,shortTitle:this.shortTitle,border:!1,enableDD:!0,selModel:new Ext.tree.DefaultSelectionModel({listeners:{beforeselect:this.handleBeforeSelect,scope:this}}),contextMenu:new Ext.menu.Menu({items:[]})}},configureLayerNode:function(a,b){b.uiProvider=this.treeNodeUI;var c=b.layer,d=b.layerStore;
if(c&&d){var e=d.getAt(d.findBy(function(a){return a.getLayer()===c}));if(e){b.qtip=e.get("abstract");if(!e.get("queryable")&&!b.iconCls)b.iconCls="gxp-tree-rasterlayer-icon";if(e.get("fixed"))b.allowDrag=!1;b.listeners={rendernode:function(a){e===this.target.selectedLayer&&a.select();this.target.on("layerselectionchange",function(b){!this.selectionChanging&&b===e&&a.select()},this)},scope:this}}}},handleBeforeSelect:function(a,b){var c=!0,d=b&&b.layer,e;if(d)c=b.layerStore,e=c.getAt(c.findBy(function(a){return a.getLayer()===
d}));this.selectionChanging=!0;c=this.target.selectLayer(e);this.selectionChanging=!1;return c},handleTreeContextMenu:function(a,b){if(a&&a.layer){a.select();var c=a.getOwnerTree();if(c.getSelectionModel().getSelectedNode()===a)c=c.contextMenu,c.contextNode=a,0<c.items.getCount()&&c.showAt(b.getXY())}},handleBeforeMoveNode:function(a,b,c,d){if(c!==d)a=d.loader.store,c=a.findBy(function(a){return a.getLayer()===b.layer}),a.getAt(c).set("group",d.attributes.group)}});
Ext.preg(gxp.plugins.LayerTree.prototype.ptype,gxp.plugins.LayerTree);Ext.namespace("gxp.plugins");
gxp.plugins.LayerManager=Ext.extend(gxp.plugins.LayerTree,{ptype:"gxp_layermanager",baseNodeText:"Base Maps",createOutputConfig:function(){var a=gxp.plugins.LayerManager.superclass.createOutputConfig.apply(this,arguments);Ext.applyIf(a,Ext.apply({cls:"gxp-layermanager-tree",lines:!1,useArrows:!0,plugins:[{ptype:"gx_treenodecomponent"}]},this.treeConfig));return a},configureLayerNode:function(a,b){gxp.plugins.LayerManager.superclass.configureLayerNode.apply(this,arguments);var c;OpenLayers.Layer.WMS&&
b.layer instanceof OpenLayers.Layer.WMS?c="gx_wmslegend":OpenLayers.Layer.Vector&&b.layer instanceof OpenLayers.Layer.Vector&&(c="gx_vectorlegend");if(c){var d;if(a&&a.baseAttrs&&a.baseAttrs.baseParams)d=a.baseAttrs.baseParams;Ext.apply(b,{component:{xtype:c,hidden:!b.layer.getVisibility(),baseParams:Ext.apply({transparent:!0,format:"image/png",legend_options:"fontAntiAliasing:true;fontSize:11;fontName:Arial"},d),layerRecord:this.target.mapPanel.layers.getByLayer(b.layer),showTitle:!1,cls:"legend"}})}}});
Ext.preg(gxp.plugins.LayerManager.prototype.ptype,gxp.plugins.LayerManager);Ext.namespace("gxp.plugins");
gxp.plugins.LayerProperties=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_layerproperties",menuText:"Layer Properties",toolTip:"Layer Properties",constructor:function(a){gxp.plugins.LayerProperties.superclass.constructor.apply(this,arguments);if(!this.outputConfig)this.outputConfig={width:325,autoHeight:!0}},addActions:function(){var a=gxp.plugins.LayerProperties.superclass.addActions.apply(this,[{menuText:this.menuText,iconCls:"gxp-icon-layerproperties",disabled:!0,tooltip:this.toolTip,handler:function(){this.removeOutput();
this.addOutput()},scope:this}]),b=a[0];this.target.on("layerselectionchange",function(a){b.setDisabled(!a||!a.get("properties"))},this);return a},addOutput:function(a){var a=a||{},b=this.target.selectedLayer;this.outputConfig.title=(this.initialConfig.outputConfig||{}).title||this.menuText+": "+b.get("title");this.outputConfig.shortTitle=b.get("title");var c=b.get("properties")||"gxp_layerpanel",d=this.layerPanelConfig;d&&d[c]&&Ext.apply(a,d[c]);a=gxp.plugins.LayerProperties.superclass.addOutput.call(this,
Ext.apply({xtype:c,authorized:this.target.isAuthorized(),layerRecord:b,source:this.target.getSource(b),defaults:{style:"padding: 10px",autoHeight:this.outputConfig.autoHeight}},a));a.on({added:function(a){if(!this.outputTarget)a.on("afterrender",function(){a.ownerCt.ownerCt.center()},this,{single:!0})},scope:this});return a}});Ext.preg(gxp.plugins.LayerProperties.prototype.ptype,gxp.plugins.LayerProperties);Ext.namespace("gxp.plugins");
gxp.plugins.Legend=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_legend",menuText:"Legend",tooltip:"Show Legend",actionTarget:null,constructor:function(a){gxp.plugins.Legend.superclass.constructor.apply(this,arguments);if(!this.outputConfig)this.outputConfig={width:300,height:400};Ext.applyIf(this.outputConfig,{title:this.menuText})},addActions:function(){return gxp.plugins.Legend.superclass.addActions.apply(this,[[{menuText:this.menuText,iconCls:"gxp-icon-legend",tooltip:this.tooltip,handler:function(){this.removeOutput();
this.addOutput(this.outputConfig)},scope:this}]])},getLegendPanel:function(){return this.output[0]},addOutput:function(a){return gxp.plugins.Legend.superclass.addOutput.call(this,Ext.apply({xtype:"gx_legendpanel",ascending:!1,border:!1,hideMode:"offsets",layerStore:this.target.mapPanel.layers,defaults:{cls:"gxp-legend-item"}},a))}});Ext.preg(gxp.plugins.Legend.prototype.ptype,gxp.plugins.Legend);Ext.namespace("gxp.plugins");
gxp.plugins.LoadingIndicator=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_loadingindicator",onlyShowOnFirstLoad:!1,loadingMapMessage:"Loading Map...",layerCount:0,busyMask:null,init:function(a){var b=a instanceof GeoExt.MapPanel?a.map:a.mapPanel.map;b.events.register("preaddlayer",this,function(a){var d=a.layer;if(d instanceof OpenLayers.Layer.WMS)d.events.on({loadstart:function(){this.layerCount++;if(!this.busyMask)this.busyMask=new Ext.LoadMask(b.div,{msg:this.loadingMapMessage});this.busyMask.show();
!0===this.onlyShowOnFirstLoad&&d.events.unregister("loadstart",this,arguments.callee)},loadend:function(){this.layerCount--;0===this.layerCount&&this.busyMask.hide();!0===this.onlyShowOnFirstLoad&&d.events.unregister("loadend",this,arguments.callee)},scope:this})})},destroy:function(){Ext.destroy(this.busyMask);this.busyMask=null;gxp.plugins.LoadingIndicator.superclass.destroy.apply(this,arguments)}});Ext.preg(gxp.plugins.LoadingIndicator.prototype.ptype,gxp.plugins.LoadingIndicator);Ext.namespace("gxp.plugins");
gxp.plugins.MapBoxSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_mapboxsource",title:"MapBox Layers",blueMarbleTopoBathyJanTitle:"Blue Marble Topography & Bathymetry (January)",blueMarbleTopoBathyJulTitle:"Blue Marble Topography & Bathymetry (July)",blueMarbleTopoJanTitle:"Blue Marble Topography (January)",blueMarbleTopoJulTitle:"Blue Marble Topography (July)",controlRoomTitle:"Control Room",geographyClassTitle:"Geography Class",naturalEarthHypsoTitle:"Natural Earth Hypsometric",naturalEarthHypsoBathyTitle:"Natural Earth Hypsometric & Bathymetry",
naturalEarth1Title:"Natural Earth I",naturalEarth2Title:"Natural Earth II",worldDarkTitle:"World Dark",worldLightTitle:"World Light",worldGlassTitle:"World Glass",worldPrintTitle:"World Print",createStore:function(){for(var a={projection:"EPSG:900913",numZoomLevels:19,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,
38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,0.5971642833948135],buffer:1},b=[{name:"blue-marble-topo-bathy-jan",numZoomLevels:9},{name:"blue-marble-topo-bathy-jul",numZoomLevels:9},{name:"blue-marble-topo-jan",numZoomLevels:9},{name:"blue-marble-topo-jul",numZoomLevels:9},{name:"control-room",numZoomLevels:9},{name:"geography-class",numZoomLevels:9},{name:"natural-earth-hypso",numZoomLevels:7},{name:"natural-earth-hypso-bathy",numZoomLevels:7},
{name:"natural-earth-1",numZoomLevels:7},{name:"natural-earth-2",numZoomLevels:7},{name:"world-dark",numZoomLevels:12},{name:"world-light",numZoomLevels:12},{name:"world-glass",numZoomLevels:11},{name:"world-print",numZoomLevels:10}],c=b.length,d=Array(c),e,f=0;f<c;++f)e=b[f],d[f]=new OpenLayers.Layer.TMS(this[OpenLayers.String.camelize(e.name)+"Title"],["http://a.tiles.mapbox.com/mapbox/","http://b.tiles.mapbox.com/mapbox/","http://c.tiles.mapbox.com/mapbox/","http://d.tiles.mapbox.com/mapbox/"],
OpenLayers.Util.applyDefaults({attribution:/^world/.test(name)?"<a href='http://mapbox.com'>MapBox</a> | Some Data &copy; OSM CC-BY-SA | <a href='http://mapbox.com/tos'>Terms of Service</a>":"<a href='http://mapbox.com'>MapBox</a> | <a href='http://mapbox.com/tos'>Terms of Service</a>",type:"png",tileOrigin:new OpenLayers.LonLat(-2.003750834E7,-2.003750834E7),layername:e.name,"abstract":'<div class="thumb-mapbox thumb-mapbox-'+e.name+'"></div>',numZoomLevels:e.numZoomLevels},a));this.store=new GeoExt.data.LayerStore({layers:d,
fields:[{name:"source",type:"string"},{name:"name",type:"string",mapping:"layername"},{name:"abstract",type:"string"},{name:"group",type:"string"},{name:"fixed",type:"boolean"},{name:"selected",type:"boolean"}]});this.fireEvent("ready",this)},createLayerRecord:function(a){var b,c=this.store.findExact("name",a.name);if(-1<c){b=this.store.getAt(c).copy(Ext.data.Record.id({}));c=b.getLayer().clone();a.title&&(c.setName(a.title),b.set("title",a.title));if("visibility"in a)c.visibility=a.visibility;b.set("selected",
a.selected||!1);b.set("source",a.source);b.set("name",a.name);"group"in a&&b.set("group",a.group);b.data.layer=c;b.commit()}return b}});Ext.preg(gxp.plugins.MapBoxSource.prototype.ptype,gxp.plugins.MapBoxSource);Ext.namespace("gxp.plugins");
gxp.plugins.MapProperties=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_mapproperties",colorManager:null,menuText:"Map Properties",toolTip:"Map Properties",wrapDateLineText:"Wrap dateline",numberOfZoomLevelsText:"Number of zoom levels",colorText:"Background color",addActions:function(){var a=this.target.mapPanel.map.baseLayer,b=Ext.get(this.target.mapPanel.map.getViewport());this.initialConfig.backgroundColor&&b.setStyle("background-color",this.initialConfig.backgroundColor);this.initialConfig.numZoomLevels&&
(a.addOptions({numZoomLevels:this.initialConfig.numZoomLevels}),this.target.mapPanel.map.events.triggerEvent("changebaselayer",{layer:a}));if(this.initialConfig.wrapDateLine)a.wrapDateLine=this.initialConfig.wrapDateLine;return gxp.plugins.MapProperties.superclass.addActions.apply(this,[{menuText:this.menuText,iconCls:"gxp-icon-mapproperties",tooltip:this.toolTip,handler:function(){this.removeOutput();this.addOutput()},scope:this}])},addOutput:function(){var a;this.colorManager&&(a=[new this.colorManager]);
var b=this.target.mapPanel.map.baseLayer,c=Ext.get(this.target.mapPanel.map.getViewport());return gxp.plugins.MapProperties.superclass.addOutput.call(this,{xtype:"form",border:!1,bodyStyle:"padding: 10px",items:[{xtype:"numberfield",allowNegative:!1,allowDecimals:!1,fieldLabel:this.numberOfZoomLevelsText,minValue:1,value:b.numZoomLevels,listeners:{change:function(a,c){b.addOptions({numZoomLevels:c});this.target.mapPanel.map.events.triggerEvent("changebaselayer",{layer:b})},scope:this}},{xtype:"checkbox",
fieldLabel:this.wrapDateLineText,checked:b.wrapDateLine,listeners:{check:function(a,c){b.wrapDateLine=c},scope:this}},{xtype:"gxp_colorfield",fieldLabel:this.colorText,value:c.getColor("background-color"),plugins:a,listeners:{valid:function(a){c.setStyle("background-color",a.getValue())},scope:this}}]})},getState:function(){var a=this.target.mapPanel.map.baseLayer;return{ptype:this.ptype,backgroundColor:Ext.get(this.target.mapPanel.map.getViewport()).getColor("background-color"),numZoomLevels:a.numZoomLevels,
wrapDateLine:a.wrapDateLine}}});Ext.preg(gxp.plugins.MapProperties.prototype.ptype,gxp.plugins.MapProperties);Ext.namespace("gxp.plugins");
gxp.plugins.MapQuestSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_mapquestsource",title:"MapQuest Layers",osmAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",osmTitle:"MapQuest OpenStreetMap",naipAttribution:"Tiles Courtesy of <a href='http://open.mapquest.co.uk/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png' border='0'>",naipTitle:"MapQuest Imagery",
createStore:function(){var a={projection:"EPSG:900913",maxExtent:new OpenLayers.Bounds(-2.00375083392E7,-2.00375083392E7,2.00375083392E7,2.00375083392E7),maxResolution:156543.03390625,numZoomLevels:19,units:"m",buffer:1,transitionEffect:"resize",tileOptions:{crossOriginKeyword:null}},a=[new OpenLayers.Layer.OSM(this.osmTitle,["http://otile1.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png","http://otile2.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png","http://otile3.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png",
"http://otile4.mqcdn.com/tiles/1.0.0/map/${z}/${x}/${y}.png"],OpenLayers.Util.applyDefaults({attribution:this.osmAttribution,type:"osm"},a)),new OpenLayers.Layer.OSM(this.naipTitle,["http://otile1.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.png","http://otile2.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.png","http://otile3.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.png","http://otile4.mqcdn.com/tiles/1.0.0/sat/${z}/${x}/${y}.png"],OpenLayers.Util.applyDefaults({attribution:this.naipAttribution,type:"naip"},
a))];this.store=new GeoExt.data.LayerStore({layers:a,fields:[{name:"source",type:"string"},{name:"name",type:"string",mapping:"type"},{name:"abstract",type:"string",mapping:"attribution"},{name:"group",type:"string",defaultValue:"background"},{name:"fixed",type:"boolean",defaultValue:!0},{name:"selected",type:"boolean"}]});this.store.each(function(a){a.set("group","background")});this.fireEvent("ready",this)},createLayerRecord:function(a){var b,c=this.store.findExact("name",a.name);if(-1<c){b=this.store.getAt(c).copy(Ext.data.Record.id({}));
c=b.getLayer().clone();a.title&&(c.setName(a.title),b.set("title",a.title));if("visibility"in a)c.visibility=a.visibility;b.set("selected",a.selected||!1);b.set("source",a.source);b.set("name",a.name);"group"in a&&b.set("group",a.group);b.data.layer=c;b.commit()}return b}});Ext.preg(gxp.plugins.MapQuestSource.prototype.ptype,gxp.plugins.MapQuestSource);Ext.namespace("gxp.plugins");
gxp.plugins.Measure=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_measure",outputTarget:"map",buttonText:"Measure",lengthMenuText:"Length",areaMenuText:"Area",lengthTooltip:"Measure length",areaTooltip:"Measure area",measureTooltip:"Measure",constructor:function(a){gxp.plugins.Measure.superclass.constructor.apply(this,arguments)},destroy:function(){this.button=null;gxp.plugins.Measure.superclass.destroy.apply(this,arguments)},createMeasureControl:function(a,b){var c=new OpenLayers.StyleMap({"default":new OpenLayers.Style(null,
{rules:[new OpenLayers.Rule({symbolizer:{Point:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#666666",strokeDashstyle:"dash"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#666666",fillColor:"white",fillOpacity:0.3}}})]})}),d=function(){f&&f.destroy()},e=function(a){var b=a.measure,c=a.units;h.displaySystem="english";var d=-1<a.geometry.CLASS_NAME.indexOf("LineString")?
h.getBestLength(a.geometry):h.getBestArea(a.geometry),e=d[0],d=d[1];h.displaySystem="metric";a=2==a.order?"<sup>2</sup>":"";return b.toFixed(2)+" "+c+a+"<br>"+e.toFixed(2)+" "+d+a},f,g=Ext.apply({},this.initialConfig.controlOptions);Ext.applyIf(g,{geodesic:!0,persist:!0,handlerOptions:{layerOptions:{styleMap:c}},eventListeners:{measurepartial:function(a){d();f=this.addOutput({xtype:"tooltip",html:e(a),title:b,autoHide:!1,closable:!0,draggable:!1,mouseOffset:[0,0],showDelay:1,listeners:{hide:d}});
if(0<a.measure){var a=h.handler.lastUp,c=this.target.mapPanel.getPosition();f.targetXY=[c[0]+a.x,c[1]+a.y];f.show()}},deactivate:d,scope:this}});var h=new OpenLayers.Control.Measure(a,g);return h},addActions:function(){this.activeIndex=0;this.button=new Ext.SplitButton({iconCls:"gxp-icon-measure-length",tooltip:this.measureTooltip,buttonText:this.buttonText,enableToggle:!0,toggleGroup:this.toggleGroup,allowDepress:!0,handler:function(a){a.pressed&&a.menu.items.itemAt(this.activeIndex).setChecked(!0)},
scope:this,listeners:{toggle:function(a,b){b||a.menu.items.each(function(a){a.setChecked(!1)})},render:function(a){Ext.ButtonToggleMgr.register(a)}},menu:new Ext.menu.Menu({items:[new Ext.menu.CheckItem(new GeoExt.Action({text:this.lengthMenuText,iconCls:"gxp-icon-measure-length",toggleGroup:this.toggleGroup,group:this.toggleGroup,listeners:{checkchange:function(a,b){this.activeIndex=0;this.button.toggle(b);b&&this.button.setIconClass(a.iconCls)},scope:this},map:this.target.mapPanel.map,control:this.createMeasureControl(OpenLayers.Handler.Path,
this.lengthTooltip)})),new Ext.menu.CheckItem(new GeoExt.Action({text:this.areaMenuText,iconCls:"gxp-icon-measure-area",toggleGroup:this.toggleGroup,group:this.toggleGroup,allowDepress:!1,listeners:{checkchange:function(a,b){this.activeIndex=1;this.button.toggle(b);b&&this.button.setIconClass(a.iconCls)},scope:this},map:this.target.mapPanel.map,control:this.createMeasureControl(OpenLayers.Handler.Polygon,this.areaTooltip)}))]})});return gxp.plugins.Measure.superclass.addActions.apply(this,[this.button])}});
Ext.preg(gxp.plugins.Measure.prototype.ptype,gxp.plugins.Measure);Ext.namespace("gxp.plugins");
gxp.plugins.Navigation=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_navigation",menuText:"Pan Map",tooltip:"Pan Map",constructor:function(a){gxp.plugins.Navigation.superclass.constructor.apply(this,arguments)},addActions:function(){var a;this.controlOptions?(this.controlOptions=this.controlOptions||{},Ext.applyIf(this.controlOptions,{dragPanOptions:{enableKinetic:!0}}),a=new OpenLayers.Control.Navigation(this.controlOptions)):(candidates=this.target.mapPanel.map.getControlsByClass("OpenLayers.Control.Navigation"),
candidates.length&&(a=candidates[0]));a=[new GeoExt.Action({tooltip:this.tooltip,menuText:this.menuText,iconCls:"gxp-icon-pan",enableToggle:!0,pressed:!0,allowDepress:!1,control:a,map:a.map?null:this.target.mapPanel.map,toggleGroup:this.toggleGroup})];return gxp.plugins.Navigation.superclass.addActions.apply(this,[a])}});Ext.preg(gxp.plugins.Navigation.prototype.ptype,gxp.plugins.Navigation);Ext.namespace("gxp.plugins");
gxp.plugins.NavigationHistory=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_navigationhistory",previousMenuText:"Zoom To Previous Extent",nextMenuText:"Zoom To Next Extent",previousTooltip:"Zoom To Previous Extent",nextTooltip:"Zoom To Next Extent",constructor:function(a){gxp.plugins.NavigationHistory.superclass.constructor.apply(this,arguments)},addActions:function(){var a=new OpenLayers.Control.NavigationHistory;this.target.mapPanel.map.addControl(a);a=[new GeoExt.Action({menuText:this.previousMenuText,
iconCls:"gxp-icon-zoom-previous",tooltip:this.previousTooltip,disabled:!0,control:a.previous}),new GeoExt.Action({menuText:this.nextMenuText,iconCls:"gxp-icon-zoom-next",tooltip:this.nextTooltip,disabled:!0,control:a.next})];return gxp.plugins.NavigationHistory.superclass.addActions.apply(this,[a])}});Ext.preg(gxp.plugins.NavigationHistory.prototype.ptype,gxp.plugins.NavigationHistory);Ext.namespace("gxp.plugins");
gxp.plugins.OLSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_olsource",createLayerRecord:function(a){var b,c=window;b=a.type.split(".");for(var d=0,e=b.length;d<e&&!(c=c[b[d]],!c);++d);if(c&&c.prototype&&c.prototype.initialize){b=function(){c.prototype.initialize.apply(this,a.args)};b.prototype=c.prototype;b=new b;if("visibility"in a)b.visibility=a.visibility;b=new (GeoExt.data.LayerRecord.create([{name:"name",type:"string"},{name:"source",type:"string"},{name:"group",type:"string"},{name:"fixed",
type:"boolean"},{name:"selected",type:"boolean"},{name:"type",type:"string"},{name:"args"}]))({layer:b,title:b.name,name:a.name||b.name,source:a.source,group:a.group,fixed:"fixed"in a?a.fixed:!1,selected:"selected"in a?a.selected:!1,type:a.type,args:a.args,properties:"properties"in a?a.properties:void 0},b.id)}else throw Error("Cannot construct OpenLayers layer from given type: "+a.type);return b},getConfigForRecord:function(a){var b=gxp.plugins.OLSource.superclass.getConfigForRecord.apply(this,arguments);
a.getLayer();return Ext.apply(b,{type:a.get("type"),args:a.get("args")})}});Ext.preg(gxp.plugins.OLSource.prototype.ptype,gxp.plugins.OLSource);Ext.namespace("gxp.plugins");
gxp.plugins.OpacitySlider=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_opacityslider",menuText:"Change Opacity",toolTip:"Change Layer Opacity",constructor:function(a){gxp.plugins.OpacitySlider.superclass.constructor.apply(this,arguments);if(!this.outputConfig)this.outputConfig={width:325,autoHeight:!0}},addActions:function(){var a=gxp.plugins.OpacitySlider.superclass.addActions.apply(this,[{menuText:this.menuText,iconCls:"gxp-icon-opacity",disabled:!0,tooltip:this.toolTip,handler:function(){this.removeOutput();
this.addOutput()},scope:this}]),b=a[0];this.target.on("layerselectionchange",function(){b.setDisabled(!1)},this);return a},addOutput:function(){var a=this.target.selectedLayer;this.outputConfig.title=(this.initialConfig.outputConfig||{}).title;var a=a.data.layer,b=Ext.getCmp("WinOpacity-"+a.id),c=[120,80];b?b.isVisible()?b.hide():(b.setPosition(c[0],c[1]),b.show(),b.focus()):(b=new Ext.Window({title:__("Opacity"),id:"WinOpacity-"+a.id,x:c[0],y:c[1],width:200,resizable:!1,constrain:!0,bodyStyle:"padding:2px 4px",
closeAction:"hide",listeners:{hide:function(){b.x=c[0];b.y=c[1]},show:function(){b.show();b.focus()}},items:[{xtype:"label",text:a.name,height:20},{xtype:"gx_opacityslider",showTitle:!1,plugins:new GeoExt.LayerOpacitySliderTip,vertical:!1,inverse:!1,aggressive:!1,layer:a}]}),b.show())}});Ext.preg(gxp.plugins.OpacitySlider.prototype.ptype,gxp.plugins.OpacitySlider);Ext.namespace("gxp.plugins");
gxp.plugins.OSMSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_osmsource",title:"OpenStreetMap Layers",mapnikAttribution:"&copy; <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a> contributors",osmarenderAttribution:"Data CC-By-SA by <a href='http://openstreetmap.org/' target='_blank'>OpenStreetMap</a>",createStore:function(){var a={projection:"EPSG:900913",maxExtent:new OpenLayers.Bounds(-2.00375083392E7,-2.00375083392E7,2.00375083392E7,2.00375083392E7),maxResolution:156543.03390625,
numZoomLevels:19,units:"m",buffer:1,transitionEffect:"resize"},a=[new OpenLayers.Layer.OSM("OpenStreetMap",["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],OpenLayers.Util.applyDefaults({attribution:this.mapnikAttribution,type:"mapnik"},a))];this.store=new GeoExt.data.LayerStore({layers:a,fields:[{name:"source",type:"string"},{name:"name",type:"string",mapping:"type"},{name:"abstract",type:"string",
mapping:"attribution"},{name:"group",type:"string",defaultValue:"background"},{name:"fixed",type:"boolean",defaultValue:!0},{name:"selected",type:"boolean"}]});this.store.each(function(a){a.set("group","background")});this.fireEvent("ready",this)},createLayerRecord:function(a){var b,c=this.store.findExact("name",a.name);if(-1<c){b=this.store.getAt(c).copy(Ext.data.Record.id({}));c=b.getLayer().clone();a.title&&(c.setName(a.title),b.set("title",a.title));if("visibility"in a)c.visibility=a.visibility;
b.set("selected",a.selected||!1);b.set("source",a.source);b.set("name",a.name);"group"in a&&b.set("group",a.group);b.data.layer=c;b.commit()}return b}});Ext.preg(gxp.plugins.OSMSource.prototype.ptype,gxp.plugins.OSMSource);Ext.ns("gxp.slider");
gxp.slider.TimeSlider=Ext.extend(Ext.slider.MultiSlider,{ref:"slider",cls:"gx_timeslider",indexMap:null,width:200,animate:!1,timeFormat:"l, F d, Y g:i:s A",timeManager:null,playbackMode:"track",autoPlay:!1,aggressive:!1,changeBuffer:10,map:null,initComponent:function(){if(!this.timeManager)this.timeManager=new OpenLayers.Control.DimensionManager,this.map.addControl(this.timeManager);if(!this.model)this.model=this.timeManager.model;if(this.timeManager.agents){if(!this.timeManager.timeUnits&&!this.timeManager.snapToList){if(this.model.values&&
!this.model.resolution&&!1!==this.timeManager.snapToList)this.timeManager.snapToList=!0;if(this.model.resolution&&!this.model.values&&this.model.timeUnits)this.timeManager.timeUnits=this.model.timeUnits,this.timeManager.timeStep=this.model.timeStep}this.playbackMode&&"track"!=this.playbackMode&&this.timeManager.timeUnits&&this.timeManager.incrementTimeValue(this.timeManager.rangeInterval)}var a=this.buildSliderValues();if(a){!this.timeManager.snapToList&&!this.timeManager.timeUnits&&this.timeManager.guessPlaybackRate();
var b={maxValue:a.maxValue,minValue:a.minValue,increment:a.interval,keyIncrement:a.interval,indexMap:a.map,values:a.values};if(!this.initialConfig.timeFormat)if(a.interval)this.setTimeFormat(gxp.PlaybackToolbar.guessTimeFormat(a.interval*OpenLayers.TimeStep[this.timeManager.timeUnits]));else if(this.model.values){for(var a="Seconds,Minutes,Hours,Days,Months,Years".split(","),c={},d=1,e=this.model.values.length;d<e;++d)diff=this.model.values[d]-this.model.values[d-1],info=gxp.PlaybackToolbar.smartIntervalFormat(diff),
c[info.units]=!0;var f=null;for(d=0,e=a.length;d<e;++d)if(!0===c[a[d]]){f=a[d];break}null!==f&&(a=gxp.PlaybackToolbar.timeFormats[f])&&this.setTimeFormat(a)}Ext.applyIf(this.initialConfig,b);Ext.apply(this,this.initialConfig)}this.timeManager.events.on({rangemodified:this.onRangeModified,tick:this.onTimeTick,scope:this});this.plugins=(this.plugins||[]).concat([new Ext.slider.Tip({cls:"gxp-timeslider-tip",getText:this.getThumbText})]);this.listeners=Ext.applyIf(this.listeners||{},{dragstart:function(){if(this.timeManager.timer)this.timeManager.stop(),
this._restartPlayback=!0},beforechange:function(a,b,c,d){b=!0;!this.timeManager.timeUnits&&!this.timeManager.snapToList?b=!1:"cumulative"==this.playbackMode&&"tail"==a.indexMap[d.index]&&(b=!1);return b},afterrender:function(a){this.sliderTip=a.plugins[0];this.timeManager.units&&1<a.thumbs.length&&a.setThumbStyles();this.autoPlay&&this.timeManager.play()},scope:this});!0===this.aggressive?this.listeners.change={fn:this.onSliderChangeComplete,buffer:this.changeBuffer}:this.listeners.changecomplete=
this.onSliderChangeComplete;gxp.slider.TimeSlider.superclass.initComponent.call(this);this.addEvents("sliderclick")},onClickChange:function(a){this.fireEvent("sliderclick",this);gxp.slider.TimeSlider.superclass.onClickChange.apply(this,arguments)},beforeDestroy:function(){this.map=null;gxp.slider.TimeSlider.superclass.beforeDestroy.call(this)},setPlaybackMode:function(a){this.playbackMode=a;this.reconfigureSlider(this.buildSliderValues());"track"!=this.playbackMode&&this.timeManager.rangeInterval&&
(this.timeManager.incrementTimeValue(this.timeManager.rangeInterval),this.setValue(0,this.timeManager.currentValue));this.setThumbStyles()},setTimeFormat:function(a){if(a)this.timeFormat=a},onRangeModified:function(){var a=this.timeManager;if(!a.agents||!a.agents.length)a.map.removeControl(this.ctl),a.destroy();else{var b=a.animationRange[0],c=a.animationRange[1];a.guessPlaybackRate();if(a.animationRange[0]!=b||a.animationRange[1]!=c||void 0!=a.units||void 0!=a.step)this.reconfigureSlider(this.buildSliderValues()),
this.setThumbStyles(),this.fireEvent("rangemodified",this,a.animationRange)}},onTimeTick:function(a){if(a=a.currentValue){var b=this.refOwner,c=this.indexMap?this.indexMap.indexOf("tail"):-1,d=-1<c?a-this.thumbs[0].value:0;this.setValue(0,a);-1<c&&this.setValue(c,this.thumbs[c].value+d);this.updateTimeDisplay();b.fireEvent("timechange",b,a)}},updateTimeDisplay:function(){this.sliderTip.onSlide(this,null,this.thumbs[0]);this.sliderTip.el.alignTo(this.el,"b-t?",this.offsets)},buildSliderValues:function(){var a=
this.timeManager;if(!a.step&&!a.snapToList)return!1;var b=["primary"],c=[a.currentValue],d=a.animationRange[0],e=a.animationRange[1],f=!1;if(this.dynamicRange){var g=0.1*(d-e);c.push(d-=g,e+=g);b[1]="minTime";b[2]="maxTime"}"track"!=this.playbackMode&&(c.push(d),b[b.length]="tail");if(!a.snapToList)f=a.step;return{values:c,map:b,maxValue:e,minValue:d,interval:f}},reconfigureSlider:function(a){this.setMaxValue(a.maxValue);this.setMinValue(a.minValue);Ext.apply(this,{increment:a.interval,keyIncrement:a.interval,
indexMap:a.map});for(var b=0;b<a.values.length;b++)this.thumbs[b]?this.setValue(b,a.values[b]):this.addThumb(a.values[b]);if(!a.interval&&this.timeManager.modelCache.values)a.interval=Math.round((a.maxValue-a.minValue)/this.timeManager.modelCache.values.length);this.setTimeFormat(gxp.PlaybackToolbar.guessTimeFormat(a.interval))},setThumbStyles:function(){var a=this.indexMap.indexOf("tail");"min"==this.indexMap[1]&&(this.thumbs[1].el.addClass("x-slider-min-thumb"),this.thumbs[2].el.addClass("x-slider-max-thumb"));
if(-1<a){var a=this.thumbs[a],b=this.thumbs[0];a.el.addClass("x-slider-tail-thumb");a.constrain=!1;b.constrain=!1}},getThumbText:function(a){if("tail"!=a.slider.indexMap[a.index]){var b=new Date(a.value);b.setTime(b.getTime()+6E4*b.getTimezoneOffset());return b.format(a.slider.timeFormat)}a=gxp.PlaybackToolbar.smartIntervalFormat.call(a,a.slider.thumbs[0].value-a.value);return a.value+" "+a.units},onSliderChangeComplete:function(a,b,c,d){var e=a.timeManager;if(b!==e.currentValue){switch(a.indexMap[c.index]){case "primary":d=
a.indexMap.indexOf("tail");if(-1<d)a.onSliderChangeComplete(a,a.thumbs[d].value,a.thumbs[d],!0);!e.snapToList&&e.timeUnits?(a=Math[b>e.currentValue?"ceil":"floor"]((b-e.currentValue)/OpenLayers.TimeStep[e.timeUnits]),e.setCurrentValue(e.incrementTimeValue(a))):e.setCurrentValue(b);break;case "min":e.setAnimationStart(b);break;case "max":e.seAnimantionEnd(b);break;case "tail":for(var c=0,f=e.agents.length;c<f;c++)if("range"==e.agents[c].tickMode)e.agents[c].rangeInterval=a.thumbs[0].value-b;d||e.setCurrentValue(a.thumbs[0].value)}this._restartPlayback&&
(delete this._restartPlayback,e.play())}},onRender:function(){this.autoEl={cls:"x-slider "+(this.vertical?"x-slider-vert":"x-slider-horz"),cn:[{cls:"x-slider-end",cn:{cls:"x-slider-inner",cn:[{tag:"a",cls:"x-slider-focus",href:"#",tabIndex:"-1",hidefocus:"on"}]}},{cls:"x-slider-progress"}]};Ext.slider.MultiSlider.superclass.onRender.apply(this,arguments);this.endEl=this.el.first();this.progressEl=this.el.child(".x-slider-progress");this.innerEl=this.endEl.first();this.focusEl=this.innerEl.child(".x-slider-focus");
for(var a=0;a<this.thumbs.length;a++)this.thumbs[a].render();a=this.innerEl.child(".x-slider-thumb");this.halfThumb=(this.vertical?a.getHeight():a.getWidth())/2;this.initEvents()}});Ext.reg("gxp_timeslider",gxp.slider.TimeSlider);Ext.namespace("gxp");
gxp.PlaybackToolbar=Ext.extend(Ext.Toolbar,{control:null,dimModel:null,mapPanel:null,initialTime:null,timeFormat:"l, F d, Y g:i:s A",toolbarCls:"x-toolbar gx-overlay-playback",ctCls:"gx-playback-wrap",slider:!0,dynamicRange:!1,playbackMode:"track",showIntervals:!1,labelButtons:!1,settingsButton:!0,rateAdjuster:!1,looped:!1,autoPlay:!1,aggressive:null,prebuffer:null,maxframes:null,optionsWindow:null,playing:!1,playLabel:"Play",playTooltip:"Play",stopLabel:"Stop",stopTooltip:"Stop",fastforwardLabel:"FFWD",
fastforwardTooltip:"Double Speed Playback",nextLabel:"Next",nextTooltip:"Advance One Frame",resetLabel:"Reset",resetTooltip:"Reset to the start",loopLabel:"Loop",loopTooltip:"Continously loop the animation",normalTooltip:"Return to normal playback",pauseLabel:"Pause",pauseTooltip:"Pause",initComponent:function(){if(!this.playbackActions)this.playbackActions="settings,slider,reset,play,fastforward,next,loop".split(",");if(!this.control)this.controlConfig=Ext.applyIf(this.controlConfig||{},{dimension:"time",
prebuffer:this.prebuffer,maxframes:this.maxframes,autoSync:!0}),this.control=this.buildTimeManager();this.control.events.on({play:function(){this.playing=!0},stop:function(){this.playing=!1},scope:this});if(!this.dimModel)this.dimModel=new OpenLayers.Dimension.Model({dimension:"time",map:this.mapPanel.map});this.mapPanel.map.events.on({zoomend:function(){if(!0===this._prebuffer&&this.mapPanel.map.zoom!==this.previousZoom)this._stopPrebuffer=!0,this.slider.progressEl.hide(),this.mapPanel.map.events.un({zoomend:arguments.callee,
scope:this});this.previousZoom=this.mapPanel.map.zoom},scope:this});this.control.events.on({prebuffer:function(a){this._prebuffer=!0;!0===this._stopPrebuffer&&this.slider.progressEl.hide();this.slider.progressEl.setWidth(100*a.progress+"%");return!0!==this._stopPrebuffer},scope:this});this.availableTools=Ext.applyIf(this.availableTools||{},this.getAvailableTools());Ext.applyIf(this,{defaults:{xtype:"button",flex:1,scale:"small"},items:this.buildPlaybackItems(),border:!1,frame:!1,unstyled:!0,shadow:!1,
timeDisplayConfig:{xtype:"tip",format:this.timeFormat,height:"auto",closeable:!1,title:!1,width:210}});this.addEvents("timechange","rangemodified");gxp.PlaybackToolbar.superclass.initComponent.call(this)},destroy:function(){if(this.control&&!this.initialConfig.control)this.control.map&&this.control.map.removeControl(this.control),this.control.destroy(),this.control=null;this.mapPanel=null;gxp.PlaybackToolbar.superclass.destroy.call(this)},setTime:function(a){a=a.getTime();if(a<this.slider.minValue||
a>this.slider.maxValue)return!1;this.control.setCurrentValue(a);return!0},setTimeFormat:function(a){if(a)this.timeFormat=a,this.slider.setTimeFormat(a)},setPlaybackMode:function(a){if(a)this.playbackMode=a,this.slider&&this.slider.setPlaybackMode(a)},buildPlaybackItems:function(){for(var a=this.playbackActions,b=[],c=0,d=a.length;c<d;c++){var e=a[c],f=this.availableTools[e];f?b.push(f):-1<["|"," ","->"].indexOf(e)&&b.push(e)}return b},getAvailableTools:function(){return{slider:{xtype:"gxp_timeslider",
ref:"slider",listeners:{sliderclick:{fn:function(){this._stopPrebuffer=!0},scope:this},dragstart:{fn:function(){this._stopPrebuffer=!0},scope:this}},map:this.mapPanel.map,timeManager:this.control,model:this.dimModel,playbackMode:this.playbackMode,aggressive:this.aggressive},reset:{iconCls:"gxp-icon-reset",ref:"btnReset",handler:this.control.reset,scope:this.control,tooltip:this.resetTooltip,menuText:this.resetLabel,text:this.labelButtons?this.resetLabel:!1},pause:{iconCls:"gxp-icon-pause",ref:"btnPause",
handler:this.control.stop,scope:this.control,tooltip:this.stopTooltip,menuText:this.stopLabel,text:this.labelButtons?this.stopLabel:!1,toggleGroup:"timecontrol",enableToggle:!0,allowDepress:!1},play:{iconCls:"gxp-icon-play",ref:"btnPlay",toggleHandler:this.toggleAnimation,scope:this,toggleGroup:"timecontrol",enableToggle:!0,allowDepress:!0,tooltip:this.playTooltip,menuText:this.playLabel,text:this.labelButtons?this.playLabel:!1},next:{iconCls:"gxp-icon-next",ref:"btnNext",handler:function(){this.stop();
this.tick()},scope:this.control,tooltip:this.nextTooltip,menuText:this.nextLabel,text:this.labelButtons?this.nextLabel:!1},end:{iconCls:"gxp-icon-last",ref:"btnEnd",handler:this.forwardToEnd,scope:this,tooltip:this.endTooltip,menuText:this.endLabel,text:this.labelButtons?this.endLabel:!1},loop:{iconCls:"gxp-icon-loop",ref:"btnLoop",tooltip:this.loopTooltip,enableToggle:!0,allowDepress:!0,pressed:this.looped,toggleHandler:this.toggleLoopMode,scope:this,menuText:this.loopLabel,text:this.labelButtons?
this.loopLabel:!1},fastforward:{iconCls:"gxp-icon-ffwd",ref:"btnFastforward",tooltip:this.fastforwardTooltip,enableToggle:!0,toggleGroup:"fastforward",toggleHandler:this.toggleDoubleSpeed,scope:this,disabled:!0,menuText:this.fastforwardLabel,text:this.labelButtons?this.fastforwardLabel:!1},settings:{iconCls:"gxp-icon-settings",ref:"btnSettings",scope:this,handler:this.toggleOptionsWindow,enableToggle:!1,tooltip:this.settingsTooltip,menuText:this.settingsLabel,text:this.labelButtons?this.settingsLabel:
!1}}},buildTimeManager:function(){this.controlConfig||(this.controlConfig={});if(this.controlConfig.timeAgents)this.controlConfig.agents=this.controlConfig.timeAgents,delete this.controlConfig.timeAgents;if(this.controlConfig.agents)for(var a=0;a<this.controlConfig.agents.length;a++){var b=this.controlConfig.agents[a],c=b.type,d=[];Ext.each(b.layers,function(a){var b=this.mapPanel.layers.findBy(function(b){return b.json&&b.json.source==a.source&&b.json.title==a.title&&b.json.name==a.name&&(b.json.styles==
a.styles||!1==!!b.json.styles&&!1==!!a.styles)});-1<b&&d.push(this.mapPanel.layers.getAt(b).getLayer())},this);b.layers=d;if(b.rangeMode)b.tickMode=b.rangeMode,delete b.rangeMode;delete b.type;if(!b.dimension)b.dimension="time";b=c&&OpenLayers.Dimension.Agent[c]?new OpenLayers.Dimension.Agent[c](b):new OpenLayers.Dimension.Agent(b);this.controlConfig.agents[a]=b}else"ranged"==this.playbackMode?Ext.apply(this.controlConfig,{agentOptions:{WMS:{tickMode:"range",rangeInterval:this.controlConfig.rangeInterval||
void 0},Vector:{tickMode:"range",rangeInterval:this.controlConfig.rangeInterval||void 0}}}):"cumulative"==this.playbackMode&&Ext.apply(this.controlConfig,{agentOptions:{WMS:{tickMode:"cumulative"},Vector:{tickMode:"cumulative"}}});if(!this.controlConfig.dimension)this.controlConfig.dimension="time";a=this.control=new OpenLayers.Control.DimensionManager(this.controlConfig);a.loop=this.looped;this.mapPanel.map.addControl(a);a.layers&&this.fireEvent("rangemodified",this,a.range);return a},forwardToEnd:function(){var a=
this.control;a.setCurrentValue(a.animationRange[0>a.step?0:1])},toggleAnimation:function(a,b){if(!a.bound&&b)this.control.events.on({stop:function(b){a.toggle(!1);if(b.rangeExceeded)this._resetOnPlay=!0},play:function(){a.toggle(!0);this._resetOnPlay&&(this.reset(),delete this._resetOnPlay)}}),a.bound=!0;b?(this.playing||this.control.play(),a.btnEl.removeClass("gxp-icon-play"),a.btnEl.addClass("gxp-icon-pause"),a.setTooltip(this.pauseTooltip)):(this.playing&&this.control.stop(),a.btnEl.addClass("gxp-icon-play"),
a.btnEl.removeClass("gxp-icon-pause"),a.setTooltip(this.playTooltip));a.el.removeClass("x-btn-pressed");a.refOwner.btnFastforward.setDisabled(!b);this.labelButtons&&a.text&&a.setText(b?this.pauseLabel:this.playLabel)},toggleLoopMode:function(a,b){this.control.loop=b;a.setTooltip(b?this.normalTooltip:this.loopTooltip);this.labelButtons&&a.text&&a.setText(b?this.normalLabel:this.loopLabel)},toggleDoubleSpeed:function(a,b){this.control.setFrameRate(this.control.frameRate*(b?2:0.5));a.setTooltip(b?this.normalTooltip:
this.fastforwardTooltip)},toggleOptionsWindow:function(a,b){if(b&&this.optionsWindow.hidden){if(!this.optionsWindow.optionsPanel.timeManager)this.optionsWindow.optionsPanel.timeManager=this.control,this.optionsWindow.optionsPanel.playbackToolbar=this;this.optionsWindow.show()}else!b&&!this.optionsWindow.hidden&&this.optionsWindow.hide()}});gxp.PlaybackToolbar.timeFormats={Minutes:"l, F d, Y g:i A",Hours:"l, F d, Y g A",Days:"l, F d, Y",Months:"F, Y",Years:"Y"};
gxp.PlaybackToolbar.guessTimeFormat=function(a){if(a){var a=gxp.PlaybackToolbar.smartIntervalFormat(a).units,b=this.timeFormat;gxp.PlaybackToolbar.timeFormats[a]&&(b=gxp.PlaybackToolbar.timeFormats[a]);return b}};
gxp.PlaybackToolbar.smartIntervalFormat=function(a){var b;b=Math.abs(a);5E3>b?(b="Seconds",a=Math.round(a/100)/10):35E5>b?(b="Minutes",a=Math.round(a/600)/10):828E5>b?(b="Hours",a=Math.round(a/36E4)/10):25E8>b?(b="Days",a=Math.round(a/864E4)/10):311E8>b?(b="Months",a=Math.round(a/2628E5)/10):(b="Years",a=Math.round(a/31536E5)/10);return{units:b,value:a}};Ext.reg("gxp_playbacktoolbar",gxp.PlaybackToolbar);Ext.namespace("gxp.form");
gxp.form.PlaybackModeComboBox=Ext.extend(Ext.form.ComboBox,{modeFieldText:"Playback Mode",normalOptText:"Normal",cumulativeOptText:"Cumulative",rangedOptText:"Ranged",modes:[],defaultMode:"track",agents:null,allowBlank:!1,mode:"local",triggerAction:"all",editable:!1,constructor:function(a){this.addEvents("beforemodechange","modechange");!a.modes&&!this.modes.length&&this.modes.push(["track",this.normalOptText],["cumulative",this.cumulativeOptText],["ranged",this.rangedOptText]);gxp.form.PlaybackModeComboBox.superclass.constructor.call(this,
a)},initComponent:function(){Ext.applyIf(this,{displayField:"field2",valueField:"field1",store:this.modes,value:this.defaultMode,listeners:{select:this.setPlaybackMode,scope:this}});gxp.form.PlaybackModeComboBox.superclass.initComponent.call(this)},setPlaybackMode:function(a,b){this.fireEvent("beforemodechange");if(!this.agents&&window.console)window.console.warn("No agents configured for playback mode combobox");else{var c=b.get("field1");Ext.each(this.agents,function(a){a.tickMode=c;if("range"==
c&&!a.rangeInterval)a.rangeInterval=1});this.fireEvent("modechange",this,c,this.agents)}}});Ext.reg("gxp_playbackmodecombo",gxp.form.PlaybackModeComboBox);Ext.namespace("gxp");
gxp.PlaybackOptionsPanel=Ext.extend(Ext.Panel,{layout:"fit",titleText:"Date & Time Options",rangeFieldsetText:"Time Range",animationFieldsetText:"Animation Options",startText:"Start",endText:"End",listOnlyText:"Use Exact List Values Only",stepText:"Animation Step",unitsText:"Animation Units",noUnitsText:"Snap To Time List",loopText:"Loop Animation",reverseText:"Reverse Animation",rangeChoiceText:"Choose the range for the time control",rangedPlayChoiceText:"Playback Mode",initComponent:function(){var a=
Ext.applyIf(this.initialConfig,{minHeight:400,minWidth:275,ref:"optionsPanel",items:[{xtype:"form",layout:"form",autoScroll:!0,ref:"form",labelWidth:10,defaultType:"textfield",items:[{xtype:"fieldset",title:this.rangeFieldsetText,defaultType:"datefield",labelWidth:60,items:[{xtype:"displayfield",text:this.rangeChoiceText},{fieldLabel:this.startText,listeners:{select:this.setStartTime,change:this.setStartTime,scope:this},ref:"../../rangeStartField"},{fieldLabel:this.endText,listeners:{select:this.setEndTime,
change:this.setEndTime,scope:this},ref:"../../rangeEndField"}]},{xtype:"fieldset",title:this.animationFieldsetText,labelWidth:100,items:[{boxLabel:this.listOnlyText,hideLabel:!0,xtype:"checkbox",handler:this.toggleListMode,scope:this,ref:"../../listOnlyCheck"},{fieldLabel:this.stepText,xtype:"numberfield",anchor:"-25",enableKeyEvents:!0,listeners:{change:this.setStep,scope:this},ref:"../../stepValueField"},{fieldLabel:this.unitsText,xtype:"combo",anchor:"-5",store:[[OpenLayers.TimeUnit.SECONDS,"Seconds"],
[OpenLayers.TimeUnit.MINUTES,"Minutes"],[OpenLayers.TimeUnit.HOURS,"Hours"],[OpenLayers.TimeUnit.DAYS,"Days"],[OpenLayers.TimeUnit.MONTHS,"Months"],[OpenLayers.TimeUnit.YEARS,"Years"]],valueNotFoundText:this.noUnitsText,mode:"local",forceSelection:!0,autoSelect:!1,editable:!1,triggerAction:"all",listeners:{select:this.setUnits,scope:this},ref:"../../stepUnitsField"},{fieldLabel:this.rangedPlayChoiceText,xtype:"gxp_playbackmodecombo",agents:this.timeManager&&this.timeManager.agents,anchor:"-5",listeners:{modechange:this.setPlaybackMode,
scope:this},ref:"../../playbackModeField"}]},{xtype:"checkbox",boxLabel:this.loopText,handler:this.setLoopMode,scope:this,ref:"../loopModeCheck"},{xtype:"checkbox",boxLabel:this.reverseText,handler:this.setReverseMode,scope:this,ref:"../reverseModeCheck"}]}],bbar:[{text:"Save",ref:"../saveBtn",hidden:this.readOnly,handler:function(){this.fireEvent("save",this)},scope:this}]});Ext.apply(this,a);this.on("show",this.populateForm,this);gxp.PlaybackOptionsPanel.superclass.initComponent.call(this)},destroy:function(){this.playbackToolbar=
this.timeManager=null;this.un("show",this,this.populateForm);gxp.PlaybackOptionsPanel.superclass.destroy.call(this)},setStartTime:function(a,b){this.timeManager.setAnimationStart(b.getTime());this.timeManager.fixedRange=!0},setEndTime:function(a,b){this.timeManager.setAnimationEnd(b.getTime());this.timeManager.fixedRange=!0},toggleListMode:function(a,b){this.stepValueField.setDisabled(b);this.stepUnitsField.setDisabled(b);this.timeManager.snapToList=b},setUnits:function(a,b){var c=b.get("field1");
if(this.timeManager.timeUnits!=c)this.timeManager.timeUnits=c,this.timeManager.step=a.refOwner.stepValueField.value*OpenLayers.TimeStep[c],"track"!=this.playbackToolbar.playbackMode&&this.timeManager.incrementValue()},setStep:function(a,b){if(a.validate()&&b&&(this.timeManager.step=b*OpenLayers.TimeStep[this.timeManager.timeUnits],this.timeManager.timeStep=b,"ranged"==this.playbackToolbar.playbackMode&&this.timeManager.rangeInterval!=b))this.timeManager.rangeInterval=b,this.timeManager.incrementTimeValue(b)},
setPlaybackMode:function(a,b,c){var d=a.startValue;Ext.each(c,function(a){if(a.tickMode==d)a.tickMode=b});this.disableListMode("ranged"==b);this.playbackToolbar.setPlaybackMode(b)},disableListMode:function(a){(a=!1!==a)&&this.listOnlyCheck.setValue(!a);this.listOnlyCheck.setDisabled(a)},setLoopMode:function(a,b){this.timeManager.loop=b},setReverseMode:function(){this.timeManager.step*=-1},populateForm:function(){this.readOnly?this.saveBtn.hide():this.saveBtn.show();this.doLayout();if(this.timeManager){var a=
new Date(this.timeManager.animationRange[0]),b=new Date(this.timeManager.animationRange[1]),c=this.timeManager.timeStep,d=this.timeManager.timeUnit,e=this.timeManager.snapToList,f=this.playbackToolbar?this.playbackToolbar.playbackMode:this.timeManager.agents[0].tickMode,g=this.timeManager.loop,h=0>this.timeManager.step;this.rangeStartField.setValue(a);this.rangeStartField.originalValue=a;this.rangeEndField.setValue(b);this.rangeEndField.originalValue=b;this.stepValueField.originalValue=this.stepValueField.setValue(c);
this.stepUnitsField.originalValue=this.stepUnitsField.setValue(d);this.listOnlyCheck.setValue(e);this.listOnlyCheck.originalValue=e;if(!this.playbackModeField.agents||!this.playbackModeField.agents.length)this.playbackModeField.agents=this.timeManager.agents;this.playbackModeField.setValue(f);this.playbackModeField.originalValue=f;this.loopModeCheck.setValue(g);this.loopModeCheck.originalValue=g;this.reverseModeCheck.setValue(h);this.reverseModeCheck.originalValue=h}},close:function(){if(this.ownerCt&&
this.ownerCt.close)this.ownerCt[this.ownerCt.closeAction]()}});Ext.reg("gxp_playbackoptions",gxp.PlaybackOptionsPanel);Ext.namespace("gxp.plugins");
gxp.plugins.Playback=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_playback",autoStart:!1,looped:!1,playbackMode:"track",menuText:"Time Playback",tooltip:"Show Time Playback Panel",actionTarget:null,outputTarget:"map",constructor:function(a){gxp.plugins.Playback.superclass.constructor.apply(this,arguments)},init:function(a){a.on("saved",function(){if(this.output)this.output[0].optionsWindow.optionsPanel.readOnly=!1},this,{single:!0});gxp.plugins.Playback.superclass.init.call(this,a)},addOutput:function(a){delete this._ready;
OpenLayers.Control.DimensionManager.prototype.maxFrameDelay=this.target.tests&&this.target.tests.dropFrames?10:NaN;a=Ext.applyIf(a||this.outputConfig||{},{xtype:"gxp_playbacktoolbar",mapPanel:this.target.mapPanel,playbackMode:this.playbackMode,prebuffer:this.target.prebuffer,maxframes:this.target.maxframes,looped:this.looped,autoPlay:this.autoStart,optionsWindow:new Ext.Window({title:gxp.PlaybackOptionsPanel.prototype.titleText,width:350,height:400,layout:"fit",items:[{xtype:"gxp_playbackoptions",
readOnly:!this.target.isAuthorized()||!(this.target.id||this.target.mapID),listeners:{save:function(a){this.target.on("saved",function(){a.ownerCt.close()},this,{single:!0});this.target.save()},scope:this}}],closeable:!0,closeAction:"hide",renderTo:Ext.getBody(),listeners:{show:function(a){a=a.findByType("gxp_playbackoptions")[0];a.fireEvent("show",a)},hide:function(a){a=a.findByType("gxp_playbackoptions")[0];a.fireEvent("hide",a)}}})});a=gxp.plugins.Playback.superclass.addOutput.call(this,a);this.relayEvents(a,
["timechange","rangemodified"]);this.playbackToolbar=a;a.control.layers&&this.fireEvent("rangemodified",this,a.control.range);return a},addActions:function(){this._ready=0;this.target.mapPanel.map.events.register("addlayer",this,function(a){var b=a.layer;b instanceof OpenLayers.Layer.WMS&&b.dimensions&&b.dimensions.time&&(this.target.mapPanel.map.events.unregister("addlayer",this,arguments.callee),this._ready+=1,1<this._ready&&this.addOutput())});this.target.on("ready",function(){this._ready+=1;1<
this._ready&&this.addOutput()},this)},setTime:function(a){return this.playbackToolbar.setTime(a)},getState:function(){var a=gxp.plugins.Playback.superclass.getState.call(this),b=this.playbackToolbar;if(b){var c=b.control;a.outputConfig=Ext.apply(b.initialConfig,{dynamicRange:b.dyanamicRange,playbackMode:b.playbackMode});if(c&&(b=c.modelCache||c.model,a.outputConfig.controlConfig={model:{dimension:b.dimension||c.dimension,values:b.values,range:b.range},animationRange:c.animationRange,timeStep:c.timeStep,
timeUnits:c.timeUnits?c.timeUnits:void 0,loop:c.loop,snapToList:c.snapToList,dimension:b.dimension||c.dimension},1<c.agents.length)){for(var c=c.agents,b=[],d=0;d<c.length;d++){for(var e={type:c[d].CLASS_NAME.split("Agent.")[1],tickMode:c[d].tickMode,rangeInterval:c[d].rangeInterval,values:c[d].values,layers:[]},f=0;f<c[d].layers.length;f++){var g=this.target.mapPanel.layers.getByLayer(c[d].layers[f]),g=this.target.layerSources[g.get("source")].getConfigForRecord(g);e.layers.push({source:g.source,
title:g.title,name:g.name,styles:g.styles?g.styles:void 0})}b.push(e)}a.outputConfig.controlConfig.agents=b}delete a.outputConfig.mapPanel;delete a.outputConfig.optionsWindow}return a}});Ext.preg(gxp.plugins.Playback.prototype.ptype,gxp.plugins.Playback);Ext.namespace("gxp.plugins");
gxp.plugins.Print=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_print",printService:null,printCapabilities:null,customParams:null,includeLegend:!1,menuText:"Print Map",tooltip:"Print Map",buttonText:"Print",notAllNotPrintableText:"Not All Layers Can Be Printed",nonePrintableText:"None of your current map layers can be printed",previewText:"Print Preview",openInNewWindow:!1,constructor:function(a){gxp.plugins.Print.superclass.constructor.apply(this,arguments)},addActions:function(){if(null!==this.printService||
null!=this.printCapabilities){var a=new GeoExt.data.PrintProvider({capabilities:this.printCapabilities,url:this.printService,customParams:this.customParams,autoLoad:!1,listeners:{beforedownload:function(a,b){if(!0===this.openInNewWindow)return window.open(b),!1},beforeencodelegend:function(a,b,c){if(c&&"gxp_layermanager"===c.ptype){var d=[];(c=c.output)&&c[0]&&c[0].getRootNode().cascade(function(a){if(a.component&&!a.component.hidden){var a=a.component,c=this.encoders.legends[a.getXType()];d=d.concat(c.call(this,
a,b.pages[0].scale))}},a);b.legends=d;return!1}},beforeprint:function(){d.items.get(0).printMapPanel.layers.each(function(a){var a=a.get("layer").params,b;for(b in a)a[b]instanceof Array&&(a[b]=a[b].join(","))})},loadcapabilities:function(){if(c)c.initialConfig.disabled=!1,c.enable()},print:function(){try{d.close()}catch(a){}},printException:function(a,b){this.target.displayXHRTrouble&&this.target.displayXHRTrouble(b)},scope:this}}),b=gxp.plugins.Print.superclass.addActions.call(this,[{menuText:this.menuText,
buttonText:this.buttonText,tooltip:this.tooltip,iconCls:"gxp-icon-print",disabled:null!==this.printCapabilities?!1:!0,handler:function(){if(0<g().length){var a=j.call(this);k.call(this);return a}Ext.Msg.alert(this.notAllNotPrintableText,this.nonePrintableText)},scope:this,listeners:{render:function(){a.loadCapabilities()}}}]),c=b[0].items[0],d,e=function(){if(d){try{d.items.first().printMapPanel.printPage.destroy()}catch(a){}d=null}},f=this.target.mapPanel,g=function(){var a=[];f.layers.each(function(b){b=
b.getLayer();h(b)&&a.push(b)});return a},h=function(a){return!0===a.getVisibility()&&(a instanceof OpenLayers.Layer.WMS||a instanceof OpenLayers.Layer.OSM)},j=function(){var b=null;if(!0===this.includeLegend){var c,g;for(c in this.target.tools)if(g=this.target.tools[c],"gxp_legend"===g.ptype){b=g.getLegendPanel();break}if(null===b)for(c in this.target.tools)if(g=this.target.tools[c],"gxp_layermanager"===g.ptype){b=g;break}}return d=new Ext.Window({title:this.previewText,modal:!0,border:!1,autoHeight:!0,
resizable:!1,width:360,items:[new GeoExt.ux.PrintPreview({minWidth:336,mapTitle:this.target.about&&this.target.about.title,comment:this.target.about&&this.target.about["abstract"],printMapPanel:{autoWidth:!0,height:Math.min(420,Ext.get(document.body).getHeight()-150),limitScales:!0,map:Ext.applyIf({controls:[new OpenLayers.Control.Navigation({zoomWheelEnabled:!1,zoomBoxEnabled:!1}),new OpenLayers.Control.PanPanel,new OpenLayers.Control.ZoomPanel,new OpenLayers.Control.Attribution],eventListeners:{preaddlayer:function(a){return h(a.layer)}}},
f.initialConfig.map),items:[{xtype:"gx_zoomslider",vertical:!0,height:100,aggressive:!0}],listeners:{afterlayout:function(){d.setWidth(Math.max(360,this.getWidth()+24));d.center()}}},printProvider:a,includeLegend:this.includeLegend,legend:b,sourceMap:f})],listeners:{beforedestroy:e}})},k=function(){d.show();d.setWidth(0);var a=0;d.items.get(0).items.get(0).items.each(function(b){b.getEl()&&(a+=b.getWidth())});d.setWidth(Math.max(d.items.get(0).printMapPanel.getWidth(),a+20));d.center()};return b}}});
Ext.preg(gxp.plugins.Print.prototype.ptype,gxp.plugins.Print);Ext.namespace("gxp.plugins");
gxp.plugins.QueryForm=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_queryform",featureManager:null,autoHide:!1,schema:null,queryActionText:"Query",cancelButtonText:"Cancel",queryMenuText:"Query layer",queryActionTip:"Query the selected layer",queryByLocationText:"Query by current map extent",queryByAttributesText:"Query by attributes",queryMsg:"Querying...",noFeaturesTitle:"No Match",noFeaturesMessage:"Your query did not return any results.",outputAction:0,autoExpand:null,addActions:function(a){!this.initialConfig.actions&&
!a&&(a=[{text:this.queryActionText,menuText:this.queryMenuText,iconCls:"gxp-icon-find",tooltip:this.queryActionTip,disabled:!0,toggleGroup:this.toggleGroup,enableToggle:!0,allowDepress:!0,toggleHandler:function(a,c){if(this.autoExpand&&0<this.output.length){var d=Ext.getCmp(this.autoExpand);d[c?"expand":"collapse"]();c?(d.expand(),d.ownerCt&&d.ownerCt instanceof Ext.Panel&&d.ownerCt.expand()):this.target.tools[this.featureManager].loadFeatures()}},scope:this}]);this.actions=gxp.plugins.QueryForm.superclass.addActions.apply(this,
a);if(null!==this.actionTarget&&this.actions)this.target.tools[this.featureManager].on("layerchange",function(a,c,d){for(a=this.actions.length-1;0<=a;--a)this.actions[a].setDisabled(!d)},this)},addOutput:function(a){var b=this.target.tools[this.featureManager],a=Ext.apply({border:!1,bodyStyle:"padding: 10px",layout:"form",width:320,autoScroll:!0,items:[{xtype:"fieldset",ref:"spatialFieldset",title:this.queryByLocationText,anchor:"97%",style:"margin-bottom:0; border-left-color:transparent; border-right-color:transparent; border-width:1px 1px 0 1px; padding-bottom:0",
checkboxToggle:!0},{xtype:"fieldset",ref:"attributeFieldset",title:this.queryByAttributesText,anchor:"97%",style:"margin-bottom:0",checkboxToggle:!0}],bbar:["->",{text:this.cancelButtonText,iconCls:"cancel",handler:function(){var a=this.outputTarget?c.ownerCt:c.ownerCt.ownerCt;a&&a instanceof Ext.Window&&a.hide();g(b,b.layerRecord,b.schema);b.loadFeatures()}},{text:this.queryActionText,iconCls:"gxp-icon-find",handler:function(){var a=[];!0!==c.spatialFieldset.collapsed&&a.push(new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,
property:b.featureStore.geometryName,value:this.target.mapPanel.map.getExtent()}));if(!0!==c.attributeFieldset.collapsed){var d=c.filterBuilder.getFilter();d&&a.push(d)}b.loadFeatures(1<a.length?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:a}):a[0])},scope:this}]},a||{}),c=gxp.plugins.QueryForm.superclass.addOutput.call(this,a),d=null,e=!0;if(this.autoExpand){var d=Ext.getCmp(this.autoExpand),f=function(){e&&(d.un("expand",f),d.un("collapse",f),d=null);e=!0};d.on({expand:f,
collapse:f})}var g=function(a,b,f){c.attributeFieldset.removeAll();c.setDisabled(!f);d&&(e=!1,d[f?"expand":"collapse"](),f&&d&&d.ownerCt&&d.ownerCt instanceof Ext.Panel&&d.ownerCt.expand());f?(c.attributeFieldset.add({xtype:"gxp_filterbuilder",ref:"../filterBuilder",attributes:f,allowBlank:!0,allowGroups:!1}),c.spatialFieldset.expand(),c.attributeFieldset.expand()):(c.attributeFieldset.rendered&&c.attributeFieldset.collapse(),c.spatialFieldset.rendered&&c.spatialFieldset.collapse());c.attributeFieldset.doLayout()};
b.on("layerchange",g);g(b,b.layerRecord,b.schema);b.on({beforequery:function(){(new Ext.LoadMask(c.getEl(),{store:b.featureStore,msg:this.queryMsg})).show()},query:function(a,b){if(b&&null!==this.target.tools[this.featureManager].featureStore&&(b.getCount()||Ext.Msg.show({title:this.noFeaturesTitle,msg:this.noFeaturesMessage,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO}),this.autoHide)){var d=this.outputTarget?c.ownerCt:c.ownerCt.ownerCt;d instanceof Ext.Window&&d.hide()}},scope:this});return c}});
Ext.preg(gxp.plugins.QueryForm.prototype.ptype,gxp.plugins.QueryForm);Ext.namespace("gxp.plugins");
gxp.plugins.RemoveLayer=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_removelayer",removeMenuText:"Remove layer",removeActionTip:"Remove layer",addActions:function(){var a,b=gxp.plugins.RemoveLayer.superclass.addActions.apply(this,[{menuText:this.removeMenuText,iconCls:"gxp-icon-removelayers",disabled:!0,tooltip:this.removeActionTip,text:this.removeActionText,handler:function(){var b=a;b&&this.target.mapPanel.layers.remove(b)},scope:this}]),c=b[0];this.target.on("layerselectionchange",function(b){a=b;c.setDisabled(1>=
this.target.mapPanel.layers.getCount()||!b)},this);var d=function(b){c.setDisabled(!a||1>=b.getCount())};this.target.mapPanel.layers.on({add:d,remove:d});return b}});Ext.preg(gxp.plugins.RemoveLayer.prototype.ptype,gxp.plugins.RemoveLayer);Ext.namespace("gxp.plugins");
gxp.plugins.SelectedFeatureActions=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_selectedfeatureactions",addActions:function(){for(var a=this.target.tools[this.featureManager],b=this.actions.length,c=Array(b),d=this,e=0;e<b;++e)c[e]=Ext.apply({iconCls:"process",disabled:!0,handler:function(){var b=a.featureLayer.selectedFeatures[0],c=new Ext.Template(this.urlTemplate),e=Ext.applyIf(this.outputConfig||{},d.initialConfig.outputConfig);d.outputConfig=Ext.apply(e,{title:this.menuText,bodyCfg:{tag:"iframe",
src:c.apply(Ext.applyIf({fid:b.fid.split(".").pop(),layer:a.layerRecord.get("name")},b.attributes)),style:{border:"0px none"}}});d.addOutput()}},this.actions[e]);a.featureLayer.events.on({featureselected:function(a){for(var a=1!=a.feature.layer.selectedFeatures.length,b=c.length-1;0<=b;--b)c[b].setDisabled(a)},featureunselected:function(a){if(0==a.feature.layer.selectedFeatures.length)for(a=c.length-1;0<=a;--a)c[a].disable()},scope:this});gxp.plugins.SelectedFeatureActions.superclass.addActions.apply(this,
[c])}});Ext.preg(gxp.plugins.SelectedFeatureActions.prototype.ptype,gxp.plugins.SelectedFeatureActions);Ext.namespace("gxp.plugins");
gxp.plugins.SnappingAgent=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_snappingagent",init:function(a){gxp.plugins.SnappingAgent.superclass.init.apply(this,arguments);this.snappingTargets=[];this.controls={};this.setSnappingTargets(this.targets)},setSnappingTargets:function(a){this.clearSnappingTargets();if(a)for(var b=0,c=a.length;b<c;++b)this.addSnappingTarget(a[b])},clearSnappingTargets:function(){for(var a,b=0,c=this.snappingTargets.length;b<c;++b)a=this.snappingTargets[b],a.layer&&a.layer.destroy();
this.snappingTargets.length=0},addSnappingTarget:function(a){var a=Ext.apply({},a),b=this.target.mapPanel.map,c=new OpenLayers.Layer.Vector(a.name,{strategies:[new OpenLayers.Strategy.BBOX({ratio:1.5,autoActivate:!1})],displayInLayerSwitcher:!1,visibility:!1,minResolution:a.minResolution,maxResolution:a.maxResolution});a.layer=c;this.snappingTargets.push(a);var d=new gxp.plugins.FeatureManager({maxFeatures:null,paging:!1,layer:{source:a.source,name:a.name},listeners:{layerchange:function(){c.protocol=
d.featureStore.proxy.protocol;b.addLayer(c);b.events.on({moveend:function(){this.updateSnappingTarget(a)},scope:this});this.updateSnappingTarget(a);this.target.on({featureedit:function(b,c){c.name==a.name&&c.source==a.source&&this.updateSnappingTarget(a,{force:!0})},scope:this})},scope:this}});d.init(this.target)},updateSnappingTarget:function(a,b){var c=a.minResolution||Number.NEGATIVE_INFINITY,d=a.maxResolution||Number.POSITIVE_INFINITY,e=this.target.mapPanel.map.getResolution();if(c<=e&&e<d)c=
a.layer.visibility,a.layer.visibility=!0,a.layer.strategies[0].update(b),a.layer.visibility=c},createSnappingControl:function(a){return new OpenLayers.Control.Snapping(Ext.applyIf({layer:a},this.initialConfig.controlOptions||this.initialConfig.options||{}))},registerEditor:function(a){var b=this.createSnappingControl(a.getFeatureManager().featureLayer);this.controls[a.id]=b;a.on({layereditable:this.onLayerEditable,featureeditable:this.onFeatureEditable,scope:this})},onLayerEditable:function(a,b,c){a=
this.controls[a.id];if(c){for(var c=[],d,e,f=b.get("source"),g=b.get("name"),h=0,j=this.snappingTargets.length;h<j;++h)if(b=this.snappingTargets[h],b.restrictedLayers){e=!1;for(var k=0,l=b.restrictedLayers.length;k<l;++k)if(d=b.restrictedLayers[k],d.source===f&&d.name===g){e=!0;break}e&&c.push(b)}else c.push(b);a.setTargets(c);a.activate()}else a.deactivate()},onFeatureEditable:function(a,b,c){for(var d=a.getFeatureManager().layerRecord,a=d.get("source"),d=d.get("name"),e,f,g,h=0,j=this.snappingTargets.length;h<
j;++h)if(e=this.snappingTargets[h],a===e.source&&d===e.name)f=this.targets[h].filter,!b||!b.fid||!c?e.filter=f:(g=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT,filters:[new OpenLayers.Filter.FeatureId({fids:[b.fid]})]}),e.filter=f?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[f,g]}):g)}});Ext.preg(gxp.plugins.SnappingAgent.prototype.ptype,gxp.plugins.SnappingAgent);Ext.namespace("gxp.plugins");
gxp.plugins.StamenSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_stamensource",title:"Stamen Design Layers",attribution:"Map tiles by <a href='http://stamen.com'>Stamen Design</a>, under <a href='http://creativecommons.org/licenses/by/3.0'>CC BY 3.0</a>. Data by <a href='http://openstreetmap.org'>OpenStreetMap</a>, under <a href='http://creativecommons.org/licenses/by-sa/3.0'>CC BY SA</a>.",tonerTitle:"Toner",tonerHybridTitle:"Toner Hybrid",tonerLabelsTitle:"Toner Labels",tonerLinesTitle:"Toner Lines",
tonerBackgroundTitle:"Toner Background",tonerLiteTitle:"Toner Lite",terrainTitle:"Terrain",terrainLabelsTitle:"Terrain Labels",terrainLinesTitle:"Terrain Lines",terrainBackgroundTitle:"Terrain Background",watercolorTitle:"Watercolor",createStore:function(){for(var a={projection:"EPSG:900913",numZoomLevels:20,attribution:this.attribution,buffer:0,transitionEffect:"resize",tileOptions:{crossOriginKeyword:null}},b=[{name:"toner",type:"png"},{name:"toner-hybrid",type:"png"},{name:"toner-labels",type:"png"},
{name:"toner-lines",type:"png"},{name:"toner-background",type:"png"},{name:"toner-lite",type:"png"},{name:"terrain",type:"png",numZoomLevels:15,maxResolution:9783.939619140625},{name:"terrain-labels",type:"png",numZoomLevels:15,maxResolution:9783.939619140625},{name:"terrain-lines",type:"png",numZoomLevels:15,maxResolution:9783.939619140625},{name:"terrain-background",type:"png",numZoomLevels:15,maxResolution:9783.939619140625},{name:"watercolor",type:"jpg"}],c=b.length,d=Array(c),e,f=0;f<c;++f)e=
b[f],d[f]=new OpenLayers.Layer.OSM(this[OpenLayers.String.camelize(e.name)+"Title"],[["http://tile.stamen.com/",e.name,"/${z}/${x}/${y}.",e.type].join(""),["http://a.tile.stamen.com/",e.name,"/${z}/${x}/${y}.",e.type].join(""),["http://b.tile.stamen.com/",e.name,"/${z}/${x}/${y}.",e.type].join(""),["http://c.tile.stamen.com/",e.name,"/${z}/${x}/${y}.",e.type].join(""),["http://d.tile.stamen.com/",e.name,"/${z}/${x}/${y}.",e.type].join("")],OpenLayers.Util.applyDefaults({layername:e.name,numZoomLevels:e.numZoomLevels,
maxResolution:e.maxResolution},a));this.store=new GeoExt.data.LayerStore({layers:d,fields:[{name:"source",type:"string"},{name:"name",type:"string",mapping:"layername"},{name:"abstract",type:"string",mapping:"attribution"},{name:"group",type:"string",defaultValue:"background"},{name:"fixed",type:"boolean",defaultValue:!0},{name:"selected",type:"boolean"}]});this.store.each(function(a){-1!=a.get("name").search(/labels|lines/i)&&a.set("group","")});this.fireEvent("ready",this)},createLayerRecord:function(a){var b,
c=this.store.findExact("name",a.name);if(-1<c){b=this.store.getAt(c).copy(Ext.data.Record.id({}));c=b.getLayer().clone();a.title&&(c.setName(a.title),b.set("title",a.title));if("visibility"in a)c.visibility=a.visibility;b.set("selected",a.selected||!1);b.set("source",a.source);b.set("name",a.name);"group"in a&&b.set("group",a.group);b.data.layer=c;b.commit()}return b}});Ext.preg(gxp.plugins.StamenSource.prototype.ptype,gxp.plugins.StamenSource);Ext.namespace("gxp");
gxp.RulePanel=Ext.extend(Ext.TabPanel,{fonts:void 0,symbolType:"Point",rule:null,attributes:null,nestedFilters:!0,minScaleDenominatorLimit:1.577757414193268E9*Math.pow(0.5,19)*OpenLayers.DOTS_PER_INCH/256,maxScaleDenominatorLimit:1.577757414193268E9*OpenLayers.DOTS_PER_INCH/256,scaleLevels:20,scaleSliderTemplate:"{scaleType} Scale 1:{scale}",modifyScaleTipContext:Ext.emptyFn,labelFeaturesText:"Label Features",labelsText:"Labels",basicText:"Basic",advancedText:"Advanced",limitByScaleText:"Limit by scale",
limitByConditionText:"Limit by condition",symbolText:"Symbol",nameText:"Name",initComponent:function(){Ext.applyIf(this,{plain:!0,border:!1});if(this.rule){if(!this.initialConfig.symbolType)this.symbolType=this.getSymbolTypeFromRule(this.rule)||this.symbolType}else this.rule=new OpenLayers.Rule({name:this.uniqueRuleName()});this.activeTab=0;this.textSymbolizer=new gxp.TextSymbolizer({symbolizer:this.getTextSymbolizer(),attributes:this.attributes,fonts:this.fonts,listeners:{change:function(){this.fireEvent("change",
this,this.rule)},scope:this}});this.scaleLimitPanel=new gxp.ScaleLimitPanel({maxScaleDenominator:this.rule.maxScaleDenominator||void 0,limitMaxScaleDenominator:!!this.rule.maxScaleDenominator,maxScaleDenominatorLimit:this.maxScaleDenominatorLimit,minScaleDenominator:this.rule.minScaleDenominator||void 0,limitMinScaleDenominator:!!this.rule.minScaleDenominator,minScaleDenominatorLimit:this.minScaleDenominatorLimit,scaleLevels:this.scaleLevels,scaleSliderTemplate:this.scaleSliderTemplate,modifyScaleTipContext:this.modifyScaleTipContext,
listeners:{change:function(a,b,c){this.rule.minScaleDenominator=b;this.rule.maxScaleDenominator=c;this.fireEvent("change",this,this.rule)},scope:this}});this.filterBuilder=new gxp.FilterBuilder({allowGroups:this.nestedFilters,filter:this.rule&&this.rule.filter&&this.rule.filter.clone(),attributes:this.attributes,listeners:{change:function(a){this.rule.filter=a.getFilter();this.fireEvent("change",this,this.rule)},scope:this}});this.items=[{title:this.labelsText,autoScroll:!0,bodyStyle:{padding:"10px"},
items:[{xtype:"fieldset",title:this.labelFeaturesText,autoHeight:!0,checkboxToggle:!0,collapsed:!this.hasTextSymbolizer(!0),items:[this.textSymbolizer],listeners:{collapse:function(){OpenLayers.Util.removeItem(this.rule.symbolizers,this.getTextSymbolizer());this.fireEvent("change",this,this.rule)},expand:function(){this.setTextSymbolizer(this.textSymbolizer.symbolizer);this.textSymbolizer.doLayout();this.fireEvent("change",this,this.rule)},scope:this}}]}];if(this.getSymbolTypeFromRule(this.rule)||
this.symbolType)this.items=[{title:this.basicText,autoScroll:!0,items:[this.createHeaderPanel(),this.createSymbolizerPanel()]},this.items[0],{title:this.advancedText,defaults:{style:{margin:"7px"}},autoScroll:!0,items:[{xtype:"fieldset",title:this.limitByScaleText,checkboxToggle:!0,collapsed:!(this.rule&&(this.rule.minScaleDenominator||this.rule.maxScaleDenominator)),autoHeight:!0,items:[this.scaleLimitPanel],listeners:{collapse:function(){delete this.rule.minScaleDenominator;delete this.rule.maxScaleDenominator;
this.fireEvent("change",this,this.rule)},expand:function(){var a=this.getActiveTab();this.activeTab=null;this.setActiveTab(a);a=!1;if(this.scaleLimitPanel.limitMinScaleDenominator)this.rule.minScaleDenominator=this.scaleLimitPanel.minScaleDenominator,a=!0;if(this.scaleLimitPanel.limitMaxScaleDenominator)this.rule.maxScaleDenominator=this.scaleLimitPanel.maxScaleDenominator,a=!0;a&&this.fireEvent("change",this,this.rule)},scope:this}},{xtype:"fieldset",title:this.limitByConditionText,checkboxToggle:!0,
collapsed:!(this.rule&&this.rule.filter),autoHeight:!0,items:[this.filterBuilder],listeners:{collapse:function(){delete this.rule.filter;this.fireEvent("change",this,this.rule)},expand:function(){this.rule.filter=this.filterBuilder.getFilter();this.fireEvent("change",this,this.rule)},scope:this}}]}];this.items[0].autoHeight=!0;this.addEvents("change");this.on({tabchange:function(a,b){b.doLayout()},scope:this});gxp.RulePanel.superclass.initComponent.call(this)},hasTextSymbolizer:function(a){for(var b,
c,d=0,e=this.rule.symbolizers.length;d<e;++d)if(b=this.rule.symbolizers[d],b instanceof OpenLayers.Symbolizer.Text&&(!0!==a||b.label)){c=b;break}return c},getTextSymbolizer:function(){var a=this.hasTextSymbolizer();a||(a=new OpenLayers.Symbolizer.Text({graphic:!1}));return a},setTextSymbolizer:function(a){for(var b,c=0,d=this.rule.symbolizers.length;c<d;++c)if(this.rule.symbolizers[c]instanceof OpenLayers.Symbolizer.Text){this.rule.symbolizers[c]=a;b=!0;break}b||this.rule.symbolizers.push(a)},uniqueRuleName:function(){return OpenLayers.Util.createUniqueID("rule_")},
createHeaderPanel:function(){this.symbolizerSwatch=new GeoExt.FeatureRenderer({symbolType:this.symbolType,isFormField:!0,fieldLabel:this.symbolText});return{xtype:"form",border:!1,labelAlign:"top",defaults:{border:!1},style:{padding:"0.3em 0 0 1em"},items:[{layout:"column",defaults:{border:!1,style:{"padding-right":"1em"}},items:[{layout:"form",width:150,items:[{xtype:"textfield",fieldLabel:this.nameText,anchor:"95%",value:this.rule&&(this.rule.title||this.rule.name||""),listeners:{change:function(a,
b){this.rule.title=b;this.fireEvent("change",this,this.rule)},scope:this}}]},{layout:"form",width:70,items:[this.symbolizerSwatch]}]}]}},createSymbolizerPanel:function(){var a,b,c=OpenLayers.Symbolizer[this.symbolType],d=!1;if(c){for(var e=0,f=this.rule.symbolizers.length;e<f;++e)if(a=this.rule.symbolizers[e],a instanceof c){d=!0;b=a;break}b||(b=new c({fill:!1,stroke:!1}))}else throw Error("Appropriate symbolizer type not included in build: "+this.symbolType);this.symbolizerSwatch.setSymbolizers([b],
{draw:this.symbolizerSwatch.rendered});a={xtype:"gxp_"+this.symbolType.toLowerCase()+"symbolizer",symbolizer:b,bodyStyle:{padding:"10px"},border:!1,labelWidth:70,defaults:{labelWidth:70},listeners:{change:function(a){this.symbolizerSwatch.setSymbolizers([a],{draw:this.symbolizerSwatch.rendered});d||(this.rule.symbolizers.push(a),d=!0);this.fireEvent("change",this,this.rule)},scope:this}};if("Point"===this.symbolType&&this.pointGraphics)a.pointGraphics=this.pointGraphics;return a},getSymbolTypeFromRule:function(a){for(var b,
c,d=0,e=a.symbolizers.length;d<e;++d)if(b=a.symbolizers[d],!(b instanceof OpenLayers.Symbolizer.Text)){c=b.CLASS_NAME.split(".").pop();break}return c}});Ext.reg("gxp_rulepanel",gxp.RulePanel);Ext.namespace("gxp");
gxp.StylePropertiesDialog=Ext.extend(Ext.Container,{titleText:"General",nameFieldText:"Name",titleFieldText:"Title",abstractFieldText:"Abstract",userStyle:null,initComponent:function(){Ext.applyIf(this,{layout:"form",items:[{xtype:"fieldset",title:this.titleText,labelWidth:75,defaults:{xtype:"textfield",anchor:"100%",listeners:{change:function(a,b){this.userStyle[a.name]=b;this.fireEvent("change",this,this.userStyle)},scope:this}},items:[{xtype:this.initialConfig.nameEditable?"textfield":"displayfield",
fieldLabel:this.nameFieldText,name:"name",value:this.userStyle.name,maskRe:/[A-Za-z0-9_]/},{fieldLabel:this.titleFieldText,name:"title",value:this.userStyle.title},{xtype:"textarea",fieldLabel:this.abstractFieldText,name:"description",value:this.userStyle.description}]}]});this.addEvents("change");gxp.StylePropertiesDialog.superclass.initComponent.apply(this,arguments)}});Ext.reg("gxp_stylepropertiesdialog",gxp.StylePropertiesDialog);Ext.namespace("gxp");
gxp.WMSStylesDialog=Ext.extend(Ext.Container,{addStyleText:"Add",addStyleTip:"Add a new style",chooseStyleText:"Choose style",deleteStyleText:"Remove",deleteStyleTip:"Delete the selected style",editStyleText:"Edit",editStyleTip:"Edit the selected style",duplicateStyleText:"Duplicate",duplicateStyleTip:"Duplicate the selected style",addRuleText:"Add",addRuleTip:"Add a new rule",newRuleText:"New Rule",deleteRuleText:"Remove",deleteRuleTip:"Delete the selected rule",editRuleText:"Edit",editRuleTip:"Edit the selected rule",
duplicateRuleText:"Duplicate",duplicateRuleTip:"Duplicate the selected rule",cancelText:"Cancel",saveText:"Save",styleWindowTitle:"User Style: {0}",ruleWindowTitle:"Style Rule: {0}",stylesFieldsetTitle:"Styles",rulesFieldsetTitle:"Rules",errorTitle:"Error saving style",errorMsg:"There was an error saving the style back to the server.",layerRecord:null,layerDescription:null,symbolType:null,stylesStore:null,selectedStyle:null,selectedRule:null,editable:!0,modified:!1,dialogCls:Ext.Window,initComponent:function(){this.addEvents("ready",
"modified","styleselected","beforesaved","saved");Ext.applyIf(this,{layout:"form",disabled:!0,items:[{xtype:"fieldset",title:this.stylesFieldsetTitle,labelWidth:85,style:"margin-bottom: 0;"},{xtype:"toolbar",style:"border-width: 0 1px 1px 1px; margin-bottom: 10px;",items:[{xtype:"button",iconCls:"add",text:this.addStyleText,tooltip:this.addStyleTip,handler:this.addStyle,scope:this},{xtype:"button",iconCls:"delete",text:this.deleteStyleText,tooltip:this.deleteStyleTip,handler:function(){this.stylesStore.remove(this.selectedStyle)},
scope:this},{xtype:"button",iconCls:"edit",text:this.editStyleText,tooltip:this.editStyleTip,handler:function(){this.editStyle()},scope:this},{xtype:"button",iconCls:"duplicate",text:this.duplicateStyleText,tooltip:this.duplicateStyleTip,handler:function(){var a=this.selectedStyle,b=a.get("userStyle").clone();b.isDefault=!1;b.name=this.newStyleName();var c=this.stylesStore;c.add(new c.recordType({name:b.name,title:b.title,"abstract":b.description,userStyle:b}));this.editStyle(a)},scope:this}]}]});
this.createStylesStore();this.on({beforesaved:function(){this._saving=!0},saved:function(){delete this._saving},savefailed:function(){Ext.Msg.show({title:this.errorTitle,msg:this.errorMsg,icon:Ext.MessageBox.ERROR,buttons:{ok:!0}});delete this._saving},render:function(){gxp.util.dispatch([this.getStyles],function(){this.enable()},this)},scope:this});gxp.WMSStylesDialog.superclass.initComponent.apply(this,arguments)},addStyle:function(){if(this._ready){var a=this.selectedStyle,b=this.stylesStore,c=
new OpenLayers.Style(null,{name:this.newStyleName(),rules:[this.createRule()]});b.add(new b.recordType({name:c.name,userStyle:c}));this.editStyle(a)}else this.on("ready",this.addStyle,this)},editStyle:function(a){var b=this.selectedStyle.get("userStyle"),c=new this.dialogCls(Ext.apply({bbar:["->",{text:this.cancelText,iconCls:"cancel",handler:function(){c.propertiesDialog.userStyle=b;c.destroy();if(a)this._cancelling=!0,this.stylesStore.remove(this.selectedStyle),this.changeStyle(a,{updateCombo:!0,
markModified:!0}),delete this._cancelling},scope:this},{text:this.saveText,iconCls:"save",handler:function(){c.destroy()}}]},{title:String.format(this.styleWindowTitle,b.title||b.name),shortTitle:b.title||b.name,bodyBorder:!1,autoHeight:!0,width:300,modal:!0,items:{border:!1,items:{xtype:"gxp_stylepropertiesdialog",ref:"../propertiesDialog",userStyle:b.clone(),nameEditable:!1,style:"padding: 10px;"}},listeners:{beforedestroy:function(){this.selectedStyle.set("userStyle",c.propertiesDialog.userStyle)},
scope:this}}));this.showDlg(c)},createSLD:function(a){var a=a||{},b={version:"1.0.0",namedLayers:{}},c=this.layerRecord.get("name");b.namedLayers[c]={name:c,userStyles:[]};this.stylesStore.each(function(d){(!a.userStyles||-1!==a.userStyles.indexOf(d.get("name")))&&b.namedLayers[c].userStyles.push(d.get("userStyle"))});return(new OpenLayers.Format.SLD({multipleSymbolizers:!0,profile:"GeoServer"})).write(b)},saveStyles:function(a){!0===this.modified&&this.fireEvent("beforesaved",this,a)},updateStyleRemoveButton:function(){var a=
this.selectedStyle&&this.selectedStyle.get("userStyle");this.items.get(1).items.get(1).setDisabled(!a||1>=this.stylesStore.getCount()||!0===a.isDefault)},updateRuleRemoveButton:function(){this.items.get(3).items.get(1).setDisabled(!this.selectedRule||2>this.items.get(2).items.get(0).rules.length)},createRule:function(){return new OpenLayers.Rule({symbolizers:[new OpenLayers.Symbolizer[this.symbolType]]})},addRulesFieldSet:function(){var a=new Ext.form.FieldSet({itemId:"rulesfieldset",title:this.rulesFieldsetTitle,
autoScroll:!0,style:"margin-bottom: 0;",hideMode:"offsets",hidden:!0}),b=new Ext.Toolbar({style:"border-width: 0 1px 1px 1px;",hidden:!0,items:[{xtype:"button",iconCls:"add",text:this.addRuleText,tooltip:this.addRuleTip,handler:this.addRule,scope:this},{xtype:"button",iconCls:"delete",text:this.deleteRuleText,tooltip:this.deleteRuleTip,handler:this.removeRule,scope:this,disabled:!0},{xtype:"button",iconCls:"edit",text:this.editRuleText,toolitp:this.editRuleTip,handler:function(){this.layerDescription?
this.editRule():this.describeLayer(this.editRule)},scope:this,disabled:!0},{xtype:"button",iconCls:"duplicate",text:this.duplicateRuleText,tip:this.duplicateRuleTip,handler:this.duplicateRule,scope:this,disabled:!0}]});this.add(a,b);this.doLayout();return a},addRule:function(){var a=this.items.get(2).items.get(0);this.selectedStyle.get("userStyle").rules.push(this.createRule());a.update();this.selectedStyle.store.afterEdit(this.selectedStyle);this.updateRuleRemoveButton()},removeRule:function(){var a=
this.selectedRule;this.items.get(2).items.get(0).unselect();this.selectedStyle.get("userStyle").rules.remove(a);this.afterRuleChange()},duplicateRule:function(){var a=this.items.get(2).items.get(0),b=this.selectedRule.clone();this.selectedStyle.get("userStyle").rules.push(b);a.update();this.selectedStyle.store.afterEdit(this.selectedStyle);this.updateRuleRemoveButton()},editRule:function(){var a=this.selectedRule,b=a.clone(),c=new this.dialogCls({title:String.format(this.ruleWindowTitle,a.title||
a.name||this.newRuleText),shortTitle:a.title||a.name||this.newRuleText,layout:"fit",width:320,height:450,modal:!0,items:[{xtype:"gxp_rulepanel",ref:"rulePanel",symbolType:this.symbolType,rule:a,attributes:new GeoExt.data.AttributeStore({url:this.layerDescription.owsURL,baseParams:{SERVICE:this.layerDescription.owsType,REQUEST:"DescribeFeatureType",TYPENAME:this.layerDescription.typeName},method:"GET",disableCaching:!1}),autoScroll:!0,border:!1,defaults:{autoHeight:!0,hideMode:"offsets"},listeners:{change:this.saveRule,
tabchange:function(){c instanceof Ext.Window&&c.syncShadow()},scope:this}}],bbar:["->",{text:this.cancelText,iconCls:"cancel",handler:function(){this.saveRule(c.rulePanel,b);c.destroy()},scope:this},{text:this.saveText,iconCls:"save",handler:function(){c.destroy()}}]});this.showDlg(c)},saveRule:function(a,b){var c=this.selectedStyle;this.items.get(2).items.get(0);var c=c.get("userStyle"),d=c.rules.indexOf(this.selectedRule);c.rules[d]=b;this.afterRuleChange(b)},afterRuleChange:function(a){this.items.get(2).items.get(0);
this.selectedRule=a;this.selectedStyle.store.afterEdit(this.selectedStyle)},setRulesFieldSetVisible:function(a){this.items.get(3).setVisible(a&&this.editable);this.items.get(2).setVisible(a);this.doLayout()},parseSLD:function(a){var b=a.responseXML;if(!b||!b.documentElement)b=(new OpenLayers.Format.XML).read(a.responseText);var a=this.layerRecord.getLayer().params,c=this.initialConfig.styleName||a.STYLES;if(c)this.selectedStyle=this.stylesStore.getAt(this.stylesStore.findExact("name",c));var d=new OpenLayers.Format.SLD({profile:"GeoServer",
multipleSymbolizers:!0});try{var e=d.read(b).namedLayers[a.LAYERS].userStyles,f;if(a.SLD_BODY)f=d.read(a.SLD_BODY).namedLayers[a.LAYERS].userStyles,Array.prototype.push.apply(e,f);this.stylesStore.removeAll();this.selectedStyle=null;for(var g,h,j,k,b=0,l=e.length;b<l;++b){g=e[b];j=this.stylesStore.findExact("name",g.name);-1!==j&&this.stylesStore.removeAt(j);h=new this.stylesStore.recordType({name:g.name,title:g.title,"abstract":g.description,userStyle:g});h.phantom=!1;this.stylesStore.add(h);if(!this.selectedStyle&&
(c===g.name||!c&&!0===g.isDefault))this.selectedStyle=h;!0===g.isDefault&&(k=h)}if(!this.selectedStyle)this.selectedStyle=k;this.addRulesFieldSet();this.createLegend(this.selectedStyle.get("userStyle").rules);this.stylesStoreReady();a.SLD_BODY&&this.markModified()}catch(n){window.console&&console.warn(n.message),this.setupNonEditable()}},createLegend:function(a){var b=OpenLayers.Symbolizer.Raster;if(b&&a[0]&&a[0].symbolizers[0]instanceof b)throw Error("Raster symbolizers are not supported.");this.addVectorLegend(a)},
setupNonEditable:function(){this.editable=!1;this.items.get(1).hide();(this.getComponent("rulesfieldset")||this.addRulesFieldSet()).add(this.createLegendImage());this.doLayout();this.items.get(3).hide();this.stylesStoreReady()},stylesStoreReady:function(){this.stylesStore.commitChanges();this.stylesStore.on({load:function(){this.addStylesCombo();this.updateStyleRemoveButton()},add:function(a,b,c){this.updateStyleRemoveButton();b=this.items.get(0).items.get(0);this.markModified();b.fireEvent("select",
b,a.getAt(c),c);b.setValue(this.selectedStyle.get("name"))},remove:function(a,b,c){if(!this._cancelling)this._removing=!0,b=Math.min(c,a.getCount()-1),this.updateStyleRemoveButton(),c=this.items.get(0).items.get(0),this.markModified(),c.fireEvent("select",c,a.getAt(b),b),c.setValue(this.selectedStyle.get("name")),delete this._removing},update:function(a,b){var c=b.get("userStyle");Ext.apply(b.data,{name:c.name,title:c.title||c.name,"abstract":c.description});this.changeStyle(b,{updateCombo:!0,markModified:!0})},
scope:this});this.stylesStore.fireEvent("load",this.stylesStore,this.stylesStore.getRange());this._ready=!0;this.fireEvent("ready")},markModified:function(){if(!1===this.modified)this.modified=!0;this._saving||this.fireEvent("modified",this,this.selectedStyle.get("name"))},createStylesStore:function(){var a=this.layerRecord.get("styles")||[];this.stylesStore=new Ext.data.JsonStore({data:{styles:a},idProperty:"name",root:"styles",fields:["name","title","abstract","legend","userStyle"],listeners:{add:function(a,
c){for(var d,e=c.length-1;0<=e;--e)d=c[e],a.suspendEvents(),d.get("title")||d.set("title",d.get("name")),a.resumeEvents()}}})},getStyles:function(a){var b=this.layerRecord.getLayer();if(!0===this.editable){var c=b.params.VERSION;1.1<parseFloat(c)&&(c="1.1.1");Ext.Ajax.request({url:b.url,params:{SERVICE:"WMS",VERSION:c,REQUEST:"GetStyles",LAYERS:""+b.params.LAYERS},method:"GET",disableCaching:!1,success:this.parseSLD,failure:this.setupNonEditable,callback:a,scope:this})}else this.setupNonEditable()},
describeLayer:function(a){if(this.layerDescription)window.setTimeout(function(){a.call(this)},0);else{var b=this.layerRecord.getLayer(),c=b.params.VERSION;1.1<parseFloat(c)&&(c="1.1.1");Ext.Ajax.request({url:b.url,params:{SERVICE:"WMS",VERSION:c,REQUEST:"DescribeLayer",LAYERS:""+b.params.LAYERS},method:"GET",disableCaching:!1,success:function(a){this.layerDescription=(new OpenLayers.Format.WMSDescribeLayer).read(a.responseXML&&a.responseXML.documentElement?a.responseXML:a.responseText)[0]},callback:a,
scope:this})}},addStylesCombo:function(){var a=this.stylesStore,a=new Ext.form.ComboBox(Ext.apply({fieldLabel:this.chooseStyleText,store:a,editable:!1,displayField:"title",valueField:"name",value:this.selectedStyle?this.selectedStyle.get("title"):this.layerRecord.getLayer().params.STYLES||"default",disabled:!a.getCount(),mode:"local",typeAhead:!0,triggerAction:"all",forceSelection:!0,anchor:"100%",listeners:{select:function(a,c){this.changeStyle(c);!c.phantom&&!this._removing&&this.fireEvent("styleselected",
this,c.get("name"))},scope:this}},this.initialConfig.stylesComboOptions));this.items.get(0).add(a);this.doLayout()},createLegendImage:function(){var a=new GeoExt.WMSLegend({showTitle:!1,layerRecord:this.layerRecord,autoScroll:!0,defaults:{listeners:{render:function(b){b.getEl().on({load:function(c,d){d.getAttribute("src")!=b.defaultImgSrc&&(this.setRulesFieldSetVisible(!0),250<b.getEl().getHeight()&&a.setHeight(250))},error:function(){this.setRulesFieldSetVisible(!1)},scope:this})},scope:this}}});
return a},changeStyle:function(a,b){var b=b||{},c=this.items.get(2).items.get(0);this.selectedStyle=a;this.updateStyleRemoveButton();a.get("name");if(!0===this.editable){var d=a.get("userStyle"),e=c.rules.indexOf(this.selectedRule);c.ownerCt.remove(c);this.createLegend(d.rules,{selectedRuleIndex:e})}!0===b.updateCombo&&(this.items.get(0).items.get(0).setValue(d.name),!0===b.markModified&&this.markModified())},addVectorLegend:function(a,b){b=Ext.applyIf(b||{},{enableDD:!0});this.symbolType=b.symbolType;
if(!this.symbolType){var c=["Point","Line","Polygon"];highest=0;for(var d=a[0].symbolizers,e,f=d.length-1;0<=f;f--)e=d[f].CLASS_NAME.split(".").pop(),highest=Math.max(highest,c.indexOf(e));this.symbolType=c[highest]}var g=this.items.get(2).add({xtype:"gx_vectorlegend",showTitle:!1,height:10<a.length?250:void 0,autoScroll:10<a.length,rules:a,symbolType:this.symbolType,selectOnClick:!0,enableDD:b.enableDD,listeners:{ruleselected:function(a,b){this.selectedRule=b;var c=this.items.get(3).items;this.updateRuleRemoveButton();
c.get(2).enable();c.get(3).enable()},ruleunselected:function(){this.selectedRule=null;var a=this.items.get(3).items;a.get(1).disable();a.get(2).disable();a.get(3).disable()},rulemoved:function(){this.markModified()},afterlayout:function(){null!==this.selectedRule&&null===g.selectedRule&&-1!==g.rules.indexOf(this.selectedRule)&&g.selectRuleEntry(this.selectedRule)},scope:this}});this.setRulesFieldSetVisible(!0);return g},newStyleName:function(){var a=this.layerRecord.get("name");return a.split(":").pop()+
"_"+gxp.util.md5(a+new Date+Math.random()).substr(0,8)},showDlg:function(a){a.show()}});
gxp.WMSStylesDialog.createGeoServerStylerConfig=function(a,b){var c=a.getLayer();b||(b=a.get("restUrl"));b||(b=c.url.split("?").shift().replace(/\/(wms|ows)\/?$/,"/rest"));return{xtype:"gxp_wmsstylesdialog",layerRecord:a,plugins:[{ptype:"gxp_geoserverstylewriter",baseUrl:b}],listeners:{styleselected:function(a,b){c.mergeNewParams({styles:b})},modified:function(a){a.saveStyles()},saved:function(a,b){c.mergeNewParams({_olSalt:Math.random(),styles:b})},scope:this}}};
OpenLayers.Renderer.defaultSymbolizerGXP={fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square",fontColor:"#000000",fontSize:10,haloColor:"#FFFFFF",haloOpacity:1,haloRadius:1,labelAlign:"cm"};Ext.reg("gxp_wmsstylesdialog",gxp.WMSStylesDialog);Ext.namespace("gxp");
gxp.StylesDialog=Ext.extend(Ext.Container,{addStyleText:"Add",addStyleTip:"Add a new style",chooseStyleText:"Choose style",deleteStyleText:"Remove",deleteStyleTip:"Delete the selected style",editStyleText:"Edit",editStyleTip:"Edit the selected style",duplicateStyleText:"Duplicate",duplicateStyleTip:"Duplicate the selected style",addRuleText:"Add",addRuleTip:"Add a new rule",newRuleText:"New Rule",deleteRuleText:"Remove",deleteRuleTip:"Delete the selected rule",editRuleText:"Edit",editRuleTip:"Edit the selected rule",
duplicateRuleText:"Duplicate",duplicateRuleTip:"Duplicate the selected rule",cancelText:"Cancel",saveText:"Save",styleWindowTitle:"User Style: {0}",ruleWindowTitle:"Style Rule: {0}",stylesFieldsetTitle:"Styles",rulesFieldsetTitle:"Rules",errorTitle:"Error saving style",errorMsg:"There was an error saving the style back to the server.",layerRecord:null,layerDescription:null,symbolType:null,stylesStore:null,selectedStyle:null,selectedRule:null,editable:!0,modified:!1,dialogCls:Ext.Window,initComponent:function(){this.addEvents("ready",
"modified","styleselected","beforesaved","saved");Ext.applyIf(this,{layout:"form",disabled:!0,items:[{xtype:"fieldset",title:this.stylesFieldsetTitle,labelWidth:85,style:"margin-bottom: 0;"},{xtype:"toolbar",style:"border-width: 0 1px 1px 1px; margin-bottom: 10px;",items:[{xtype:"button",iconCls:"add",text:this.addStyleText,tooltip:this.addStyleTip,handler:this.addStyle,scope:this},{xtype:"button",iconCls:"delete",text:this.deleteStyleText,tooltip:this.deleteStyleTip,handler:function(){this.stylesStore.remove(this.selectedStyle)},
scope:this},{xtype:"button",iconCls:"edit",text:this.editStyleText,tooltip:this.editStyleTip,handler:function(){this.editStyle()},scope:this},{xtype:"button",iconCls:"duplicate",text:this.duplicateStyleText,tooltip:this.duplicateStyleTip,handler:function(){var a=this.selectedStyle,b=a.get("userStyle").clone();b.isDefault=!1;b.name=this.newStyleName();var c=this.stylesStore;c.add(new c.recordType({name:b.name,title:b.title,"abstract":b.description,userStyle:b}));this.editStyle(a)},scope:this}]}]});
this.createStylesStore();this.on({beforesaved:function(){this._saving=!0},saved:function(){delete this._saving},savefailed:function(){Ext.Msg.show({title:this.errorTitle,msg:this.errorMsg,icon:Ext.MessageBox.ERROR,buttons:{ok:!0}});delete this._saving},render:function(){gxp.util.dispatch([this.getStyles],function(){this.enable()},this)},scope:this});gxp.StylesDialog.superclass.initComponent.apply(this,arguments)},addStyle:function(){if(this._ready){var a=this.selectedStyle,b=this.stylesStore,c=new OpenLayers.Style(null,
{name:this.newStyleName(),rules:[this.createRule()]});b.add(new b.recordType({name:c.name,userStyle:c}));this.editStyle(a)}else this.on("ready",this.addStyle,this)},editStyle:function(a){var b=this.selectedStyle.get("userStyle"),c=new this.dialogCls(Ext.apply({bbar:["->",{text:this.cancelText,iconCls:"cancel",handler:function(){c.propertiesDialog.userStyle=b;c.destroy();if(a)this._cancelling=!0,this.stylesStore.remove(this.selectedStyle),this.changeStyle(a,{updateCombo:!0,markModified:!0}),delete this._cancelling},
scope:this},{text:this.saveText,iconCls:"save",handler:function(){c.destroy()}}]},{title:String.format(this.styleWindowTitle,b.title||b.name),shortTitle:b.title||b.name,bodyBorder:!1,autoHeight:!0,width:300,modal:!0,items:{border:!1,items:{xtype:"gxp_stylepropertiesdialog",ref:"../propertiesDialog",userStyle:b.clone(),nameEditable:!1,style:"padding: 10px;"}},listeners:{beforedestroy:function(){this.selectedStyle.set("userStyle",c.propertiesDialog.userStyle)},scope:this}}));this.showDlg(c)},createSLD:function(a){var a=
a||{},b={version:"1.0.0",namedLayers:{}},c=this.layerRecord.get("name");b.namedLayers[c]={name:c,userStyles:[]};this.stylesStore.each(function(d){(!a.userStyles||-1!==a.userStyles.indexOf(d.get("name")))&&b.namedLayers[c].userStyles.push(d.get("userStyle"))});return(new OpenLayers.Format.SLD({multipleSymbolizers:!0,profile:"GeoServer"})).write(b)},saveStyles:function(a){!0===this.modified&&this.fireEvent("beforesaved",this,a)},updateStyleRemoveButton:function(){var a=this.selectedStyle&&this.selectedStyle.get("userStyle");
this.items.get(1).items.get(1).setDisabled(!a||1>=this.stylesStore.getCount()||!0===a.isDefault)},updateRuleRemoveButton:function(){this.items.get(3).items.get(1).setDisabled(!this.selectedRule||2>this.items.get(2).items.get(0).rules.length)},createRule:function(){return new OpenLayers.Rule({symbolizers:[new OpenLayers.Symbolizer[this.symbolType]]})},addRulesFieldSet:function(){var a=new Ext.form.FieldSet({itemId:"rulesfieldset",title:this.rulesFieldsetTitle,autoScroll:!0,style:"margin-bottom: 0;",
hideMode:"offsets",hidden:!0}),b=new Ext.Toolbar({style:"border-width: 0 1px 1px 1px;",hidden:!0,items:[{xtype:"button",iconCls:"add",text:this.addRuleText,tooltip:this.addRuleTip,handler:this.addRule,scope:this},{xtype:"button",iconCls:"delete",text:this.deleteRuleText,tooltip:this.deleteRuleTip,handler:this.removeRule,scope:this,disabled:!0},{xtype:"button",iconCls:"edit",text:this.editRuleText,toolitp:this.editRuleTip,handler:function(){this.layerDescription?this.editRule():this.describeLayer(this.editRule)},
scope:this,disabled:!0},{xtype:"button",iconCls:"duplicate",text:this.duplicateRuleText,tip:this.duplicateRuleTip,handler:this.duplicateRule,scope:this,disabled:!0}]});this.add(a,b);this.doLayout();return a},addRule:function(){var a=this.items.get(2).items.get(0);this.selectedStyle.get("userStyle").rules.push(this.createRule());a.update();this.selectedStyle.store.afterEdit(this.selectedStyle);this.updateRuleRemoveButton()},removeRule:function(){var a=this.selectedRule;this.items.get(2).items.get(0).unselect();
this.selectedStyle.get("userStyle").rules.remove(a);this.afterRuleChange()},duplicateRule:function(){var a=this.items.get(2).items.get(0),b=this.selectedRule.clone();this.selectedStyle.get("userStyle").rules.push(b);a.update();this.selectedStyle.store.afterEdit(this.selectedStyle);this.updateRuleRemoveButton()},editRule:function(){var a=this.selectedRule,b=a.clone(),c=new this.dialogCls({title:String.format(this.ruleWindowTitle,a.title||a.name||this.newRuleText),shortTitle:a.title||a.name||this.newRuleText,
layout:"fit",width:320,height:450,modal:!0,items:[{xtype:"gxp_rulepanel",ref:"rulePanel",symbolType:this.symbolType,rule:a,attributes:new GeoExt.data.AttributeStore({url:this.layerDescription.owsURL,baseParams:{SERVICE:this.layerDescription.owsType,REQUEST:"DescribeFeatureType",TYPENAME:this.layerDescription.typeName},method:"GET",disableCaching:!1}),autoScroll:!0,border:!1,defaults:{autoHeight:!0,hideMode:"offsets"},listeners:{change:this.saveRule,tabchange:function(){c instanceof Ext.Window&&c.syncShadow()},
scope:this}}],bbar:["->",{text:this.cancelText,iconCls:"cancel",handler:function(){this.saveRule(c.rulePanel,b);c.destroy()},scope:this},{text:this.saveText,iconCls:"save",handler:function(){c.destroy()}}]});this.showDlg(c)},saveRule:function(a,b){var c=this.selectedStyle;this.items.get(2).items.get(0);var c=c.get("userStyle"),d=c.rules.indexOf(this.selectedRule);c.rules[d]=b;this.afterRuleChange(b)},afterRuleChange:function(a){this.items.get(2).items.get(0);this.selectedRule=a;this.selectedStyle.store.afterEdit(this.selectedStyle)},
setRulesFieldSetVisible:function(a){this.items.get(3).setVisible(a&&this.editable);this.items.get(2).setVisible(a);this.doLayout()},parseSLD:function(a){var b=a.responseXML;if(!b||!b.documentElement)b=(new OpenLayers.Format.XML).read(a.responseText);var a=this.layerRecord.getLayer().params,c=this.initialConfig.styleName||a.STYLES;if(c)this.selectedStyle=this.stylesStore.getAt(this.stylesStore.findExact("name",c));var d=new OpenLayers.Format.SLD({profile:"GeoServer",multipleSymbolizers:!0});try{var e=
d.read(b).namedLayers[a.LAYERS].userStyles,f;if(a.SLD_BODY)f=d.read(a.SLD_BODY).namedLayers[a.LAYERS].userStyles,Array.prototype.push.apply(e,f);this.stylesStore.removeAll();this.selectedStyle=null;for(var g,h,j,k,b=0,l=e.length;b<l;++b){g=e[b];j=this.stylesStore.findExact("name",g.name);-1!==j&&this.stylesStore.removeAt(j);h=new this.stylesStore.recordType({name:g.name,title:g.title,"abstract":g.description,userStyle:g});h.phantom=!1;this.stylesStore.add(h);if(!this.selectedStyle&&(c===g.name||!c&&
!0===g.isDefault))this.selectedStyle=h;!0===g.isDefault&&(k=h)}if(!this.selectedStyle)this.selectedStyle=k;this.addRulesFieldSet();this.createLegend(this.selectedStyle.get("userStyle").rules);this.stylesStoreReady();a.SLD_BODY&&this.markModified()}catch(n){window.console&&console.warn(n.msg),this.setupNonEditable()}},createLegend:function(a){var b=OpenLayers.Symbolizer.Raster;if(b&&a[0]&&a[0].symbolizers[0]instanceof b)throw Error("Raster symbolizers are not supported.");this.addVectorLegend(a)},
setupNonEditable:function(){this.editable=!1;this.items.get(1).hide();(this.getComponent("rulesfieldset")||this.addRulesFieldSet()).add(this.createLegendImage());this.doLayout();this.items.get(3).hide();this.stylesStoreReady()},stylesStoreReady:function(){this.stylesStore.commitChanges();this.stylesStore.on({load:function(){this.addStylesCombo();this.updateStyleRemoveButton()},add:function(a,b,c){this.updateStyleRemoveButton();b=this.items.get(0).items.get(0);this.markModified();b.fireEvent("select",
b,a.getAt(c),c);b.setValue(this.selectedStyle.get("name"))},remove:function(a,b,c){if(!this._cancelling)this._removing=!0,b=Math.min(c,a.getCount()-1),this.updateStyleRemoveButton(),c=this.items.get(0).items.get(0),this.markModified(),c.fireEvent("select",c,a.getAt(b),b),c.setValue(this.selectedStyle.get("name")),delete this._removing},update:function(a,b){var c=b.get("userStyle");Ext.apply(b.data,{name:c.name,title:c.title||c.name,"abstract":c.description});this.changeStyle(b,{updateCombo:!0,markModified:!0})},
scope:this});this.stylesStore.fireEvent("load",this.stylesStore,this.stylesStore.getRange());this._ready=!0;this.fireEvent("ready")},markModified:function(){if(!1===this.modified)this.modified=!0;this._saving||this.fireEvent("modified",this,this.selectedStyle.get("name"))},createStylesStore:function(){var a=this.layerRecord.get("styles")||[];this.stylesStore=new Ext.data.JsonStore({data:{styles:a},idProperty:"name",root:"styles",fields:["name","title","abstract","legend","userStyle"],listeners:{add:function(a,
c){for(var d,e=c.length-1;0<=e;--e)d=c[e],a.suspendEvents(),d.get("title")||d.set("title",d.get("name")),a.resumeEvents()}}})},getStyles:function(a){var b=this.layerRecord.getLayer();if(!0===this.editable){var c=b.params.VERSION;1.1<parseFloat(c)&&(c="1.1.1");Ext.Ajax.request({url:b.url,params:{SERVICE:"WMS",VERSION:c,REQUEST:"GetStyles",LAYERS:""+b.params.LAYERS},method:"GET",disableCaching:!1,success:this.parseSLD,failure:this.setupNonEditable,callback:a,scope:this})}else this.setupNonEditable()},
describeLayer:function(){},addStylesCombo:function(){var a=this.stylesStore,a=new Ext.form.ComboBox(Ext.apply({fieldLabel:this.chooseStyleText,store:a,editable:!1,displayField:"title",valueField:"name",value:this.selectedStyle?this.selectedStyle.get("title"):this.layerRecord.getLayer().params.STYLES||"default",disabled:!a.getCount(),mode:"local",typeAhead:!0,triggerAction:"all",forceSelection:!0,anchor:"100%",listeners:{select:function(a,c){this.changeStyle(c);!c.phantom&&!this._removing&&this.fireEvent("styleselected",
this,c.get("name"))},scope:this}},this.initialConfig.stylesComboOptions));this.items.get(0).add(a);this.doLayout()},createLegendImage:function(){var a=new GeoExt.WMSLegend({showTitle:!1,layerRecord:this.layerRecord,autoScroll:!0,defaults:{listeners:{render:function(b){b.getEl().on({load:function(c,d){d.getAttribute("src")!=b.defaultImgSrc&&(this.setRulesFieldSetVisible(!0),250<b.getEl().getHeight()&&a.setHeight(250))},error:function(){this.setRulesFieldSetVisible(!1)},scope:this})},scope:this}}});
return a},changeStyle:function(a,b){var b=b||{},c=this.items.get(2).items.get(0);this.selectedStyle=a;this.updateStyleRemoveButton();a.get("name");if(!0===this.editable){var d=a.get("userStyle"),e=c.rules.indexOf(this.selectedRule);c.ownerCt.remove(c);this.createLegend(d.rules,{selectedRuleIndex:e})}!0===b.updateCombo&&(this.items.get(0).items.get(0).setValue(d.name),!0===b.markModified&&this.markModified())},addVectorLegend:function(a,b){b=Ext.applyIf(b||{},{enableDD:!0});this.symbolType=b.symbolType;
if(!this.symbolType){for(var c=["Point","Line","Polygon"],d=0,e=a[0].symbolizers,f,g=e.length-1;0<=g;g--)f=e[g].CLASS_NAME.split(".").pop(),d=Math.max(d,c.indexOf(f));this.symbolType=c[d]}var h=this.items.get(2).add({xtype:"gx_vectorlegend",showTitle:!1,height:10<a.length?250:void 0,autoScroll:10<a.length,rules:a,symbolType:this.symbolType,selectOnClick:!0,enableDD:b.enableDD,listeners:{ruleselected:function(a,b){this.onRuleSelected(a,b)},ruleunselected:function(a,b){this.onRuleUnselected(a,b)},rulemoved:function(){this.markModified()},
afterlayout:function(){null!==this.selectedRule&&null===h.selectedRule&&-1!==h.rules.indexOf(this.selectedRule)&&h.selectRuleEntry(this.selectedRule)},scope:this}});this.setRulesFieldSetVisible(!0);return h},newStyleName:function(){var a=this.layerRecord.get("name");return a.split(":").pop()+"_"+gxp.util.md5(a+new Date+Math.random()).substr(0,8)},onRuleSelected:function(a,b){this.selectedRule=b;var c=this.items.get(3).items;this.updateRuleRemoveButton();c.get(2).enable();c.get(3).enable()},onRuleUnselected:function(){this.selectedRule=
null;var a=this.items.get(3).items;a.get(1).disable();a.get(2).disable();a.get(3).disable()},showDlg:function(a){a.show()}});
gxp.StylesDialog.createGeoServerStylerConfig=function(a,b){var c=a.getLayer();b||(b=a.get("restUrl"));b||(b=c.url.split("?").shift().replace(/\/(wms|ows)\/?$/,"/rest"));return{xtype:"gxp_stylesdialog",layerRecord:a,plugins:[{ptype:"gxp_geoserverstylewriter",baseUrl:b}],listeners:{styleselected:function(a,b){c.mergeNewParams({styles:b})},modified:function(a){a.saveStyles()},saved:function(a,b){c.mergeNewParams({_olSalt:Math.random(),styles:b})},scope:this}}};
OpenLayers.Renderer.defaultSymbolizerGXP={fillColor:"#808080",fillOpacity:1,strokeColor:"#000000",strokeOpacity:1,strokeWidth:1,strokeDashstyle:"solid",pointRadius:3,graphicName:"square",fontColor:"#000000",fontSize:10,haloColor:"#FFFFFF",haloOpacity:1,haloRadius:1,labelAlign:"cm"};Ext.reg("gxp_stylesdialog",gxp.StylesDialog);Ext.namespace("gxp");
gxp.VectorStylesDialog=Ext.extend(gxp.StylesDialog,{attributeStore:null,initComponent:function(){gxp.VectorStylesDialog.superclass.initComponent.apply(this,arguments);this.initialConfig.styleName="default";this.items.get(1).setDisabled(!0);this.on({styleselected:function(a,b){var c=this.stylesStore.findExact("name",b.name);if(-1!==c)this.selectedStyle=this.stylesStore.getAt(c)},modified:function(a){a.saveStyles()},beforesaved:function(){this._saving=!0},saved:function(){delete this._saving},savefailed:function(){Ext.Msg.show({title:this.errorTitle,
msg:this.errorMsg,icon:Ext.MessageBox.ERROR,buttons:{ok:!0}});delete this._saving},render:function(){gxp.util.dispatch([this.getStyles],function(){this.enable()},this)},scope:this})},addRulesFieldSet:function(){var a=gxp.VectorStylesDialog.superclass.addRulesFieldSet.apply(this,arguments);this.items.get(3).get(0).disable();return a},disableConditional:function(a){var b=this.layerRecord.getLayer();a&&b.customStyling&&a.disable()},onRuleSelected:function(a,b){gxp.VectorStylesDialog.superclass.onRuleSelected.call(this,
a,b);this.disableConditional(this.items.get(3).items.get(3))},editRule:function(){var a=this.selectedRule;if(!this.textSym&&this.attributeStore&&0<this.attributeStore.data.getCount())a.symbolizers.push(this.createSymbolizer("Text",{})),this.textSym=!0;var b=a.clone(),c=new this.dialogCls({title:String.format(this.ruleWindowTitle,a.title||a.name||this.newRuleText),shortTitle:a.title||a.name||this.newRuleText,layout:"fit",width:320,height:490,pageX:150,pageY:100,modal:!0,listeners:{hide:function(){gxp.ColorManager.pickerWin&&
gxp.ColorManager.pickerWin.hide()},scope:this},items:[{xtype:"gxp_rulepanel",ref:"rulePanel",symbolType:a.symbolType?a.symbolType:this.symbolType,rule:a,attributes:this.attributeStore,autoScroll:!0,border:!1,defaults:{autoHeight:!0,hideMode:"offsets"},listeners:{change:this.saveRule,tabchange:function(){c instanceof Ext.Window&&c.syncShadow()},scope:this}}],bbar:["->",{text:this.cancelText,iconCls:"cancel",handler:function(){this.saveRule(c.rulePanel,b);c.destroy()},scope:this},{text:this.saveText,
iconCls:"save",handler:function(){c.destroy()}}]}),d;if(0==this.attributeStore.data.getCount()){var e=c.findByType("gxp_rulepanel")[0],a=e.items.getRange(1,2);for(d=0;d<a.length;d++)e.remove(a[d])}if((a=c.findByType("gxp_textsymbolizer"))&&1==a.length){e=a[0];a=e.items.getRange(3,7);for(d=0;d<a.length;d++)e.remove(a[d])}this.showDlg(c)},createSymbolizer:function(a,b){return new (eval("OpenLayers.Symbolizer."+a))(b)},prepareStyle:function(a,b,c){b=b.clone();b.isDefault="default"===c;b.name=c;b.title=
c+" style";b.description=c+" style for this layer";b.layerName=a.name;var c=[],d,e;if(b.rules&&0<b.rules.length)for(var f=0;f<b.rules.length;f++){a=b.rules[f];c=[];for(e in a.symbolizer)d=a.symbolizer[e],d=d.CLASS_NAME?d.clone():this.createSymbolizer(e,d),c.push(d);a.symbolizers=c;a.symbolizer=void 0}else if(a.customStyling){c=["Point","Line","Polygon"];b.rules=[];d=b.defaultStyle;for(f=0;f<c.length;f++)e=c[f],a=new OpenLayers.Rule({title:e,symbolType:e,symbolizers:[this.createSymbolizer(e,d)]}),
b.rules.push(a);b.defaultsPerSymbolizer=!1}else{e="Polygon";if(a&&a.features&&0<a.features.length)(a=a.features[0].geometry)&&(0<a.CLASS_NAME.indexOf("Point")?e="Point":0<a.CLASS_NAME.indexOf("Line")&&(e="Line"));d=this.createSymbolizer(e,b.defaultStyle);c=[d];b.rules=[new OpenLayers.Rule({title:b.name,symbolizers:c})]}return b},getStyles:function(){if(!this.first){var a=this.layerRecord.getLayer();if(this.editable){this.first=!0;var b=this.initialConfig.styleName;this.selectedStyle=this.stylesStore.getAt(this.stylesStore.findExact("name",
b));try{var c=[];a.style&&a.styleMap&&(OpenLayers.Util.extend(a.styleMap.styles["default"].defaultStyle,a.style),delete a.style);for(var d in a.styleMap.styles)"default"==d&&c.push(this.prepareStyle(a,a.styleMap.styles[d],d));this.stylesStore.removeAll();this.selectedStyle=null;for(var e,f,g,a=0,h=c.length;a<h;++a)if(e=c[a],g=this.stylesStore.findExact("name",e.name),-1!==g&&this.stylesStore.removeAt(g),f=new this.stylesStore.recordType({name:e.name,title:e.title,"abstract":e.description,userStyle:e}),
f.phantom=!1,this.stylesStore.add(f),!this.selectedStyle&&(b===e.name||!b&&!0===e.isDefault))this.selectedStyle=f;this.addRulesFieldSet();this.createLegend(this.selectedStyle.get("userStyle").rules);this.stylesStoreReady();this.markModified()}catch(j){this.setupNonEditable()}}else this.setupNonEditable()}},describeLayer:function(a){this.layerDescription&&a.call(this);var b=this.layerRecord.getLayer();if(b.protocol&&0<b.protocol.CLASS_NAME.indexOf(".WFS"))this.wfsLayer={},this.wfsLayer.owsURL=b.protocol.url.replace("?",
""),this.wfsLayer.owsType="WFS",this.wfsLayer.typeName=b.protocol.featureType;var c=this;if(this.wfsLayer)this.attributeStore=new GeoExt.data.AttributeStore({url:this.wfsLayer.owsURL,baseParams:{SERVICE:"WFS",VERSION:"1.1.0",REQUEST:"DescribeFeatureType",TYPENAME:this.wfsLayer.typeName},autoLoad:!0,listeners:{load:function(b){c.layerDescription=c.attributeStore;b.load=function(){};a.call(c)},scope:this}});else{this.attributeStore=new Ext.data.Store({reader:new Ext.data.ArrayReader({idIndex:0},Ext.data.Record.create([{name:"name"}]))});
var d=[];if(b&&b.features&&0<b.features.length){var b=b.features[0].attributes,e;for(e in b)d.push([e])}this.attributeStore.loadData(d);this.attributeStore.proxy={request:function(){}};this.layerDescription=this.attributeStore;a.call(this)}},addStylesCombo:function(){if(!this.combo){var a=this.stylesStore;this.combo=new Ext.form.ComboBox(Ext.apply({fieldLabel:this.chooseStyleText,store:a,editable:!1,displayField:"title",valueField:"name",value:this.selectedStyle?this.selectedStyle.get("title"):"default",
disabled:!a.getCount(),mode:"local",typeAhead:!0,triggerAction:"all",forceSelection:!0,anchor:"100%",listeners:{select:function(a,c){this.changeStyle(c);!c.phantom&&!this._removing&&this.fireEvent("styleselected",this,c.get("name"))},scope:this}},this.initialConfig.stylesComboOptions));this.items.get(0).add(this.combo);this.doLayout()}},createLegendImage:function(){return new GeoExt.VectorLegend({showTitle:!1,layerRecord:this.layerRecord,autoScroll:!0})},updateRuleRemoveButton:function(){gxp.VectorStylesDialog.superclass.updateRuleRemoveButton.apply(this,
arguments);this.disableConditional(this.items.get(3).items.get(1))},updateStyleRemoveButton:function(){this.items.get(1).items.get(1).setDisabled(!0)}});gxp.VectorStylesDialog.createVectorStylerConfig=function(a){return{xtype:"gxp_vectorstylesdialog",layerRecord:a,listeners:{hide:function(){alert("hide")}},plugins:[{ptype:"gxp_vectorstylewriter"}]}};Ext.reg("gxp_vectorstylesdialog",gxp.VectorStylesDialog);
(function(){Ext.util.Observable.observeClass(Ext.ColorPalette);Ext.ColorPalette.on({render:function(){gxp.ColorManager.pickerWin&&gxp.ColorManager.pickerWin.setPagePosition(200,100)}});Ext.ColorPalette.on({select:function(){gxp.ColorManager.pickerWin&&gxp.ColorManager.pickerWin.hide()}})})();Ext.namespace("gxp.plugins");
gxp.plugins.WMSRasterStylesDialog={isRaster:null,init:function(a){Ext.apply(a,gxp.plugins.WMSRasterStylesDialog)},createRule:function(){var a=[new OpenLayers.Symbolizer[this.isRaster?"Raster":this.symbolType]];return new OpenLayers.Rule({symbolizers:a})},addRule:function(){var a=this.items.get(2).items.get(0);this.isRaster?(a.rules.push(this.createPseudoRule()),1==a.rules.length&&a.rules.push(this.createPseudoRule()),this.savePseudoRules()):(this.selectedStyle.get("userStyle").rules.push(this.createRule()),
a.update(),this.selectedStyle.store.afterEdit(this.selectedStyle));this.updateRuleRemoveButton()},removeRule:function(){if(this.isRaster){var a=this.items.get(2).items.get(0),b=this.selectedRule;a.unselect();a.rules.remove(b);1==a.rules.length&&a.rules.remove(a.rules[0]);this.savePseudoRules()}else gxp.WMSStylesDialog.prototype.removeRule.apply(this,arguments)},duplicateRule:function(){var a=this.items.get(2).items.get(0);if(this.isRaster)a.rules.push(this.createPseudoRule({quantity:this.selectedRule.name,
label:this.selectedRule.title,color:this.selectedRule.symbolizers[0].fillColor,opacity:this.selectedRule.symbolizers[0].fillOpacity})),this.savePseudoRules();else{var b=this.selectedRule.clone();b.name=gxp.util.uniqueName((b.title||b.name)+" (copy)");delete b.title;this.selectedStyle.get("userStyle").rules.push(b);a.update()}this.updateRuleRemoveButton()},editRule:function(){this.isRaster?this.editPseudoRule():gxp.WMSStylesDialog.prototype.editRule.apply(this,arguments)},editPseudoRule:function(){var a=
this,b=this.selectedRule,c=new Ext.Window({title:"Color Map Entry: "+b.name,width:340,autoHeight:!0,modal:!0,items:[{bodyStyle:"padding-top: 5px",border:!1,defaults:{autoHeight:!0,hideMode:"offsets"},items:[{xtype:"form",border:!1,labelAlign:"top",defaults:{border:!1},style:{padding:"0.3em 0 0 1em"},items:[{layout:"column",defaults:{border:!1,style:{"padding-right":"1em"}},items:[{layout:"form",width:70,items:[{xtype:"numberfield",anchor:"95%",value:b.name,allowBlank:!1,fieldLabel:"Quantity",validator:function(c){for(var d=
a.items.get(2).items.get(0).rules,g=d.length-1;0<=g;g--)if(b!==d[g]&&d[g].name==c)return"Quantity "+c+" is already defined";return!0},listeners:{valid:function(a){this.selectedRule.name=""+a.getValue();this.savePseudoRules()},scope:this}}]},{layout:"form",width:130,items:[{xtype:"textfield",fieldLabel:"Label",anchor:"95%",value:b.title,listeners:{valid:function(a){this.selectedRule.title=a.getValue();this.savePseudoRules()},scope:this}}]},{layout:"form",width:70,items:[new GeoExt.FeatureRenderer({symbolType:this.symbolType,
symbolizers:[b.symbolizers[0]],isFormField:!0,fieldLabel:"Appearance"})]}]}]},{xtype:"gxp_polygonsymbolizer",symbolizer:b.symbolizers[0],bodyStyle:{padding:"10px"},border:!1,labelWidth:70,defaults:{labelWidth:70},listeners:{change:function(a){var b=c.findByType(GeoExt.FeatureRenderer)[0];b.setSymbolizers([a],{draw:b.rendered});this.selectedRule.symbolizers[0]=a;this.savePseudoRules()},scope:this}}]}]}),d=c.findByType("gxp_strokesymbolizer")[0];d.ownerCt.remove(d);c.show()},savePseudoRules:function(){var a=
this.selectedStyle,b=this.items.get(2).items.get(0),a=a.get("userStyle"),b=b.rules;b.sort(function(a,b){var c=parseFloat(a.name),d=parseFloat(b.name);return c===d?0:c<d?-1:1});a=a.rules[0].symbolizers[0];a.colorMap=0<b.length?Array(b.length):void 0;for(var c,d=0,e=b.length;d<e;++d)c=b[d],a.colorMap[d]={quantity:parseFloat(c.name),label:c.title||void 0,color:c.symbolizers[0].fillColor||void 0,opacity:!1==c.symbolizers[0].fill?0:c.symbolizers[0].fillOpacity};this.afterRuleChange(this.selectedRule)},
createLegend:function(a,b){var c=OpenLayers.Symbolizer.Raster;c&&a[0]&&a[0].symbolizers[0]instanceof c?(this.getComponent("rulesfieldset").setTitle("Color Map Entries"),this.isRaster=!0,this.addRasterLegend(a,b)):(this.isRaster=!1,this.addVectorLegend(a))},addRasterLegend:function(a,b){for(var b=b||{},c=a[0].symbolizers[0].colorMap||[],d=[],e=0,f=c.length;e<f;e++)d.push(this.createPseudoRule(c[e]));this.selectedRule=null!=b.selectedRuleIndex?d[b.selectedRuleIndex]:null;return this.addVectorLegend(d,
{symbolType:"Polygon",enableDD:!1})},createPseudoRule:function(a){var b=-1;if(!a){var c=this.items.get(2);if(c.items){rules=c.items.get(0).rules;for(c=rules.length-1;0<=c;c--)b=Math.max(b,parseFloat(rules[c].name))}}a=Ext.applyIf(a||{},{quantity:++b,color:"#000000",opacity:1});return new OpenLayers.Rule({title:a.label,name:""+a.quantity,symbolizers:[new OpenLayers.Symbolizer.Polygon({fillColor:a.color,fillOpacity:a.opacity,stroke:!1,fill:0!==a.opacity})]})},updateRuleRemoveButton:function(){this.items.get(3).items.get(1).setDisabled(!this.selectedRule||
!1===this.isRaster&&1>=this.items.get(2).items.get(0).rules.length)}};Ext.preg("gxp_wmsrasterstylesdialog",gxp.plugins.WMSRasterStylesDialog);Ext.namespace("gxp.plugins");
gxp.plugins.Styler=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_styler",menuText:"Edit Styles",tooltip:"Manage layer styles",roles:["ROLE_ADMINISTRATOR"],sameOriginStyling:!0,rasterStyling:!1,requireDescribeLayer:!0,constructor:function(a){gxp.plugins.Styler.superclass.constructor.apply(this,arguments);if(!this.outputConfig)this.outputConfig={autoHeight:!0,width:265};Ext.applyIf(this.outputConfig,{closeAction:"close"})},init:function(a){gxp.plugins.Styler.superclass.init.apply(this,arguments);this.target.on("authorizationchange",
this.enableOrDisable,this)},destroy:function(){this.target.un("authorizationchange",this.enableOrDisable,this);gxp.plugins.Styler.superclass.destroy.apply(this,arguments)},enableOrDisable:function(){this.target&&null!==this.target.selectedLayer&&this.handleLayerChange(this.target.selectedLayer)},isVectorLayer:function(a){var b=!1;try{b=-1<a.data.layer.CLASS_NAME.indexOf("Vector")}catch(c){}return b},addActions:function(){var a=gxp.plugins.Styler.superclass.addActions.apply(this,[{menuText:this.menuText,
iconCls:"gxp-icon-palette",disabled:!0,tooltip:this.tooltip,handler:function(){this.isVectorLayer(this.target.selectedLayer)?this.addOutput():this.target.doAuthorized(this.roles,this.addOutput,this)},scope:this}]);this.launchAction=a[0];this.target.on({layerselectionchange:this.handleLayerChange,scope:this});return a},handleLayerChange:function(a){this.launchAction.disable();if(a){var b=this.target.getSource(a);b instanceof gxp.plugins.WMSSource?b.describeLayer(a,function(b){this.checkIfStyleable(a,
b)},this):b instanceof gxp.plugins.WFSSource&&this.launchAction.enable()}},checkIfStyleable:function(a,b){if(b){var c=["WFS"];!0===this.rasterStyling&&c.push("WCS")}if(b?-1!==c.indexOf(b.get("owsType")):!this.requireDescribeLayer){var c=!1,c=this.target.layerSources[a.get("source")],d;d=(d=a.get("restUrl"))?d+"/styles":c.url.split("?").shift().replace(/\/(wms|ows)\/?$/,"/rest/styles");if(this.sameOriginStyling){if(c="/"===d.charAt(0),this.target.authenticate&&c){this.launchAction.enable();return}}else c=
!0;c&&this.target.isAuthorized()&&this.enableActionIfAvailable(d)}},enableActionIfAvailable:function(a){Ext.Ajax.request({method:"PUT",url:a,callback:function(a,c,d){this.launchAction.setDisabled(405!==d.status)},scope:this})},addOutput:function(a){var a=a||{},b=this.target.selectedLayer;this.outputConfig.title=(this.initialConfig.outputConfig||{}).title||this.menuText+": "+b.get("title");this.outputConfig.shortTitle=b.get("title");if(this.isVectorLayer(b))(new Ext.Window({layout:"auto",resizable:!1,
autoHeight:!0,pageX:100,pageY:200,width:400,closeAction:"hide",title:__("Style Editor (Vector)"),items:[gxp.VectorStylesDialog.createVectorStylerConfig(b)]})).show();else{Ext.apply(a,gxp.WMSStylesDialog.createGeoServerStylerConfig(b));!0===this.rasterStyling&&a.plugins.push({ptype:"gxp_wmsrasterstylesdialog"});Ext.applyIf(a,{style:"padding: 10px"});var c=gxp.plugins.Styler.superclass.addOutput.call(this,a);if(!(c.ownerCt.ownerCt instanceof Ext.Window))c.dialogCls=Ext.Panel,c.showDlg=function(a){a.layout=
"fit";a.autoHeight=!1;c.ownerCt.add(a)};c.stylesStore.on("load",function(){!this.outputTarget&&c.ownerCt.ownerCt instanceof Ext.Window&&c.ownerCt.ownerCt.center()})}}});Ext.preg(gxp.plugins.Styler.prototype.ptype,gxp.plugins.Styler);Ext.namespace("gxp");
Ext.override(Ext.Tip,{showBy:function(a,b,c){if(Ext.isEmpty(b))b=this.defaultAlign;var d=c[0],c=c[1];"b"===b.charAt(0)&&(c=-c);if("r"===b.charAt(0)||"r"===b.charAt(1))d=-d;"c"===b.charAt(0)&&(c=d=0);if("l"===b.charAt(0)||"r"===b.charAt(0))c=0;this.rendered||this.render(Ext.getBody());b=this.el.getAlignToXY(a,b||this.defaultAlign,[d,c]);0<document.body.scrollTop&&document.body.scrollTop>a.getTop()&&(b[1]+=a.getTop()-document.body.scrollTop);this.isVisible()?this.setPagePosition(b[0],b[1]):this.showAt(b)}});
GeoExt.FeatureTip=Ext.extend(Ext.Tip,{map:null,location:null,shouldBeVisible:null,initComponent:function(){var a=this.location.geometry.getCentroid();this.location=new OpenLayers.LonLat(a.x,a.y);this.map.events.on({move:this.show,scope:this});GeoExt.FeatureTip.superclass.initComponent.call(this)},beforeDestroy:function(){for(var a in this.youtubePlayers)this.youtubePlayers[a].destroy(),delete this.youtubePlayers[a];this.map.events.un({move:this.show,scope:this});GeoExt.FeatureTip.superclass.beforeDestroy.call(this)},
getPosition:function(){if(this.map.getExtent().containsLonLat(this.location)){var a=this.map.getPixelFromLonLat(this.location),b=Ext.fly(this.map.div).getBox(!0);return[a.x+b.x,a.y+b.y]}return null},show:function(){var a=this.getPosition();null!==a&&(null===this.shouldBeVisible||this.shouldBeVisible.call(this))?this.isVisible()?this.setPagePosition(a[0],a[1]):this.showAt(a):this.hide()}});
window.Timeline&&window.SimileAjax&&function(){SimileAjax.History.enabled=!1;Timeline._Band.prototype._onDblClick=Ext.emptyFn;Timeline.DefaultEventSource.prototype.remove=function(a){this._events.remove(a)};SimileAjax.EventIndex.prototype.remove=function(a){this._events.remove(this._idToEvent[a]);delete this._idToEvent[a]};Timeline._Band.prototype.zoom=function(a){if(this._zoomSteps){var b=this.getCenterVisibleDate();this._etherPainter.zoom(this._ether.zoom(a));this.setCenterVisibleDate(b)}}}();
gxp.TimelinePanel=Ext.extend(Ext.Panel,{youtubePlayers:{},scrollInterval:500,annotationConfig:{timeAttr:"start_time",endTimeAttr:"end_time",filterAttr:"in_timeline",mapFilterAttr:"in_map"},layout:"border",initComponent:function(){Timeline.OriginalEventPainter.prototype._showBubble=this.handleEventClick.createDelegate(this);this.timelineContainer=new Ext.Container({region:"center"});this.eventSource=new Timeline.DefaultEventSource(0);this.items=[this.timelineContainer];this.initialConfig.viewer&&(delete this.viewer,
this.bindViewer(this.initialConfig.viewer));this.initialConfig.annotationsStore&&this.bindAnnotationsStore(this.initialConfig.annotationsStore);this.initialConfig.playbackTool&&(delete this.playbackTool,this.bindPlaybackTool(this.initialConfig.playbackTool));this.ownerCt&&(this.ownerCt.on("beforecollapse",function(){this._silentMapMove=!0},this),this.ownerCt.on("beforeexpand",function(){delete this._silentMapMove},this),this.ownerCt.on("afterlayout",function(){delete this._silent},this));gxp.TimelinePanel.superclass.initComponent.call(this)},
handleEventClick:function(a,b,c){this.fireEvent("click",c.getProperty("fid"))},bindAnnotationsStore:function(a){this.annotationsStore=a;a.on("load",function(a,c){this.layerLookup.annotations=Ext.apply({titleAttr:"title",icon:Timeline.urlPrefix+"/images/note.png",layer:a.layer,visible:!0},this.annotationConfig);var d=[];a.each(function(a){d.push(a.getFeature())});this.addFeatures("annotations",d);0<c.length&&this.ownerCt.expand();this.showAnnotations()},this,{single:!0});a.on("write",this.onSave,this)},
unbindAnnotationsStore:function(){this.annotationsStore&&this.annotationsStore.un("write",this.onSave,this)},clearEventsForFid:function(a,b){for(var c=this.eventSource.getAllEventIterator(),d=[];c.hasNext();){var e=c.next();e.getProperty("key")===a&&e.getProperty("fid")===b&&d.push(e.getID())}c=0;for(e=d.length;c<e;++c)this.eventSource.remove(d[c]);this.timeline&&this.timeline.layout()},onSave:function(a,b,c){for(var a=[],d=0,e=c.length;d<e;d++){var f=c[d].feature;a.push(f);f=f.fid;this.clearEventsForFid("annotations",
f);this.tooltips&&this.tooltips[f]&&(this.tooltips[f].destroy(),this.tooltips[f]=null)}b!==Ext.data.Api.actions.destroy&&this.addFeatures("annotations",a);this.showAnnotations()},bindPlaybackTool:function(a){this.playbackTool=a;this.playbackTool.on("timechange",this.onTimeChange,this);this.playbackTool.on("rangemodified",this.onRangeModify,this)},unbindPlaybackTool:function(){if(this.playbackTool)this.playbackTool.un("timechange",this.onTimeChange,this),this.playbackTool.un("rangemodified",this.onRangeModify,
this),this.playbackTool=null},onTimeChange:function(a,b){this._silent=!0;!0!==this._ignoreTimeChange&&this.setCenterDate(b);delete this._silent},onRangeModify:function(a,b){this._silent=!0;this.setRange(b);delete this._silent},createTimeline:function(a){if(this.rendered&&!(0===this.timelineContainer.el.getSize().width&&0===this.timelineContainer.el.getSize().height)){var b=Timeline.ClassicTheme.create(),c=a[1]-a[0],d=[];50<=c/1E3/60/60/24/365?(d.push(Timeline.DateTime.DECADE),d.push(Timeline.DateTime.CENTURY)):
(d.push(Timeline.DateTime.YEAR),d.push(Timeline.DateTime.DECADE));a=new Date(a[0]+c/2);d=[Timeline.createBandInfo({width:"80%",intervalUnit:d[0],intervalPixels:200,eventSource:this.eventSource,date:a,theme:b,layout:"original",zoomIndex:7,zoomSteps:[{pixelsPerInterval:25,unit:d[0]},{pixelsPerInterval:50,unit:d[0]},{pixelsPerInterval:75,unit:d[0]},{pixelsPerInterval:100,unit:d[0]},{pixelsPerInterval:125,unit:d[0]},{pixelsPerInterval:150,unit:d[0]},{pixelsPerInterval:175,unit:d[0]},{pixelsPerInterval:200,
unit:d[0]},{pixelsPerInterval:225,unit:d[0]},{pixelsPerInterval:250,unit:d[0]},{pixelsPerInterval:275,unit:d[0]},{pixelsPerInterval:300,unit:d[0]},{pixelsPerInterval:325,unit:d[0]},{pixelsPerInterval:350,unit:d[0]},{pixelsPerInterval:375,unit:d[0]}]}),Timeline.createBandInfo({width:"20%",intervalUnit:d[1],intervalPixels:200,eventSource:this.eventSource,date:a,theme:b,layout:"overview"})];d[1].syncWith=0;d[1].highlight=!0;d[0].decorators=[new Timeline.PointHighlightDecorator({date:a,theme:b})];this.timeline=
Timeline.create(this.timelineContainer.el.dom,d,Timeline.HORIZONTAL);this._silent=!0;this.timeline.getBand(0).addOnScrollListener(gxp.util.throttle(this.setPlaybackCenter.createDelegate(this),this.scrollInterval))}},setPlaybackCenter:function(a){a=a.getCenterVisibleDate();if(!0!==this._silent&&this.playbackTool&&!0!==this.playbackTool.playbackToolbar.playing)this._ignoreTimeChange=!0,this.playbackTool.setTime(a),this.timeline.getBand(0)._decorators[0]._date=this.playbackTool.playbackToolbar.control.currentValue,
this.timeline.getBand(0)._decorators[0].paint(),delete this._ignoreTimeChange,this.showAnnotations()},bindViewer:function(a){this.viewer&&this.unbindViewer();this.viewer=a;if(!this.layerLookup)this.layerLookup={}},unbindViewer:function(){delete this.viewer;delete this.layerLookup},onLayout:function(){gxp.TimelinePanel.superclass.onLayout.call(this,arguments);!this.timeline&&this.playbackTool&&this.playbackTool.playbackToolbar&&(this.setRange(this.playbackTool.playbackToolbar.control.animationRange),
this.setCenterDate(this.playbackTool.playbackToolbar.control.currentValue))},setRange:function(a){this.originalRange=a;this.timeline||this.createTimeline(a);if(this.timeline){var b=this.timeline.getBand(0);b.setMinVisibleDate(a[0]);b.setMaxVisibleDate(a[1]);this.timeline.getBand(1).getEtherPainter().setHighlight(a[0],a[1])}},buildHTML:function(a){var b=a.get("content"),c=b?b.indexOf("[youtube="):-1;if(-1!==c){var d=b.substr(0,c),e=b.indexOf("]",c),f=b.substr(e+1),b=b.substr(c+9,e-9),g=OpenLayers.Util.getParameters(b),
c=g.w||250,e=g.h||250,g=g.v;void 0===g&&(g=b.substr(b.lastIndexOf("/")+1,-1!==b.indexOf("?")?b.indexOf("?")-(b.lastIndexOf("/")+1):void 0));b="http://www.youtube.com/embed/"+g;a="player_"+a.getFeature().fid;return d+'<br/><iframe id="'+a+'" type="text/html" width="'+c+'" height="'+e+'" src="'+b+"?enablejsapi=1&origin="+window.location.origin+'" frameborder="0"></iframe><br/>'+f}return b},displayTooltip:function(a){var b=null!==a.getFeature().geometry;if(!this.tooltips)this.tooltips={};var c=a.getFeature().fid,
d=-1!==(a.get("content")||"").indexOf("[youtube="),e={hide:function(){!0===d&&this.youtubePlayers[c].stopVideo()},show:function(){!0===d&&this.youtubePlayers[c]._ready&&this.playbackTool.playbackToolbar.playing&&this.youtubePlayers[c].playVideo()},afterrender:function(){if(!0===d&&!this.youtubePlayers[c]){var a=this;if(a.playbackTool.playbackToolbar.playing)a.playbackTool.playbackToolbar._weStopped=!0,window.setTimeout(function(){a.playbackTool.playbackToolbar.control.stop()},0);this.youtubePlayers[c]=
new YT.Player("player_"+c,{events:{onReady:function(b){b.target._ready=!0;(a.playbackTool.playbackToolbar.playing||a.playbackTool.playbackToolbar._weStopped)&&b.target.playVideo()},onStateChange:function(b){if(b.data===YT.PlayerState.PLAYING){if(!a.playbackTool.playbackToolbar._weStopped&&a.playbackTool.playbackToolbar.playing)a.playbackTool.playbackToolbar._weStopped=!0,a.playbackTool.playbackToolbar.control.stop()}else b.data==YT.PlayerState.ENDED&&a.playbackTool.playbackToolbar._weStopped&&(a.playbackTool.playbackToolbar.control.play(),
delete a.playbackTool.playbackToolbar._weStopped)}}})}},scope:this};this.tooltips[c]||(this.tooltips[c]=!b||b&&"geom"!==a.get("appearance")&&!Ext.isEmpty(a.get("appearance"))?new Ext.Tip({cls:"gxp-annotations-tip",maxWidth:500,bodyCssClass:"gxp-annotations-tip-body",listeners:e,title:a.get("title"),html:this.buildHTML(a)}):new GeoExt.FeatureTip({map:this.viewer.mapPanel.map,location:a.getFeature(),shouldBeVisible:function(){return!0===this._inTimeRange},cls:"gxp-annotations-tip",bodyCssClass:"gxp-annotations-tip-body",
maxWidth:500,title:a.get("title"),listeners:e,html:this.buildHTML(a)}));e=this.tooltips[c];e._inTimeRange=!0;!b||b&&"geom"!==a.get("appearance")&&!Ext.isEmpty(a.get("appearance"))?(e.showBy(this.viewer.mapPanel.body,a.get("appearance"),[10,10]),e.showBy(this.viewer.mapPanel.body,a.get("appearance"),[10,10])):e.isVisible()||e.show();b&&this.annotationsLayer.addFeatures([a.getFeature()])},hideTooltip:function(a){var b=a.getFeature().fid,c=null!==a.getFeature().geometry;if(this.tooltips&&this.tooltips[b])this.tooltips[b]._inTimeRange=
!1,this.tooltips[b].hide(),c&&this.annotationsLayer.removeFeatures([a.getFeature()])},showAnnotations:function(){if(!this.annotationsLayer)this.annotationsLayer=new OpenLayers.Layer.Vector(null,{displayInLayerSwitcher:!1}),this.viewer&&this.viewer.mapPanel.map.addLayer(this.annotationsLayer);var a=(new Date(this.playbackTool.playbackToolbar.control.currentValue)).getTime()/1E3;this.annotationsStore&&this.annotationsStore.each(function(b){var c=this.annotationConfig.mapFilterAttr;if(Ext.isBoolean(b.get(c))?
b.get(c):"true"===b.get(c)){var c=parseFloat(b.get(this.annotationConfig.timeAttr)),d=b.get(this.annotationConfig.endTimeAttr),e=d!=c;if(""==d||null==d)d=this.playbackTool.playbackToolbar.control.animationRange[1];!0===e?a<=parseFloat(d)&&a>=c?this.displayTooltip(b):this.hideTooltip(b):0===c-a?this.displayTooltip(b):this.hideTooltip(b)}},this)},setCenterDate:function(a){a instanceof Date||(a=new Date(a));if(this.timeline)this.timeline.getBand(0)._decorators[0]._date=a,this.timeline.getBand(0)._decorators[0].paint(),
this.timeline.getBand(0).setCenterVisibleDate(a);this.showAnnotations()},addFeatures:function(a,b){var c=!1,d=this.layerLookup[a].titleAttr,e=this.layerLookup[a].timeAttr,f=this.layerLookup[a].endTimeAttr,g=this.layerLookup[a].filterAttr;f&&(c=!0);for(var h=b.length,j=[],k,l=0;l<h;++l){a:{k=b[l].fid;for(var n=this.eventSource.getAllEventIterator();n.hasNext();){var m=n.next();if(m.getProperty("key")===a&&m.getProperty("fid")===k){k=!0;break a}}k=!1}if(!1===k)if(k=b[l].attributes,!1===c)j.push({start:OpenLayers.Date.parse(k[e]),
title:k[d],durationEvent:!1,key:a,icon:this.layerLookup[a].icon,fid:b[l].fid});else if(Ext.isBoolean(k[g])?k[g]:"true"===k[g]){var n=k[e],m=k[f],o=n!=m;Ext.isEmpty(n)||(n=parseFloat(n),n=Ext.isNumber(n)?new Date(1E3*n):OpenLayers.Date.parse(n));Ext.isEmpty(m)||(m=parseFloat(m),m=Ext.isNumber(m)?new Date(1E3*m):OpenLayers.Date.parse(m));if(!1===o)m=void 0;else if(""==m||null==m)m=new Date(this.playbackTool.playbackToolbar.control.animationRange[1]);null!=n&&j.push({start:n,end:m,icon:this.layerLookup[a].icon,
title:k[d],durationEvent:o,key:a,fid:b[l].fid})}}this.eventSource.loadJSON({dateTimeFormat:"javascriptnative",events:j},"mapstory.org")},onResize:function(){gxp.TimelinePanel.superclass.onResize.apply(this,arguments);this.timeline&&this.timeline.layout()},beforeDestroy:function(){gxp.TimelinePanel.superclass.beforeDestroy.call(this);this.annotationsLayer=null;this.unbindViewer();this.unbindAnnotationsStore();this.unbindPlaybackTool();this.eventSource=null;if(this.timeline)this.timeline.dispose(),
this.timeline=null}});Ext.reg("gxp_timelinepanel",gxp.TimelinePanel);Ext.namespace("gxp.plugins");
gxp.plugins.Timeline=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_timeline",playbackTool:null,menuText:"Timeline",tooltip:"Show Timeline",actionTarget:null,constructor:function(a){gxp.plugins.Timeline.superclass.constructor.apply(this,arguments);if(!this.outputConfig)this.outputConfig={};Ext.applyIf(this.outputConfig,{title:this.menuText})},addActions:function(){return gxp.plugins.Timeline.superclass.addActions.apply(this,[[{menuText:this.menuText,tooltip:this.tooltip,handler:function(){this.addOutput()},
scope:this}]])},addOutput:function(){return gxp.plugins.Timeline.superclass.addOutput.call(this,Ext.apply({xtype:"gxp_timelinepanel",viewer:this.target,listeners:{click:function(a){this.fireEvent("click",a)},scope:this},annotationsStore:this.annotationsStore,playbackTool:this.target.tools[this.playbackTool]},this.outputConfig))},getTimelinePanel:function(){return this.output[0]},getState:function(){var a=gxp.plugins.Timeline.superclass.getState.call(this);a.outputConfig=Ext.apply(a.outputConfig||
{},this.getTimelinePanel().getState());return a},setAnnotationsStore:function(a){this.annotationsStore=a;this.output&&this.output[0]&&this.output[0].bindAnnotationsStore(a)}});Ext.preg(gxp.plugins.Timeline.prototype.ptype,gxp.plugins.Timeline);Ext.namespace("gxp.plugins");
gxp.plugins.VectorStyleWriter=Ext.extend(gxp.plugins.StyleWriter,{constructor:function(a){this.initialConfig=a;Ext.apply(this,a);gxp.plugins.VectorStyleWriter.superclass.constructor.apply(this,arguments)},init:function(a){gxp.plugins.VectorStyleWriter.superclass.init.apply(this,arguments);a.on({beforesaved:this.write,saved:this.assignStyles,scope:this})},write:function(){var a=this.target.layerRecord.getLayer();if(a.customStyling&&a.features&&a.styleMap&&a.styleMap.styles["default"])for(var b=a.styleMap.styles["default"],
c=a.features,d,e,f=0;f<c.length;f++)if(d=c[f],!d.style)e=b,d.renderIntent&&"default"!=d.renderIntent&&(e=a.styleMap.styles[d.renderIntent]),d.style=e.createSymbolizer(d);this.target.stylesStore.commitChanges();this.target.fireEvent("saved",this.target,this.target.selectedStyle.get("name"))},writeStyle:function(a){a.get("userStyle")},assignStyles:function(a,b){if(this.target.first){var c=this.target.layerRecord.getLayer(),d=c.styleMap,e=this.target.selectedStyle;if(e){e=e.get("userStyle").clone();
e.defaultsPerSymbolizer=!1;var f={},g;if(e.rules)for(var h=0,j=e.rules.length;h<j;h++){var k=e.rules[h];k.symbolizer={};for(var l=0;l<k.symbolizers.length;l++){g=k.symbolizers[l];var n=g.CLASS_NAME.split(".").pop();if("Text"==n)f.label=g.label,f.fontFamily=g.fontFamily,f.fontSize=g.fontSize,f.fontWeight=g.fontWeight,f.fontStyle=g.fontStyle,f.fontColor=g.fontColor,f.fontOpacity=g.fontOpacity;k.symbolizer[n]=k.symbolizers[l].clone()}k.symbolizers=void 0}OpenLayers.Util.extend(e.defaultStyle,f);e.propertyStyles=
e.findPropertyStyles();d.styles[b]=e;d=c.selectedFeatures&&0<c.selectedFeatures.length?c.selectedFeatures:c.features;c.eraseFeatures(d);for(g=0;g<d.length;g++){f=d[g];h=!1;if(c.selectedFeatures)for(j=0;j<c.selectedFeatures.length;j++)if(c.selectedFeatures[j].id==f.id){h=!0;break}if(c.customStyling){if(h||!f.style)f.style&&delete f.style,f.style="text"==f.featureType?c.styleMap.styles.defaultLabel.createSymbolizer(f):e.createSymbolizer(f)}else f.style=null;c.drawFeature(f)}c.events.triggerEvent("stylechanged",
e)}}},deleteStyles:function(){this.deletedStyles=[]}});Ext.preg("gxp_vectorstylewriter",gxp.plugins.VectorStyleWriter);Ext.namespace("gxp.plugins");
gxp.plugins.VersionedEditor=Ext.extend(Ext.TabPanel,{url:null,historyTpl:'<ol><tpl for="."><li class="commit"><div class="commit-msg">{message}</div><div>{author} <span class="commit-datetime">authored {date:this.formatDate}</span></div></li></tpl>',attributesTitle:"Attributes",historyTitle:"History",hour:"hour",hours:"hours",day:"day",days:"days",ago:"ago",border:!1,activeTab:0,editor:null,attributeEditor:null,ptype:"gxp_versionededitor",initComponent:function(){gxp.plugins.VersionedEditor.superclass.initComponent.call(this);
var a=Ext.apply({xtype:this.initialConfig.editor||"gxp_editorgrid",title:this.attributesTitle},{feature:this.initialConfig.feature,schema:this.initialConfig.schema,fields:this.initialConfig.fields,excludeFields:this.initialConfig.excludeFields,propertyNames:this.initialConfig.propertyNames,readOnly:this.initialConfig.readOnly});this.attributeEditor=Ext.ComponentMgr.create(a);this.add(this.attributeEditor);this.add({xtype:"panel",border:!1,plain:!0,layout:"fit",autoScroll:!0,items:[this.createDataView()],
title:this.historyTitle})},createDataView:function(){var a=this.schema.reader.raw.featureTypes[0].typeName.split(":").pop()+"/"+this.feature.fid;"/"!==this.url.charAt(this.url.length-1)&&(this.url+="/");var b=this.url+"log",b=Ext.urlAppend(b,"path="+a+"&output_format=json"),a=new Ext.data.JsonStore({url:b,root:"response.commit",fields:["message","author","email","commit",{name:"date",type:"date",convert:function(a){return new Date(a)}}],autoLoad:!0}),c=this,b=new Ext.XTemplate(this.historyTpl,{formatDate:function(a){var b=
new Date,f="";if(a>b.add(Date.DAY,-1))return a=Math.round((b-a)/36E5),f+=a+" ",f+=1<f?c.hours:c.hour,f+=" "+c.ago;if(a>b.add(Date.MONTH,-1))return a=Math.round((b-a)/864E5),f+=a+" ",f+=1<f?c.days:c.day,f+=" "+c.ago}});return new Ext.DataView({store:a,tpl:b,autoHeight:!0})},init:function(a){a.on("beforeadd",OpenLayers.Function.False,this);this.attributeEditor.init(a);a.un("beforeadd",OpenLayers.Function.False,this);a.add(this);a.doLayout()}});Ext.preg(gxp.plugins.VersionedEditor.prototype.ptype,gxp.plugins.VersionedEditor);
Ext.namespace("gxp.plugins");
gxp.plugins.WFSSource=Ext.extend(gxp.plugins.LayerSource,{ptype:"gxp_wfssource",baseParams:null,format:null,describeLayerStore:null,describedLayers:null,schemaCache:null,ready:!1,version:"1.1.0",requiredProperties:["title","bbox"],owsPreviewStrategies:["randomcolor"],defaultSrs:"EPSG:4326",constructor:function(a){if(a&&!0===a.forceLazy)a.requiredProperties=[],delete a.forceLazy,window.console&&console.warn("Deprecated config option 'forceLazy: true' for layer source '"+a.id+"'. Use 'requiredProperties: []' instead.");
gxp.plugins.WFSSource.superclass.constructor.apply(this,arguments);if(!this.format)this.format=new OpenLayers.Format.WFSCapabilities({keepData:!0})},init:function(a){gxp.plugins.WFSSource.superclass.init.apply(this,arguments);this.target.on("authorizationchange",this.onAuthorizationChange,this)},getPreviewImageURL:function(a){function b(a,b,c){var g=(a&3)<<4|b>>4,b=(b&15)<<2|c>>6,c=c&63;return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(a>>2)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)}if(-1==this.owsPreviewStrategies.indexOf("randomcolor"))return null;var c="#"+("000000"+Math.round(16777215*Math.random()).toString(16)).substr(-6);a.data.colour=c;return"data:image/gif;base64,R0lGODlhAQABAPAA"+function(a){var c="0x"+a.charAt(1)+a.charAt(2),f="0x"+a.charAt(3)+a.charAt(4),a="0x"+a.charAt(5)+a.charAt(6);return b(0,c,f)+b(a,255,255)}(c)+
"/yH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},onAuthorizationChange:function(){if(this.store&&"/"===this.url.charAt(0)){var a=this.store.lastOptions||{params:{}};Ext.apply(a.params,{_dc:Math.random()});this.store.reload(a)}},destroy:function(){this.target.un("authorizationchange",this.onAuthorizationChange,this);gxp.plugins.WFSSource.superclass.destroy.apply(this,arguments)},isLazy:function(){var a=!0,b=this.target.initialConfig.map;if(b&&b.layers)for(var c,d=0,e=b.layers.length;d<e&&!(c=b.layers[d],c.source===
this.id&&(a=this.layerConfigComplete(c),!1===a));++d);return a},layerConfigComplete:function(a){var b=!0;if(!Ext.isObject(a.capability))for(var c=this.requiredProperties,d=c.length-1;0<=d&&!(b=!!a[c[d]],!1===b);--d);return b},createStore:function(){var a=this.baseParams||{SERVICE:"WFS",REQUEST:"GetCapabilities"};if(this.version)a.VERSION=this.version;this.store=new GeoExt.data.WFSCapabilitiesStore({url:this.trimUrl(this.url,a),baseParams:a,format:this.format,autoLoad:!0,listeners:{load:function(){if(!this.store.reader.raw||
!this.store.reader.raw.service&&!this.store.reader.raw.serviceIdentification)this.fireEvent("failure",this,"Invalid capabilities document.");else{this.serviceTitle=this.store.reader.raw.service?this.store.reader.raw.service.title:this.store.reader.raw.serviceIdentification.title;if(!this.title||0==this.title.length)this.title=this.serviceTitle;this.ready?this.lazy=!1:(this.ready=!0,this.fireEvent("ready",this))}delete this.format.data},exception:function(a,c,d,e,f,g){delete this.store;a="";"response"===
c?"string"==typeof g?c=g:(c="Invalid response from server.",(a=this.format&&this.format.data)&&a.parseError&&(c+="  "+a.parseError.reason+" - line: "+a.parseError.line),f=f.status,a=200<=f&&300>f?gxp.util.getOGCExceptionText(g&&g.arg&&g.arg.exceptionReport):"Status: "+f):(c="Trouble creating layer store from response.",a="Unable to handle response.");this.fireEvent("failure",this,c,a);delete this.format.data},scope:this}})},trimUrl:function(a,b){var c=OpenLayers.Util.getParameters(a),b=OpenLayers.Util.upperCaseObject(b),
d=0,e;for(e in c)++d,e.toUpperCase()in b&&(--d,delete c[e]);return a.split("?").shift()+(d?"?"+OpenLayers.Util.getParameterString(c):"")},createLayerRecord:function(a){var b,c,d=this.store.findExact("name",a.name);-1<d?c=this.store.getAt(d):Ext.isObject(a.capability)?c=this.store.reader.readRecords({capability:{request:{getmap:{href:this.trimUrl(this.url,this.baseParams)}},layers:[a.capability]}}).records[0]:this.layerConfigComplete(a);if(c){var d=b=this.getMapProjection(),e=c.get("srs");e&&(0<=e.indexOf("urn")&&
(e="EPSG"+e.split("EPSG")[1]),b=new OpenLayers.Projection(e));!b.equals(d)&&this.defaultSrs&&(b=new OpenLayers.Projection(this.defaultSrs));(e=c.get("bounds"))||(e=new OpenLayers.Bounds(-180,-90,180,90));d=e.transform("EPSG:4326",d);e=c.data.layer.styleMap;c.data.colour&&(e=new OpenLayers.StyleMap({"default":new OpenLayers.Style({fillColor:c.data.colour,fillOpacity:0.6,strokeColor:c.data.colour,strokeOpacity:0.8,strokeWidth:1,pointRadius:4,graphicName:"circle"}),select:new OpenLayers.Style({fillColor:"#0000ee",
fillOpacity:0.4,strokeColor:"#0000ee",strokeOpacity:1,strokeWidth:1,pointRadius:6,graphicName:"circle"})}));var f=c.getLayer();b=new OpenLayers.Layer.Vector(a.title||f.name,{strategies:[new OpenLayers.Strategy.BBOX],styleMap:e,protocol:new OpenLayers.Protocol.WFS({version:this.version,url:f.protocol.url,srsName:b.getCode(),featureType:f.protocol.featureType,featureNS:f.protocol.featureNS,outputFormat:"GML2",geometryName:null}),projection:b,attribution:f.attribution||a.attribution,maxExtent:d,restrictedExtent:d,
visibility:"visibility"in a?a.visibility:!1,queryable:c.get("queryable")});var d=Ext.applyIf({title:b.name,group:a.group,source:a.source,properties:null,fixed:a.fixed,selected:"selected"in a?a.selected:!1,restUrl:this.restUrl,layer:b},c.data),g=[{name:"source",type:"string"},{name:"group",type:"string"},{name:"properties",type:"string"},{name:"fixed",type:"boolean"},{name:"selected",type:"boolean"},{name:"restUrl",type:"string"},{name:"infoFormat",type:"string"},{name:"getFeatureInfo"}];c.fields.each(function(a){g.push(a)});
b=new (GeoExt.data.LayerRecord.create(g))(d,b.id);b.json=a}else window.console&&0<this.store.getCount()&&void 0!==a.name&&console.warn("Could not create layer record for layer '"+a.name+"'. Check if the layer is found in the WFS GetCapabilities response.");return b},initDescribeLayerStore:function(){var a=this.store.reader.raw;this.lazy&&(a={capability:{request:{describelayer:{href:this.url}}},version:this.version||"1.1.1"});var b=a.capability.request.describelayer;if(b)a=a.version,1.1<parseFloat(a)&&
(a="1.1.1"),a={SERVICE:"WFS",VERSION:a,REQUEST:"DescribeLayer"},this.describeLayerStore=new GeoExt.data.WFSDescribeLayerStore({url:this.trimUrl(b.href,a),baseParams:a})},describeLayer:function(a,b,c){function d(a){window.setTimeout(function(){b.call(c,a)},0)}this.describeLayerStore||this.initDescribeLayerStore();if(this.describeLayerStore){if(!this.describedLayers)this.describedLayers={};var e=a.getLayer().params.LAYERS,a=function(){for(var a=Ext.isArray(arguments[1])?arguments[1]:arguments[0],d,
g,l=a.length-1;0<=l;l--){d=a[l];g=d.get("layerName");if(g==e){this.describeLayerStore.un("load",arguments.callee,this);this.describedLayers[g]=!0;b.call(c,d);return}"function"==typeof this.describedLayers[g]&&(d=this.describedLayers[g],this.describeLayerStore.un("load",d,this),d.apply(this,arguments))}delete f[e];b.call(c,!1)},f=this.describedLayers,g;if(f[e])if(-1==(g=this.describeLayerStore.findExact("layerName",e)))this.describeLayerStore.on("load",a,this);else d(this.describeLayerStore.getAt(g));
else f[e]=a,this.describeLayerStore.load({params:{LAYERS:e},add:!0,callback:a,scope:this})}else d(!1)},fetchSchema:function(a,b,c,d){var e=this.schemaCache[b];if(e)if(0==e.getCount())e.on("load",function(){c.call(d,e)},this,{single:!0});else c.call(d,e);else e=new GeoExt.data.AttributeStore({url:a,baseParams:{SERVICE:"WFS",VERSION:"1.1.0",REQUEST:"DescribeFeatureType",TYPENAME:b},autoLoad:!0,listeners:{load:function(){c.call(d,e)},scope:this}}),this.schemaCache[b]=e},getSchema:function(a,b,c){if(!this.schemaCache)this.schemaCache=
{};this.describeLayer(a,function(d){if(d&&"WFS"==d.get("owsType")){var e=d.get("typeName");this.fetchSchema(d.get("owsURL"),e,b,c)}else d?b.call(c,!1):this.fetchSchema(this.url,a.get("name"),b,c)},this)},getWFSProtocol:function(a,b,c){this.getSchema(a,function(d){var e=!1;if(d){var f,g=/gml:((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry)).*/;d.each(function(a){g.exec(a.get("type"))&&(f=a.get("name"))},this);e=new OpenLayers.Protocol.WFS({version:"1.1.0",srsName:a.getLayer().projection.getCode(),
url:d.url,featureType:d.reader.raw.featureTypes[0].typeName,featureNS:d.reader.raw.targetNamespace,geometryName:f})}b.call(c,e,d,a)},this)},getConfigForRecord:function(a){var b=Ext.applyIf(gxp.plugins.WFSSource.superclass.getConfigForRecord.apply(this,arguments),a.json),c=a.getLayer(),d=c.params,e=c.options,f=b.name,g=this.store.reader.raw;if(g)for(var g=g.capability.layers,h=g.length-1;0<=h;--h)if(g[h].name===f){b.capability=Ext.apply({},g[h]);f={};f[c.projection.getCode()]=!0;b.capability.srs=f;
break}if(!b.capability){if(c.maxExtent)b.bbox=c.maxExtent.toArray();b.srs=c.projection.getCode()}return Ext.apply(b,{format:d.FORMAT,styles:d.STYLES,tiled:!e.singleTile,transparent:d.TRANSPARENT,cql_filter:d.CQL_FILTER,minscale:e.minScale,maxscale:e.maxScale,infoFormat:a.get("infoFormat"),attribution:c.attribution})},getState:function(){var a=gxp.plugins.WFSSource.superclass.getState.apply(this,arguments);return Ext.applyIf(a,{title:this.title})}});Ext.preg(gxp.plugins.WFSSource.prototype.ptype,gxp.plugins.WFSSource);
Ext.namespace("gxp.plugins");gxp.plugins.WizardContainer={init:function(a){a.addEvents("wizardstepvalid","wizardstepinvalid","wizardstepexpanded");a.on("add",function(b){b.on("expand",function(){a.fireEvent("wizardstepexpanded",a.items.indexOf(b))})})}};Ext.preg("gxp_wizardcontainer",gxp.plugins.WizardContainer);Ext.namespace("gxp.plugins");
gxp.plugins.WizardStep=Ext.extend(gxp.plugins.Tool,{autoActivate:!1,index:null,valid:!1,wizardContainer:null,wizardData:null,constructor:function(a){gxp.plugins.WizardStep.superclass.constructor.apply(this,arguments);this.wizardData={}},addOutput:function(a){a=Ext.ComponentMgr.create(Ext.apply(a,this.outputConfig));a.on("added",function(a,c){this.wizardContainer=c.ownerCt;this.index=c.ownerCt.items.indexOf(c);c.setDisabled(0!=this.index);c.ownerCt.on({wizardstepvalid:function(a,b){Ext.apply(this.wizardData,
b);this.previousStepsCompleted()&&c.enable()},wizardstepinvalid:function(){this.previousStepsCompleted()||c.disable()},scope:this});c.on({expand:this.activate,collapse:this.deactivate,scope:this})},this);return gxp.plugins.WizardStep.superclass.addOutput.call(this,a)},setValid:function(a,b){(this.valid=a)?this.wizardContainer.fireEvent("wizardstepvalid",this,b):this.wizardContainer.fireEvent("wizardstepinvalid",this)},previousStepsCompleted:function(){var a=this.index,b=!0;if(0<a){var c,d;for(d in this.target.tools)c=
this.target.tools[d],c instanceof gxp.plugins.WizardStep&&c.index<a&&(b=b&&c.valid)}return b}});Ext.namespace("gxp.plugins");
gxp.plugins.WMSCSource=Ext.extend(gxp.plugins.WMSSource,{ptype:"gxp_wmscsource",version:"1.1.1",constructor:function(a){a.baseParams={SERVICE:"WMS",REQUEST:"GetCapabilities",TILED:!0};if(!a.format)this.format=new OpenLayers.Format.WMSCapabilities({keepData:!0,profile:"WMSC",allowFallback:!0});gxp.plugins.WMSCSource.superclass.constructor.apply(this,arguments)},createLayerRecord:function(a){var b=gxp.plugins.WMSCSource.superclass.createLayerRecord.apply(this,arguments);if(b){var c,d;if(this.store.reader.raw)c=
this.store.reader.raw.capability;var e=c&&c.vendorSpecific?c.vendorSpecific.tileSets:a.capability&&a.capability.tileSets;c=b.get("layer");if(e)for(var f=this.getProjection(b)||this.getMapProjection(),g=0,h=e.length;g<h;g++){var j=e[g];if(j.layers===c.params.LAYERS){var k;for(d in j.srs){k=new OpenLayers.Projection(d);break}if(f.equals(k)){d=j.bbox[d].bbox;c.projection=k;c.addOptions({resolutions:j.resolutions,tileSize:new OpenLayers.Size(j.width,j.height),tileOrigin:new OpenLayers.LonLat(d[0],d[1])});
break}}}else if(this.lazy&&(k=a.tileSize,d=a.tileOrigin,c.addOptions({resolutions:a.resolutions,tileSize:k?new OpenLayers.Size(k[0],k[1]):void 0,tileOrigin:d?OpenLayers.LonLat.fromArray(d):void 0}),!d&&(this.target.map.maxExtent?k=this.target.map.maxExtent:(d=a.srs||this.target.map.projection,k=OpenLayers.Projection.defaults[d].maxExtent),k)))c.tileOrigin=OpenLayers.LonLat.fromArray(k);c.params.TILED=!1!==a.cached&&!0;return b}},getConfigForRecord:function(a){var b=gxp.plugins.WMSCSource.superclass.getConfigForRecord.apply(this,
arguments),c=b.name,d,e=a.getLayer();if(b.capability&&this.store.reader.raw){d=this.store.reader.raw.capability;var f=d.vendorSpecific&&d.vendorSpecific.tileSets;if(f)for(var g=f.length-1;0<=g;--g)if(d=f[g],d.layers===c&&d.srs[e.projection]){b.capability.tileSets=[d];break}}if(!b.capability||!b.capability.tileSets){if(c=e.options.tileSize)b.tileSize=[c.w,c.h];b.tileOrigin=e.options.tileOrigin;b.resolutions=e.options.resolutions}return Ext.applyIf(b,{cached:!!e.params.TILED})}});
Ext.preg(gxp.plugins.WMSCSource.prototype.ptype,gxp.plugins.WMSCSource);Ext.namespace("gxp.plugins");
gxp.plugins.WMSFilterView=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_wmsfilterview",featureManager:null,init:function(a){gxp.plugins.WMSFilterView.superclass.init.apply(this,arguments);this.createFilterLayer()},createFilterLayer:function(){this.filterLayer=new OpenLayers.Layer.WMS(this.id+"filterlayer",Ext.BLANK_IMAGE_URL,{format:"image/png",transparent:!0},{buffer:0,displayInLayerSwitcher:!1,tileOptions:{maxGetUrlLength:2048}});var a=this.target.mapPanel.map;a.addLayer(this.filterLayer);a.events.on({addlayer:this.raiseLayer,
scope:this});var b=this.target.tools[this.featureManager],c=new OpenLayers.Format.SLD,a=function(){this.filterLayer.setUrl(Ext.BLANK_IMAGE_URL);this.filterLayer.setVisibility(!1)}.bind(this);b.on({clearfeatures:a,beforelayerchange:a,beforequery:function(){this.filterLayer.setUrl(Ext.BLANK_IMAGE_URL);this.filterLayer.setVisibility(!1)},query:function(a,e,f){if(f){var e=new OpenLayers.Rule,g=b.geometryType.replace(/^Multi/,""),h=b.style.all.rules[0].symbolizer;e.symbolizer[g]=Ext.applyIf(Ext.apply({},
h[g]||h),OpenLayers.Feature.Vector.style["default"]);e=new OpenLayers.Style(null,{rules:[e]});this.filterLayer.setUrl(a.layerRecord.getLayer().url);if(f instanceof OpenLayers.Filter.Logical){a=f.filters;for(g=a.length-1;0<=g;--g)a[g].type===OpenLayers.Filter.Spatial.BBOX&&a.remove(a[g]);1==a.length&&f.type!==OpenLayers.Filter.Comparison.NOT?f=a[0]:0==a.length&&(f=null)}else f.type===OpenLayers.Filter.Spatial.BBOX&&(f=null);a={};if(f)f instanceof OpenLayers.Filter.FeatureId?a.featureid=f.fids:a.cql_filter=
(new OpenLayers.Format.CQL).write(f);this.filterLayer.mergeNewParams(Ext.apply(a,{sld_body:c.write({namedLayers:[{name:b.layerRecord.get("name"),userStyles:[e]}]}).replace(/( (xmlns|xsi):[^\"]*\"[^\"]*"|sld:)/g,"")}));this.filterLayer.setVisibility(!0)}},scope:this})},raiseLayer:function(){var a=this.filterLayer.map;a.setLayerIndex(this.filterLayer,a.layers.length)}});Ext.preg(gxp.plugins.WMSFilterView.prototype.ptype,gxp.plugins.WMSFilterView);Ext.namespace("gxp.plugins");
gxp.plugins.WMSGetFeatureInfo=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_wmsgetfeatureinfo",outputTarget:"map",popupCache:null,infoActionTip:"Get Feature Info",popupTitle:"Feature Info",buttonText:"Identify",format:"html",addActions:function(){var a;this.popupCache={};var b=gxp.plugins.WMSGetFeatureInfo.superclass.addActions.call(this,[{tooltip:this.infoActionTip,iconCls:"gxp-icon-getfeatureinfo",buttonText:this.buttonText,toggleGroup:this.toggleGroup,enableToggle:!0,allowDepress:!0,toggleHandler:function(b,
c){for(var d=0,h=a.length;d<h;d++)c?a[d].activate():a[d].deactivate()}}]),c=this.actions[0].items[0];a=[];var d=function(){for(var b=this.target.mapPanel.layers.queryBy(function(a){return a.get("queryable")}),d=this.target.mapPanel.map,g,h=0,j=a.length;h<j;h++)g=a[h],g.deactivate(),g.destroy();a=[];b.each(function(b){var e=b.getLayer(),g=Ext.apply({},this.vendorParams),h;if(this.layerParams)for(var j=this.layerParams.length-1;0<=j;--j)h=this.layerParams[j].toUpperCase(),g[h]=e.params[h];var q=b.get("infoFormat");
void 0===q&&(q="html"==this.format?"text/html":"application/vnd.ogc.gml");e=new OpenLayers.Control.WMSGetFeatureInfo(Ext.applyIf({url:e.url,queryVisible:!0,layers:[e],infoFormat:q,vendorParams:g,eventListeners:{getfeatureinfo:function(a){var c=b.get("title")||b.get("name");if("text/html"==q){var d=a.text.match(/<body[^>]*>([\s\S]*)<\/body>/);d&&!d[1].match(/^\s*$/)&&this.displayPopup(a,c,d[1])}else"text/plain"==q?this.displayPopup(a,c,"<pre>"+a.text+"</pre>"):a.features&&0<a.features.length&&this.displayPopup(a,
c,null,b.get("getFeatureInfo"))},scope:this}},this.controlOptions));d.addControl(e);a.push(e);c.pressed&&e.activate()},this)};this.target.mapPanel.layers.on("update",d,this);this.target.mapPanel.layers.on("add",d,this);this.target.mapPanel.layers.on("remove",d,this);return b},displayPopup:function(a,b,c,d){var e,f=a.xy.x+"."+a.xy.y,d=d||{};f in this.popupCache?e=this.popupCache[f]:(e=this.addOutput({xtype:"gx_popup",title:this.popupTitle,layout:"accordion",fill:!1,autoScroll:!0,location:a.xy,map:this.target.mapPanel,
width:250,height:300,defaults:{layout:"fit",autoScroll:!0,autoHeight:!0,autoWidth:!0,collapsible:!0}}),e.on({close:function(a){return function(){delete this.popupCache[a]}}(f),scope:this}),this.popupCache[f]=e);a=a.features;f=[];if(!c&&a)for(var g=0,h=a.length;g<h;++g)c=a[g],f.push(Ext.apply({xtype:"gxp_editorgrid",readOnly:!0,listeners:{beforeedit:function(){return!1}},title:c.fid?c.fid:b,feature:c,fields:d.fields,propertyNames:d.propertyNames},this.itemConfig));else c&&f.push(Ext.apply({title:b,
html:c},this.itemConfig));e.add(f);e.doLayout()}});Ext.preg(gxp.plugins.WMSGetFeatureInfo.prototype.ptype,gxp.plugins.WMSGetFeatureInfo);Ext.namespace("gxp.plugins");
gxp.plugins.Zoom=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_zoom",zoomMenuText:"Zoom Box",zoomInMenuText:"Zoom In",zoomOutMenuText:"Zoom Out",zoomTooltip:"Zoom by dragging a box",zoomInTooltip:"Zoom in",zoomOutTooltip:"Zoom out",constructor:function(a){gxp.plugins.Zoom.superclass.constructor.apply(this,arguments)},addActions:function(){var a=[{menuText:this.zoomInMenuText,iconCls:"gxp-icon-zoom-in",tooltip:this.zoomInTooltip,handler:function(){this.target.mapPanel.map.zoomIn()},scope:this},{menuText:this.zoomOutMenuText,
iconCls:"gxp-icon-zoom-out",tooltip:this.zoomOutTooltip,handler:function(){this.target.mapPanel.map.zoomOut()},scope:this}];this.showZoomBoxAction&&a.unshift(new GeoExt.Action({menuText:this.zoomText,iconCls:"gxp-icon-zoom",tooltip:this.zoomTooltip,control:new OpenLayers.Control.ZoomBox(this.controlOptions),map:this.target.mapPanel.map,enableToggle:!0,allowDepress:!1,toggleGroup:this.toggleGroup}));return gxp.plugins.Zoom.superclass.addActions.apply(this,[a])}});
Ext.preg(gxp.plugins.Zoom.prototype.ptype,gxp.plugins.Zoom);Ext.namespace("gxp.plugins");
gxp.plugins.ZoomToExtent=Ext.extend(gxp.plugins.Tool,{ptype:"gxp_zoomtoextent",menuText:"Zoom To Max Extent",tooltip:"Zoom To Max Extent",extent:null,closest:!0,iconCls:"gxp-icon-zoomtoextent",closest:!0,constructor:function(a){gxp.plugins.ZoomToExtent.superclass.constructor.apply(this,arguments);if(this.extent instanceof Array)this.extent=OpenLayers.Bounds.fromArray(this.extent)},addActions:function(){return gxp.plugins.ZoomToExtent.superclass.addActions.apply(this,[{text:this.buttonText,menuText:this.menuText,
iconCls:this.iconCls,tooltip:this.tooltip,handler:function(){var a=this.target.mapPanel.map,b="function"==typeof this.extent?this.extent():this.extent;if(!b)for(var c,d=0,e=a.layers.length;d<e;++d)c=a.layers[d],c.getVisibility()&&(c=c.restrictedExtent||c.maxExtent,b?b.extend(c):c&&(b=c.clone()));b&&((d=a.restrictedExtent||a.maxExtent)&&(b=new OpenLayers.Bounds(Math.max(b.left,d.left),Math.max(b.bottom,d.bottom),Math.min(b.right,d.right),Math.min(b.top,d.top))),a.zoomToExtent(b,this.closest))},scope:this}])}});
Ext.preg(gxp.plugins.ZoomToExtent.prototype.ptype,gxp.plugins.ZoomToExtent);Ext.namespace("gxp.plugins");
gxp.plugins.ZoomToDataExtent=Ext.extend(gxp.plugins.ZoomToExtent,{ptype:"gxp_zoomtodataextent",menuText:"Zoom to layer extent",tooltip:"Zoom to layer extent",closest:!1,iconCls:"gxp-icon-zoom-to",extent:function(){return this.target.tools[this.featureManager].featureLayer.getDataExtent()},addActions:function(){var a=gxp.plugins.ZoomToDataExtent.superclass.addActions.apply(this,arguments);a[0].disable();var b=this.target.tools[this.featureManager].featureLayer;b.events.on({featuresadded:function(){a[0].isDisabled()&&
a[0].enable()},featuresremoved:function(){0==b.features.length&&a[0].disable()}});return a}});Ext.preg(gxp.plugins.ZoomToDataExtent.prototype.ptype,gxp.plugins.ZoomToDataExtent);Ext.namespace("gxp.plugins");
gxp.plugins.ZoomToLayerExtent=Ext.extend(gxp.plugins.ZoomToExtent,{ptype:"gxp_zoomtolayerextent",menuText:"Zoom to layer extent",tooltip:"Zoom to layer extent",iconCls:"gxp-icon-zoom-to",destroy:function(){this.selectedRecord=null;gxp.plugins.ZoomToLayerExtent.superclass.destroy.apply(this,arguments)},extent:function(){var a=this.selectedRecord.getLayer(),b;OpenLayers.Layer.Vector&&(b=a instanceof OpenLayers.Layer.Vector&&a.getDataExtent());return a.restrictedExtent||b||a.maxExtent||map.maxExtent},
addActions:function(){var a=gxp.plugins.ZoomToLayerExtent.superclass.addActions.apply(this,arguments);a[0].disable();this.target.on("layerselectionchange",function(b){this.selectedRecord=b;a[0].setDisabled(!b||!b.get("layer"))},this);return a}});Ext.preg(gxp.plugins.ZoomToLayerExtent.prototype.ptype,gxp.plugins.ZoomToLayerExtent);Ext.namespace("gxp.plugins");
gxp.plugins.ZoomToSelectedFeatures=Ext.extend(gxp.plugins.ZoomToExtent,{ptype:"gxp_zoomtoselectedfeatures",menuText:"Zoom to selected features",tooltip:"Zoom to selected features",closest:!1,layer:null,iconCls:"gxp-icon-zoom-to",extent:function(){for(var a,b,c=this.target.tools[this.featureManager].featureLayer.selectedFeatures,d=c.length-1;0<=d;--d)if(b=c[d].geometry)b=b.getBounds(),a?a.extend(b):a=b.clone();return a},addActions:function(){function a(){this.layer&&this.layer.events.un(c);if(this.layer=
d.featureLayer)this.layer.events.on(c)}var b=gxp.plugins.ZoomToSelectedFeatures.superclass.addActions.apply(this,arguments);b[0].disable();var c={featureselected:function(a){b[0].isDisabled()&&null!==a.feature.geometry&&b[0].enable()},featureunselected:function(){0===this.layer.selectedFeatures.length&&b[0].disable()},scope:this},d=this.target.tools[this.featureManager];this.target.on("layerselectionchange",a);d.on("query",function(){b[0].disable()});a.call(this);return b}});
Ext.preg(gxp.plugins.ZoomToSelectedFeatures.prototype.ptype,gxp.plugins.ZoomToSelectedFeatures);Ext.namespace("gxp");
gxp.CrumbPanel=Ext.extend(Ext.TabPanel,{widths:null,enableTabScroll:!0,initComponent:function(){gxp.CrumbPanel.superclass.initComponent.apply(this,arguments);this.widths={}},onBeforeAdd:function(a){gxp.CrumbPanel.superclass.onBeforeAdd.apply(this,arguments);if(a.shortTitle)a.title=a.shortTitle},onAdd:function(a){gxp.CrumbPanel.superclass.onAdd.apply(this,arguments);this.setActiveTab(this.items.getCount()-1);a.on("hide",this.onCmpHide,this);a.getEl().dom.style.display=""},onRemove:function(a){gxp.CrumbPanel.superclass.onRemove.apply(this,
arguments);a.un("hide",this.onCmpHide,this);var b=this.widths[this.get(this.items.getCount()-1).id];b&&b<this.getWidth()&&(this.setWidth(b),this.ownerCt&&this.ownerCt.syncSize());a.getEl().dom.style.display="none";this.activeTab.doLayout()},onRender:function(a){if(!this.initialConfig.itemTpl)this.itemTpl=new Ext.Template('<li class="{cls} gxp-crumb" id="{id}"><div class="gxp-crumb-separator">\u00bb</div>','<a class="x-tab-right" href="#"><em class="x-tab-left">','<span class="x-tab-strip-inner"><span class="x-tab-strip-text {iconCls}">{text}</span></span>',
"</em></a></li>");gxp.CrumbPanel.superclass.onRender.apply(this,arguments);this.getEl().down("div").addClass("gxp-crumbpanel-header")},onCmpHide:function(a){var b=this.items.getCount()-1;this.items.indexOf(a)===b&&this.setActiveTab(this.get(--b))},setActiveTab:function(a){var b;Ext.isNumber(a)?(b=a,a=this.get(b)):b=this.items.indexOf(a);if(~b){var c,d;for(d=this.items.getCount()-1;d>b;--d)c=this.get(d),this.remove(c,"hide"!==c.closeAction)}c=a.initialConfig.minWidth||a.initialConfig.width;d=this.getWidth();
c>d&&(this.widths[this.get(b-1).id]=d,this.setWidth(c),this.ownerCt&&this.ownerCt.syncSize());gxp.CrumbPanel.superclass.setActiveTab.apply(this,arguments)}});Ext.reg("gxp_crumbpanel",gxp.CrumbPanel);Ext.namespace("gxp");
gxp.EmbedMapDialog=Ext.extend(Ext.Container,{url:null,url:null,publishMessage:"Your map is ready to be published to the web! Simply copy the following HTML to embed the map in your website:",heightLabel:"Height",widthLabel:"Width",mapSizeLabel:"Map Size",miniSizeLabel:"Mini",smallSizeLabel:"Small",premiumSizeLabel:"Premium",largeSizeLabel:"Large",snippetArea:null,heightField:null,widthField:null,initComponent:function(){Ext.apply(this,this.getConfig());gxp.EmbedMapDialog.superclass.initComponent.call(this)},
getIframeHTML:function(){return this.snippetArea.getValue()},updateSnippet:function(){this.snippetArea.setValue('<iframe style="border: none;" height="'+this.heightField.getValue()+'" width="'+this.widthField.getValue()+'" src="'+gxp.util.getAbsoluteUrl(this.url)+'"></iframe>');!0===this.snippetArea.isVisible()&&this.snippetArea.focus(!0,100)},getConfig:function(){this.snippetArea=new Ext.form.TextArea({height:70,selectOnFocus:!0,readOnly:!0});var a={change:this.updateSnippet,specialkey:function(a,
c){c.getKey()==c.ENTER&&this.updateSnippet()},scope:this};this.heightField=new Ext.form.NumberField({width:50,value:400,listeners:a});this.widthField=new Ext.form.NumberField({width:50,value:600,listeners:a});return{border:!1,defaults:{border:!1,cls:"gxp-export-section",xtype:"container",layout:"fit"},items:[{items:[new Ext.Container({layout:"column",defaults:{border:!1,xtype:"box"},items:[{autoEl:{cls:"gxp-field-label",html:this.mapSizeLabel}},new Ext.form.ComboBox({editable:!1,width:75,store:new Ext.data.SimpleStore({fields:["name",
"height","width"],data:[[this.miniSizeLabel,100,100],[this.smallSizeLabel,200,300],[this.largeSizeLabel,400,600],[this.premiumSizeLabel,600,800]]}),triggerAction:"all",displayField:"name",value:this.largeSizeLabel,mode:"local",listeners:{select:function(a,c){this.widthField.setValue(c.get("width"));this.heightField.setValue(c.get("height"));this.updateSnippet()},scope:this}}),{autoEl:{cls:"gxp-field-label",html:this.heightLabel}},this.heightField,{autoEl:{cls:"gxp-field-label",html:this.widthLabel}},
this.widthField]})]},{xtype:"box",autoEl:{tag:"p",html:this.publishMessage}},{items:[this.snippetArea]}],listeners:{afterrender:this.updateSnippet,scope:this}}}});Ext.reg("gxp_embedmapdialog",gxp.EmbedMapDialog);Ext.namespace("gxp");
gxp.FillSymbolizer=Ext.extend(Ext.FormPanel,{symbolizer:null,colorProperty:"fillColor",opacityProperty:"fillOpacity",colorManager:null,checkboxToggle:!0,defaultColor:null,border:!1,fillText:"Fill",colorText:"Color",opacityText:"Opacity",initComponent:function(){if(!this.symbolizer)this.symbolizer={};var a;this.colorManager&&(a=[new this.colorManager]);var b=100;this.opacityProperty in this.symbolizer?b=100*this.symbolizer[this.opacityProperty]:OpenLayers.Renderer.defaultSymbolizerGXP[this.opacityProperty]&&
(b=100*OpenLayers.Renderer.defaultSymbolizerGXP[this.opacityProperty]);this.items=[{xtype:"fieldset",title:this.fillText,autoHeight:!0,checkboxToggle:this.checkboxToggle,collapsed:!0===this.checkboxToggle&&!1===this.symbolizer.fill,hideMode:"offsets",defaults:{width:100},items:[{xtype:"gxp_colorfield",fieldLabel:this.colorText,name:"color",emptyText:OpenLayers.Renderer.defaultSymbolizerGXP[this.colorProperty],value:this.symbolizer[this.colorProperty],defaultBackground:this.defaultColor||OpenLayers.Renderer.defaultSymbolizerGXP[this.colorProperty],
plugins:a,listeners:{valid:function(a){var a=a.getValue(),b=this.symbolizer[this.colorProperty]!=a;this.symbolizer[this.colorProperty]=a;b&&this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"slider",fieldLabel:this.opacityText,name:"opacity",values:[b],isFormField:!0,listeners:{changecomplete:function(a,b){this.symbolizer[this.opacityProperty]=b/100;this.fireEvent("change",this.symbolizer)},scope:this},plugins:[new GeoExt.SliderTip({getText:function(a){return a.value+"%"}})]}],listeners:{collapse:function(){if(!1!==
this.symbolizer.fill)this.symbolizer.fill=!1,this.fireEvent("change",this.symbolizer)},expand:function(){this.symbolizer.fill=!0;this.fireEvent("change",this.symbolizer)},scope:this}}];this.addEvents("change");gxp.FillSymbolizer.superclass.initComponent.call(this)}});Ext.reg("gxp_fillsymbolizer",gxp.FillSymbolizer);Ext.namespace("gxp");
gxp.FilterBuilder=Ext.extend(Ext.Container,{builderTypeNames:["any","all","none","not all"],allowedBuilderTypes:null,allowBlank:!1,caseInsensitiveMatch:!1,preComboText:"Match",postComboText:"of the following:",cls:"gxp-filterbuilder",builderType:null,childFilterContainer:null,customizeFilterOnInit:!0,addConditionText:"add condition",addGroupText:"add group",removeConditionText:"remove condition",allowGroups:!0,initComponent:function(){Ext.applyIf(this,{defaultBuilderType:gxp.FilterBuilder.ANY_OF});
if(this.customizeFilterOnInit)this.filter=this.customizeFilter(this.filter);this.builderType=this.getBuilderType();this.items=[{xtype:"container",layout:"form",ref:"form",defaults:{anchor:"100%"},hideLabels:!0,items:[{xtype:"compositefield",style:"padding-left: 2px",items:[{xtype:"label",style:"padding-top: 0.3em",text:this.preComboText},this.createBuilderTypeCombo(),{xtype:"label",style:"padding-top: 0.3em",text:this.postComboText}]},this.createChildFiltersPanel(),{xtype:"toolbar",items:this.createToolBar()}]}];
this.addEvents("change");gxp.FilterBuilder.superclass.initComponent.call(this)},createToolBar:function(){var a=[{text:this.addConditionText,iconCls:"add",handler:function(){this.addCondition()},scope:this}];this.allowGroups&&a.push({text:this.addGroupText,iconCls:"add",handler:function(){this.addCondition(!0)},scope:this});return a},getFilter:function(){var a;this.filter&&(a=this.filter.clone(),a instanceof OpenLayers.Filter.Logical&&(a=this.cleanFilter(a)));return a},cleanFilter:function(a){if(a instanceof
OpenLayers.Filter.Logical)if(a.type!==OpenLayers.Filter.Logical.NOT&&1===a.filters.length)a=this.cleanFilter(a.filters[0]);else for(var b,c=0,d=a.filters.length;c<d;++c)if(b=a.filters[c],b instanceof OpenLayers.Filter.Logical)if(b=this.cleanFilter(b))a.filters[c]=b;else{a=b;break}else{if(!b||null===b.type||null===b.property||null===b[a.type===OpenLayers.Filter.Comparison.BETWEEN?"lowerBoundary":"value"]){a=!1;break}}else if(!a||null===a.type||null===a.property||null===a[a.type===OpenLayers.Filter.Comparison.BETWEEN?
"lowerBoundary":"value"])a=!1;return a},customizeFilter:function(a){if(a){var a=this.cleanFilter(a),b,c,d;switch(a.type){case OpenLayers.Filter.Logical.AND:case OpenLayers.Filter.Logical.OR:if(!a.filters||0===a.filters.length)a.filters=[this.createDefaultFilter()];else for(c=0,d=a.filters.length;c<d;++c)b=a.filters[c],b instanceof OpenLayers.Filter.Logical&&(a.filters[c]=this.customizeFilter(b));a=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[a]});break;case OpenLayers.Filter.Logical.NOT:if(!a.filters||
0===a.filters.length)a.filters=[new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[this.createDefaultFilter()]})];else if(b=a.filters[0],b instanceof OpenLayers.Filter.Logical)if(b.type!==OpenLayers.Filter.Logical.NOT){var e;for(c=0,d=b.filters.length;c<d;++c)e=b.filters[c],e instanceof OpenLayers.Filter.Logical&&(b.filters[c]=this.customizeFilter(e))}else a=b.filters&&0<b.filters.length?this.customizeFilter(b.filters[0]):this.wrapFilter(this.createDefaultFilter());else a.filters=
[new OpenLayers.Filter.Logical({type:this.defaultBuilderType===gxp.FilterBuilder.NOT_ALL_OF?OpenLayers.Filter.Logical.AND:OpenLayers.Filter.Logical.OR,filters:[b]})];break;default:a=this.wrapFilter(a)}}else a=this.wrapFilter(this.createDefaultFilter());return a},createDefaultFilter:function(){return new OpenLayers.Filter.Comparison({matchCase:!this.caseInsensitiveMatch})},wrapFilter:function(a){return new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:[new OpenLayers.Filter.Logical({type:this.defaultBuilderType===
gxp.FilterBuilder.ALL_OF?OpenLayers.Filter.Logical.AND:OpenLayers.Filter.Logical.OR,filters:[a]})]})},addCondition:function(a){var b,c;a?(c="gxp_filterbuilder",b=this.wrapFilter(this.createDefaultFilter())):(c="gxp_filterfield",b=this.createDefaultFilter());this.childFilterContainer.add(this.newRow({xtype:c,filter:b,columnWidth:1,attributes:this.attributes,allowBlank:a?void 0:this.allowBlank,customizeFilterOnInit:a&&!1,caseInsensitiveMatch:this.caseInsensitiveMatch,listeners:{change:function(){this.fireEvent("change",
this)},scope:this}}));this.filter.filters[0].filters.push(b);this.childFilterContainer.doLayout()},removeCondition:function(a,b){var c=this.filter.filters[0].filters;0<c.length&&(c.remove(b),this.childFilterContainer.remove(a,!0));0===c.length&&this.addCondition();this.fireEvent("change",this)},createBuilderTypeCombo:function(){for(var a=this.allowedBuilderTypes||[gxp.FilterBuilder.ANY_OF,gxp.FilterBuilder.ALL_OF,gxp.FilterBuilder.NONE_OF],b=a.length,c=Array(b),d,e=0;e<b;++e)d=a[e],c[e]=[d,this.builderTypeNames[d]];
return{xtype:"combo",store:new Ext.data.SimpleStore({data:c,fields:["value","name"]}),value:this.builderType,ref:"../../builderTypeCombo",displayField:"name",valueField:"value",triggerAction:"all",mode:"local",listeners:{select:function(a,b){this.changeBuilderType(b.get("value"));this.fireEvent("change",this)},scope:this},width:60}},changeBuilderType:function(a){if(a!==this.builderType){this.builderType=a;var b=this.filter.filters[0];switch(a){case gxp.FilterBuilder.ANY_OF:this.filter.type=OpenLayers.Filter.Logical.OR;
b.type=OpenLayers.Filter.Logical.OR;break;case gxp.FilterBuilder.ALL_OF:this.filter.type=OpenLayers.Filter.Logical.OR;b.type=OpenLayers.Filter.Logical.AND;break;case gxp.FilterBuilder.NONE_OF:this.filter.type=OpenLayers.Filter.Logical.NOT;b.type=OpenLayers.Filter.Logical.OR;break;case gxp.FilterBuilder.NOT_ALL_OF:this.filter.type=OpenLayers.Filter.Logical.NOT,b.type=OpenLayers.Filter.Logical.AND}}},createChildFiltersPanel:function(){this.childFilterContainer=new Ext.Container;for(var a=this.filter.filters[0].filters,
b,c=0,d=a.length;c<d;++c){b=a[c];var e={xtype:"gxp_filterfield",allowBlank:this.allowBlank,columnWidth:1,filter:b,attributes:this.attributes,listeners:{change:function(){this.fireEvent("change",this)},scope:this}};this.childFilterContainer.add(this.newRow(Ext.applyIf(b instanceof OpenLayers.Filter.Logical?{xtype:"gxp_filterbuilder"}:{xtype:"container",layout:"form",hideLabels:!0,items:e},e)))}return this.childFilterContainer},newRow:function(a){var b=new Ext.Container({layout:"column",items:[{xtype:"container",
width:28,height:26,style:"padding-left: 2px",items:{xtype:"button",tooltip:this.removeConditionText,iconCls:"delete",handler:function(){this.removeCondition(b,a.filter)},scope:this}},a]});return b},getBuilderType:function(){var a=this.defaultBuilderType;if(this.filter){var b=this.filter.filters[0];if(this.filter.type===OpenLayers.Filter.Logical.NOT)switch(b.type){case OpenLayers.Filter.Logical.OR:a=gxp.FilterBuilder.NONE_OF;break;case OpenLayers.Filter.Logical.AND:a=gxp.FilterBuilder.NOT_ALL_OF}else switch(b.type){case OpenLayers.Filter.Logical.OR:a=
gxp.FilterBuilder.ANY_OF;break;case OpenLayers.Filter.Logical.AND:a=gxp.FilterBuilder.ALL_OF}}return a},setFilter:function(a){this.filter=this.customizeFilter(a);this.changeBuilderType(this.getBuilderType());this.builderTypeCombo.setValue(this.builderType);this.form.remove(this.childFilterContainer);this.form.insert(1,this.createChildFiltersPanel());this.form.doLayout();this.fireEvent("change",this)}});gxp.FilterBuilder.ANY_OF=0;gxp.FilterBuilder.ALL_OF=1;gxp.FilterBuilder.NONE_OF=2;
gxp.FilterBuilder.NOT_ALL_OF=3;Ext.reg("gxp_filterbuilder",gxp.FilterBuilder);Ext.namespace("gxp.form");
gxp.form.AutoCompleteComboBox=Ext.extend(Ext.form.ComboBox,{xtype:"gxp_autocompletecombo",fieldName:null,featureType:null,featurePrefix:null,fieldLabel:null,geometryName:null,maxFeatures:500,url:null,srsName:null,autoHeight:!0,hideTrigger:!0,customSortInfo:null,initComponent:function(){var a=[{name:this.fieldName}],b=[this.fieldName];null!==this.geometryName&&(a.push({name:this.geometryName}),b.push(this.geometryName));if(!this.name)this.name=this.fieldName;this.valueField=this.displayField=this.fieldName;
this.tpl=new Ext.XTemplate('<tpl for="."><div class="x-form-field">',"{"+this.fieldName+"}","</div></tpl>");this.itemSelector="div.x-form-field";this.store=new Ext.data.Store({fields:a,reader:new gxp.data.AutoCompleteReader({uniqueField:this.fieldName},b),proxy:new gxp.data.AutoCompleteProxy({protocol:new OpenLayers.Protocol.WFS({version:"1.1.0",url:this.url,featureType:this.featureType,featurePrefix:this.featurePrefix,srsName:this.srsName,propertyNames:b,maxFeatures:this.maxFeatures}),setParamsAsOptions:!0}),
sortInfo:this.customSortInfo&&{field:this.fieldName,direction:this.customSortInfo.direction}});if(this.customSortInfo)this.store.createSortFunction=this.createCustomSortFunction();return gxp.form.AutoCompleteComboBox.superclass.initComponent.apply(this,arguments)},createCustomSortFunction:function(){for(var a=RegExp(this.customSortInfo.matcher),b=this.customSortInfo.parts.length,c=Array(b),d,e=0;e<b;++e)d=this.customSortInfo.parts[e],c[e]={index:e,sortType:Ext.data.SortTypes[d.sortType||"none"],order:d.order||
0};c.sort(function(a,b){return a.order-b.order});return function(b,d){var e="DESC"==(d||"ASC").toUpperCase()?-1:1;return function(d,g){for(var l=d.data[b],n=g.data[b],m=a.exec(l)||[],o=a.exec(n)||[],q,r,s=0,u=c.length;s<u&&!(r=c[s],q=r.sortType(m[r.index+1]||l),r=r.sortType(o[r.index+1]||n),q=q>r?1:q<r?-1:0);++s);return e*q}}}});Ext.reg(gxp.form.AutoCompleteComboBox.prototype.xtype,gxp.form.AutoCompleteComboBox);Ext.namespace("gxp.form");
gxp.form.ComparisonComboBox=Ext.extend(Ext.form.ComboBox,{allowedTypes:[[OpenLayers.Filter.Comparison.EQUAL_TO,"="],[OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<>"],[OpenLayers.Filter.Comparison.LESS_THAN,"<"],[OpenLayers.Filter.Comparison.GREATER_THAN,">"],[OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,"<="],[OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,">="],[OpenLayers.Filter.Comparison.LIKE,"like"],[OpenLayers.Filter.Comparison.BETWEEN,"between"]],allowBlank:!1,mode:"local",typeAhead:!0,
forceSelection:!0,triggerAction:"all",width:50,editable:!0,initComponent:function(){var a={displayField:"name",valueField:"value",store:new Ext.data.SimpleStore({data:this.allowedTypes,fields:["value","name"]}),value:void 0===this.value?this.allowedTypes[0][0]:this.value,listeners:{blur:function(){var a=this.store.findExact("value",this.getValue());-1!=a?this.fireEvent("select",this,this.store.getAt(a)):null!=this.startValue&&this.setValue(this.startValue)}}};Ext.applyIf(this,a);gxp.form.ComparisonComboBox.superclass.initComponent.call(this)}});
Ext.reg("gxp_comparisoncombo",gxp.form.ComparisonComboBox);Ext.namespace("gxp.form");Date.defaults.d=1;Date.defaults.m=1;
gxp.form.ExtendedDateTimeField=Ext.extend(Ext.form.CompositeField,{initComponent:function(){Ext.QuickTips.init();this.items=[{xtype:"gxp_datefield",allowBlank:!1!==this.initialConfig.allowBlank,todayText:this.initialConfig.todayText,selectToday:this.initialConfig.selectToday,ref:"date"},{xtype:"timefield",width:80,ref:"time"}];gxp.form.ExtendedDateTimeField.superclass.initComponent.apply(this,arguments)},getValue:function(){var a=this.date.getValue(),b=this.time.getValue();null!==a&&""===b&&(b="12:00 AM");
if(""!==b){var b=this.time.parseDate(b),c=new Date(this.time.initDate),b=b.getTime()/1E3-c.getTime()/1E3;return a+b-60*(new Date(1E3*a)).getTimezoneOffset()}return a},setValue:function(a){this.date.setValue(a);a=new Date(1E3*parseFloat(a));a.setTime(a.getTime()+6E4*a.getTimezoneOffset());if(a){var b=a.getHours();12<b?b-=12:0===b&&(b=12);var c=a.getMinutes();10>c&&(c="0"+c);this.time.setValue(b+":"+c+" "+(12<a.getHours()?"PM":"AM"))}}});Ext.reg("gxp_datetimefield",gxp.form.ExtendedDateTimeField);
gxp.form.ExtendedDateField=Ext.extend(Ext.form.DateField,{altFormats:"-c|-Y|m -Y|n -Y|M -Y|m/d/-Y|n/j/-Y|m/j/-Y|n/d/-Y|c|Y|m/d/Y|n/j/Y|n/j/y|m/j/y|n/d/y|m/j/Y|n/d/Y|m-d-y|m-d-Y|m/d|m-d|md|mdy|mdY|d|Y-m-d|n-j|n/j",bcYrRegEx:/^(-\d{3,4})|(-\d{3,4})$/,invalidText:"{0} is not a valid date. If you are attempting to enter a BCE date please enter a zero padded 4 digit year or just enter the year",beforeBlur:Ext.emptyFn,getValue:function(){var a=Ext.form.DateField.superclass.getValue.call(this),b=this.parseDate(a);
a.match(this.bcYrRegEx)&&(1===(a.match(/-/g)||[]).length||"-"===a.charAt(0))&&b&&(b=new Date(-1*b.getFullYear(),b.getMonth(),b.getDate(),b.getHours(),b.getMinutes(),b.getSeconds()));return b?b.getTime()/1E3:null},setValue:function(a){var b=a;Ext.isNumber(parseFloat(a))&&(b=new Date(1E3*parseFloat(a)),b.setTime(b.getTime()+6E4*b.getTimezoneOffset()));if(a=this.formatDate(b))if(b=a.match(this.bcYrRegEx))if((b=b[0]||b[1])&&5>b.length){for(var c="-",d=b.length;4>=d;++d)c+="0";a=a.replace(b,c+Math.abs(parseInt(b,
10)))}return Ext.form.DateField.superclass.setValue.call(this,a)},getPickerDate:function(){return new Date},onTriggerClick:function(){if(!this.disabled){if(!this.menu)this.menu=new Ext.menu.DateMenu({hideOnClick:!1,focusOnSelect:!1});this.onFocus();Ext.apply(this.menu.picker,{minDate:this.minValue,todayText:this.todayText?this.todayText:Ext.DatePicker.prototype.todayText,selectToday:this.selectToday?this.selectToday:Ext.DatePicker.prototype.selectToday,maxDate:this.maxValue,disabledDatesRE:this.disabledDatesRE,
disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,showToday:this.showToday,startDay:this.startDay,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))});var a=this.getValue();this.menu.picker.setValue(null===a?this.getPickerDate():new Date(1E3*a));this.menu.show(this.el,"tl-bl?");this.menuEvents("on")}}});Ext.reg("gxp_datefield",gxp.form.ExtendedDateField);
Ext.namespace("gxp.form");
gxp.form.FontComboBox=Ext.extend(Ext.form.ComboBox,{fonts:"Serif,SansSerif,Arial,Courier New,Tahoma,Times New Roman,Verdana".split(","),defaultFont:"Serif",allowBlank:!1,mode:"local",triggerAction:"all",editable:!1,initComponent:function(){var a=this.fonts||gxp.form.FontComboBox.prototype.fonts,b=this.defaultFont;-1===a.indexOf(this.defaultFont)&&(b=a[0]);a={displayField:"field1",valueField:"field1",store:a,value:b,tpl:new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item"><span style="font-family: {field1};">{field1}</span></div></tpl>')};Ext.applyIf(this,
a);gxp.form.FontComboBox.superclass.initComponent.call(this)}});Ext.reg("gxp_fontcombo",gxp.form.FontComboBox);Ext.namespace("gxp.form");
gxp.form.ViewerField=Ext.extend(Ext.form.TextArea,{viewer:null,initComponent:function(){this.width=this.width||350;this.height=this.height||220;gxp.form.ViewerField.superclass.initComponent.call(this)},onRender:function(){if(!this.el)this.defaultAutoCreate={tag:"textarea",style:{color:"transparent",background:"none"}};gxp.form.ViewerField.superclass.onRender.apply(this,arguments);this.viewerEl=Ext.get(document.createElement("div"));this.viewerEl.setStyle("position","absolute");this.viewerEl.on({mouseenter:function(){this.hasFocus||
this.el.focus()},mousemove:function(){this.hasFocus||this.el.focus()},mouseleave:function(){this.hasFocus&&this.el.blur()},scope:this});this.el.dom.parentNode.appendChild(this.viewerEl.dom);this.viewerEl.anchorTo(this.el,"tl-tl");var a={border:!1,renderTo:this.viewerEl,width:this.width,height:this.height,style:"border: 1px solid transparent"},b=Ext.applyIf(this.initialConfig.viewer||{},{field:this,portalConfig:a});Ext.apply(b.portalConfig,a);this.viewer=new gxp.Viewer(b)}});
Ext.reg("gxp_viewerfield",gxp.form.ViewerField);Ext.namespace("gxp");
gxp.GoogleEarthPanel=Ext.extend(Ext.Panel,{HORIZONTAL_FIELD_OF_VIEW:30*Math.PI/180,map:null,mapPanel:null,layers:null,earth:null,projection:null,layerCache:null,initComponent:function(){this.addEvents("beforeadd","pluginfailure","pluginready");gxp.GoogleEarthPanel.superclass.initComponent.call(this);var a=this.mapPanel;a&&!(a instanceof GeoExt.MapPanel)&&(a=Ext.getCmp(a));if(!a)throw Error("Could not get map panel from config: "+this.mapPanel);this.map=a.map;this.layers=a.layers;this.projection=new OpenLayers.Projection("EPSG:4326");
this.on("render",this.onRenderEvent,this);this.on("show",this.onShowEvent,this);this.on("hide",function(){null!=this.earth&&this.updateMap();this.body.dom.innerHTML="";this.earth=null},this)},onEarthReady:function(a){this.earth=a;void 0===this.flyToSpeed?this.earth.getOptions().setFlyToSpeed(this.earth.SPEED_TELEPORT):null!==this.flyToSpeed&&this.earth.getOptions().setFlyToSpeed(this.flyToSpeed);this.resetCamera();this.setExtent(this.map.getExtent());this.earth.getNavigationControl().setVisibility(this.earth.VISIBILITY_SHOW);
a=this.earth.getNavigationControl().getScreenXY();a.setXUnits(this.earth.UNITS_PIXELS);a.setYUnits(this.earth.UNITS_INSET_PIXELS);this.earth.getWindow().setVisibility(!0);this.layers.each(function(a){this.addLayer(a)},this);this.layers.on("remove",this.updateLayers,this);this.layers.on("update",this.updateLayers,this);this.layers.on("add",this.updateLayers,this);this.fireEvent("pluginready",this.earth)},onRenderEvent:function(){var a=this.ownerCt&&this.ownerCt.layout instanceof Ext.layout.CardLayout;
if(!this.hidden&&!a)this.onShowEvent()},onShowEvent:function(){if(this.rendered)this.layerCache={},google.earth.createInstance(this.body.dom,this.onEarthReady.createDelegate(this),function(a){this.fireEvent("pluginfailure",this,a)}.createDelegate(this))},beforeDestroy:function(){this.layers.un("remove",this.updateLayers,this);this.layers.un("update",this.updateLayers,this);this.layers.un("add",this.updateLayers,this);gxp.GoogleEarthPanel.superclass.beforeDestroy.call(this)},updateLayers:function(){if(this.earth){for(var a=
this.earth.getFeatures(),b=a.getFirstChild();null!=b;)a.removeChild(b),b=a.getFirstChild();this.layers.each(function(a){this.addLayer(a)},this)}},addLayer:function(a,b){var c=a.getLayer(),d=c&&c.url;if(this.earth&&c instanceof OpenLayers.Layer.WMS&&"string"==typeof d&&!1!==this.fireEvent("beforeadd",a)){var e=c.id;if(this.layerCache[e])d=this.layerCache[e];else{var f=this.earth.createLink("kl_"+e),d=d.replace(/\?.*/,""),g=c.params;f.setHref(d+("/kml?mode=refresh&layers="+g.LAYERS+"&styles="+g.STYLES));
d=this.earth.createNetworkLink("nl_"+e);d.setName(e);d.set(f,!1,!1);this.layerCache[e]=d}d.setVisibility(c.getVisibility());void 0!==b&&b<this.earth.getFeatures().getChildNodes().getLength()?this.earth.getFeatures().insertBefore(this.earth.getFeatures().getChildNodes().item(b)):this.earth.getFeatures().appendChild(d)}},setExtent:function(a){var a=a.transform(this.map.getProjectionObject(),this.projection),b=a.getCenterLonLat(),a=this.getExtentWidth(a)/(2*Math.tan(this.HORIZONTAL_FIELD_OF_VIEW)),c=
this.earth.getView().copyAsLookAt(this.earth.ALTITUDE_RELATIVE_TO_GROUND);c.setLatitude(b.lat);c.setLongitude(b.lon);c.setRange(a);this.earth.getView().setAbstractView(c)},resetCamera:function(){var a=this.earth.getView().copyAsCamera(this.earth.ALTITUDE_RELATIVE_TO_GROUND);a.setRoll(0);a.setHeading(0);a.setTilt(0);this.earth.getView().setAbstractView(a)},getExtent:function(){var a=this.earth.getView().getViewportGlobeBounds();return new OpenLayers.Bounds(a.getWest(),a.getSouth(),a.getEast(),a.getNorth())},
updateMap:function(){var a=this.earth.getView().copyAsLookAt(this.earth.ALTITUDE_RELATIVE_TO_GROUND),b=this.reprojectToMap(new OpenLayers.LonLat(a.getLongitude(),a.getLatitude()));this.map.zoomToExtent(this.reprojectToMap(this.getExtent()),!0);this.map.setCenter(b);var a=2*a.getRange()*Math.tan(this.HORIZONTAL_FIELD_OF_VIEW),c=this.map.getResolutionForZoom(this.map.getZoom()+1),d=this.map.getExtent(),b=new OpenLayers.Bounds(b.lon-this.map.getSize().w/2*c,b.lat+this.map.getSize().h/2*c,b.lon+this.map.getSize().w/
2*c,b.lat-this.map.getSize().h/2*c),d=Math.abs(this.getExtentWidth(d)-a);Math.abs(this.getExtentWidth(b)-a)<d&&this.map.zoomTo(this.map.getZoom()+1)},getExtentWidth:function(a){var b=a.getCenterLonLat(),c=new OpenLayers.LonLat(a.left,b.lat),a=new OpenLayers.LonLat(a.right,b.lat);return 1E3*OpenLayers.Util.distVincenty(c,a)},reprojectToGE:function(a){return a.clone().transform(this.map.getProjectionObject(),this.projection)},reprojectToMap:function(a){return a.clone().transform(this.projection,this.map.getProjectionObject())}});
Ext.reg("gxp_googleearthpanel",gxp.GoogleEarthPanel);Ext.namespace("gxp");
gxp.GoogleStreetViewPanel=Ext.extend(Ext.Panel,{panorama:null,heading:0,pitch:0,zoom:0,location:null,initComponent:function(){Ext.applyIf(this,{plain:!0,border:!1});return gxp.GoogleStreetViewPanel.superclass.initComponent.call(this)},afterRender:function(){var a=this.ownerCt;a&&(a=a.getSize(),Ext.applyIf(this,a),this.location||GeoExt.Popup&&this.bubble(function(a){if(a instanceof GeoExt.Popup)return this.location=a.location.clone().transform(a.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326")),
!1},this));gxp.GoogleStreetViewPanel.superclass.afterRender.call(this);a={position:new google.maps.LatLng(this.location.lat,this.location.lon),pov:{heading:this.heading,pitch:this.pitch,zoom:this.zoom}};this.panorama=new google.maps.StreetViewPanorama(this.body.dom,a)},beforeDestroy:function(){delete this.panorama;gxp.GoogleStreetViewPanel.superclass.beforeDestroy.apply(this,arguments)},onResize:function(a,b){gxp.GoogleStreetViewPanel.superclass.onResize.apply(this,arguments);this.panorama&&"object"==
typeof this.panorama&&google.maps.event.trigger(this.panorama,"resize")},setSize:function(a,b,c){gxp.GoogleStreetViewPanel.superclass.setSize.apply(this,arguments);this.panorama&&"object"==typeof this.panorama&&google.maps.event.trigger(this.panorama,"resize")}});Ext.reg("gxp_googlestreetviewpanel",gxp.GoogleStreetViewPanel);Ext.namespace("gxp.grid");
gxp.grid.CapabilitiesGrid=Ext.extend(Ext.grid.GridPanel,{store:null,cm:null,expander:null,mapPanel:null,url:null,autoExpandColumn:"title",allowNewSources:!0,nameHeaderText:"Name",titleHeaderText:"Title",queryableHeaderText:"Queryable",layerSelectionLabel:"View available data from:",layerAdditionLabel:"or add a new server.",expanderTemplateText:"<p><b>Abstract:</b> {abstract}</p>",constructor:function(){this.addEvents("sourceselected");gxp.grid.CapabilitiesGrid.superclass.constructor.apply(this,arguments)},
initComponent:function(){if(!this.store)this.store=new GeoExt.data.WMSCapabilitiesStore({url:this.url+"?service=wms&request=GetCapabilities"}),this.store.load();this.on("afterrender",function(){this.fireEvent("sourceselected",this,this.store)},this);if(!("expander"in this))this.expander=new Ext.grid.RowExpander({tpl:new Ext.Template(this.expanderTemplateText)});if(!this.plugins&&this.expander)this.plugins=this.expander;if(!this.cm){var a=[{id:"title",header:this.titleHeaderText,dataIndex:"title",
sortable:!0},{header:this.nameHeaderText,dataIndex:"name",width:180,sortable:!0},{header:this.queryableHeaderText,dataIndex:"queryable",width:70,renderer:function(a,b){b.css="x-btn";var e="x-btn cancel";a&&(e="x-btn add");return'<div style="background-repeat: no-repeat; background-position: 50% 0%; height: 16px;" class="'+e+'">&nbsp;</div>'}}];this.expander&&a.unshift(this.expander);this.cm=new Ext.grid.ColumnModel(a)}if(!("allowNewSources"in this))this.allowNewSources=!!this.metaStore;if(this.allowNewSources||
this.metaStore&&1<this.metaStore.getCount())this.sourceComboBox=new Ext.form.ComboBox({store:this.metaStore,valueField:"identifier",displayField:"name",triggerAction:"all",editable:!1,allowBlank:!1,forceSelection:!0,mode:"local",value:this.metaStore.getAt(this.metaStore.findBy(function(a){return a.get("store")==this.store},this)).get("identifier"),listeners:{select:function(a,b){this.fireEvent("sourceselected",this,b.data.store);this.reconfigure(b.data.store,this.getColumnModel());if(this.expander)this.expander.ows=
b.get("url")},scope:this}}),this.metaStore.on("add",function(a,b,e){this.sourceComboBox.onSelect(b[0],e)},this),this.tbar=this.tbar||[],this.tbar.push(""+this.layerSelectionLabel),this.tbar.push(this.sourceComboBox);if(this.allowNewSources){var b=this;if(!this.newSourceWindow)this.newSourceWindow=new gxp.NewSourceWindow({modal:!0,metaStore:this.metaStore,addSource:function(){b.addSource.apply(b,arguments)}});this.tbar.push(new Ext.Button({iconCls:"gxp-icon-addserver",text:this.layerAdditionLabel,
handler:function(){this.newSourceWindow.show()},scope:this}))}gxp.grid.CapabilitiesGrid.superclass.initComponent.call(this)},addSource:function(a,b,c,d){d=d||this;c=new GeoExt.data.WMSCapabilitiesStore({url:a,autoLoad:!0});this.metaStore.add(new this.metaStore.recordType({url:a,store:c,identifier:a,name:a}));b.apply(d)},addLayers:function(){for(var a=this.getSelectionModel().getSelections(),b,c,d=[],e=0;e<a.length;e++)Ext.data.Record.AUTO_ID++,b=a[e].copy(Ext.data.Record.AUTO_ID),this.alignToGrid?
(c=b.getLayer().clone(),c.maxExtent=new OpenLayers.Bounds(-180,-90,180,90)):(c=b.getLayer(),c instanceof OpenLayers.Layer.WMS&&(c=new OpenLayers.Layer.WMS(c.name,c.url,{layers:c.params.LAYERS},{attribution:c.attribution,maxExtent:OpenLayers.Bounds.fromArray(b.get("llbbox")).transform(new OpenLayers.Projection("EPSG:4326"),this.mapPanel.map.getProjectionObject())}))),b.data.layer=c,b.commit(!0),d.push(b);d.length&&(a=this.mapPanel.layers.findBy(function(a){return a.getLayer()instanceof OpenLayers.Layer.Vector}),
-1!==a?this.mapPanel.layers.insert(a,d):this.mapPanel.layers.add(d))}});Ext.reg("gxp_capabilitiesgrid",gxp.grid.CapabilitiesGrid);Ext.ns("gxp.tree");
gxp.tree.TreeGridNodeUI=Ext.ux&&Ext.ux.tree&&Ext.ux.tree.TreeGridNodeUI&&Ext.extend(Ext.ux.tree.TreeGridNodeUI,{renderElements:function(a,b,c,d){var e=a.getOwnerTree(),f=e.columns,g=f[0],h,j,k;this.indentMarkup=a.parentNode?a.parentNode.ui.getChildIndent():"";var l=Ext.isBoolean(b.checked);j=['<tbody class="x-tree-node">','<tr ext:tree-node-id="',a.id,'" class="x-tree-node-el x-tree-node-leaf ',b.cls,'">','<td class="x-treegrid-col">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",
'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',b.icon||this.emptyIcon,'" class="x-tree-node-icon',b.icon?" x-tree-node-inline-icon":"",b.iconCls?" "+b.iconCls:"",'" unselectable="on" />',l?'<input class="x-tree-node-cb" type="checkbox" '+(b.checked?'checked="checked" />':"/>"):"",'<a hidefocus="on" class="x-tree-node-anchor" href="',b.href?b.href:"#",'" tabIndex="1" ',b.hrefTarget?' target="'+b.hrefTarget+'"':"",">",'<span unselectable="on">',g.tpl?g.tpl.apply(b):
b[g.dataIndex]||g.text,"</span></a>","</td>"];for(h=1,k=f.length;h<k;h++)g=f[h],j.push('<td class="x-treegrid-col ',g.cls?g.cls:"",'">','<div unselectable="on" class="x-treegrid-text"',g.align?' style="text-align: '+g.align+';"':"",">",g.tpl?g.tpl.apply(b):b[g.dataIndex],"</div>","</td>");j.push('</tr><tr class="x-tree-node-ct"><td colspan="',f.length,'">','<table class="x-treegrid-node-ct-table" cellpadding="0" cellspacing="0" style="table-layout: fixed; display: none; width: ',e.innerCt.getWidth(),
'px;"><colgroup>');for(h=0,k=f.length;h<k;h++)j.push('<col style="width: ',f[h].hidden?0:f[h].width,'px;" />');j.push("</colgroup></table></td></tr></tbody>");this.wrap=!0!==d&&a.nextSibling&&a.nextSibling.ui.getEl()?Ext.DomHelper.insertHtml("beforeBegin",a.nextSibling.ui.getEl(),j.join("")):Ext.DomHelper.insertHtml("beforeEnd",c,j.join(""));this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1].firstChild.firstChild;a=this.elNode.firstChild.childNodes;this.indentNode=a[0];this.ecNode=
a[1];this.iconNode=a[2];b=3;if(l)this.checkbox=a[3],this.checkbox.defaultChecked=this.checkbox.checked,b++;this.anchor=a[b];this.textNode=a[b].firstChild}});Ext.ns("gxp.tree");gxp.tree.SymbolizerLoader=function(a){Ext.apply(this,a);gxp.tree.SymbolizerLoader.superclass.constructor.call(this)};
Ext.extend(gxp.tree.SymbolizerLoader,Ext.util.Observable,{symbolizers:null,load:function(a,b){if(this.fireEvent("beforeload",this,a)){for(;a.firstChild;)a.removeChild(a.firstChild);for(var c=new Ext.Template('<div class="gxp-symbolgrid-swatch" id="{id}"></div>'),d=0,e=this.symbolizers.length;d<e;++d){var f=this.symbolizers[d],g=f.CLASS_NAME.substring(f.CLASS_NAME.lastIndexOf(".")+1),h=f.clone();if("Text"===g&&(h.label="Ab",h.fillColor||h.graphicName))h.graphic=!0;var j=Ext.id(),f=this.createNode({type:g,
expanded:!0,rendererId:j,originalSymbolizer:f,symbolizer:h,iconCls:"gxp-icon-symbolgrid-"+g.toLowerCase(),preview:c.applyTemplate({id:j})});if("Polygon"===g||"Point"===g)j=Ext.id(),g=h.clone(),g.fill=!1,f.appendChild(this.createNode({checked:void 0!==h.stroke?h.stroke:!0,iconCls:"gxp-icon-symbolgrid-none",type:"Stroke",symbolizer:g,rendererId:j,preview:c.applyTemplate({id:j})})),j=Ext.id(),g=h.clone(),g.stroke=!1,f.appendChild(this.createNode({checked:void 0!==h.fill?h.fill:!0,iconCls:"gxp-icon-symbolgrid-none",
type:"Fill",symbolizer:g,rendererId:j,preview:c.applyTemplate({id:j})}));else if("Line"===g)j=Ext.id(),f.appendChild(this.createNode({type:"Stroke",checked:!0,iconCls:"gxp-icon-symbolgrid-none",symbolizer:h.clone(),rendererId:j,preview:c.applyTemplate({id:j})}));else if("Text"===g)j=Ext.id(),g=h.clone(),g.graphic=!1,f.appendChild(this.createNode({checked:!0,iconCls:"gxp-icon-symbolgrid-none",type:"Label",symbolizer:g,rendererId:j,preview:c.applyTemplate({id:j})})),j=Ext.id(),g=h.clone(),g.label="",
f.appendChild(this.createNode({checked:h.graphic,iconCls:"gxp-icon-symbolgrid-none",type:"Graphic",symbolizer:g,rendererId:j,preview:c.applyTemplate({id:j})}));a.appendChild(f)}"function"==typeof b&&b();this.fireEvent("load",this,a)}},createNode:function(a){this.baseAttrs&&Ext.apply(a,this.baseAttrs);if(!a.uiProvider)a.uiProvider=gxp.tree.TreeGridNodeUI;a.nodeType=a.nodeType||"node";return new Ext.tree.TreePanel.nodeTypes[a.nodeType](a)}});Ext.namespace("gxp.grid");
gxp.grid.SymbolizerGrid=Ext.ux&&Ext.ux.tree&&Ext.ux.tree.TreeGrid&&Ext.extend(Ext.ux.tree.TreeGrid,{symbolizers:null,enableHdMenu:!1,enableSort:!1,useArrows:!1,columnResize:!1,cls:"gxp-symbolgrid",typeTitle:"Symbolizer Type",previewTitle:"Preview",initComponent:function(){this.on("checkchange",this.onCheckChange,this);this.loader=new gxp.tree.SymbolizerLoader({symbolizers:this.symbolizers});this.columns=[{header:this.typeTitle,dataIndex:"type",width:200},{header:this.previewTitle,width:100,dataIndex:"preview"}];
gxp.grid.SymbolizerGrid.superclass.initComponent.call(this)},getSymbolizers:function(){var a=[];this.root.eachChild(function(b){var c=!1;b.eachChild(function(a){var e=a.attributes.type.toLowerCase();if("label"!==e)b.attributes.originalSymbolizer[e]=a.attributes.checked;!0===a.attributes.checked&&(c=!0)});c&&a.push(b.attributes.originalSymbolizer)});return a},beforeDestroy:function(){this.root.cascade(function(a){if(a.attributes.featureRenderer)a.attributes.featureRenderer.destroy(),a.attributes.featureRenderer=
null});gxp.grid.SymbolizerGrid.superclass.onDestroy.call(this)},onCheckChange:function(a,b){var c=a.attributes,d=c.featureRenderer,e=c.type.toLowerCase(),c=c.symbolizer,f=a.parentNode.attributes.symbolizer;if("label"!==e)if("graphic"===e){var g=a.parentNode.findChild("type","Label");null!==g&&(g.attributes.checked&&b||!b?f[e]=c[e]=b:a.getUI().toggleCheck(!1))}else f[e]=c[e]=b;else b?c[e]=f[e]="Ab":(c[e]=f[e]="",e=a.parentNode.findChild("type","Graphic"),null!==e&&e.getUI().toggleCheck(!1));a.parentNode.attributes.featureRenderer&&
a.parentNode.attributes.featureRenderer.update({symbolizers:[f]});d.update({symbolizers:[c]})},afterRender:function(){gxp.grid.SymbolizerGrid.superclass.afterRender.call(this);this.root.cascade(function(a){if(a.attributes.rendererId){var b=Ext.get(a.attributes.rendererId);if(b)a.attributes.featureRenderer=new GeoExt.FeatureRenderer({symbolizers:[a.attributes.symbolizer],renderTo:b,width:21,height:21})}})}});gxp.grid.SymbolizerGrid&&Ext.reg("gxp_symbolgrid",gxp.grid.SymbolizerGrid);Ext.namespace("gxp");
gxp.Histogram=Ext.extend(Ext.BoxComponent,{onRender:function(a,b){if(!this.el){var c=document.createElement("div");c.id=this.getId();this.el=Ext.get(c)}this.el.addClass("gxp-histogram");this.quantities&&this.setQuantities(this.quantities);gxp.Histogram.superclass.onRender.apply(this,arguments)},setQuantities:function(a){for(this.quantities=a;this.el.dom.firstChild;)this.el.dom.removeChild(this.el.dom.firstChild);var b,c=0,d=Number.POSITIVE_INFINITY,e,f=a.length;for(e=0;e<f;++e)b=a[e],b<d&&(d=b),b>
c&&(c=b);var c=100/c,g,h=100/f;for(e=0;e<f;++e)b=document.createElement("div"),b.className="bar",g=b.style,g.width=h+"%",g.left=e*h+"%",g.top=100-(a[e]-d)*c+"%",this.el.dom.appendChild(b)}});Ext.reg("gxp_histogram",gxp.Histogram);Ext.namespace("gxp");
gxp.LayerUploadPanel=Ext.extend(Ext.FormPanel,{titleLabel:"Title",titleEmptyText:"Layer title",abstractLabel:"Description",abstractEmptyText:"Layer description",fileLabel:"Data",fieldEmptyText:"Browse for data archive...",uploadText:"Upload",uploadFailedText:"Upload failed",processingUploadText:"Processing upload...",waitMsgText:"Uploading your data...",invalidFileExtensionText:"File extension must be one of: ",optionsText:"Options",workspaceLabel:"Workspace",workspaceEmptyText:"Default workspace",
dataStoreLabel:"Store",dataStoreEmptyText:"Choose a store",dataStoreNewText:"Create new store",crsLabel:"CRS",crsEmptyText:"Coordinate Reference System ID",invalidCrsText:"CRS identifier should be an EPSG code (e.g. EPSG:4326)",fileUpload:!0,validFileExtensions:".zip,.tif,.tiff,.gz,.tar.bz2,.tar,.tgz,.tbz2".split(","),defaultDataStore:null,constructor:function(a){a.errorReader={read:a.handleUploadResponse||this.handleUploadResponse.createDelegate(this)};gxp.LayerUploadPanel.superclass.constructor.call(this,
a)},selectedWorkspace:null,initComponent:function(){this.items=[{xtype:"textfield",name:"title",fieldLabel:this.titleLabel,emptyText:this.titleEmptyText,allowBlank:!0},{xtype:"textarea",name:"abstract",fieldLabel:this.abstractLabel,emptyText:this.abstractEmptyText,allowBlank:!0},{xtype:"fileuploadfield",id:"file",anchor:"90%",emptyText:this.fieldEmptyText,fieldLabel:this.fileLabel,name:"file",buttonText:"",buttonCfg:{iconCls:"gxp-icon-filebrowse"},listeners:{fileselected:function(a,b){a.setValue(b.split(/[/\\]/).pop())}},
validator:this.fileNameValidator.createDelegate(this)},{xtype:"fieldset",ref:"optionsFieldset",title:this.optionsText,checkboxToggle:!0,collapsed:!0,hidden:void 0!=this.workspace&&void 0!=this.store&&void 0!=this.crs,hideMode:"offsets",defaults:{anchor:"97%"},items:[this.createWorkspacesCombo(),this.createDataStoresCombo(),{xtype:"textfield",name:"nativeCRS",fieldLabel:this.crsLabel,emptyText:this.crsEmptyText,allowBlank:!0,regex:/^epsg:\d+$/i,regexText:this.invalidCrsText}],listeners:{collapse:function(a){a.items.each(function(a){a.reset()})}}}];
this.buttons=[{text:this.uploadText,handler:function(){var a=this.getForm();if(a.isValid()){var b=a.getFieldValues(),c={"import":{}};if(b.workspace)c["import"].targetWorkspace={workspace:{name:b.workspace}};if(Ext.isEmpty(b.store)&&this.defaultDataStore)c["import"].targetStore={dataStore:{name:this.defaultDataStore}};else if(!Ext.isEmpty(b.store)&&b.store!==this.dataStoreNewText)c["import"].targetStore={dataStore:{name:b.store}};Ext.Ajax.request({url:this.getUploadUrl(),method:"POST",jsonData:c,success:function(b){this._import=
b.getResponseHeader("Location");this.optionsFieldset.expand();a.submit({url:this._import+"/tasks?expand=all",waitMsg:this.waitMsgText,waitMsgTarget:!0,reset:!0,scope:this})},scope:this})}},scope:this}];this.addEvents("workspaceselected","datastoreselected","uploadcomplete");this.getDefaultDataStore("default");gxp.LayerUploadPanel.superclass.initComponent.call(this)},fileNameValidator:function(a){for(var b=!1,c,d=0,e=this.validFileExtensions.length;d<e;++d)if(c=this.validFileExtensions[d],a.slice(-c.length).toLowerCase()===
c){b=!0;break}return b||this.invalidFileExtensionText+"<br/>"+this.validFileExtensions.join(", ")},createWorkspacesCombo:function(){return{xtype:"combo",name:"workspace",ref:"../workspace",fieldLabel:this.workspaceLabel,store:new Ext.data.JsonStore({url:this.getWorkspacesUrl(),autoLoad:!0,root:"workspaces.workspace",fields:["name","href"]}),displayField:"name",valueField:"name",mode:"local",allowBlank:!0,triggerAction:"all",forceSelection:!0,listeners:{select:function(a,b){this.getDefaultDataStore(b.get("name"));
this.fireEvent("workspaceselected",this,b)},scope:this}}},createDataStoresCombo:function(){var a=new Ext.data.JsonStore({autoLoad:!1,root:"dataStores.dataStore",fields:["name","href"]});this.on({workspaceselected:function(d,e){c.reset();var f=e.get("href");a.removeAll();a.proxy=new Ext.data.HttpProxy({url:f.split(".json").shift()+"/datastores.json"});a.proxy.on("loadexception",b,this);a.load()},scope:this});var b=function(){var c=new a.recordType({name:this.dataStoreNewText});a.insert(0,c);a.proxy&&
a.proxy.un("loadexception",b,this)};a.on("load",b,this);var c=new Ext.form.ComboBox({name:"store",ref:"../dataStore",emptyText:this.dataStoreEmptyText,fieldLabel:this.dataStoreLabel,store:a,displayField:"name",valueField:"name",mode:"local",allowBlank:!0,triggerAction:"all",forceSelection:!0,listeners:{select:function(a,b){this.fireEvent("datastoreselected",this,b)},scope:this}});return c},getDefaultDataStore:function(a){Ext.Ajax.request({url:this.url+"/workspaces/"+a+"/datastores/default.json",callback:function(b,
c,d){this.defaultDataStore=null;if(200===d.status&&(b=Ext.decode(d.responseText),"default"===a&&b.dataStore&&b.dataStore.workspace&&(this.workspace.setValue(b.dataStore.workspace.name),this.fireEvent("workspaceselected",this,new this.workspace.store.recordType({name:b.dataStore.workspace.name,href:b.dataStore.workspace.href}))),b.dataStore&&!0===b.dataStore.enabled&&!/file/i.test(b.dataStore.type)))this.defaultDataStore=b.dataStore.name,this.dataStore.setValue(this.defaultDataStore)},scope:this})},
getUploadUrl:function(){return this.url+"/imports"},getWorkspacesUrl:function(){return this.url+"/workspaces.json"},handleUploadResponse:function(a){var b=this.parseResponseText(a.responseText),c,d,e,f,a=this.getForm().getFieldValues(),g=!!b;if(b)if("string"===typeof b)g=!1,e=b;else if(d=b.tasks||[b.task],0===d.length)g=!1,e="Upload contains no suitable files.";else for(f=d.length-1;0<=f;--f)(b=d[f])?"NO_FORMAT"===b.state?(g=!1,e="Upload contains no suitable files."):"NO_CRS"===b.state&&!a.nativeCRS&&
(g=!1,e="Coordinate Reference System (CRS) of source file "+b.data.file+" could not be determined. Please specify manually."):(g=!1,e="Unknown upload error");g?(a.title||a["abstract"]||a.nativeCRS)&&d[0].target.dataStore?(this.waitMsg=new Ext.LoadMask((this.ownerCt||this).getEl(),{msg:this.processingUploadText}),this.waitMsg.show(),Ext.Ajax.request({method:"PUT",url:d[0].layer.href,jsonData:{title:a.title||void 0,"abstract":a["abstract"]||void 0,srs:a.nativeCRS||void 0},success:this.finishUpload,
failure:function(a){this.waitMsg&&this.waitMsg.hide();var b=[];try{var c=Ext.decode(a.responseText);if(c.errors)for(var d=0,e=c.errors.length;d<e;++d)b.push({id:~c.errors[d].indexOf("SRS")?"nativeCRS":"file",msg:c.errors[d]})}catch(f){b.push({id:"file",msg:a.responseText})}this.getForm().markInvalid(b)},scope:this})):this.finishUpload():c=[{data:{id:"file",msg:e||this.uploadFailedText}}];return{success:!1,records:c}},finishUpload:function(){Ext.Ajax.request({method:"POST",url:this._import,failure:this.handleFailure,
success:this.handleUploadSuccess,scope:this})},parseResponseText:function(a){var b;try{b=Ext.decode(a)}catch(c){if(a=a.match(/^\s*<pre[^>]*>(.*)<\/pre>\s*/))try{b=Ext.decode(a[1])}catch(d){b=a[1]}}return b},handleUploadSuccess:function(){Ext.Ajax.request({method:"GET",url:this._import+"?expand=all",failure:this.handleFailure,success:function(a){this.waitMsg&&this.waitMsg.hide();this.getForm().reset();this.fireEvent("uploadcomplete",this,Ext.decode(a.responseText));delete this._import},scope:this})},
handleFailure:function(a){a&&1223===a.status?this.handleUploadSuccess(a):(this.waitMsg&&this.waitMsg.hide(),this.getForm().markInvalid([{file:this.uploadFailedText}]))}});Ext.reg("gxp_layeruploadpanel",gxp.LayerUploadPanel);Ext.namespace("gxp");
gxp.LineSymbolizer=Ext.extend(Ext.Panel,{symbolizer:null,initComponent:function(){this.items=[{xtype:"gxp_strokesymbolizer",symbolizer:this.symbolizer,listeners:{change:function(){this.fireEvent("change",this.symbolizer)},scope:this}}];this.addEvents("change");gxp.LineSymbolizer.superclass.initComponent.call(this)}});Ext.reg("gxp_linesymbolizer",gxp.LineSymbolizer);Ext.namespace("gxp");
gxp.NewSourceWindow=Ext.extend(Ext.Window,{bodyStyle:"padding: 0px",hideBorders:!0,width:300,closeAction:"hide",error:null,initComponent:function(){window.setTimeout(function(){throw"gxp.NewSourceWindow is deprecated. Use gxp.NewSourceDialog instead.";},0);this.addEvents("server-added");gxp.NewSourceWindow.superclass.initComponent.apply(this,arguments);this.addEvents("server-added");var a=this.add(new gxp.NewSourceDialog(Ext.applyIf({addSource:this.addSource,header:!1,listeners:{urlselected:function(a,
c){this.fireEvent("server-added",c)}}},this.initialConfig)));this.setTitle(a.title);this.setLoading=a.setLoading.createDelegate(a);this.setError=a.setError.createDelegate(a);this.on("hide",a.onHide,a)},addSource:function(){}});Ext.namespace("gxp");
gxp.PolygonSymbolizer=Ext.extend(Ext.Panel,{symbolizer:null,initComponent:function(){this.items=[{xtype:"gxp_fillsymbolizer",symbolizer:this.symbolizer,listeners:{change:function(){this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"gxp_strokesymbolizer",symbolizer:this.symbolizer,listeners:{change:function(){this.fireEvent("change",this.symbolizer)},scope:this}}];this.addEvents("change");gxp.PolygonSymbolizer.superclass.initComponent.call(this)}});Ext.reg("gxp_polygonsymbolizer",gxp.PolygonSymbolizer);
Ext.namespace("gxp");
gxp.QueryPanel=Ext.extend(Ext.Panel,{layout:"form",spatialQuery:!0,attributeQuery:!0,caseInsensitiveMatch:!1,likeSubstring:!1,wildCardString:".*",selectedLayer:null,featureStore:null,attributeStore:null,geometryType:null,geometryName:null,queryByLocationText:"Query by location",currentTextText:"Current extent",queryByAttributesText:"Query by attributes",layerText:"Layer",initComponent:function(){this.addEvents("ready","beforelayerchange","layerchange","beforequery","query","storeload");this.mapExtentField=
new Ext.form.TextField({fieldLabel:this.currentTextText,readOnly:!0,anchor:"100%",value:this.getFormattedMapExtent()});this.map.events.on({moveend:this.updateMapExtent,scope:this});this.createFilterBuilder(this.layerStore.getAt(0));this.items=[{xtype:"combo",name:"layer",fieldLabel:this.layerText,store:this.layerStore,value:this.layerStore.getAt(0).get("name"),displayField:"title",valueField:"name",mode:"local",allowBlank:!0,editable:!1,triggerAction:"all",listeners:{beforeselect:function(a,b){return this.fireEvent("beforelayerchange",
this,b)},select:function(a,b){this.createFilterBuilder(b)},scope:this}},{xtype:"fieldset",title:this.queryByLocationText,checkboxToggle:!0,collapsed:!this.spatialQuery,anchor:"95%",items:[this.mapExtentField],listeners:{collapse:function(){this.spatialQuery=!1},expand:function(){this.spatialQuery=!0},scope:this}},{xtype:"fieldset",title:this.queryByAttributesText,checkboxToggle:!0,collapsed:!this.attributeQuery,anchor:"95%",items:[this.filterBuilder],listeners:{collapse:function(){this.attributeQuery=
!1},expand:function(){this.attributeQuery=!0},scope:this}}];gxp.QueryPanel.superclass.initComponent.apply(this,arguments)},createFilterBuilder:function(a){this.selectedLayer=a;var b=this.filterBuilder&&this.filterBuilder.ownerCt;b&&b.remove(this.filterBuilder,!0);this.attributeStore=new GeoExt.data.AttributeStore({url:a.get("schema"),listeners:{load:function(b){this.geometryName=null;b.filterBy(function(b){var c=/gml:((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry)).*/.exec(b.get("type"));if(c&&
!this.geometryName)this.geometryName=b.get("name"),this.geometryType=c[1],this.fireEvent("layerchange",this,a);return!c},this);this.createFeatureStore()},scope:this},autoLoad:!0});this.filterBuilder=new gxp.FilterBuilder({attributes:this.attributeStore,allowGroups:!1,caseInsensitiveMatch:this.caseInsensitiveMatch});b&&(b.add(this.filterBuilder),b.doLayout())},getFormattedMapExtent:function(){return this.map&&this.map.getExtent()&&this.map.getExtent().toBBOX().replace(/\.(\d)\d*/g,".$1").replace(/,/g,
", ")},updateMapExtent:function(){this.mapExtentField.setValue(this.getFormattedMapExtent())},getFilter:function(){var a=this.attributeQuery&&this.filterBuilder.getFilter();a&&this.likeSubstring&&(a=this.wrapWildCards(a));var b=this.spatialQuery&&new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,value:this.map.getExtent()});return a&&b?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[b,a]}):a||b},wrapWildCards:function(a){if(a instanceof OpenLayers.Filter.Logical)for(var b=
0,c=a.filters.length;b<c;++b)a=this.wrapWildCards(a.filters[b]);else if(a.type===OpenLayers.Filter.Comparison.LIKE)a.value=this.wildCardString+a.value+this.wildCardString;return a},getFieldType:function(a){return{"xsd:boolean":"boolean","xsd:int":"int","xsd:integer":"int","xsd:short":"int","xsd:long":"int","xsd:date":"date","xsd:string":"string","xsd:float":"float","xsd:double":"float"}[a]},createFeatureStore:function(){var a=[];this.attributeStore.each(function(b){a.push({name:b.get("name"),type:this.getFieldType(b.get("type"))})},
this);var b=this.selectedLayer;this.featureStore=new gxp.data.WFSFeatureStore({fields:a,srsName:this.map.getProjection(),url:b.get("url"),featureType:b.get("name"),featureNS:b.get("namespace"),geometryName:this.geometryName,schema:b.get("schema"),maxFeatures:this.maxFeatures,autoLoad:!1,autoSave:!1,listeners:{load:function(a,b,e){this.fireEvent("storeload",this,a,b,e)},scope:this}});this.fireEvent("ready",this,this.featureStore)},query:function(){this.featureStore&&!1!==this.fireEvent("beforequery",
this)&&(this.featureStore.setOgcFilter(this.getFilter()),this.featureStore.load(),this.fireEvent("query",this,this.featureStore))},beforeDestroy:function(){this.map&&this.map.events&&this.map.events.un({moveend:this.updateMapExtent,scope:this});gxp.QueryPanel.superclass.beforeDestroy.apply(this,arguments)}});Ext.reg("gxp_querypanel",gxp.QueryPanel);Ext.namespace("gxp");
gxp.ScaleLimitPanel=Ext.extend(Ext.Panel,{maxScaleDenominatorLimit:1.577757414193268E9*OpenLayers.DOTS_PER_INCH/256,limitMaxScaleDenominator:!0,maxScaleDenominator:void 0,minScaleDenominatorLimit:1.577757414193268E9*Math.pow(0.5,19)*OpenLayers.DOTS_PER_INCH/256,limitMinScaleDenominator:!0,minScaleDenominator:void 0,scaleLevels:20,scaleSliderTemplate:"{scaleType} Scale 1:{scale}",modifyScaleTipContext:Ext.emptyFn,scaleFactor:null,changing:!1,border:!1,maxScaleLimitText:"Max scale limit",minScaleLimitText:"Min scale limit",
initComponent:function(){this.layout="column";this.defaults={border:!1,bodyStyle:"margin: 0 5px;"};this.bodyStyle={padding:"5px"};this.scaleSliderTemplate=new Ext.Template(this.scaleSliderTemplate);Ext.applyIf(this,{minScaleDenominator:this.minScaleDenominatorLimit,maxScaleDenominator:this.maxScaleDenominatorLimit});this.scaleFactor=Math.pow(this.maxScaleDenominatorLimit/this.minScaleDenominatorLimit,1/(this.scaleLevels-1));this.scaleSlider=new Ext.Slider({vertical:!0,height:100,values:[0,100],listeners:{changecomplete:function(a){this.updateScaleValues(a)},
render:function(a){a.thumbs[0].el.setVisible(this.limitMaxScaleDenominator);a.thumbs[1].el.setVisible(this.limitMinScaleDenominator);a.setDisabled(!this.limitMinScaleDenominator&&!this.limitMaxScaleDenominator)},scope:this},plugins:[new gxp.slider.Tip({getText:function(a){var b=a.slider.thumbs.indexOf(a),a={scale:""+this.sliderValuesToScale([a.value])[0],zoom:(a.value*(this.scaleLevels/100)).toFixed(1),type:0===b?"Max":"Min",scaleType:0===b?"Min":"Max"};this.modifyScaleTipContext(this,a);return this.scaleSliderTemplate.apply(a)}.createDelegate(this)})]});
this.maxScaleDenominatorInput=new Ext.form.NumberField({allowNegative:!1,width:100,fieldLabel:"1",value:Math.round(this.maxScaleDenominator),disabled:!this.limitMaxScaleDenominator,validator:function(a){return!this.limitMinScaleDenominator||a>this.minScaleDenominator}.createDelegate(this),listeners:{valid:function(a){var a=Number(a.getValue()),b=Math.round(this.maxScaleDenominatorLimit);if(a<b&&a>this.minScaleDenominator)this.maxScaleDenominator=a,this.updateSliderValues()},change:function(a){var b=
Number(a.getValue()),c=Math.round(this.maxScaleDenominatorLimit);b>c?a.setValue(c):b<this.minScaleDenominator?a.setValue(this.minScaleDenominator):(this.maxScaleDenominator=b,this.updateSliderValues())},scope:this}});this.minScaleDenominatorInput=new Ext.form.NumberField({allowNegative:!1,width:100,fieldLabel:"1",value:Math.round(this.minScaleDenominator),disabled:!this.limitMinScaleDenominator,validator:function(a){return!this.limitMaxScaleDenominator||a<this.maxScaleDenominator}.createDelegate(this),
listeners:{valid:function(a){var a=Number(a.getValue()),b=Math.round(this.minScaleDenominatorLimit);if(a>b&&a<this.maxScaleDenominator)this.minScaleDenominator=a,this.updateSliderValues()},change:function(a){var b=Number(a.getValue()),c=Math.round(this.minScaleDenominatorLimit);b<c?a.setValue(c):b>this.maxScaleDenominator?a.setValue(this.maxScaleDenominator):(this.minScaleDenominator=b,this.updateSliderValues())},scope:this}});this.items=[this.scaleSlider,{xtype:"panel",layout:"form",defaults:{border:!1},
items:[{labelWidth:90,layout:"form",width:150,items:[{xtype:"checkbox",checked:!!this.limitMinScaleDenominator,fieldLabel:this.maxScaleLimitText,listeners:{check:function(a,b){this.limitMinScaleDenominator=b;var c=this.scaleSlider;c.setValue(1,100);c.thumbs[1].el.setVisible(b);this.minScaleDenominatorInput.setDisabled(!b);this.updateScaleValues(c);c.setDisabled(!this.limitMinScaleDenominator&&!this.limitMaxScaleDenominator)},scope:this}}]},{labelWidth:10,layout:"form",items:[this.minScaleDenominatorInput]},
{labelWidth:90,layout:"form",items:[{xtype:"checkbox",checked:!!this.limitMaxScaleDenominator,fieldLabel:this.minScaleLimitText,listeners:{check:function(a,b){this.limitMaxScaleDenominator=b;var c=this.scaleSlider;c.setValue(0,0);c.thumbs[0].el.setVisible(b);this.maxScaleDenominatorInput.setDisabled(!b);this.updateScaleValues(c);c.setDisabled(!this.limitMinScaleDenominator&&!this.limitMaxScaleDenominator)},scope:this}}]},{labelWidth:10,layout:"form",items:[this.maxScaleDenominatorInput]}]}];this.addEvents("change");
gxp.ScaleLimitPanel.superclass.initComponent.call(this)},updateScaleValues:function(a){if(!this.changing){var b=a.getValues(),c=!1;!this.limitMaxScaleDenominator&&0<b[0]&&(b[0]=0,c=!0);!this.limitMinScaleDenominator&&100>b[1]&&(b[1]=100,c=!0);c?(a.setValue(0,b[0]),a.setValue(1,b[1])):(b=this.sliderValuesToScale(b),a=b[0],b=b[1],this.changing=!0,this.minScaleDenominatorInput.setValue(b),this.maxScaleDenominatorInput.setValue(a),this.changing=!1,this.fireEvent("change",this,this.limitMinScaleDenominator?
b:void 0,this.limitMaxScaleDenominator?a:void 0))}},updateSliderValues:function(){if(!this.changing){var a=this.minScaleDenominator,b=this.maxScaleDenominator,c=this.scaleToSliderValues([b,a]);this.changing=!0;this.scaleSlider.setValue(0,c[0]);this.scaleSlider.setValue(1,c[1]);this.changing=!1;this.fireEvent("change",this,this.limitMinScaleDenominator?a:void 0,this.limitMaxScaleDenominator?b:void 0)}},sliderValuesToScale:function(a){var b=100/(this.scaleLevels-1);return[Math.round(Math.pow(this.scaleFactor,
(100-a[0])/b)*this.minScaleDenominatorLimit),Math.round(Math.pow(this.scaleFactor,(100-a[1])/b)*this.minScaleDenominatorLimit)]},scaleToSliderValues:function(a){var b=100/(this.scaleLevels-1);return[100-b*Math.log(a[0]/this.minScaleDenominatorLimit)/Math.log(this.scaleFactor),100-b*Math.log(a[1]/this.minScaleDenominatorLimit)/Math.log(this.scaleFactor)]}});Ext.reg("gxp_scalelimitpanel",gxp.ScaleLimitPanel);Ext.namespace("gxp");
gxp.ScaleOverlay=Ext.extend(Ext.Panel,{map:null,zoomLevelText:"Zoom level",initComponent:function(){gxp.ScaleOverlay.superclass.initComponent.call(this);this.cls="map-overlay";if(this.map){if(this.map instanceof GeoExt.MapPanel)this.map=this.map.map;this.bind(this.map)}this.on("beforedestroy",this.unbind,this)},addToMapPanel:function(a){this.on({afterrender:function(){this.bind(a.map)},scope:this})},stopMouseEvents:function(a){a.stopEvent()},removeFromMapPanel:function(){var a=this.getEl();a.un("mousedown",
this.stopMouseEvents,this);a.un("click",this.stopMouseEvents,this);this.unbind()},addScaleLine:function(){var a=new Ext.BoxComponent({autoEl:{tag:"div",cls:"olControlScaleLine overlay-element overlay-scaleline"}});this.on("afterlayout",function(){a.getEl().dom.style.position="relative";a.getEl().dom.style.display="inline";this.getEl().on("click",this.stopMouseEvents,this);this.getEl().on("mousedown",this.stopMouseEvents,this)},this);a.on("render",function(){var b=new OpenLayers.Control.ScaleLine({geodesic:!0,
div:a.getEl().dom});this.map.addControl(b);b.activate()},this);this.add(a)},handleZoomEnd:function(){var a=this.zoomStore.queryBy(function(a){return this.map.getZoom()==a.data.level},this);0<a.length?(a=a.items[0],this.zoomSelector.setValue("1 : "+parseInt(a.data.scale,10))):this.zoomSelector.rendered&&this.zoomSelector.clearValue()},addScaleCombo:function(){this.zoomStore=new GeoExt.data.ScaleStore({map:this.map});this.zoomSelector=new Ext.form.ComboBox({emptyText:this.zoomLevelText,tpl:'<tpl for="."><div class="x-combo-list-item">1 : {[parseInt(values.scale)]}</div></tpl>',
editable:!1,triggerAction:"all",mode:"local",store:this.zoomStore,width:110});this.zoomSelector.on({click:this.stopMouseEvents,mousedown:this.stopMouseEvents,select:function(a,b){this.map.zoomTo(b.data.level)},scope:this});this.map.events.register("zoomend",this,this.handleZoomEnd);this.add(new Ext.Panel({items:[this.zoomSelector],cls:"overlay-element overlay-scalechooser",border:!1}))},bind:function(a){this.map=a;this.addScaleLine();this.addScaleCombo();this.doLayout()},unbind:function(){this.map&&
this.map.events&&this.map.events.unregister("zoomend",this,this.handleZoomEnd);this.zoomSelector=this.zoomStore=null}});Ext.reg("gxp_scaleoverlay",gxp.ScaleOverlay);Ext.namespace("gxp.slider");
gxp.slider.ClassBreakSlider=Ext.extend(Ext.slider.MultiSlider,{store:null,initComponent:function(){this.store=Ext.StoreMgr.lookup(this.store);if(!("constrainThumbs"in this.initialConfig))this.constrainThumbs=this.store.reader.raw instanceof OpenLayers.Style;this.values=this.storeToValues();this.on("changecomplete",this.valuesToStore);this.store.on("update",this.storeToValues,this);gxp.slider.ClassBreakSlider.superclass.initComponent.call(this)},storeToValues:function(){var a=[];this.store.each(function(b){var d=
b.get("filter");d instanceof OpenLayers.Filter?d.type===OpenLayers.Filter.Comparison.BETWEEN?(0===this.store.indexOf(b)&&a.push(d.lowerBoundary),a.push(d.upperBoundary)):d.type===OpenLayers.Filter.Comparison.LESS_THAN&&a.push(d.value):a.push(d)},this);if(this.thumbs)for(var b=a.length-1;0<=b;--b)this.setValue(b,a[b]);return a},valuesToStore:function(){var a=this.getValues(),b=this.store;b.un("update",this.storeToValues,this);b.each(function(b){var d=b.get("filter"),e=a.shift();if(d instanceof OpenLayers.Filter){d=
d.clone();if(d.type===OpenLayers.Filter.Comparison.BETWEEN)d.upperBoundary=e;else if(d.type===OpenLayers.Filter.Comparison.LESS_THAN)d.value=e;b.get("filter").toString()!==d.toString()&&b.set("filter",d)}else d!=e&&b.set("filter",e)},this);b.on("update",this.storeToValues,this)}});Ext.reg("gxp_classbreakslider",gxp.slider.ClassBreakSlider);Ext.namespace("gxp");
gxp.StrokeSymbolizer=Ext.extend(Ext.FormPanel,{solidStrokeName:"Solid",dashStrokeName:"Dash",dotStrokeName:"Dot",titleText:"Stroke",styleText:"Style",colorText:"Color",widthText:"Width (pixels)",opacityText:"Opacity",symbolizer:null,colorManager:null,checkboxToggle:!0,defaultColor:null,dashStyles:null,border:!1,initComponent:function(){this.dashStyles=this.dashStyles||[["solid",this.solidStrokeName],["4 4",this.dashStrokeName],["2 4",this.dotStrokeName]];if(!this.symbolizer)this.symbolizer={};var a;
this.colorManager&&(a=[new this.colorManager]);this.items=[{xtype:"fieldset",title:this.titleText,autoHeight:!0,checkboxToggle:this.checkboxToggle,collapsed:!0===this.checkboxToggle&&!1===this.symbolizer.stroke,hideMode:"offsets",defaults:{width:100},items:[{xtype:"combo",name:"style",fieldLabel:this.styleText,store:new Ext.data.SimpleStore({data:this.dashStyles,fields:["value","display"]}),displayField:"display",valueField:"value",value:this.getDashArray(this.symbolizer.strokeDashstyle)||OpenLayers.Renderer.defaultSymbolizerGXP.strokeDashstyle,
mode:"local",allowBlank:!0,triggerAction:"all",editable:!1,listeners:{select:function(a,c){this.symbolizer.strokeDashstyle=c.get("value");this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"gxp_colorfield",name:"color",fieldLabel:this.colorText,emptyText:OpenLayers.Renderer.defaultSymbolizerGXP.strokeColor,value:this.symbolizer.strokeColor,defaultBackground:this.defaultColor||OpenLayers.Renderer.defaultSymbolizerGXP.strokeColor,plugins:a,listeners:{valid:function(a){var a=a.getValue(),
c=this.symbolizer.strokeColor!=a;this.symbolizer.strokeColor=a;c&&this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"numberfield",name:"width",fieldLabel:this.widthText,allowNegative:!1,emptyText:OpenLayers.Renderer.defaultSymbolizerGXP.strokeWidth,value:this.symbolizer.strokeWidth,listeners:{change:function(a,c){c=parseFloat(c);isNaN(c)?delete this.symbolizer.strokeWidth:this.symbolizer.strokeWidth=c;this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"slider",name:"opacity",
fieldLabel:this.opacityText,values:[100*("strokeOpacity"in this.symbolizer?this.symbolizer.strokeOpacity:OpenLayers.Renderer.defaultSymbolizerGXP.strokeOpacity)],isFormField:!0,listeners:{changecomplete:function(a,c){this.symbolizer.strokeOpacity=c/100;this.fireEvent("change",this.symbolizer)},scope:this},plugins:[new GeoExt.SliderTip({getText:function(a){return a.value+"%"}})]}],listeners:{collapse:function(){if(!1!==this.symbolizer.stroke)this.symbolizer.stroke=!1,this.fireEvent("change",this.symbolizer)},
expand:function(){this.symbolizer.stroke=!0;this.fireEvent("change",this.symbolizer)},scope:this}}];this.addEvents("change");gxp.StrokeSymbolizer.superclass.initComponent.call(this)},getDashArray:function(a){var b;a&&(a=a.split(/\s+/),a=a[0]/a[1],isNaN(a)||(b=1<=a?"4 4":"2 4"));return b}});Ext.reg("gxp_strokesymbolizer",gxp.StrokeSymbolizer);Ext.namespace("gxp");
gxp.TextSymbolizer=Ext.extend(Ext.Panel,{fonts:void 0,symbolizer:null,defaultSymbolizer:null,attributes:null,colorManager:null,haloCache:null,border:!1,layout:"form",labelValuesText:"Label values",haloText:"Halo",sizeText:"Size",priorityText:"Priority",labelOptionsText:"Label options",autoWrapText:"Auto wrap",followLineText:"Follow line",maxDisplacementText:"Maximum displacement",repeatText:"Repeat",forceLeftToRightText:"Force left to right",groupText:"Grouping",spaceAroundText:"Space around",labelAllGroupText:"Label all segments in line group",
maxAngleDeltaText:"Maximum angle delta",conflictResolutionText:"Conflict resolution",goodnessOfFitText:"Goodness of fit",polygonAlignText:"Polygon alignment",graphicResizeText:"Graphic resize",graphicMarginText:"Graphic margin",graphicTitle:"Graphic",fontColorTitle:"Font color and opacity",positioningText:"Label positioning",anchorPointText:"Anchor point",displacementXText:"Displacement (X-direction)",displacementYText:"Displacement (Y-direction)",perpendicularOffsetText:"Perpendicular offset",priorityHelp:"The higher the value of the specified field, the sooner the label will be drawn (which makes it win in the conflict resolution game)",
autoWrapHelp:"Wrap labels that exceed a certain length in pixels",followLineHelp:"Should the label follow the geometry of the line?",maxDisplacementHelp:"Maximum displacement in pixels if label position is busy",repeatHelp:"Repeat labels after a certain number of pixels",forceLeftToRightHelp:"Labels are usually flipped to make them readable. If the character happens to be a directional arrow then this is not desirable",groupHelp:"Grouping works by collecting all features with the same label text, then choosing a representative geometry for the group. Road data is a classic example to show why grouping is useful. It is usually desirable to display only a single label for all of 'Main Street', not a label for every block of 'Main Street.'",
spaceAroundHelp:"Overlapping and Separating Labels. By default GeoServer will not render labels 'on top of each other'. By using the spaceAround option you can either allow labels to overlap, or add extra space around labels. The value supplied for the option is a positive or negative size in pixels. Using the default value of 0, the bounding box of a label cannot overlap the bounding box of another label.",labelAllGroupHelp:"The labelAllGroup option makes sure that all of the segments in a line group are labeled instead of just the longest one.",
conflictResolutionHelp:"By default labels are subjected to conflict resolution, meaning the renderer will not allow any label to overlap with a label that has been drawn already. Setting this parameter to false pull the label out of the conflict resolution game, meaning the label will be drawn even if it overlaps with other labels, and other labels drawn after it won\u2019t mind overlapping with it.",goodnessOfFitHelp:"Geoserver will remove labels if they are a particularly bad fit for the geometry they are labeling. For Polygons: the label is sampled approximately at every letter. The distance from these points to the polygon is determined and each sample votes based on how close it is to the polygon. The default value is 0.5.",
graphic_resizeHelp:"Specifies a mode for resizing label graphics (such as highway shields) to fit the text of the label. The default mode, \u2018none\u2019, never modifies the label graphic. In stretch mode, GeoServer will resize the graphic to exactly surround the label text, possibly modifying the image\u2019s aspect ratio. In proportional mode, GeoServer will expand the image to be large enough to surround the text while preserving its original aspect ratio.",maxAngleDeltaHelp:"Designed to use used in conjuection with followLine, the maxAngleDelta option sets the maximum angle, in degrees, between two subsequent characters in a curved label. Large angles create either visually disconnected words or overlapping characters. It is advised not to use angles larger than 30.",
polygonAlignHelp:"GeoServer normally tries to place horizontal labels within a polygon, and give up in case the label position is busy or if the label does not fit enough in the polygon. This options allows GeoServer to try alternate rotations for the labels. Possible options: the default value, only the rotation manually specified in the <Rotation> tag will be used (manual), If the label does not fit horizontally and the polygon is taller than wider the vertical alignement will also be tried (ortho), If the label does not fit horizontally the minimum bounding rectangle will be computed and a label aligned to it will be tried out as well (mbr).",
graphic_marginHelp:"Similar to the margin shorthand property in CSS for HTML, its interpretation varies depending on how many margin values are provided: 1 = use that margin length on all sides of the label 2 = use the first for top & bottom margins and the second for left & right margins. 3 = use the first for the top margin, second for left & right margins, third for the bottom margin. 4 = use the first for the top margin, second for the right margin, third for the bottom margin, and fourth for the left margin.",
initComponent:function(){if(!this.symbolizer)this.symbolizer={};Ext.applyIf(this.symbolizer,this.defaultSymbolizer);if(!this.symbolizer.vendorOptions)this.symbolizer.vendorOptions={};this.haloCache={};this.attributes.on("load",this.showHideGeometryOptions,this);this.attributes.load();var a={xtype:"combo",fieldLabel:this.labelValuesText,store:this.attributes,mode:"local",lastQuery:"",editable:!1,triggerAction:"all",allowBlank:!1,displayField:"name",valueField:"name",value:this.symbolizer.label&&this.symbolizer.label.replace(/^\${(.*)}$/,
"$1"),listeners:{select:function(a,c){this.symbolizer.label="${"+c.get("name")+"}";this.fireEvent("change",this.symbolizer)},scope:this},width:120};this.attributesComboConfig=this.attributesComboConfig||{};Ext.applyIf(this.attributesComboConfig,a);this.labelWidth=80;this.items=[this.attributesComboConfig,{cls:"x-html-editor-tb",style:"background: transparent; border: none; padding: 0 0em 0.5em;",xtype:"toolbar",items:[{xtype:"gxp_fontcombo",fonts:this.fonts||void 0,width:110,value:this.symbolizer.fontFamily,
listeners:{select:function(a,c){this.symbolizer.fontFamily=c.get("field1");this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"tbtext",text:this.sizeText+": "},{xtype:"numberfield",allowNegative:!1,emptyText:OpenLayers.Renderer.defaultSymbolizerGXP.fontSize,value:this.symbolizer.fontSize,width:30,listeners:{change:function(a,c){c=parseFloat(c);isNaN(c)?delete this.symbolizer.fontSize:this.symbolizer.fontSize=c;this.fireEvent("change",this.symbolizer)},scope:this}},{enableToggle:!0,cls:"x-btn-icon",
iconCls:"x-edit-bold",pressed:"bold"===this.symbolizer.fontWeight,listeners:{toggle:function(a,c){this.symbolizer.fontWeight=c?"bold":"normal";this.fireEvent("change",this.symbolizer)},scope:this}},{enableToggle:!0,cls:"x-btn-icon",iconCls:"x-edit-italic",pressed:"italic"===this.symbolizer.fontStyle,listeners:{toggle:function(a,c){this.symbolizer.fontStyle=c?"italic":"normal";this.fireEvent("change",this.symbolizer)},scope:this}}]},{xtype:"gxp_fillsymbolizer",fillText:this.fontColorTitle,symbolizer:this.symbolizer,
colorProperty:"fontColor",opacityProperty:"fontOpacity",checkboxToggle:!1,autoHeight:!0,width:213,labelWidth:70,plugins:this.colorManager&&[new this.colorManager],listeners:{change:function(){this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"fieldset",title:this.graphicTitle,checkboxToggle:!0,hideMode:"offsets",collapsed:!(this.symbolizer.fillColor||this.symbolizer.fillOpacity||this.symbolizer.vendorOptions["graphic-resize"]||this.symbolizer.vendorOptions["graphic-margin"]),labelWidth:70,
items:[{xtype:"gxp_pointsymbolizer",symbolizer:this.symbolizer,listeners:{change:function(a){a.graphic=!!a.graphicName||!!a.externalGraphic;this.fireEvent("change",this.symbolizer)},scope:this},border:!1,labelWidth:70},this.createVendorSpecificField({name:"graphic-resize",xtype:"combo",store:["none","stretch","proportional"],mode:"local",listeners:{select:function(a){"none"===a.getValue()?this.graphicMargin.hide():(Ext.isEmpty(this.graphicMargin.getValue())&&(this.graphicMargin.setValue(0),this.symbolizer.vendorOptions["graphic-margin"]=
0),this.graphicMargin.show())},scope:this},width:100,triggerAction:"all",fieldLabel:this.graphicResizeText}),this.createVendorSpecificField({name:"graphic-margin",ref:"../graphicMargin",hidden:"stretch"!==this.symbolizer.vendorOptions["graphic-resize"]&&"proportional"!==this.symbolizer.vendorOptions["graphic-resize"],width:100,fieldLabel:this.graphicMarginText,xtype:"textfield"})],listeners:{collapse:function(){this.graphicCache={externalGraphic:this.symbolizer.externalGraphic,fillColor:this.symbolizer.fillColor,
fillOpacity:this.symbolizer.fillOpacity,graphicName:this.symbolizer.graphicName,pointRadius:this.symbolizer.pointRadius,rotation:this.symbolizer.rotation,strokeColor:this.symbolizer.strokeColor,strokeWidth:this.symbolizer.strokeWidth,strokeDashStyle:this.symbolizer.strokeDashStyle};delete this.symbolizer.externalGraphic;delete this.symbolizer.fillColor;delete this.symbolizer.fillOpacity;delete this.symbolizer.graphicName;delete this.symbolizer.pointRadius;delete this.symbolizer.rotation;delete this.symbolizer.strokeColor;
delete this.symbolizer.strokeWidth;delete this.symbolizer.strokeDashStyle;this.fireEvent("change",this.symbolizer)},expand:function(){Ext.apply(this.symbolizer,this.graphicCache);this.doLayout();this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"fieldset",title:this.haloText,checkboxToggle:!0,collapsed:!(this.symbolizer.haloRadius||this.symbolizer.haloColor||this.symbolizer.haloOpacity),autoHeight:!0,labelWidth:50,items:[{xtype:"numberfield",fieldLabel:this.sizeText,anchor:"89%",allowNegative:!1,
emptyText:OpenLayers.Renderer.defaultSymbolizerGXP.haloRadius,value:this.symbolizer.haloRadius,listeners:{change:function(a,c){c=parseFloat(c);isNaN(c)?delete this.symbolizer.haloRadius:this.symbolizer.haloRadius=c;this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"gxp_fillsymbolizer",symbolizer:{fillColor:"haloColor"in this.symbolizer?this.symbolizer.haloColor:OpenLayers.Renderer.defaultSymbolizerGXP.haloColor,fillOpacity:"haloOpacity"in this.symbolizer?this.symbolizer.haloOpacity:100*
OpenLayers.Renderer.defaultSymbolizerGXP.haloOpacity},defaultColor:OpenLayers.Renderer.defaultSymbolizerGXP.haloColor,checkboxToggle:!1,width:190,labelWidth:60,plugins:this.colorManager&&[new this.colorManager],listeners:{change:function(a){this.symbolizer.haloColor=a.fillColor;this.symbolizer.haloOpacity=a.fillOpacity;this.fireEvent("change",this.symbolizer)},scope:this}}],listeners:{collapse:function(){this.haloCache={haloRadius:this.symbolizer.haloRadius,haloColor:this.symbolizer.haloColor,haloOpacity:this.symbolizer.haloOpacity};
delete this.symbolizer.haloRadius;delete this.symbolizer.haloColor;delete this.symbolizer.haloOpacity;this.fireEvent("change",this.symbolizer)},expand:function(){Ext.apply(this.symbolizer,this.haloCache);this.doLayout();this.fireEvent("change",this.symbolizer)},scope:this}},{xtype:"fieldset",collapsed:!(this.symbolizer.labelAlign||this.symbolizer.vendorOptions.polygonAlign||this.symbolizer.labelXOffset||this.symbolizer.labelYOffset||this.symbolizer.labelPerpendicularOffset),title:this.positioningText,
checkboxToggle:!0,autoHeight:!0,labelWidth:75,defaults:{width:100},items:[this.createField(Ext.applyIf({fieldLabel:this.anchorPointText,geometryTypes:["POINT"],value:this.symbolizer.labelAlign||"lb",store:[["lt","Left-top"],["ct","Center-top"],["rt","Right-top"],["lm","Left-center"],["cm","Center"],["rm","Right-center"],["lb","Left-bottom"],["cb","Center-bottom"],["rb","Right-bottom"]],listeners:{select:function(a){this.symbolizer.labelAlign=a.getValue();delete this.symbolizer.labelAnchorPointX;delete this.symbolizer.labelAnchorPointY;
this.fireEvent("change",this.symbolizer)},scope:this}},this.attributesComboConfig)),this.createField({xtype:"numberfield",geometryTypes:["POINT"],fieldLabel:this.displacementXText,value:this.symbolizer.labelXOffset,listeners:{change:function(a,c){this.symbolizer.labelXOffset=c;this.fireEvent("change",this.symbolizer)},scope:this}}),this.createField({xtype:"numberfield",geometryTypes:["POINT"],fieldLabel:this.displacementYText,value:this.symbolizer.labelYOffset,listeners:{change:function(a,c){this.symbolizer.labelYOffset=
c;this.fireEvent("change",this.symbolizer)},scope:this}}),this.createField({xtype:"numberfield",geometryTypes:["LINE"],fieldLabel:this.perpendicularOffsetText,value:this.symbolizer.labelPerpendicularOffset,listeners:{change:function(a,c){Ext.isEmpty(c)?delete this.symbolizer.labelPerpendicularOffset:this.symbolizer.labelPerpendicularOffset=c;this.fireEvent("change",this.symbolizer)},scope:this}}),this.createVendorSpecificField({name:"polygonAlign",geometryTypes:["POLYGON"],xtype:"combo",mode:"local",
value:this.symbolizer.vendorOptions.polygonAlign||"manual",triggerAction:"all",store:["manual","ortho","mbr"],fieldLabel:this.polygonAlignText})]},{xtype:"fieldset",title:this.priorityText,checkboxToggle:!0,collapsed:!this.symbolizer.priority,autoHeight:!0,labelWidth:50,items:[Ext.applyIf({fieldLabel:this.priorityText,value:this.symbolizer.priority&&this.symbolizer.priority.replace(/^\${(.*)}$/,"$1"),allowBlank:!0,name:"priority",plugins:[{ptype:"gxp_formfieldhelp",dismissDelay:2E4,helpText:this.priorityHelp}],
listeners:{select:function(a,c){this.symbolizer[a.name]="${"+c.get("name")+"}";this.fireEvent("change",this.symbolizer)},scope:this}},this.attributesComboConfig)]},{xtype:"fieldset",title:this.labelOptionsText,checkboxToggle:!0,collapsed:!(this.symbolizer.vendorOptions.autoWrap||this.symbolizer.vendorOptions.followLine||this.symbolizer.vendorOptions.maxAngleDelta||this.symbolizer.vendorOptions.maxDisplacement||this.symbolizer.vendorOptions.repeat||this.symbolizer.vendorOptions.forceLeftToRight||this.symbolizer.vendorOptions.group||
this.symbolizer.vendorOptions.spaceAround||this.symbolizer.vendorOptions.labelAllGroup||this.symbolizer.vendorOptions.conflictResolution||this.symbolizer.vendorOptions.goodnessOfFit||this.symbolizer.vendorOptions.polygonAlign),autoHeight:!0,labelWidth:80,defaults:{width:100},items:[this.createVendorSpecificField({name:"autoWrap",allowBlank:!1,fieldLabel:this.autoWrapText}),this.createVendorSpecificField({name:"followLine",geometryTypes:["LINE"],xtype:"checkbox",listeners:{check:function(a,c){c?this.maxAngleDelta.show():
this.maxAngleDelta.hide()},scope:this},fieldLabel:this.followLineText}),this.createVendorSpecificField({name:"maxAngleDelta",ref:"../maxAngleDelta",hidden:null==this.symbolizer.vendorOptions.followLine,geometryTypes:["LINE"],fieldLabel:this.maxAngleDeltaText}),this.createVendorSpecificField({name:"maxDisplacement",fieldLabel:this.maxDisplacementText}),this.createVendorSpecificField({name:"repeat",geometryTypes:["LINE"],fieldLabel:this.repeatText}),this.createVendorSpecificField({name:"forceLeftToRight",
xtype:"checkbox",geometryTypes:["LINE"],fieldLabel:this.forceLeftToRightText}),this.createVendorSpecificField({name:"group",listeners:{check:function(a,c){"LINE"===this.geometryType&&(!1===c?this.labelAllGroup.hide():this.labelAllGroup.show())},scope:this},xtype:"checkbox",yesno:!0,fieldLabel:this.groupText}),this.createVendorSpecificField({name:"labelAllGroup",ref:"../labelAllGroup",geometryTypes:["LINE"],hidden:"yes"!==this.symbolizer.vendorOptions.group,xtype:"checkbox",fieldLabel:this.labelAllGroupText}),
this.createVendorSpecificField({name:"conflictResolution",xtype:"checkbox",listeners:{check:function(a,c){c?this.spaceAround.show():this.spaceAround.hide()},scope:this},fieldLabel:this.conflictResolutionText}),this.createVendorSpecificField({name:"spaceAround",hidden:!0!==this.symbolizer.vendorOptions.conflictResolution,allowNegative:!0,ref:"../spaceAround",fieldLabel:this.spaceAroundText}),this.createVendorSpecificField({name:"goodnessOfFit",geometryTypes:["POLYGON"],fieldLabel:this.goodnessOfFitText})]}];
this.addEvents("change");gxp.TextSymbolizer.superclass.initComponent.call(this)},createField:function(a){var b=Ext.ComponentMgr.create(a);if(a.geometryTypes)this.on("geometrytype",function(c){-1===a.geometryTypes.indexOf(c)&&b.hide()});return b},createVendorSpecificField:function(a){var b=function(b,c){Ext.isEmpty(c)?delete this.symbolizer.vendorOptions[a.name]:this.symbolizer.vendorOptions[a.name]=!0===a.yesno?!0==c?"yes":"no":c;this.fireEvent("change",this.symbolizer)},c=Ext.ComponentMgr.create(Ext.applyIf(a,
{xtype:"numberfield",allowNegative:!1,value:a.value||this.symbolizer.vendorOptions[a.name],checked:!0===a.yesno?"yes"===this.symbolizer.vendorOptions[a.name]:this.symbolizer.vendorOptions[a.name],plugins:[{ptype:"gxp_formfieldhelp",dismissDelay:2E4,helpText:this[a.name.replace(/-/g,"_")+"Help"]}]}));c.on("change",b,this);c.on("check",b,this);if(a.geometryTypes)this.on("geometrytype",function(b){-1===a.geometryTypes.indexOf(b)&&c.hide()});return c},showHideGeometryOptions:function(){var a=/gml:((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry)).*/,
b=/gml:((Multi)?(Polygon|Surface)).*/,c=/gml:((Multi)?(Point)).*/,d=/gml:((Multi)?(Line|Curve|Surface)).*/,e=null;this.attributes.each(function(f){f=f.get("type");a.exec(f)&&(b.exec(f)?e="POLYGON":c.exec(f)?e="POINT":d.exec(f)&&(e="LINE"))},this);if(null!==e)this.geometryType=e,this.fireEvent("geometrytype",e)}});Ext.reg("gxp_textsymbolizer",gxp.TextSymbolizer);Ext.namespace("gxp.slider");
gxp.slider.Tip=Ext.extend(Ext.slider.Tip,{hover:!0,dragging:!1,init:function(a){if(this.hover)a.on("render",this.registerThumbListeners,this);this.slider=a;gxp.slider.Tip.superclass.init.apply(this,arguments)},registerThumbListeners:function(){for(var a=0,b=this.slider.thumbs.length;a<b;++a)this.slider.thumbs[a].el.on({mouseover:this.createHoverListener(a),mouseout:function(){this.dragging||this.hide.apply(this,arguments)},scope:this})},createHoverListener:function(a){return function(){this.onSlide(this.slider,
{},this.slider.thumbs[a]);this.dragging=!1}.createDelegate(this)},onSlide:function(a,b,c){this.dragging=!0;gxp.slider.Tip.superclass.onSlide.apply(this,arguments)}});Ext.namespace("gxp");
gxp.Viewer=Ext.extend(Ext.util.Observable,{defaultToolType:"gxp_tool",tools:null,selectedLayer:null,authenticate:null,saveErrorText:"Trouble saving: ",constructor:function(a){this.addEvents("ready","beforecreateportal","portalready","beforelayerselectionchange","layerselectionchange","featureedit","authorizationchange","beforesave","save","beforehashchange");Ext.apply(this,{layerSources:{},portalItems:[]});this.createLayerRecordQueue=[];(a.loadConfig||this.loadConfig).call(this,a,this.applyConfig);
gxp.Viewer.superclass.constructor.apply(this,arguments)},selectLayer:function(a){var a=a||null,b=!1;if(!1!==this.fireEvent("beforelayerselectionchange",a))b=!0,this.selectedLayer&&this.selectedLayer.set("selected",!1),(this.selectedLayer=a)&&this.selectedLayer.set("selected",!0),this.fireEvent("layerselectionchange",a);return b},loadConfig:function(a){this.applyConfig(a)},applyConfig:function(a){this.initialConfig=Ext.apply({},a);Ext.apply(this,this.initialConfig);this.load()},load:function(){if(this.proxy)OpenLayers.ProxyHost=
this.proxy;this.initMapPanel();this.initTools();var a=[],b;for(b in this.sources)a.push(this.createSourceLoader(b));a.push(function(a){Ext.onReady(function(){this.initPortal();a()},this)});gxp.util.dispatch(a,this.activate,this)},createSourceLoader:function(a){return function(b){var c=this.sources[a];c.projection=this.initialConfig.map.projection;this.addLayerSource({id:a,config:c,callback:b,fallback:function(){b()},scope:this})}},addLayerSource:function(a){var b=a.id||Ext.id(null,"gxp-source-"),
c,d=a.config;d.id=b;try{c=Ext.ComponentMgr.createPlugin(d,this.defaultSourceType)}catch(e){throw Error("Could not create new source plugin with ptype: "+a.config.ptype);}c.on({ready:{fn:function(){(a.callback||Ext.emptyFn).call(a.scope||this,b)},scope:this,single:!0},failure:{fn:function(){var c=a.fallback||Ext.emptyFn;delete this.layerSources[b];c.apply(a.scope||this,arguments)},scope:this,single:!0}});this.layerSources[b]=c;c.init(this);return c},initMapPanel:function(){var a=Ext.apply({},this.initialConfig.map),
b={},c={wrapDateLine:void 0!==a.wrapDateLine?a.wrapDateLine:!0,maxResolution:a.maxResolution,numZoomLevels:a.numZoomLevels,displayInLayerSwitcher:!1};if(this.initialConfig.map)for(var d="theme,controls,resolutions,projection,units,maxExtent,restrictedExtent,maxResolution,numZoomLevels,panMethod".split(","),e,f=d.length-1;0<=f;--f)e=d[f],e in a&&(b[e]=a[e],delete a[e]);this.mapPanel=Ext.ComponentMgr.create(Ext.applyIf({xtype:a.xtype||"gx_mappanel",map:Ext.applyIf({theme:b.theme||null,controls:b.controls||
[new OpenLayers.Control.Navigation({zoomWheelOptions:{interval:250},dragPanOptions:{enableKinetic:!0}}),new OpenLayers.Control.PanPanel,new OpenLayers.Control.ZoomPanel,new OpenLayers.Control.Attribution],maxExtent:b.maxExtent&&OpenLayers.Bounds.fromArray(b.maxExtent),restrictedExtent:b.restrictedExtent&&OpenLayers.Bounds.fromArray(b.restrictedExtent),numZoomLevels:b.numZoomLevels||20},b),center:a.center&&new OpenLayers.LonLat(a.center[0],a.center[1]),resolutions:a.resolutions,forceInitialExtent:!0,
layers:[new OpenLayers.Layer(null,c)],items:this.mapItems,plugins:this.mapPlugins,tbar:a.tbar||new Ext.Toolbar({hidden:!0})},a));this.mapPanel.getTopToolbar().on({afterlayout:this.mapPanel.map.updateSize,show:this.mapPanel.map.updateSize,hide:this.mapPanel.map.updateSize,scope:this.mapPanel.map});this.mapPanel.layers.on({add:function(a,b){for(var c,d=b.length-1;0<=d;d--)c=b[d],!0===c.get("selected")&&this.selectLayer(c)},remove:function(a,b){!0===b.get("selected")&&this.selectLayer()},scope:this})},
initTools:function(){this.tools={};if(this.initialConfig.tools&&0<this.initialConfig.tools.length)for(var a,b=0,c=this.initialConfig.tools.length;b<c;b++){try{a=Ext.ComponentMgr.createPlugin(this.initialConfig.tools[b],this.defaultToolType)}catch(d){throw Error("Could not create tool plugin with ptype: "+this.initialConfig.tools[b].ptype);}a.init(this)}},initPortal:function(){var a=Ext.apply({},this.portalConfig);if(0===this.portalItems.length)this.mapPanel.region="center",this.portalItems.push(this.mapPanel);
this.fireEvent("beforecreateportal");this.portal=Ext.ComponentMgr.create(Ext.applyIf(a,{layout:"fit",hideBorders:!0,items:{layout:"border",deferredRender:!1,items:this.portalItems}}),a.renderTo?"panel":"viewport");this.fireEvent("portalready")},activate:function(){Ext.QuickTips.init();this.addLayers();this.checkLayerRecordQueue();this.fireEvent("ready")},addLayers:function(){var a=this.initialConfig.map;if(a&&a.layers){for(var b,c,d=[],e=[],f=0;f<a.layers.length;++f)b=a.layers[f],(c=this.layerSources[b.source])?
(b=c.createLayerRecord(b))&&("background"===b.get("group")?d.push(b):e.push(b)):window.console&&console.warn("Non-existing source '"+b.source+"' referenced in layer config.");a=this.mapPanel;d=d.concat(e);d.length&&a.layers.add(d)}},getLayerRecordFromMap:function(a){var b=null;this.mapPanel&&this.mapPanel.layers.each(function(c){if(c.get("source")==a.source&&c.get("name")==a.name)return b=c,!1});return b},createLayerRecord:function(a,b,c){this.createLayerRecordQueue.push({config:a,callback:b,scope:c});
this.checkLayerRecordQueue()},checkLayerRecordQueue:function(){for(var a,b,c,d,e=[],f=0,g=this.createLayerRecordQueue.length;f<g;++f)d=!1,a=this.createLayerRecordQueue[f],b=a.config.source,b in this.layerSources&&(b=this.layerSources[b],(c=b.createLayerRecord(a.config))?(function(a,b){window.setTimeout(function(){a.callback.call(a.scope,b)},0)}(a,c),d=!0):b.lazy&&b.store.load({callback:this.checkLayerRecordQueue,scope:this})),d||e.push(a);this.createLayerRecordQueue=e},getSource:function(a){return a&&
this.layerSources[a.get("source")]},getState:function(){var a=Ext.apply({},this.initialConfig),b=this.mapPanel.map.getCenter();Ext.apply(a.map,{center:[b.lon,b.lat],zoom:this.mapPanel.map.zoom,layers:[]});var c={};this.mapPanel.layers.each(function(b){var e=b.getLayer();if(e.displayInLayerSwitcher&&!(e instanceof OpenLayers.Layer.Vector)){var f=b.get("source"),g=this.layerSources[f];if(!g)throw Error("Could not find source for record '"+b.get("name")+" and layer "+e.name+"'");a.map.layers.push(g.getConfigForRecord(b));
c[f]||(c[f]=g.getState())}},this);Ext.apply(this.sources,c);a.tools=[];Ext.iterate(this.tools,function(b,c){c.getState!=gxp.plugins.Tool.prototype.getState&&a.tools.push(c.getState())});return a},isAuthorized:function(a){var b=!0;if(this.authorizedRoles){b=!1;a||(a="ROLE_ADMINISTRATOR");Ext.isArray(a)||(a=[a]);for(var c=a.length-1;0<=c;--c)if(~this.authorizedRoles.indexOf(a[c])){b=!0;break}}return b},setAuthorizedRoles:function(a){this.authorizedRoles=a;this.fireEvent("authorizationchange")},cancelAuthentication:function(){this._authFn&&
this.un("authorizationchange",this._authFn,this);this.fireEvent("authorizationchange")},isAuthenticated:function(){return!this.authorizedRoles||0<this.authorizedRoles.length},doAuthorized:function(a,b,c){this.isAuthorized(a)||!this.authenticate?window.setTimeout(function(){b.call(c)},0):(this.authenticate(),this._authFn=function(){delete this._authFn;this.doAuthorized(a,b,c,!0)},this.on("authorizationchange",this._authFn,this,{single:!0}))},save:function(a,b){var c=Ext.util.JSON.encode(this.getState()),
d,e;this.id?(d="PUT",e="../maps/"+this.id):(d="POST",e="../maps/");c={method:d,url:e,data:c};!1!==this.fireEvent("beforesave",c,a)&&OpenLayers.Request.issue(Ext.apply(c,{callback:function(c){this.handleSave(c);a&&a.call(b||this,c)},scope:this}))},handleSave:function(a){if(200==a.status){if(a=Ext.util.JSON.decode(a.responseText).id){this.id=a;a="#maps/"+a;if(!1!==this.fireEvent("beforehashchange",a))window.location.hash=a;this.fireEvent("save",this.id)}}else window.console&&console.warn(this.saveErrorText+
a.responseText)},destroy:function(){this.mapPanel.destroy();this.portal&&this.portal.destroy()}});(function(){OpenLayers.DOTS_PER_INCH=25.4/0.28})();Ext.namespace("gxp");
gxp.WMSLayerPanel=Ext.extend(Ext.TabPanel,{layerRecord:null,source:null,styling:!0,sameOriginStyling:!0,rasterStyling:!1,transparent:null,editableStyles:!1,activeTab:0,border:!1,imageFormats:/png|gif|jpe?g/i,aboutText:"About",titleText:"Title",attributionText:"Attribution",nameText:"Name",descriptionText:"Description",displayText:"Display",opacityText:"Opacity",formatText:"Tile format",infoFormatText:"Info format",infoFormatEmptyText:"Select a format",transparentText:"Transparent",cacheText:"Caching",
cacheFieldText:"Use cached tiles",stylesText:"Available Styles",displayOptionsText:"Display options",queryText:"Limit with filters",scaleText:"Limit by scale",minScaleText:"Min scale",maxScaleText:"Max scale",switchToFilterBuilderText:"Switch back to filter builder",cqlPrefixText:"or ",cqlText:"use CQL filter instead",singleTileText:"Single tile",singleTileFieldText:"Use a single tile",initComponent:function(){this.cqlFormat=new OpenLayers.Format.CQL;this.source&&this.source.getSchema(this.layerRecord,
function(a){if(!1!==a){var c=this.layerRecord.getLayer().params.CQL_FILTER;this.filterBuilder=new gxp.FilterBuilder({filter:c&&this.cqlFormat.read(c),allowGroups:!1,listeners:{afterrender:function(){this.filterBuilder.cascade(function(a){"toolbar"===a.getXType()&&(a.addText(this.cqlPrefixText),a.addButton({text:this.cqlText,handler:this.switchToCQL,scope:this}))},this)},change:function(a){var a=a.getFilter(),b=null;!1!==a&&(b=this.cqlFormat.write(a));this.layerRecord.getLayer().mergeNewParams({CQL_FILTER:b})},
scope:this},attributes:a});this.filterFieldset.add(this.filterBuilder);this.filterFieldset.doLayout()}},this);this.addEvents("change");this.items=[this.createAboutPanel(),this.createDisplayPanel()];if(this.styling&&gxp.WMSStylesDialog&&this.layerRecord.get("styles")){var a=this.layerRecord.get("restUrl");a||(a=(this.source||this.layerRecord.get("layer")).url.split("?").shift().replace(/\/(wms|ows)\/?$/,"/rest"));this.editableStyles=this.sameOriginStyling?"/"===a.charAt(0):!0;this.items.push(this.createStylesPanel(a))}gxp.WMSLayerPanel.superclass.initComponent.call(this)},
switchToCQL:function(){var a=this.filterBuilder.getFilter(),b="";!1!==a&&(b=this.cqlFormat.write(a));this.filterBuilder.hide();this.cqlField.setValue(b);this.cqlField.show();this.cqlToolbar.show()},switchToFilterBuilder:function(){var a=null;try{a=this.cqlFormat.read(this.cqlField.getValue())}catch(b){}this.cqlField.hide();this.cqlToolbar.hide();this.filterBuilder.show();null!==a&&this.filterBuilder.setFilter(a)},createStylesPanel:function(a){a=gxp.WMSStylesDialog.createGeoServerStylerConfig(this.layerRecord,
a);!0===this.rasterStyling&&a.plugins.push({ptype:"gxp_wmsrasterstylesdialog"});var b=this.ownerCt;if(!(b.ownerCt instanceof Ext.Window))a.dialogCls=Ext.Panel,a.showDlg=function(a){a.layout="fit";a.autoHeight=!1;b.add(a)};return Ext.apply(a,{title:this.stylesText,style:"padding: 10px",editable:!1})},createAboutPanel:function(){return{title:this.aboutText,bodyStyle:{padding:"10px"},defaults:{border:!1},items:[{layout:"form",labelWidth:70,items:[{xtype:"textfield",fieldLabel:this.titleText,anchor:"99%",
value:this.layerRecord.get("title"),listeners:{change:function(a){this.layerRecord.set("title",a.getValue());this.layerRecord.commit();this.fireEvent("change")},scope:this}},{xtype:"textfield",fieldLabel:this.nameText,anchor:"99%",value:this.layerRecord.get("name"),readOnly:!0},{xtype:"textfield",fieldLabel:this.attributionText,anchor:"99%",listeners:{change:function(a){var b=this.layerRecord.getLayer();b.attribution=a.getValue();b.map.events.triggerEvent("changelayer",{layer:b,property:"attribution"});
this.fireEvent("change")},scope:this},value:this.layerRecord.getLayer().attribution}]},{layout:"form",labelAlign:"top",items:[{xtype:"textarea",fieldLabel:this.descriptionText,grow:!0,growMax:150,anchor:"99%",value:this.layerRecord.get("abstract"),readOnly:!0}]}]}},onFormatChange:function(a){var b=this.layerRecord.getLayer(),a=a.getValue();b.mergeNewParams({format:a});b=this.transparentCb;if("image/jpeg"==a)this.transparent=b.getValue(),b.setValue(!1);else if(null!==this.transparent)b.setValue(this.transparent),
this.transparent=null;b.setDisabled("image/jpeg"==a);this.fireEvent("change")},addScaleOptions:function(a,b){a.alwaysInRange=null;a.addOptions(b);a.display();a.redraw()},createDisplayPanel:function(){var a=this.layerRecord,b=a.getLayer(),c=b.opacity;null==c&&(c=1);var d=[],c=b.params.FORMAT.toLowerCase();Ext.each(a.get("formats"),function(a){this.imageFormats.test(a)&&d.push(a.toLowerCase())},this);-1===d.indexOf(c)&&d.push(c);var e=b.params.TRANSPARENT;return{title:this.displayText,layout:"form",
bodyStyle:{padding:"10px"},defaults:{labelWidth:70},items:[{xtype:"fieldset",title:this.displayOptionsText,items:[{xtype:"gx_opacityslider",name:"opacity",anchor:"99%",isFormField:!0,fieldLabel:this.opacityText,listeners:{change:function(){this.fireEvent("change")},scope:this},layer:this.layerRecord},{xtype:"compositefield",fieldLabel:this.formatText,anchor:"99%",items:[{xtype:"combo",width:90,listWidth:150,store:d,value:c,mode:"local",triggerAction:"all",editable:!1,listeners:{select:this.onFormatChange,
scope:this}},{xtype:"checkbox",ref:"../../../transparentCb",checked:"true"===e||!0===e,listeners:{check:function(a,c){b.mergeNewParams({transparent:c?"true":"false"});this.fireEvent("change")},scope:this}},{xtype:"label",cls:"gxp-layerproperties-label",text:this.transparentText}]},{xtype:"compositefield",fieldLabel:this.singleTileText,anchor:"99%",items:[{xtype:"checkbox",checked:this.layerRecord.get("layer").singleTile,listeners:{check:function(a,c){b.addOptions({singleTile:c});this.fireEvent("change")},
scope:this}},{xtype:"label",cls:"gxp-layerproperties-label",text:this.singleTileFieldText}]},{xtype:"compositefield",anchor:"99%",hidden:null==this.layerRecord.get("layer").params.TILED,fieldLabel:this.cacheText,items:[{xtype:"checkbox",checked:!0===this.layerRecord.get("layer").params.TILED,listeners:{check:function(a,b){this.layerRecord.get("layer").mergeNewParams({TILED:b});this.fireEvent("change")},scope:this}},{xtype:"label",cls:"gxp-layerproperties-label",text:this.cacheFieldText}]},{xtype:"combo",
fieldLabel:this.infoFormatText,emptyText:this.infoFormatEmptyText,store:a.get("infoFormats"),value:a.get("infoFormat"),hidden:void 0===a.get("infoFormats"),mode:"local",listWidth:150,triggerAction:"all",editable:!1,anchor:"99%",listeners:{select:function(b){b=b.getValue();a.set("infoFormat",b);this.fireEvent("change")}},scope:this}]},{xtype:"fieldset",title:this.queryText,hideLabels:!0,ref:"../filterFieldset",listeners:{expand:function(){this.layerRecord.getLayer().mergeNewParams({CQL_FILTER:this.cqlFilter})},
collapse:function(){this.cqlFilter=this.layerRecord.getLayer().params.CQL_FILTER;this.layerRecord.getLayer().mergeNewParams({CQL_FILTER:null})},scope:this},hidden:null===this.source,checkboxToggle:!0,collapsed:!this.layerRecord.getLayer().params.CQL_FILTER,items:[{xtype:"textarea",value:this.layerRecord.getLayer().params.CQL_FILTER,grow:!0,anchor:"99%",width:"100%",growMax:100,ref:"../../cqlField",hidden:!0}],buttons:[{ref:"../../../cqlToolbar",hidden:!0,text:this.switchToFilterBuilderText,handler:this.switchToFilterBuilder,
scope:this}]},{xtype:"fieldset",title:this.scaleText,listeners:{expand:function(){var a=this.layerRecord.getLayer();(void 0!==this.minScale||void 0!==this.maxScale)&&this.addScaleOptions(a,{minScale:this.maxScale,maxScale:this.minScale})},collapse:function(){var a=this.layerRecord.getLayer();this.minScale=a.options.maxScale;this.maxScale=a.options.minScale;this.addScaleOptions(a,{minScale:null,maxScale:null})},scope:this},checkboxToggle:!0,collapsed:null==this.layerRecord.getLayer().options.maxScale&&
null==this.layerRecord.getLayer().options.minScale,items:[{xtype:"compositefield",fieldLabel:this.minScaleText,items:[{xtype:"label",text:"1:",cls:"gxp-layerproperties-label"},{xtype:"numberfield",anchor:"99%",width:"85%",listeners:{change:function(a){a={maxScale:parseInt(a.getValue())};this.addScaleOptions(this.layerRecord.getLayer(),a)},scope:this},value:this.layerRecord.getLayer().options.maxScale}]},{xtype:"compositefield",fieldLabel:this.maxScaleText,items:[{xtype:"label",text:"1:",cls:"gxp-layerproperties-label"},
{xtype:"numberfield",anchor:"99%",width:"85%",listeners:{change:function(a){a={minScale:parseInt(a.getValue())};this.addScaleOptions(this.layerRecord.getLayer(),a)},scope:this},value:this.layerRecord.getLayer().options.minScale}]}]}]}}});Ext.reg("gxp_wmslayerpanel",gxp.WMSLayerPanel);/**
 * Copyright (c) 2008-2009 The Open Source Geospatial Foundation
 *
 * Published under the BSD license.
 * See http://svn.geoext.org/core/trunk/geoext/license.txt for the full text
 * of the license.
 */
/**
 * Copyright (c) 2008-2009 The Open Source Geospatial Foundation
 *
 * Published under the BSD license.
 * See http://svn.geoext.org/core/trunk/geoext/license.txt for the full text
 * of the license.
 */

Ext.namespace("GeoExt.ux");GeoExt.ux.PrintPreview=Ext.extend(Ext.Container,{paperSizeText:"Layout:",resolutionText:"Resolution:",printText:"Print",emptyTitleText:"Enter map title here.",emptyCommentText:"Enter comments here.",emptyFooterText:"Enter map footer here.",creatingPdfText:"Creating PDF...",creatingPrintText:"Creating Print...",includeLegendText:"Include legend?",rotationText:"Rotation",outputFormatText:"Format",printProvider:null,sourceMap:null,printMapPanel:null,showTitle:true,mapTitle:null,mapTitleYAML:"mapTitle",showComment:true,mapComment:null,mapCommentYAML:"mapComment",showFooter:true,mapFooter:null,mapFooterYAML:"mapFooter",printAttribution:true,mapAttribution:null,mapAttributionYAML:"mapAttribution",showLegend:true,mapLegend:null,showLegendChecked:false,showRotation:true,printRotationPage:null,printRotationExtent:null,printRotationExtentOptions:null,showOutputFormats:false,addMapOverlay:true,mapPreviewAutoHeight:true,mapPreviewHeight:250,busyMask:null,form:null,autoEl:"center",cls:"x-panel-body x-panel-body-noheader",initComponent:function(){var printMapPanelOptions={sourceMap:this.sourceMap,printProvider:this.printProvider};if(this.printMapPanel){if(!(this.printMapPanel instanceof GeoExt.PrintMapPanel)){printMapPanelOptions.xtype="gx_printmappanel";this.printMapPanel=new GeoExt.PrintMapPanel(Ext.applyIf(this.printMapPanel,printMapPanelOptions));}}else{this.printMapPanel=new GeoExt.PrintMapPanel(printMapPanelOptions);}
this.sourceMap=this.printMapPanel.sourceMap;this.printProvider=this.printMapPanel.printProvider;this.printMapPanel.autoHeight=this.mapPreviewAutoHeight;this.printMapPanel.height=this.mapPreviewHeight;if(this.mapLegend){this.printProvider.encoders.legends.gx_vectorlegend=function(legend){return[{name:'',classes:[]}];}}
if(this.showRotation){this.printRotationPage=new GeoExt.data.PrintPage({printProvider:this.printProvider});this.printRotationExtent=new GeoExt.plugins.PrintExtent(Ext.applyIf({pages:[this.printRotationPage],layer:this.initialConfig.layer},this.printRotationExtentOptions));}
if(this.printAttribution){var attributions=[];if(!this.mapAttribution){if(this.sourceMap&&this.sourceMap.layers){for(var i=0,len=this.sourceMap.layers.length;i<len;i++){var layer=this.sourceMap.layers[i];if(layer.attribution&&layer.getVisibility()){if(OpenLayers.Util.indexOf(attributions,layer.attribution)===-1){attributions.push(layer.attribution);}}}
this.mapAttribution=attributions;}}}else{this.mapAttribution=null;}
this.form=this.createForm();if(!this.items){this.items=[];}
this.items.push(this.createToolbar(),{xtype:"container",cls:"gx-printpreview",autoHeight:this.printMapPanel.autoHeight?this.autoHeight:true,autoWidth:this.printMapPanel.autoHeight?this.autoWidth:true,items:[this.form,this.printMapPanel]});GeoExt.ux.PrintPreview.superclass.initComponent.call(this);this.addMapOverlay&&this.printMapPanel.add(this.createMapOverlay());if(this.showRotation){this.printMapPanel.initPlugin(this.printRotationExtent);}
this.printMapPanel.on({"resize":this.updateSize,scope:this});this.on({"render":function(){if(!this.busyMask){this.busyMask=new Ext.LoadMask(this.getEl(),{msg:this.showOutputFormats?this.creatingPrintText:this.creatingPdfText});}
this.printProvider.on({"beforeprint":this.busyMask.show,"print":this.busyMask.hide,"printexception":this.busyMask.hide,scope:this.busyMask});},scope:this});},createToolbar:function(){var items=[];this.printProvider.layouts.getCount()>1&&items.push(this.paperSizeText,{xtype:"combo",width:100,plugins:new GeoExt.plugins.PrintProviderField({printProvider:this.printProvider}),store:this.printProvider.layouts,displayField:"name",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true},"&nbsp;");this.printProvider.dpis.getCount()>1&&items.push(this.resolutionText,{xtype:"combo",width:65,plugins:new GeoExt.plugins.PrintProviderField({printProvider:this.printProvider}),store:this.printProvider.dpis,displayField:"name",tpl:'<tpl for="."><div class="x-combo-list-item">{name} dpi</div></tpl>',typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true,setValue:function(v){v=parseInt(v)+" dpi";Ext.form.ComboBox.prototype.setValue.apply(this,arguments);}},"&nbsp;");items.push("->",{text:"&nbsp;"+this.printText,iconCls:"icon-print",handler:function(){if(!this.showRotation){this.printMapPanel.print(this.showLegendChecked&&{legend:this.mapLegend});}else{this.printRotationExtent.print(this.showLegendChecked&&{legend:this.mapLegend});}},scope:this});return{xtype:"toolbar",enableOverflow:true,items:items};},stripHTML:function(html){var tmp=document.createElement("DIV");tmp.innerHTML=html;return tmp.textContent||tmp.innerText||"";},createForm:function(){var titleCfg={xtype:"textfield",name:this.mapTitleYAML,value:this.mapTitle,emptyText:this.emptyTitleText,hideLabel:true,cls:"x-form-item",hidden:!this.showTitle,plugins:new GeoExt.plugins.PrintProviderField({printProvider:this.printProvider})};var commentCfg={xtype:"textarea",name:this.mapCommentYAML,value:this.mapComment,emptyText:this.emptyCommentText,hideLabel:true,cls:"x-form-item",hidden:!this.showComment,plugins:new GeoExt.plugins.PrintProviderField({printProvider:this.printProvider})};var footerCfg={xtype:"textfield",name:this.mapFooterYAML,value:this.mapFooter,emptyText:this.emptyFooterText,hideLabel:true,cls:"x-form-item",hidden:!this.showFooter,plugins:new GeoExt.plugins.PrintProviderField({printProvider:this.printProvider})};var attributionCfg={xtype:"textfield",name:this.mapAttributionYAML,value:this.mapAttribution?this.stripHTML(this.mapAttribution):"",hidden:true,plugins:new GeoExt.plugins.PrintProviderField({printProvider:this.printProvider})};var advancedItems=[];if(this.showOutputFormats){advancedItems.push(this.outputFormatText+':',{xtype:"combo",width:62,listWidth:80,plugins:new GeoExt.plugins.PrintProviderField({printProvider:this.printProvider}),store:this.printProvider.outputFormats,displayField:"name",tpl:'<tpl for="."><div class="x-combo-list-item">{name}</div></tpl>',typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true,setValue:function(v){Ext.form.ComboBox.prototype.setValue.apply(this,arguments);}},{xtype:'tbspacer',width:12});}
if(this.showRotation){advancedItems.push(this.rotationText+":",{xtype:"numberfield",name:"rotation",value:0,hideLabel:true,width:40,allowBlank:false,allowNegative:false,allowDecimals:false,decimalPrecision:0,minValue:-360,maxValue:360,enableKeyEvents:true,plugins:new GeoExt.plugins.PrintPageField({printPage:this.printRotationPage})},{xtype:'tbspacer',width:12});}
if(this.mapLegend){advancedItems.push('->',new Ext.form.Checkbox({name:"mapLegend",checked:this.showLegendChecked,boxLabel:this.includeLegendText,hideLabel:true,ctCls:"gx-item-nowrap",hidden:!this.showLegend,handler:function(cb,checked){this.showLegendChecked=checked;},scope:this}));}
var formItems=[titleCfg,commentCfg,footerCfg,attributionCfg];advancedItems.length>0&&formItems.push({xtype:"toolbar",cls:"x-form-item",items:advancedItems});return new Ext.form.FormPanel({autoHeight:true,border:false,defaults:{anchor:"100%"},items:formItems});},createMapOverlay:function(){var map=this.printMapPanel.map;var scaleLine=new OpenLayers.Control.ScaleLine({geodesic:!(map.getProjectionObject()||new OpenLayers.Projection(map.projection||"EPSG:4326")).equals("EPSG:4326")});map.addControl(scaleLine);scaleLine.activate();return new Ext.Panel({cls:"gx-map-overlay",layout:"column",width:235,bodyStyle:"padding:5px",items:[{xtype:"box",el:scaleLine.div,width:scaleLine.maxWidth},{xtype:"container",layout:"form",style:"padding: .2em 5px 0 0;",columnWidth:1,cls:"x-small-editor x-form-item",items:{xtype:"combo",name:"scale",anchor:"100%",hideLabel:true,store:this.printMapPanel.previewScales,displayField:"name",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true,getListParent:function(){return this.el.up(".x-window")||document.body;},plugins:(!this.showRotation)?new GeoExt.plugins.PrintPageField({printPage:this.printMapPanel.printPage}):new GeoExt.plugins.PrintPageField({printPage:this.printRotationPage})}},{xtype:"box",autoEl:{tag:"div",cls:"gx-northarrow"}}],listeners:{"render":function(){function stop(evt){evt.stopPropagation();}
this.getEl().on({"click":stop,"dblclick":stop,"mousedown":stop});}}});},updateSize:function(){this.suspendEvents();var mapWidth=this.printMapPanel.getWidth();this.form.setWidth(mapWidth);this.form.items.get(0).setWidth(mapWidth);var minWidth=this.initialConfig.minWidth||0;this.items.get(0).setWidth(this.form.ownerCt.el.getPadding("lr")+Math.max(mapWidth,minWidth));var parent=this.ownerCt;if(parent&&parent instanceof Ext.Window){this.ownerCt.syncShadow();}
this.resumeEvents();},beforeDestroy:function(){if(this.busyMask){this.printProvider.un("beforeprint",this.busyMask.show,this.busyMask);this.printProvider.un("print",this.busyMask.hide,this.busyMask);}
this.printMapPanel.un("resize",this.updateSize,this);GeoExt.ux.PrintPreview.superclass.beforeDestroy.apply(this,arguments);}});Ext.reg("gxux_printpreview",GeoExt.ux.PrintPreview);/*
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

Ext.namespace("Heron.i18n");function __(string){var dict=Heron.i18n.dict;if(typeof(dict)!='undefined'&&dict[string]){return dict[string];}
return string;}
Ext.namespace("gxp");if(!gxp.QueryPanel){gxp.QueryPanel=function(){};}else{Ext.namespace("gxp.data");gxp.data.WFSProtocolProxy=Ext.extend(GeoExt.data.ProtocolProxy,{setFilter:function(filter){this.protocol.filter=filter;this.protocol.options.filter=filter;},constructor:function(config){Ext.applyIf(config,{version:"1.1.0"});if(!(this.protocol&&this.protocol instanceof OpenLayers.Protocol)){config.protocol=new OpenLayers.Protocol.WFS(Ext.apply({version:config.version,srsName:config.srsName,url:config.url,featureType:config.featureType,featureNS:config.featureNS,geometryName:config.geometryName,schema:config.schema,filter:config.filter,maxFeatures:config.maxFeatures,outputFormat:config.url.indexOf('nationaalgeoregister')>0?'GML2':undefined,multi:config.multi},config.protocol));}
gxp.data.WFSProtocolProxy.superclass.constructor.apply(this,arguments);},doRequest:function(action,records,params,reader,callback,scope,arg){delete params.xaction;if(action===Ext.data.Api.actions.read){this.load(params,reader,callback,scope,arg);}else{if(!(records instanceof Array)){records=[records];}
var features=new Array(records.length),feature;Ext.each(records,function(r,i){features[i]=r.getFeature();feature=features[i];feature.modified=Ext.apply(feature.modified||{},{attributes:Ext.apply((feature.modified&&feature.modified.attributes)||{},r.modified)});},this);var o={action:action,records:records,callback:callback,scope:scope};var options={callback:function(response){this.onProtocolCommit(response,o);},scope:this};Ext.applyIf(options,params);this.protocol.commit(features,options);}},onProtocolCommit:function(response,o){if(response.success()){var features=response.reqFeatures;var state,feature;var destroys=[];var insertIds=response.insertIds||[];var i,len,j=0;for(i=0,len=features.length;i<len;++i){feature=features[i];state=feature.state;if(state){if(state==OpenLayers.State.DELETE){destroys.push(feature);}else if(state==OpenLayers.State.INSERT){feature.fid=insertIds[j];++j;}else if(feature.modified){feature.modified={};}
feature.state=null;}}
for(i=0,len=destroys.length;i<len;++i){feature=destroys[i];feature.layer&&feature.layer.destroyFeatures([feature]);}
len=features.length;var data=new Array(len);var f;for(i=0;i<len;++i){f=features[i];data[i]={id:f.id,feature:f,state:null};var fields=o.records[i].fields;for(var a in f.attributes){if(fields.containsKey(a)){data[i][a]=f.attributes[a];}}}
o.callback.call(o.scope,data,response.priv,true);}else{var request=response.priv;if(request.status>=200&&request.status<300){this.fireEvent("exception",this,"remote",o.action,o,response.error,o.records);}else{this.fireEvent("exception",this,"response",o.action,o,request);}
o.callback.call(o.scope,[],request,false);}}});}
if(gxp.ColorManager){Ext.override(gxp.ColorManager,{fieldFocus:function(field){if(!gxp.ColorManager.pickerWin){gxp.ColorManager.picker=new Ext.ColorPalette();gxp.ColorManager.pickerWin=new Ext.Window({title:"Color Picker",closeAction:"hide",autoWidth:Ext.isIE?false:true,autoHeight:Ext.isIE?false:true});}else{gxp.ColorManager.picker.purgeListeners();}
var listenerCfg={select:this.setFieldValue,scope:this};var value=this.getPickerValue();if(value){var colors=[].concat(gxp.ColorManager.picker.colors);if(!~colors.indexOf(value)){if(gxp.ColorManager.picker.ownerCt){gxp.ColorManager.pickerWin.remove(gxp.ColorManager.picker);gxp.ColorManager.picker=new Ext.ColorPalette();}
colors.push(value);gxp.ColorManager.picker.colors=colors;}
gxp.ColorManager.pickerWin.add(gxp.ColorManager.picker);if(Ext.isIE){gxp.ColorManager.pickerWin.setSize(456+10,248+36);}
gxp.ColorManager.pickerWin.doLayout();if(gxp.ColorManager.picker.rendered){gxp.ColorManager.picker.select(value);}else{listenerCfg.afterrender=function(){gxp.ColorManager.picker.select(value);};}}
gxp.ColorManager.picker.on(listenerCfg);gxp.ColorManager.pickerWin.show();}});}
if(!Ext.grid.GridView.prototype.templates){Ext.grid.GridView.prototype.templates={};}
Ext.grid.GridView.prototype.templates.cell=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} x-selectable {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="x-grid3-cell-inner x-grid3-col-{id}" {attr}>{value}</div>','</td>');(function(){var createComplete=function(fn,cb){return function(request){if(cb&&cb[fn]){cb[fn].call(cb.scope||window,Ext.applyIf({argument:cb.argument},request));}};};Ext.apply(Ext.lib.Ajax,{request:function(method,uri,cb,data,options){options=options||{};method=method||options.method;var hs=options.headers;if(options.xmlData){if(!hs||!hs["Content-Type"]){hs=hs||{};hs["Content-Type"]="text/xml";}
method=method||"POST";data=options.xmlData;}else if(options.jsonData){if(!hs||!hs["Content-Type"]){hs=hs||{};hs["Content-Type"]="application/json";}
method=method||"POST";data=typeof options.jsonData=="object"?Ext.encode(options.jsonData):options.jsonData;}
if((method&&method.toLowerCase()=="post")&&(options.form||options.params)&&(!hs||!hs["Content-Type"])){hs=hs||{};hs["Content-Type"]="application/x-www-form-urlencoded";}
return OpenLayers.Request.issue({success:createComplete("success",cb),failure:createComplete("failure",cb),method:method,headers:hs,data:data,url:uri});},isCallInProgress:function(request){return true;},abort:function(request){request.abort();}});})();Ext.override(Ext.ColorPalette,{colors:['FBEFEF','FBF2EF','FBF5EF','FBF8EF','FBFBEF','F8FBEF','F5FBEF','F2FBEF','EFFBEF','EFFBF2','EFFBF5','EFFBF8','EFFBFB','EFF8FB','EFF5FB','EFF2FB','EFEFFB','F2EFFB','F5EFFB','F8EFFB','FBEFFB','FBEFF8','FBEFF5','FBEFF2','FFFFFF','F8E0E0','F8E6E0','F8ECE0','F7F2E0','F7F8E0','F1F8E0','ECF8E0','E6F8E0','E0F8E0','E0F8E6','E0F8EC','E0F8F1','E0F8F7','E0F2F7','E0ECF8','E0E6F8','E0E0F8','E6E0F8','ECE0F8','F2E0F7','F8E0F7','F8E0F1','F8E0EC','F8E0E6','FAFAFA','F6CECE','F6D8CE','F6E3CE','F5ECCE','F5F6CE','ECF6CE','E3F6CE','D8F6CE','CEF6CE','CEF6D8','CEF6E3','CEF6EC','CEF6F5','CEECF5','CEE3F6','CED8F6','CECEF6','D8CEF6','E3CEF6','ECCEF5','F6CEF5','F6CEEC','F6CEE3','F6CED8','F2F2F2','F5A9A9','F5BCA9','F5D0A9','F3E2A9','F2F5A9','E1F5A9','D0F5A9','BCF5A9','A9F5A9','A9F5BC','A9F5D0','A9F5E1','A9F5F2','A9E2F3','A9D0F5','A9BCF5','A9A9F5','BCA9F5','D0A9F5','E2A9F3','F5A9F2','F5A9E1','F5A9D0','F5A9BC','E6E6E6','F78181','F79F81','F7BE81','F5DA81','F3F781','D8F781','BEF781','9FF781','81F781','81F79F','81F7BE','81F7D8','81F7F3','81DAF5','81BEF7','819FF7','8181F7','9F81F7','BE81F7','DA81F5','F781F3','F781D8','F781BE','F7819F','D8D8D8','FA5858','FA8258','FAAC58','F7D358','F4FA58','D0FA58','ACFA58','82FA58','58FA58','58FA82','58FAAC','58FAD0','58FAF4','58D3F7','58ACFA','5882FA','5858FA','8258FA','AC58FA','D358F7','FA58F4','FA58D0','FA58AC','FA5882','BDBDBD','FE2E2E','FE642E','FE9A2E','FACC2E','F7FE2E','C8FE2E','9AFE2E','64FE2E','2EFE2E','2EFE64','2EFE9A','2EFEC8','2EFEF7','2ECCFA','2E9AFE','2E64FE','2E2EFE','642EFE','9A2EFE','CC2EFA','FE2EF7','FE2EC8','FE2E9A','FE2E64','A4A4A4','FF0000','FF4000','FF8000','FFBF00','FFFF00','BFFF00','80FF00','40FF00','00FF00','00FF40','00FF80','00FFBF','00FFFF','00BFFF','0080FF','0040FF','0000FF','4000FF','8000FF','BF00FF','FF00FF','FF00BF','FF0080','FF0040','848484','DF0101','DF3A01','DF7401','DBA901','D7DF01','A5DF00','74DF00','3ADF00','01DF01','01DF3A','01DF74','01DFA5','01DFD7','01A9DB','0174DF','013ADF','0101DF','3A01DF','7401DF','A901DB','DF01D7','DF01A5','DF0174','DF013A','6E6E6E','B40404','B43104','B45F04','B18904','AEB404','86B404','5FB404','31B404','04B404','04B431','04B45F','04B486','04B4AE','0489B1','045FB4','0431B4','0404B4','3104B4','5F04B4','8904B1','B404AE','B40486','B4045F','B40431','585858','8A0808','8A2908','8A4B08','886A08','868A08','688A08','4B8A08','298A08','088A08','088A29','088A4B','088A68','088A85','086A87','084B8A','08298A','08088A','29088A','4B088A','6A0888','8A0886','8A0868','8A084B','8A0829','424242','610B0B','61210B','61380B','5F4C0B','5E610B','4B610B','38610B','21610B','0B610B','0B6121','0B6138','0B614B','0B615E','0B4C5F','0B3861','0B2161','0B0B61','210B61','380B61','4C0B5F','610B5E','610B4B','610B38','610B21','2E2E2E','190707','190B07','191007','181407','181907','141907','101907','0B1907','071907','07190B','071910','071914','071918','071418','071019','070B19','070719','0B0719','100719','140718','190718','190714','190710','19070B','000000']});Ext.override(Ext.grid.PropertyColumnModel,{renderCell:function(val,meta,rec){var renderer=this.grid.customRenderers[rec.get('name')];if(renderer){return renderer.apply(this,arguments);}
var rv=val;if(Ext.isDate(val)){rv=this.renderDate(val);}else if(typeof val=='boolean'){rv=this.renderBool(val);}
if(val.indexOf("<")>=0&&(val.lastIndexOf("<")<val.lastIndexOf("\>"))){return rv;}else{return Ext.util.Format.htmlEncode(rv);}}});OpenLayers.Util.extend(OpenLayers.Format.WFST.v1.prototype.namespaces,{gml32:'http://www.opengis.net/gml/3.2'});OpenLayers.Format.Atom.prototype.parseLocations=function(node){var georssns=this.namespaces.georss;var locations={components:[]};var where=this.getElementsByTagNameNS(node,georssns,"where");if(where&&where.length>0){if(!this.gmlParser){this.initGmlParser();}
for(var i=0,ii=where.length;i<ii;i++){this.gmlParser.readChildNodes(where[i],locations);}}
var components=locations.components;var point=this.getElementsByTagNameNS(node,georssns,"point");if(point&&point.length>0){for(var i=0,ii=point.length;i<ii;i++){var xy=OpenLayers.String.trim(point[i].firstChild.nodeValue).split(/\s+/);if(xy.length!=2){xy=OpenLayers.String.trim(point[i].firstChild.nodeValue).split(/\s*,\s*/);}
components.push(new OpenLayers.Geometry.Point(xy[1],xy[0]));}}
var line=this.getElementsByTagNameNS(node,georssns,"line");if(line&&line.length>0){var coords;var p;var points;for(var i=0,ii=line.length;i<ii;i++){coords=OpenLayers.String.trim(line[i].firstChild.nodeValue).split(/\s+/);points=[];for(var j=0,jj=coords.length;j<jj;j+=2){p=new OpenLayers.Geometry.Point(coords[j+1],coords[j]);points.push(p);}
components.push(new OpenLayers.Geometry.LineString(points));}}
var polygon=this.getElementsByTagNameNS(node,georssns,"polygon");if(polygon&&polygon.length>0){var coords;var p;var points;for(var i=0,ii=polygon.length;i<ii;i++){coords=OpenLayers.String.trim(polygon[i].firstChild.nodeValue).split(/\s+/);points=[];for(var j=0,jj=coords.length;j<jj;j+=2){p=new OpenLayers.Geometry.Point(coords[j+1],coords[j]);points.push(p);}
components.push(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(points)]));}}
if(this.internalProjection&&this.externalProjection){for(var i=0,ii=components.length;i<ii;i++){if(components[i]){components[i].transform(this.externalProjection,this.internalProjection);}}}
return components;};OpenLayers.Util.modifyDOMElement=function(element,id,px,sz,position,border,overflow,opacity){if(id){element.id=id;}
if(px){if(!px.x){px.x=0;}
if(!px.y){px.y=0;}
element.style.left=px.x+"px";element.style.top=px.y+"px";}
if(sz){element.style.width=sz.w+"px";element.style.height=sz.h+"px";}
if(position){element.style.position=position;}
if(border){element.style.border=border;}
if(overflow){element.style.overflow=overflow;}
if(parseFloat(opacity)>=0.0&&parseFloat(opacity)<1.0){element.style.filter='alpha(opacity='+(opacity*100)+')';element.style.opacity=opacity;}else if(parseFloat(opacity)==1.0){element.style.filter='';element.style.opacity='';}};OpenLayers.Layer.Vector.prototype.setOpacity=function(opacity){if(opacity!=this.opacity){this.opacity=opacity;var element=this.renderer.root;OpenLayers.Util.modifyDOMElement(element,null,null,null,null,null,null,opacity);if(this.map!=null){this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"});}}};OpenLayers.Feature.Vector.prototype.clone=function(){var clone=new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style);clone.renderIntent=this.renderIntent;return clone;};OpenLayers.Control.SelectFeature.prototype.highlight=function(feature){var layer=feature.layer;var cont=this.events.triggerEvent("beforefeaturehighlighted",{feature:feature});if(cont!==false){feature._prevHighlighter=feature._lastHighlighter;feature._lastHighlighter=this.id;if(feature.style&&!this.selectStyle&&layer.styleMap){var styleMap=layer.styleMap;var selectStyle=styleMap.styles['select'];if(selectStyle){var defaultStyle=styleMap.styles['default'].clone();this.selectStyle=OpenLayers.Util.extend(defaultStyle.defaultStyle,selectStyle.defaultStyle);}}
var style=this.selectStyle||this.renderIntent;layer.drawFeature(feature,style);this.events.triggerEvent("featurehighlighted",{feature:feature});}};OpenLayers.Control.WMSGetFeatureInfo.prototype.buildWMSOptions=function(url,layers,clickPosition,format){var layerNames=[],styleNames=[];var time;for(var i=0,len=layers.length;i<len;i++){if(layers[i].params.LAYERS!=null){layerNames=layerNames.concat(layers[i].params.LAYERS);styleNames=styleNames.concat(this.getStyleNames(layers[i]));}
if(layers[i].params.TIME!=null){this.vendorParams.time=layers[i].params.TIME;}}
var firstLayer=layers[0];var projection=this.map.getProjection();var layerProj=firstLayer.projection;if(layerProj&&layerProj.equals(this.map.getProjectionObject())){projection=layerProj.getCode();}
var params=OpenLayers.Util.extend({service:"WMS",version:firstLayer.params.VERSION,request:"GetFeatureInfo",exceptions:firstLayer.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,firstLayer.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:format,info_format:firstLayer.params.INFO_FORMAT||this.infoFormat},(parseFloat(firstLayer.params.VERSION)>=1.3)?{crs:projection,i:parseInt(clickPosition.x),j:parseInt(clickPosition.y)}:{srs:projection,x:parseInt(clickPosition.x),y:parseInt(clickPosition.y)});if(layerNames.length!=0){params=OpenLayers.Util.extend({layers:layerNames,query_layers:layerNames,styles:styleNames},params);}
OpenLayers.Util.applyDefaults(params,firstLayer.params.vendorParams);OpenLayers.Util.applyDefaults(params,this.vendorParams);return{url:url,params:OpenLayers.Util.upperCaseObject(params),callback:function(request){this.handleResponse(clickPosition,request,url);},scope:this};};OpenLayers.Control.WMSGetFeatureInfo.prototype.request=function(clickPosition,options){var layers=this.findLayers();if(layers.length==0){this.events.triggerEvent("nogetfeatureinfo");OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait");return;}
options=options||{};if(this.drillDown===false){var wmsOptions=this.buildWMSOptions(this.url,layers,clickPosition,layers[0].params.FORMAT);var request=OpenLayers.Request.GET(wmsOptions);if(options.hover===true){this.hoverRequest=request;}}else{this._requestCount=0;this._numRequests=0;this.features=[];var services={},url;for(var i=0,len=layers.length;i<len;i++){var layer=layers[i];var service,found=false;url=OpenLayers.Util.isArray(layer.url)?layer.url[0]:layer.url;if(url in services){services[url].push(layer);}else{this._numRequests++;services[url]=[layer];}}
var layers;for(var url in services){layers=services[url];if(this.requestPerLayer){for(var l=0,len=layers.length;l<len;l++){var wmsOptions=this.buildWMSOptions(url,[layers[l]],clickPosition,layers[0].params.FORMAT);var req=OpenLayers.Request.GET(wmsOptions);req.layer=layers[l];}
this._numRequests+=layers.length-1;}else{var wmsOptions=this.buildWMSOptions(url,layers,clickPosition,layers[0].params.FORMAT);OpenLayers.Request.GET(wmsOptions);}}}};OpenLayers.Control.WMSGetFeatureInfo.prototype.handleResponse=function(xy,request,url){var doc=request.responseXML;if(!doc||!doc.documentElement){doc=request.responseText;}
var features=this.format.read(doc);if(request.layer&&features){for(var f=0;f<features.length;f++){features[f].layer=request.layer;}}
if(this.drillDown===false){this.triggerGetFeatureInfo(request,xy,features);}else{this._requestCount++;if(this.output==="object"){this._features=(this._features||[]).concat({url:url,features:features});}else{this._features=(this._features||[]).concat(features);}
if(this._requestCount===this._numRequests){this.triggerGetFeatureInfo(request,xy,this._features.concat());delete this._features;delete this._requestCount;delete this._numRequests;}}};OpenLayers.Format.TMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML,{defaultPrefix:"tms",readers:{"tms":{"Services":function(node,obj){obj.services=[];this.readChildNodes(node,obj);},"TileMapService":function(node,obj){if(obj.services){obj.services.push({service:'TMS',version:node.getAttribute("version"),title:node.getAttribute("title"),href:node.getAttribute("href")});}else{this.readChildNodes(node,obj);}},"TileMaps":function(node,obj){obj.tileMaps=[];this.readChildNodes(node,obj);},"TileMap":function(node,obj){if(obj.tileMaps){obj.tileMaps.push({href:node.getAttribute("href"),srs:node.getAttribute("srs"),title:node.getAttribute("title"),profile:node.getAttribute("profile")});}else{obj.version=node.getAttribute("version");obj.tileMapService=node.getAttribute("tilemapservice");this.readChildNodes(node,obj);}},"Title":function(node,obj){obj.title=this.getChildValue(node);},"Abstract":function(node,obj){obj['abstract']=this.getChildValue(node);},"SRS":function(node,obj){obj.srs=this.getChildValue(node);},"BoundingBox":function(node,obj){obj.bbox=new OpenLayers.Bounds(node.getAttribute("minx"),node.getAttribute("miny"),node.getAttribute("maxx"),node.getAttribute("maxy"));},"Origin":function(node,obj){obj.origin=new OpenLayers.LonLat(node.getAttribute("x"),node.getAttribute("y"));},"TileFormat":function(node,obj){obj.tileFormat={width:parseInt(node.getAttribute("width"),10),height:parseInt(node.getAttribute("height"),10),mimeType:node.getAttribute("mime-type"),extension:node.getAttribute("extension")};},"TileSets":function(node,obj){obj.tileSets=[];this.readChildNodes(node,obj);},"TileSet":function(node,obj){obj.tileSets.push({href:node.getAttribute("href"),unitsPerPixel:parseFloat(node.getAttribute("units-per-pixel")),order:parseInt(node.getAttribute("order"),10)});},"TileMapServerError":function(node,obj){obj.error=true;},"Message":function(node,obj){obj.message=this.getChildValue(node);}}},read:function(data){if(typeof data=="string"){data=OpenLayers.Format.XML.prototype.read.apply(this,[data]);}
var raw=data;if(data&&data.nodeType==9){data=data.documentElement;}
var capabilities={};this.readNode(data,capabilities);return capabilities;},CLASS_NAME:"OpenLayers.Format.TMSCapabilities"});OpenLayers.Protocol.CSW.v2_0_2.prototype.read=function(options){options=OpenLayers.Util.extend({},options);OpenLayers.Util.applyDefaults(options,this.options||{});var response=new OpenLayers.Protocol.Response({requestType:"read"});var data=this.format.write(options.params||options);response.priv=OpenLayers.Request.POST({url:options.url,callback:this.createCallback(this.handleRead,response,options),params:options.params,headers:options.headers,data:data});return response;};Ext.override(GeoExt.WMSLegend,{getLegendUrl:function(layerName,layerNames){var rec=this.layerRecord;var url;var styles=rec&&rec.get("styles");var layer=rec.getLayer();layerNames=layerNames||[layer.params.LAYERS].join(",").split(",");var styleNames=layer.params.STYLES&&[layer.params.STYLES].join(",").split(",");var idx=layerNames.indexOf(layerName);var styleName=styleNames&&styleNames[idx];if(styles&&styles.length>0){if(styleName){Ext.each(styles,function(s){url=(s.name==styleName&&s.legend)&&s.legend.href;return!url;});}else if(this.defaultStyleIsFirst===true&&!styleNames&&!layer.params.SLD&&!layer.params.SLD_BODY){url=styles[0].legend&&styles[0].legend.href;}}
if(!url){url=layer.getFullRequestString({REQUEST:"GetLegendGraphic",WIDTH:null,HEIGHT:null,EXCEPTIONS:"application/vnd.ogc.se_xml",LAYER:layerName,LAYERS:null,STYLE:(styleName!=='')?styleName:null,STYLES:null,SRS:null,FORMAT:null,TIME:null});}
var params=Ext.apply({},this.baseParams);if(layer.params._OLSALT){params._OLSALT=layer.params._OLSALT;}
url=Ext.urlAppend(url,Ext.urlEncode(params));if(url.toLowerCase().indexOf("request=getlegendgraphic")!=-1){if(url.toLowerCase().indexOf("format=")==-1){url=Ext.urlAppend(url,"FORMAT=image%2Fgif");}
if(this.useScaleParameter===true){var scale=layer.map.getScale();url=Ext.urlAppend(url,"SCALE="+scale);}}
return url;}});Ext.override(GeoExt.tree.LayerNodeUI,{enforceOneVisible:function(){var attributes=this.node.attributes;var group=attributes.checkedGroup;if(group&&group!=="gx_baselayer"){var layer=this.node.layer;if(attributes.checked){var checkedNodes=this.node.getOwnerTree().getChecked();var checkedCount=0;Ext.each(checkedNodes,function(n){var l=n.layer;if(!n.hidden&&n.attributes.checkedGroup===group){checkedCount++;if(l!=layer&&attributes.checked){l.setVisibility(false);}}});if(checkedCount===0&&attributes.checked==false){layer.setVisibility(true);}}}}});Ext.override(GeoExt.tree.LayerNode,{renderX:function(bulkRender){var layer=this.layer instanceof OpenLayers.Layer&&this.layer;if(!layer){if(!this.layerStore||this.layerStore=="auto"){this.layerStore=GeoExt.MapPanel.guess().layers;}
var i=this.layerStore.findBy(function(o){return o.get("title")==this.layer;},this);if(i!=-1){layer=this.layerStore.getAt(i).getLayer();}}
if(!this.rendered||!layer){var ui=this.getUI();if(layer){this.layer=layer;if(layer.isBaseLayer){this.draggable=false;this.disabled=true;}
this.autoDisable=!(this.autoDisable===false||this.layer.isBaseLayer||this.layer.alwaysInRange);if(!this.text){this.text=layer.name;}
ui.show();this.addVisibilityEventHandlers();}else{ui.hide();}
if(this.layerStore instanceof GeoExt.data.LayerStore){this.addStoreEventHandlers(layer);}}
GeoExt.tree.LayerNode.superclass.render.apply(this,arguments);}});Ext.override(GeoExt.form.SearchAction,{run:function(){var o=this.options;var f=GeoExt.form.toFilter(this.form,o);if(o.clientValidation===false||this.form.isValid()){if(o.abortPrevious&&this.form.prevResponse){o.protocol.abort(this.form.prevResponse);}
this.form.prevResponse=o.protocol.read(Ext.applyIf({filter:f,callback:this.handleResponse,scope:this},o));}else if(o.clientValidation!==false){this.failureType=Ext.form.Action.CLIENT_INVALID;this.form.afterAction(this,false);}}});GeoExt.form.toFilter=function(form,options){var wildcard=options.wildcard;var logicalOp=options.logicalOp;var matchCase=options.matchCase;if(form instanceof Ext.form.FormPanel){form=form.getForm();}
var filters=[],values=form.getValues(false);for(var prop in values){var s=prop.split("__");var value=values[prop],type;if(s.length>1&&(type=GeoExt.form.toFilter.FILTER_MAP[s[1]])!==undefined){prop=s[0];}else{type=OpenLayers.Filter.Comparison.EQUAL_TO;}
if(type===OpenLayers.Filter.Comparison.LIKE){if(wildcard&&(!value||value.length==0)){continue;}
switch(wildcard){case GeoExt.form.ENDS_WITH:value='.*'+value;break;case GeoExt.form.STARTS_WITH:value+='.*';break;case GeoExt.form.CONTAINS:value='.*'+value+'.*';break;default:break;}}
filters.push(new OpenLayers.Filter.Comparison({type:type,value:value,property:prop,matchCase:matchCase}));}
return filters.length==1&&logicalOp!=OpenLayers.Filter.Logical.NOT?filters[0]:new OpenLayers.Filter.Logical({type:logicalOp||OpenLayers.Filter.Logical.AND,filters:filters});};GeoExt.form.toFilter.FILTER_MAP={"eq":OpenLayers.Filter.Comparison.EQUAL_TO,"ne":OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"lt":OpenLayers.Filter.Comparison.LESS_THAN,"le":OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,"gt":OpenLayers.Filter.Comparison.GREATER_THAN,"ge":OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,"like":OpenLayers.Filter.Comparison.LIKE};GeoExt.form.ENDS_WITH=1;GeoExt.form.STARTS_WITH=2;GeoExt.form.CONTAINS=3;Ext.override(GeoExt.PrintMapPanel,{initComponent:function(){if(this.sourceMap instanceof GeoExt.MapPanel){this.sourceMap=this.sourceMap.map;}
if(!this.map){this.map={};}
Ext.applyIf(this.map,{projection:this.sourceMap.getProjection(),maxExtent:this.sourceMap.getMaxExtent(),maxResolution:this.sourceMap.getMaxResolution(),resolutions:this.sourceMap.resolutions?this.sourceMap.resolutions.slice(0):this.map.resolutions,units:this.sourceMap.getUnits()});if(!(this.printProvider instanceof GeoExt.data.PrintProvider)){this.printProvider=new GeoExt.data.PrintProvider(this.printProvider);}
this.printPage=new GeoExt.data.PrintPage({printProvider:this.printProvider});this.previewScales=new Ext.data.Store();this.previewScales.add(this.printProvider.scales.getRange());this.layers=[];var layer,clonedLayer;Ext.each(this.sourceMap.layers,function(layer){if(layer.getVisibility()===true){if(layer.protocol){layer.protocol.autoDestroy=false;}
clonedLayer=layer.clone();if(layer.styleMap&&layer.styleMap.styles){clonedLayer.styleMap=new OpenLayers.StyleMap(layer.styleMap.styles);}
this.layers.push(clonedLayer);}},this);this.extent=this.sourceMap.getExtent();GeoExt.PrintMapPanel.superclass.initComponent.call(this);}});Ext.namespace("GeoExt.data");GeoExt.data.PrintProvider=Ext.extend(Ext.util.Observable,{url:null,capabilities:null,method:"POST",encoding:document.charset||document.characterSet||"UTF-8",timeout:30000,customParams:null,scales:null,dpis:null,outputFormats:null,outputFormatsEnabled:false,layouts:null,dpi:null,layout:null,outputFormat:null,defaultOutputFormatName:'pdf',constructor:function(config){this.initialConfig=config;Ext.apply(this,config);if(!this.customParams){this.customParams={};}
this.addEvents("loadcapabilities","layoutchange","dpichange","outputformatchange","beforeprint","print","printexception","beforeencodelayer","encodelayer","beforedownload","beforeencodelegend");GeoExt.data.PrintProvider.superclass.constructor.apply(this,arguments);this.scales=new Ext.data.JsonStore({root:"scales",sortInfo:{field:"value",direction:"DESC"},fields:["name",{name:"value",type:"float"}]});this.dpis=new Ext.data.JsonStore({root:"dpis",fields:["name",{name:"value",type:"float"}]});if(this.outputFormatsEnabled===true){this.outputFormats=new Ext.data.JsonStore({root:"outputFormats",sortInfo:{field:"name",direction:"ASC"},fields:["name"]});}
this.layouts=new Ext.data.JsonStore({root:"layouts",fields:["name",{name:"size",mapping:"map"},{name:"rotation",type:"boolean"}]});if(config.capabilities){this.loadStores();}else{if(this.url.split("/").pop()){this.url+="/";}
this.initialConfig.autoLoad&&this.loadCapabilities();}},setLayout:function(layout){this.layout=layout;this.fireEvent("layoutchange",this,layout);},setDpi:function(dpi){this.dpi=dpi;this.fireEvent("dpichange",this,dpi);},setOutputFormat:function(outputFormat){this.outputFormat=outputFormat;this.fireEvent("outputformatchange",this,outputFormat);},print:function(map,pages,options){if(map instanceof GeoExt.MapPanel){map=map.map;}
pages=pages instanceof Array?pages:[pages];options=options||{};if(this.fireEvent("beforeprint",this,map,pages,options)===false){return;}
var jsonData=Ext.apply({units:map.getUnits(),srs:map.baseLayer.projection.getCode(),layout:this.layout.get("name"),dpi:this.dpi.get("value"),outputFormat:this.outputFormat?this.outputFormat.get("name"):this.defaultOutputFormatName},this.customParams);var pagesLayer=pages[0].feature.layer;var encodedLayers=[];var layers=map.layers.concat();layers.remove(map.baseLayer);layers.unshift(map.baseLayer);Ext.each(layers,function(layer){if(layer!==pagesLayer&&layer.getVisibility()===true){var enc=this.encodeLayer(layer);enc&&encodedLayers.push(enc);}},this);jsonData.layers=encodedLayers;var encodedPages=[];Ext.each(pages,function(page){encodedPages.push(Ext.apply({center:[page.center.lon,page.center.lat],scale:page.scale.get("value"),rotation:page.rotation},page.customParams));},this);jsonData.pages=encodedPages;if(options.overview){var encodedOverviewLayers=[];Ext.each(options.overview.layers,function(layer){var enc=this.encodeLayer(layer);enc&&encodedOverviewLayers.push(enc);},this);jsonData.overviewLayers=encodedOverviewLayers;}
if(options.legend&&!(this.fireEvent("beforeencodelegend",this,jsonData,options.legend)===false)){var legend=options.legend;var rendered=legend.rendered;if(!rendered){legend=legend.cloneConfig({renderTo:document.body,hidden:true});}
var encodedLegends=[];legend.items&&legend.items.each(function(cmp){if(!cmp.hidden){var encFn=this.encoders.legends[cmp.getXType()];encodedLegends=encodedLegends.concat(encFn.call(this,cmp,jsonData.pages[0].scale));}},this);if(!rendered){legend.destroy();}
jsonData.legends=encodedLegends;}
if(this.method==="GET"){var url=Ext.urlAppend(this.capabilities.printURL,"spec="+encodeURIComponent(Ext.encode(jsonData)));this.download(url);}else{Ext.Ajax.request({url:this.capabilities.createURL,timeout:this.timeout,jsonData:jsonData,headers:{"Content-Type":"application/json; charset="+this.encoding},success:function(response){var url=Ext.decode(response.responseText).getURL;this.download(url);},failure:function(response){this.fireEvent("printexception",this,response);},params:this.initialConfig.baseParams,scope:this});}},download:function(url){if(this.fireEvent("beforedownload",this,url)!==false){if(Ext.isOpera){window.open(url);}else{window.location.href=url;}}
this.fireEvent("print",this,url);},loadCapabilities:function(){if(!this.url){return;}
var url=this.url+"info.json";Ext.Ajax.request({url:url,method:"GET",disableCaching:false,success:function(response){this.capabilities=Ext.decode(response.responseText);this.loadStores();},params:this.initialConfig.baseParams,scope:this});},loadStores:function(){this.scales.loadData(this.capabilities);this.dpis.loadData(this.capabilities);this.layouts.loadData(this.capabilities);this.setLayout(this.layouts.getAt(0));this.setDpi(this.dpis.getAt(0));if(this.outputFormatsEnabled&&this.capabilities.outputFormats){this.outputFormats.loadData(this.capabilities);var defaultOutputIndex=this.outputFormats.find('name',this.defaultOutputFormatName);this.setOutputFormat(defaultOutputIndex>-1?this.outputFormats.getAt(defaultOutputIndex):this.outputFormats.getAt(0));}
this.fireEvent("loadcapabilities",this,this.capabilities);},encodeLayer:function(layer){var encLayer;for(var c in this.encoders.layers){if(OpenLayers.Layer[c]&&layer instanceof OpenLayers.Layer[c]){if(this.fireEvent("beforeencodelayer",this,layer)===false){return;}
encLayer=this.encoders.layers[c].call(this,layer);this.fireEvent("encodelayer",this,layer,encLayer);break;}}
return(encLayer&&encLayer.type)?encLayer:null;},getAbsoluteUrl:function(url){if(Ext.isSafari){url=url.replace(/{/g,'%7B');url=url.replace(/}/g,'%7D');}
var a;if(Ext.isIE6||Ext.isIE7||Ext.isIE8){a=document.createElement("<a href='"+url+"'/>");a.style.display="none";document.body.appendChild(a);a.href=a.href;document.body.removeChild(a);}else{a=document.createElement("a");a.href=url;}
return a.href;},encoders:{"layers":{"Layer":function(layer){var enc={};if(layer.options&&layer.options.maxScale){enc.minScaleDenominator=layer.options.maxScale;}
if(layer.options&&layer.options.minScale){enc.maxScaleDenominator=layer.options.minScale;}
return enc;},"WMS":function(layer){var enc=this.encoders.layers.HTTPRequest.call(this,layer);enc.singleTile=layer.singleTile;Ext.apply(enc,{type:'WMS',layers:[layer.params.LAYERS].join(",").split(","),format:layer.params.FORMAT,styles:[layer.params.STYLES].join(",").split(","),singleTile:layer.singleTile});var param;for(var p in layer.params){param=p.toLowerCase();if(layer.params[p]!=null&&!layer.DEFAULT_PARAMS[param]&&"layers,styles,width,height,srs".indexOf(param)==-1){if(!enc.customParams){enc.customParams={};}
enc.customParams[p]=layer.params[p];}}
return enc;},"OSM":function(layer){var enc=this.encoders.layers.TileCache.call(this,layer);return Ext.apply(enc,{type:'OSM',baseURL:enc.baseURL.substr(0,enc.baseURL.indexOf("$")),extension:"png"});},"XYZ":function(layer){var enc=this.encoders.layers.TileCache.call(this,layer);return Ext.apply(enc,{type:'XYZ',baseURL:enc.baseURL.substr(0,enc.baseURL.indexOf("$")),extension:enc.baseURL.substr(enc.baseURL.lastIndexOf("$")).split(".").pop(),tileOriginCorner:layer.tileOriginCorner});},"TMS":function(layer){var enc=this.encoders.layers.TileCache.call(this,layer);return Ext.apply(enc,{type:'TMS',format:layer.type});},"TileCache":function(layer){var enc=this.encoders.layers.HTTPRequest.call(this,layer);var maxExtent=layer.maxExtent.toArray();var tileOriginX=layer.tileOrigin?layer.tileOrigin.lon:maxExtent[0];var tileOriginY=layer.tileOrigin?layer.tileOrigin.lat:maxExtent[1];return Ext.apply(enc,{type:'TileCache',layer:layer.layername,maxExtent:maxExtent,tileOrigin:{x:tileOriginX,y:tileOriginY},tileSize:[layer.tileSize.w,layer.tileSize.h],extension:layer.extension,resolutions:layer.serverResolutions||layer.resolutions});},"WMTS":function(layer){var enc=this.encoders.layers.HTTPRequest.call(this,layer);enc=Ext.apply(enc,{type:'WMTS',layer:layer.layer,version:layer.version,requestEncoding:layer.requestEncoding,style:layer.style,dimensions:layer.dimensions,params:layer.params,matrixSet:layer.matrixSet});if(layer.matrixIds){if(layer.requestEncoding=="KVP"){enc.format=layer.format;}
enc.matrixIds=[]
Ext.each(layer.matrixIds,function(matrixId){enc.matrixIds.push({identifier:matrixId.identifier,matrixSize:[matrixId.matrixWidth,matrixId.matrixHeight],resolution:matrixId.scaleDenominator*0.28E-3/OpenLayers.METERS_PER_INCH/OpenLayers.INCHES_PER_UNIT[layer.units],tileSize:[matrixId.tileWidth,matrixId.tileHeight],topLeftCorner:[matrixId.topLeftCorner.lon,matrixId.topLeftCorner.lat]});})
return enc;}
else{return Ext.apply(enc,{formatSuffix:layer.formatSuffix,tileOrigin:[layer.tileOrigin.lon,layer.tileOrigin.lat],tileSize:[layer.tileSize.w,layer.tileSize.h],maxExtent:(layer.tileFullExtent!=null)?layer.tileFullExtent.toArray():layer.maxExtent.toArray(),zoomOffset:layer.zoomOffset,resolutions:layer.serverResolutions||layer.resolutions});}},"KaMapCache":function(layer){var enc=this.encoders.layers.KaMap.call(this,layer);return Ext.apply(enc,{type:'KaMapCache',group:layer.params['g'],metaTileWidth:layer.params['metaTileSize']['w'],metaTileHeight:layer.params['metaTileSize']['h']});},"KaMap":function(layer){var enc=this.encoders.layers.HTTPRequest.call(this,layer);return Ext.apply(enc,{type:'KaMap',map:layer.params['map'],extension:layer.params['i'],group:layer.params['g']||"",maxExtent:layer.maxExtent.toArray(),tileSize:[layer.tileSize.w,layer.tileSize.h],resolutions:layer.serverResolutions||layer.resolutions});},"HTTPRequest":function(layer){var enc=this.encoders.layers.Layer.call(this,layer);return Ext.apply(enc,{baseURL:this.getAbsoluteUrl(layer.url instanceof Array?layer.url[0]:layer.url),opacity:(layer.opacity!=null)?layer.opacity:1.0});},"Image":function(layer){var enc=this.encoders.layers.Layer.call(this,layer);return Ext.apply(enc,{type:'Image',baseURL:this.getAbsoluteUrl(layer.getURL(layer.extent)),opacity:(layer.opacity!=null)?layer.opacity:1.0,extent:layer.extent.toArray(),pixelSize:[layer.size.w,layer.size.h],name:layer.name});},"Vector":function(layer){if(!layer.features.length){return;}
var encFeatures=[];var encStyles={};var features=layer.features;var featureFormat=new OpenLayers.Format.GeoJSON();var styleFormat=new OpenLayers.Format.JSON();var nextId=1;var styleDict={};var feature,style,dictKey,dictItem,styleName;for(var i=0,len=features.length;i<len;++i){feature=features[i];style=feature.style||layer.style||layer.styleMap.createSymbolizer(feature,feature.renderIntent);if(style.display=='none'){continue;}
if(style.strokeDashstyle){if(style.strokeDashstyle=='4 4'){style.strokeDashstyle='dash';}else if(style.strokeDashstyle=='2 4'){style.strokeDashstyle='dot';}}
dictKey=styleFormat.write(style);dictItem=styleDict[dictKey];if(dictItem){styleName=dictItem;}else{styleDict[dictKey]=styleName=nextId++;if(style.externalGraphic){encStyles[styleName]=Ext.applyIf({externalGraphic:this.getAbsoluteUrl(style.externalGraphic)},style);}else{encStyles[styleName]=style;}}
var featureGeoJson=featureFormat.extract.feature.call(featureFormat,feature);featureGeoJson.properties=OpenLayers.Util.extend({_gx_style:styleName},featureGeoJson.properties);encFeatures.push(featureGeoJson);}
var enc=this.encoders.layers.Layer.call(this,layer);return Ext.apply(enc,{type:'Vector',styles:encStyles,styleProperty:'_gx_style',geoJson:{type:"FeatureCollection",features:encFeatures},name:layer.name,opacity:(layer.opacity!=null)?layer.opacity:1.0});},"Markers":function(layer){var features=[];for(var i=0,len=layer.markers.length;i<len;i++){var marker=layer.markers[i];var geometry=new OpenLayers.Geometry.Point(marker.lonlat.lon,marker.lonlat.lat);var style={externalGraphic:marker.icon.url,graphicWidth:marker.icon.size.w,graphicHeight:marker.icon.size.h,graphicXOffset:marker.icon.offset.x,graphicYOffset:marker.icon.offset.y};var feature=new OpenLayers.Feature.Vector(geometry,{},style);features.push(feature);}
var vector=new OpenLayers.Layer.Vector(layer.name);vector.addFeatures(features);var output=this.encoders.layers.Vector.call(this,vector);vector.destroy();return output;}},"legends":{"gx_wmslegend":function(legend,scale){var enc=this.encoders.legends.base.call(this,legend);var icons=[];for(var i=1,len=legend.items.getCount();i<len;++i){var url=legend.items.get(i).url;if(legend.useScaleParameter===true&&url.toLowerCase().indexOf('request=getlegendgraphic')!=-1){var split=url.split("?");var params=Ext.urlDecode(split[1]);params['SCALE']=scale;url=split[0]+"?"+Ext.urlEncode(params);}
icons.push(this.getAbsoluteUrl(url));}
enc[0].classes[0]={name:"",icons:icons};return enc;},"gx_wmtslegend":function(legend,scale){return this.encoders.legends.gx_urllegend.call(this,legend);},"gx_urllegend":function(legend){var enc=this.encoders.legends.base.call(this,legend);enc[0].classes.push({name:"",icon:this.getAbsoluteUrl(legend.items.get(1).url)});return enc;},"base":function(legend){return[{name:legend.getLabel(),classes:[]}];}}}});Ext.namespace("GeoExt.plugins");GeoExt.plugins.PrintProviderField=Ext.extend(Ext.util.Observable,{target:null,constructor:function(config){this.initialConfig=config;Ext.apply(this,config);GeoExt.plugins.PrintProviderField.superclass.constructor.apply(this,arguments);},init:function(target){this.target=target;var onCfg={scope:this,"render":this.onRender,"beforedestroy":this.onBeforeDestroy};onCfg[target instanceof Ext.form.ComboBox?"select":"valid"]=this.onFieldChange;target.on(onCfg);},onRender:function(field){var printProvider=this.printProvider||field.ownerCt.printProvider;if(field.store===printProvider.layouts){field.setValue(printProvider.layout.get(field.displayField));printProvider.on({"layoutchange":this.onProviderChange,scope:this});}else if(field.store===printProvider.dpis){field.setValue(printProvider.dpi.get(field.displayField));printProvider.on({"dpichange":this.onProviderChange,scope:this});}else if(field.store===printProvider.outputFormats){if(printProvider.outputFormat){field.setValue(printProvider.outputFormat.get(field.displayField));printProvider.on({"outputformatchange":this.onProviderChange,scope:this});}else{field.setValue(printProvider.defaultOutputFormatName);field.disable();}}else if(field.initialConfig.value===undefined){field.setValue(printProvider.customParams[field.name]);}},onFieldChange:function(field,record){var printProvider=this.printProvider||field.ownerCt.printProvider;var value=field.getValue();this._updating=true;if(record){switch(field.store){case printProvider.layouts:printProvider.setLayout(record);break;case printProvider.dpis:printProvider.setDpi(record);break;case printProvider.outputFormats:printProvider.setOutputFormat(record);}}else{printProvider.customParams[field.name]=value;}
delete this._updating;},onProviderChange:function(printProvider,rec){if(!this._updating){this.target.setValue(rec.get(this.target.displayField));}},onBeforeDestroy:function(){var target=this.target;target.un("beforedestroy",this.onBeforeDestroy,this);target.un("render",this.onRender,this);target.un("select",this.onFieldChange,this);target.un("valid",this.onFieldChange,this);var printProvider=this.printProvider||target.ownerCt.printProvider;printProvider.un("layoutchange",this.onProviderChange,this);printProvider.un("dpichange",this.onProviderChange,this);printProvider.un("outputformatchange",this.onProviderChange,this);}});Ext.override(GeoExt.VectorLegend,{styleChanged:function(){var layer=this.layer;if(!layer||!layer.features||layer.features.length==0){return;}
var feature=layer.features[0].clone();feature.attributes={};this.feature=feature;this.symbolType=this.symbolTypeFromFeature(this.feature);this.setRules();this.update();},update:function(){if(this.layer&&!this.layer.events.listeners['stylechanged']){this.layer.events.on({stylechanged:this.styleChanged,scope:this});}
GeoExt.VectorLegend.superclass.update.apply(this,arguments);if(this.symbolType&&this.rules){if(this.rulesContainer.items){var comp;for(var i=this.rulesContainer.items.length-1;i>=0;--i){comp=this.rulesContainer.getComponent(i);this.rulesContainer.remove(comp,true);}}
for(var i=0,ii=this.rules.length;i<ii;++i){this.addRuleEntry(this.rules[i],true);}
this.doLayout();if(this.selectedRule){this.getRuleEntry(this.selectedRule).body.addClass("x-grid3-row-selected");}}}});Ext.extend(GeoExt.data.WFSCapabilitiesReader,Ext.data.DataReader,{read:function(request){var data=request.responseXML;if(!data||!data.documentElement){data=request.responseText;}
return this.readRecords(data);},readRecords:function(data){if(typeof data==="string"||data.nodeType){data=this.meta.format.read(data);}
var featureTypes=data.featureTypeList.featureTypes;var fields=this.recordType.prototype.fields;var featureType,values,field,v,parts,layer;var layerOptions,protocolOptions;var url=(parseFloat(data.version)>=1.1)?data.operationsMetadata&&data.operationsMetadata["GetFeature"].dcp.http.post[0].url:data.capability.request.getfeature.href.post;var protocolDefaults={url:url,version:data.version};var records=[];for(var i=0,lenI=featureTypes.length;i<lenI;i++){featureType=featureTypes[i];if(featureType.name){values={};for(var j=0,lenJ=fields.length;j<lenJ;j++){field=fields.items[j];v=featureType[field.mapping||field.name]||field.defaultValue;v=field.convert(v);values[field.name]=v;}
protocolOptions={featureType:featureType.name,featureNS:featureType.featureNS};if(this.meta.protocolOptions){Ext.apply(protocolOptions,this.meta.protocolOptions,protocolDefaults);}else{Ext.apply(protocolOptions,{},protocolDefaults);}
layerOptions={protocol:new OpenLayers.Protocol.WFS(protocolOptions),strategies:[new OpenLayers.Strategy.Fixed()]};if(featureType.bounds){layerOptions.maxExtent=featureType.bounds.clone();values.bounds=featureType.bounds.clone();}
if(featureType.srs){values.srs=featureType.srs;}
var metaLayerOptions=this.meta.layerOptions;if(metaLayerOptions){Ext.apply(layerOptions,Ext.isFunction(metaLayerOptions)?metaLayerOptions():metaLayerOptions);}
values.layer=new OpenLayers.Layer.Vector(featureType.title||featureType.name,layerOptions);records.push(new this.recordType(values,values.layer.id));}}
return{totalRecords:records.length,success:true,records:records};}});(function(){function keepRawWFS(data){var format=this.meta.format;if(typeof data==="string"||data.nodeType){data=format.read(data);var origRead=format.read;format.read=function(){format.read=origRead;return data;};}
this.raw=data;}
Ext.intercept(GeoExt.data.WFSCapabilitiesReader.prototype,"readRecords",keepRawWFS);GeoExt.data.AttributeReader&&Ext.intercept(GeoExt.data.AttributeReader.prototype,"readRecords",keepRawWFS);})();GeoExt.data.CSWRecordsReader=function(meta,recordType){meta=meta||{};if(!meta.format){meta.format=new OpenLayers.Format.CSWGetRecords();}
if(!meta.root){meta.root='records';}
GeoExt.data.CSWRecordsReader.superclass.constructor.call(this,meta,recordType);};Ext.extend(GeoExt.data.CSWRecordsReader,Ext.data.JsonReader,{read:function(data){var o=data.data;if(!o){o=data.responseXML;if(!o||!o.documentElement){o=data.responseText;}}
return this.readRecords(o);},readRecords:function(data){if(typeof data==="string"||data.nodeType){data=this.meta.format.read(data);}
if(data.success===false){throw new Ext.data.DataReader.Error("invalid-response",data);}
var result=GeoExt.data.CSWRecordsReader.superclass.readRecords.call(this,data);Ext.each(result.records,function(record){for(var key in record.data){var value=record.data[key];if(value instanceof Array){for(var i=0,ii=value.length;i<ii;++i){if(value[i]instanceof Object){var size=0;for(var property in value[i]){if(value[i].hasOwnProperty(property)){size++;}}
if(size===1&&value[i].value){value[i]=value[i].value;}}}}}});if(data.SearchResults){result.totalRecords=data.SearchResults.numberOfRecordsMatched;}
return result;}});Ext.namespace("Heron");Heron.singleFile=true;Ext.namespace("Heron");Ext.namespace("Heron.globals");Heron.globals={serviceUrl:'/cgi-bin/heron.cgi',version:'1.0.2',imagePath:undefined};Ext.BLANK_IMAGE_URL='data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==';try{Proj4js.defs["EPSG:28992"]="+proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 +k=0.999908 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +towgs84=565.2369,50.0087,465.658,-0.406857330322398,0.350732676542563,-1.8703473836068,4.0812 +no_defs";Proj4js.defs["EPSG:25831"]="+proj=utm +zone=31 +ellps=GRS80 +units=m +no_defs";}catch(err){}
try{Ext.reg('gxp_viewer',gxp.Viewer);}catch(err){}
Ext.namespace("Heron.App");Heron.App=function(){return{create:function(){Ext.QuickTips.init();if(Heron.app){Heron.App.createApp();}else if(Heron.layout){if(Heron.layout.mapContextUrl){var mgr=Heron.App.contextManager=new Heron.data.HeronMapContext({name:Heron.layout.mapContextUrl,async:true});mgr.on('loaded',Heron.App.onContextLoaded);mgr.on('failure',Heron.App.onContextFailure);mgr.load();return;}
Heron.App.createLayout();}else{alert('need Heron.layout or Heron.app configuration!')}},createApp:function(){console.log('Creating Heron App from xtype = '+Heron.app.xtype);Heron.App.app=Ext.create(Heron.app);},onContextFailure:function(msg){console.log('Error loading context: '+msg);},onContextLoaded:function(context){Heron.App.context=context;Heron.App.createLayout();},createLayout:function(){console.log('Creating Heron App from layout = '+Heron.layout.xtype);if(Heron.layout.renderTo||Heron.layout.xtype=='window'){Heron.App.topComponent=Ext.create(Heron.layout);}else{Heron.App.topComponent=new Ext.Viewport({id:"hr-topComponent",layout:"fit",hideBorders:true,items:[Heron.layout]});}
if(Heron.App.topComponent.isVisible()===false){Heron.App.topComponent.show();}},init:function(){Heron.App.create();},show:function(){if(Heron.App.topComponent&&Heron.App.topComponent.isVisible()===false){Heron.App.topComponent.show();}},getMapContext:function(contextName){return Heron.App.context;},getMap:function(){return Heron.App.map;},setMap:function(aMap){Heron.App.map=aMap;},getMapPanel:function(){return Heron.App.mapPanel;},setMapPanel:function(aMapPanel){Heron.App.mapPanel=aMapPanel;}};}();Ext.namespace("Heron");Ext.onReady(function(){if(typeof console==='undefined'){console={log:function(s){}}}
console.log('Starting Heron v'+Heron.globals.version+' - Proxy URL="'+OpenLayers.ProxyHost+'" - Service URL="'+Heron.globals.serviceUrl+'"');if(!Heron.noAutoLaunch){Heron.App.init();}},Heron.App);Ext.namespace("Heron.Utils");Ext.namespace("Heron.globals");Heron.Utils=(function(){var browserWindows=new Array();var openMsgURL='http://extjs.cachefly.net/ext-3.4.0/resources/images/default/s.gif';var instance={createOLObject:function(argArr){var clazz=eval(argArr[0]);var args=[].slice.call(argArr,1);function F(){}
F.prototype=clazz.prototype;var instance=new F();instance.initialize.apply(instance,args);return instance;},getScriptLocation:function(){if(!Heron.globals.scriptLoc){Heron.globals.scriptLoc='';var scriptName=(!Heron.singleFile)?"lib/DynLoader.js":"script/Heron.js";var r=new RegExp("(^|(.*?\\/))("+scriptName+")(\\?|$)"),scripts=document.getElementsByTagName('script'),src="";for(var i=0,len=scripts.length;i<len;i++){src=scripts[i].getAttribute('src');if(src){var m=src.match(r);if(m){Heron.globals.scriptLoc=m[1];break;}}}}
return Heron.globals.scriptLoc;},getImagesLocation:function(){return Heron.globals.imagePath||(Heron.Utils.getScriptLocation()+"resources/images/");},getImageLocation:function(image){return Heron.Utils.getImagesLocation()+image;},rand:function(min,max){return Math.floor(Math.random()*((max-min)+1)+min);},randArrayElm:function(arr){return arr[Heron.Utils.rand(0,arr.length-1)];},formatXml:function(xml,htmlEscape){var reg=/(>)(<)(\/*)/g;var wsexp=/ *(.*) +\n/g;var contexp=/(<.+>)(.+\n)/g;xml=xml.replace(reg,'$1\n$2$3').replace(wsexp,'$1\n').replace(contexp,'$1\n$2');var pad=0;var formatted='';var lines=xml.split('\n');var indent=0;var lastType='other';var transitions={'single->single':0,'single->closing':-1,'single->opening':0,'single->other':0,'closing->single':0,'closing->closing':-1,'closing->opening':0,'closing->other':0,'opening->single':1,'opening->closing':0,'opening->opening':1,'opening->other':1,'other->single':0,'other->closing':-1,'other->opening':0,'other->other':0};for(var i=0;i<lines.length;i++){var ln=lines[i];var single=Boolean(ln.match(/<.+\/>/));var closing=Boolean(ln.match(/<\/.+>/));var opening=Boolean(ln.match(/<[^!].*>/));var type=single?'single':closing?'closing':opening?'opening':'other';var fromTo=lastType+'->'+type;lastType=type;var padding='';indent+=transitions[fromTo];for(var j=0;j<indent;j++){padding+='    ';}
if(htmlEscape){ln=ln.replace('<','&lt;');ln=ln.replace('>','&gt;');}
formatted+=padding+ln+'\n';}
return formatted;},openBrowserWindow:function(winName,bReopen,theURL,hasMenubar,hasToolbar,hasAddressbar,hasStatusbar,hasScrollbars,isResizable,hasPos,xPos,yPos,hasSize,wSize,hSize){var x,y;var options="";var pwin=null;if(hasMenubar){options+="menubar=yes";}else{options+="menubar=no";}
if(hasToolbar){options+=",toolbar=yes";}else{options+=",toolbar=no";}
if(hasAddressbar){options+=",location=yes";}else{options+=",location=no";}
if(hasStatusbar){options+=",status=yes";}else{options+=",status=no";}
if(hasScrollbars){options+=",scrollbars=yes";}else{options+=",scrollbars=no";}
if(isResizable){options+=",resizable=yes";}else{options+=",resizable=no";}
if(!hasSize){wSize=640;hSize=480;}
options+=",width="+wSize+",innerWidth="+wSize;options+=",height="+hSize+",innerHeight="+hSize;if(!hasPos){xPos=(screen.width-700)/2;yPos=75;}
options+=",left="+xPos+",top="+yPos;if(bReopen){browserWindows[winName]=window.open(theURL,winName,options);}else{if(!browserWindows[winName]||browserWindows[winName].closed){browserWindows[winName]=window.open(theURL,winName,options);}else{browserWindows[winName].location.href=theURL;}}
browserWindows[winName].focus();}};return(instance);})();Ext.ns('Ext.ux.form');Ext.ux.form.Spacer=Ext.extend(Ext.BoxComponent,{height:12,autoEl:'div'});Ext.reg('spacer',Ext.ux.form.Spacer);Ext.namespace("Heron.data");Heron.data.OpenLS_XLSReader=function(meta,recordType){meta=meta||{};Ext.applyIf(meta,{idProperty:meta.idProperty||meta.idPath||meta.id,successProperty:meta.successProperty||meta.success});Heron.data.OpenLS_XLSReader.superclass.constructor.call(this,meta,recordType||meta.fields);};Ext.extend(Heron.data.OpenLS_XLSReader,Ext.data.XmlReader,{addOptXlsText:function(format,text,node,tagname,sep){var elms=format.getElementsByTagNameNS(node,"http://www.opengis.net/xls",tagname);if(elms){Ext.each(elms,function(elm,index){var str=format.getChildValue(elm);if(str){text=text+sep+str;}});}
return text;},readRecords:function(doc){this.xmlData=doc;var root=doc.documentElement||doc;var records=this.extractData(root);return{success:true,records:records,totalRecords:records.length};},extractData:function(root){var opts={namespaces:{gml:"http://www.opengis.net/gml",xls:"http://www.opengis.net/xls"}};var records=[];var format=new OpenLayers.Format.XML(opts);var addresses=format.getElementsByTagNameNS(root,"http://www.opengis.net/xls",'GeocodedAddress');var recordType=Ext.data.Record.create([{name:"lon",type:"number"},{name:"lat",type:"number"},"text"]);var reader=this;Ext.each(addresses,function(address,index){var pos=format.getElementsByTagNameNS(address,"http://www.opengis.net/gml",'pos');var xy='';if(pos&&pos[0]){xy=format.getChildValue(pos[0]);}
var xyArr=xy.split(' ');var text='';text=reader.addOptXlsText(format,text,address,'Street','');text=reader.addOptXlsText(format,text,address,'Place',',');var values={lon:parseFloat(xyArr[0]),lat:parseFloat(xyArr[1]),text:text};var record=new recordType(values,index);records.push(record);});return records;}});Ext.namespace("Heron.data");Heron.data.DataExporter={formatStore:function(store,config){var formatter=new Ext.ux.Exporter[config.formatter]();var data=formatter.format(store,config);if(config.encoding&&config.encoding=='base64'){data=Base64.encode(data);}
return data;},download:function(data,config){try{Ext.destroy(Ext.get('hr_uploadForm'));}
catch(e){}
var formFields=[{tag:'input',type:'hidden',name:'data',value:data},{tag:'input',type:'hidden',name:'filename',value:config.fileName},{tag:'input',type:'hidden',name:'mime',value:config.mimeType}];if(config.format){var format=config.format instanceof OpenLayers.Format?config.format.CLASS_NAME.split("."):config.format.split(".");format=format.length==4?format[2]:format.pop();formFields.push({tag:'input',type:'hidden',name:'source_format',value:format});}
if(config.encoding){formFields.push({tag:'input',type:'hidden',name:'encoding',value:config.encoding});}
if(config.targetFormat){formFields.push({tag:'input',type:'hidden',name:'target_format',value:config.targetFormat});}
if(config.assignSrs){formFields.push({tag:'input',type:'hidden',name:'assign_srs',value:config.assignSrs});formFields.push({tag:'input',type:'hidden',name:'source_srs',value:config.assignSrs});}
if(config.sourceSrs){formFields.push({tag:'input',type:'hidden',name:'source_srs',value:config.sourceSrs});}
if(config.targetSrs){formFields.push({tag:'input',type:'hidden',name:'target_srs',value:config.targetSrs});}
var form=Ext.DomHelper.append(document.body,{tag:'form',id:'hr_uploadForm',method:'post',action:Heron.globals.serviceUrl,children:formFields});document.body.appendChild(form);form.submit();},directDownload:function(url){try{Ext.destroy(Ext.get('hr_directdownload'));}
catch(e){}
var iframe=Ext.DomHelper.append(document.body,{tag:'iframe',id:'hr_directdownload',name:'hr_directdownload',width:'0px',height:'0px',border:'0px',style:'width: 0; height: 0; border: none;',src:url});document.body.appendChild(iframe);}};Ext.namespace("Heron.data");Heron.data.MapContext={prefix:"heron:",xmlns:'xmlns:heron="http://heron-mc.org/context"',oldNodes:null,initComponent:function(){Heron.data.MapContext.superclass.initComponent.call(this);},saveContext:function(mapPanel,options){var self=this;var data=self.writeContext(mapPanel);data=this.formatXml(data);data=Base64.encode(data);try{Ext.destroy(Ext.get('hr_downloadForm'));}
catch(e){}
var formFields=[{tag:'input',type:'hidden',name:'data',value:data},{tag:'input',type:'hidden',name:'filename',value:options.fileName+options.fileExt},{tag:'input',type:'hidden',name:'mime',value:'text/xml'},{tag:'input',type:'hidden',name:'encoding',value:'base64'},{tag:'input',type:'hidden',name:'action',value:'download'}];var form=Ext.DomHelper.append(document.body,{tag:'form',id:'hr_downloadForm',method:'post',action:Heron.globals.serviceUrl,children:formFields});document.body.appendChild(form);form.submit();},openContext:function(mapPanel,options){var self=this;var data=null;try{Ext.destroy(Ext.get('hr_uploadForm'));}
catch(e){}
var uploadForm=new Ext.form.FormPanel({id:'hr_uploadForm',fileUpload:true,width:300,autoHeight:true,bodyStyle:'padding: 10px 10px 10px 10px;',labelWidth:5,defaults:{anchor:'95%',allowBlank:false,msgTarget:'side'},items:[{xtype:'field',id:'mapfile',name:'file',inputType:'file'}],buttons:[{text:__('Upload'),handler:function(){if(uploadForm.getForm().isValid()){var fileField=uploadForm.getForm().findField('mapfile');var selectedFile=fileField.getValue();if(!selectedFile){Ext.Msg.alert(__('Warning'),__('No file specified.'));return;}
uploadForm.getForm().submit({url:Heron.globals.serviceUrl,mime:'text/html',params:{action:'upload',mime:'text/html',encoding:'base64'},waitMsg:__('Uploading file...'),success:function(form,action){data=Base64.decode(action.response.responseText);self.loadContext(mapPanel,data);uploadWindow.close();},failure:function(form,action){data=Base64.decode(action.response.responseText);self.loadContext(mapPanel,data);uploadWindow.close();}});}}},{text:__('Cancel'),handler:function(){uploadWindow.close();}}]});var uploadWindow=new Ext.Window({id:'hr_uploadWindow',title:'Upload',closable:true,width:400,height:120,plain:true,layout:'fit',items:uploadForm,listeners:{show:function(){var form=this.items.get(0);form.getForm().load();}}});uploadWindow.show();},writeContext:function(mapPanel){var map=mapPanel.getMap();var format=new OpenLayers.Format.WMC();var data=format.write(map);var objMap={units:map.units,xy_precision:map.xy_precision,projection:map.projection,zoom:map.zoom,resolutions:map.resolutions,resolution:map.resolution,maxExtent:{bottom:map.maxExtent.bottom,left:map.maxExtent.left,right:map.maxExtent.right,top:map.maxExtent.top}};var jsonMap=(Ext.encode(objMap));jsonMap=this.formatJson(jsonMap);var mapOptions="<Extension><"+this.prefix+"mapOptions "+this.xmlns+">\n"+
jsonMap+"</"+this.prefix+"mapOptions></Extension>";data=data.replace("</LayerList>","</LayerList>"+mapOptions);var treePanel=Heron.App.topComponent.findByType('hr_layertreepanel')[0];if(treePanel&&treePanel.jsonTreeConfig!=null){var jsonTree=treePanel.jsonTreeConfig;var tree="<Extension><"+this.prefix+"treeConfig "+this.xmlns+">"+
jsonTree+"</"+this.prefix+"treeConfig></Extension>";data=data.replace("</LayerList>","</LayerList>"+tree);}
var arrTmsLayers=new Array();arrTmsLayers=map.getLayersBy("id",/OpenLayers.Layer.TMS/);var jsonTmsLayers='';for(var i=0;i<arrTmsLayers.length;i++){var tmsLayer=arrTmsLayers[i];var objTmsOptions={layername:tmsLayer.layername,type:tmsLayer.type,isBaseLayer:tmsLayer.isBaseLayer,transparent:tmsLayer.transparent,bgcolor:tmsLayer.bgcolor,visibility:tmsLayer.visibility,singleTile:tmsLayer.singleTile,alpha:tmsLayer.alpha,opacity:tmsLayer.opacity,minResolution:tmsLayer.minResolution,maxResolution:tmsLayer.maxResolution,resolutions:tmsLayer.resolutions,projection:tmsLayer.projection.projCode,units:tmsLayer.units,transitionEffect:tmsLayer.transitionEffect}
var objTms={name:tmsLayer.name,url:tmsLayer.url,options:objTmsOptions};var jsonTms=(Ext.encode(objTms));if(jsonTmsLayers=='')
jsonTmsLayers+=jsonTms
else
jsonTmsLayers=jsonTmsLayers+','+jsonTms;}
if(jsonTmsLayers!=''){jsonTmsLayers=this.formatJson(jsonTmsLayers);var tms="<Extension><"+this.prefix+"tmsLayers "+this.xmlns+">\n["+
jsonTmsLayers+"]\n</"+this.prefix+"tmsLayers></Extension>";data=data.replace("</LayerList>","</LayerList>"+tms);}
var arrImgLayers=new Array();arrImgLayers=map.getLayersBy("id",/OpenLayers.Layer.Image/);var jsonImgLayers='';for(i=0;i<arrImgLayers.length;i++){var imgLayer=arrImgLayers[i];var objImgOptions={layername:imgLayer.layername,type:imgLayer.type,isBaseLayer:imgLayer.isBaseLayer,transparent:imgLayer.transparent,bgcolor:imgLayer.bgcolor,visibility:imgLayer.visibility,alpha:imgLayer.alpha,opacity:imgLayer.opacity,minResolution:imgLayer.minResolution,maxResolution:imgLayer.maxResolution,resolutions:imgLayer.resolutions,projection:imgLayer.projection.projCode,units:imgLayer.units,transitionEffect:imgLayer.transitionEffect,size:imgLayer.size,extent:imgLayer.extent}
var objImg={name:imgLayer.name,url:imgLayer.url,options:objImgOptions};var jsonImg=(Ext.encode(objImg));if(jsonImgLayers=='')
jsonImgLayers+=jsonImg
else
jsonImgLayers=jsonImgLayers+','+jsonImg;}
if(jsonImgLayers!=''){jsonImgLayers=this.formatJson(jsonImgLayers);var img="<Extension><"+this.prefix+"imageLayers "+this.xmlns+">\n["+
jsonImgLayers+"]\n</"+this.prefix+"imageLayers></Extension>";data=data.replace("</LayerList>","</LayerList>"+img);}
return data;},loadContext:function(mapPanel,data){var map=mapPanel.getMap();var format=new OpenLayers.Format.WMC();var num;var objLayer;var newLayer;var isBaseLayerInFile=false;var oldNodes=new Array();var treePanel=Heron.App.topComponent.findByType('hr_layertreepanel')[0];if(treePanel){var treeRoot=treePanel.getRootNode();}
var strTagStart="<"+this.prefix+'treeConfig '+this.xmlns+">"
var strTagEnd="</"+this.prefix+'treeConfig'+">"
var posStart=data.indexOf(strTagStart);var posEnd=data.indexOf(strTagEnd);var newTreeConfig=null;if(posStart>0){posStart=data.indexOf(strTagStart)+strTagStart.length;newTreeConfig=data.substring(posStart,posEnd);}
strTagStart="<"+this.prefix+'mapOptions '+this.xmlns+">"
strTagEnd="</"+this.prefix+'mapOptions'+">"
posStart=data.indexOf(strTagStart);posEnd=data.indexOf(strTagEnd);var newMapOptions=null;if(posStart>0){posStart=data.indexOf(strTagStart)+strTagStart.length;newMapOptions=data.substring(posStart,posEnd);}
strTagStart="<"+this.prefix+'tmsLayers '+this.xmlns+">"
strTagEnd="</"+this.prefix+'tmsLayers'+">"
posStart=data.indexOf(strTagStart);posEnd=data.indexOf(strTagEnd);var tmsLayers=null;if(posStart>0){posStart=data.indexOf(strTagStart)+strTagStart.length;tmsLayers=data.substring(posStart,posEnd);}
strTagStart="<"+this.prefix+'imageLayers '+this.xmlns+">"
strTagEnd="</"+this.prefix+'imageLayers'+">"
posStart=data.indexOf(strTagStart);posEnd=data.indexOf(strTagEnd);var imgLayers=null;if(posStart>0){posStart=data.indexOf(strTagStart)+strTagStart.length;imgLayers=data.substring(posStart,posEnd);}
try{var testMap=new OpenLayers.Map();testMap=format.read(data,{map:testMap});num=testMap.getNumLayers();var i=0;do{isBaseLayerInFile=testMap.layers[i].isBaseLayer;i++;}while(!isBaseLayerInFile&&i<num)
testMap.destroy();}catch(err){Ext.Msg.alert(__('Warning'),__('Error reading map file, map has not been loaded.'));console.log("Error while testing WMC file: "+err.message);testMap.destroy();return;}
if(treePanel){treePanel.getLoader().doPreload(treeRoot);for(i=0;i<treeRoot.childNodes.length;i++){oldNodes.push(treeRoot.childNodes[i]);treeRoot.childNodes[i].cascade(function(node){oldNodes.push(node);},null,null);}}
num=map.getNumLayers();for(i=num-1;i>=0;i--){var strLayer=null;try{strLayer=map.layers[i].name;map.removeLayer(map.layers[i],false);}catch(err){Ext.Msg.alert(__('Warning'),__('Error on removing layers.'));console.log("Problem with removing layers before loading map: "+err.message);console.log("Layer["+i+"]: "+strLayer);}}
if(treePanel){while(oldNodes.length>0){var oldNode=oldNodes.pop()
if(oldNode){this.removeTreeNode(oldNode);}}}
var mapOptions=Ext.decode(newMapOptions);var maxExtent=mapOptions.maxExtent;var bounds=new OpenLayers.Bounds(maxExtent.left,maxExtent.bottom,maxExtent.right,maxExtent.top);delete mapOptions.maxExtent;map.setOptions(mapOptions);map.setOptions({maxExtent:bounds});map.allOverlays=!isBaseLayerInFile
if(tmsLayers!=null){tmsLayers=Ext.decode(tmsLayers);for(i=0;i<tmsLayers.length;i++){objLayer=tmsLayers[i];newLayer=new OpenLayers.Layer.TMS(objLayer.name,objLayer.url,objLayer.options);if(newLayer.isBaseLayer&&!isBaseLayerInFile){isBaseLayerInFile=true;map.allOverlays=false;}
map.addLayer(newLayer);if(objLayer.options.isBaseLayer&&objLayer.options.visibility){map.setBaseLayer(newLayer);}}}
if(imgLayers!=null){imgLayers=Ext.decode(imgLayers);for(i=0;i<imgLayers.length;i++){objLayer=imgLayers[i];var imgExtent=objLayer.options.extent;delete objLayer.options.extent;var objExtent=new OpenLayers.Bounds(imgExtent.left,imgExtent.bottom,imgExtent.right,imgExtent.top);newLayer=new OpenLayers.Layer.Image(objLayer.name,objLayer.url,objExtent,objLayer.options.size,objLayer.options);if(newLayer.isBaseLayer&&!isBaseLayerInFile){isBaseLayerInFile=true;map.allOverlays=false;}
map.addLayer(newLayer);if(objLayer.options.isBaseLayer&&objLayer.options.visibility){map.setBaseLayer(newLayer);}}}
try{map=format.read(data,{map:map});}catch(err){Ext.Msg.alert(__('Warning'),__('Error loading map file.'));console.log("Error loading map file: "+err.message);}
if(treePanel&&newTreeConfig){treeRoot.attributes.children=Ext.decode(newTreeConfig);try{treePanel.getLoader().load(treeRoot);treePanel.jsonTreeConfig=newTreeConfig;}catch(err){Ext.Msg.alert(__('Warning'),__('Error reading layer tree.'));console.log("Error on loading tree: "+err.message);}}
var epsgTxt=map.getProjection();if(epsgTxt){var epsg=Ext.getCmp("map-panel-epsg");if(epsg){epsg.setText(epsgTxt);}}
num=format.context.layersContext.length;for(i=num-1;i>=0;i--){if((format.context.layersContext[i].isBaseLayer==true)&&(format.context.layersContext[i].visibility==true)){var strActiveBaseLayer=format.context.layersContext[i].title;var newBaseLayer=map.getLayersByName(strActiveBaseLayer)[0];if(newBaseLayer){try{map.setBaseLayer(newBaseLayer);}catch(err){console.log("Error on setting Baselayer: "+err.message);}}}}
map.zoomToExtent(format.context.bounds);},removeTreeNode:function(node){if(node.childNodes&&node.childNodes.length>0){for(var i=0;i<node.childNodes.length;i++){this.removeTreeNode(node.childNodes[i]);}}else{node.remove(true);}},formatXml:function(xml){var formatted='';var reg=/(>)(<)(\/*)/g;xml=xml.replace(reg,'$1\n$2$3');var arrSplit=xml.split('\n');var pad=0;for(var intNode=0;intNode<arrSplit.length;intNode++){var node=arrSplit[intNode];var indent=0;if(node.match(/.+<\/\w[^>]*>$/)){indent=0;}else if(node.match(/^<\/\w/)){if(pad!=0){pad-=1;}}else if(node.match(/^<\w[^>]*[^\/]>.*$/)){indent=1;}else{indent=0;}
var padding='';for(var i=0;i<pad;i++){padding+='    ';}
formatted+=padding+node+'\n';pad+=indent;}
return formatted;},formatJson:function(json){var formatted='';json=json.replace(/({)/g,'$1\n');json=json.replace(/(})({)/g,'$1\n$2');json=json.replace(/(:)({)/g,'$1\n$2');json=json.replace(/(,)/g,'$1\n');json=json.replace(/(})/g,'\n$1');var arrSplit=json.split('\n');var pad=0;for(var intNode=0;intNode<arrSplit.length;intNode++){var node=arrSplit[intNode];var indent=0;if(node.match(/}/)){if(pad!=0){pad-=1;}}else if(node.match(/{/)){indent=1;}else{indent=0;}
var padding='';for(var i=0;i<pad;i++){padding+='    ';}
formatted+=padding+node+'\n';pad+=indent;}
return formatted;}};Ext.namespace("Heron.data");Heron.data.HeronMapContext=Ext.extend(Ext.util.Observable,{name:'default',async:true,showLoadMask:true,baseUrl:'',constructor:function(config){Ext.apply(this,config);this.setName(this.name);this.addEvents("loaded","failure");Heron.data.HeronMapContext.superclass.constructor.apply(this,arguments);},getQueryString:function(key,defaultVal){key=key.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");var regex=new RegExp("[\\?&]"+key+"=([^&#]*)");var qs=regex.exec(window.location.href);if(qs==null){return defaultVal;}
else{return qs[1];}},setName:function(name){if(!name){name='default';}
if(this.getQueryString('config',null)||this.getQueryString('context',null)){name=this.getQueryString('config',null);if(!name){name=this.getQueryString('context',null);}}
this.name=name;this.setUrl(this.name);this.setBaseUrl(this.url);},setBaseUrl:function(url){this.baseUrl=url.slice(0,url.lastIndexOf("/")+1);},setUrl:function(name){var url;if(name.indexOf('http://')==0){url=name;}else{url=this.baseUrl+name;if(name.search(/\.xml/i)<0){url+='.xml';}}
this.url=url;},handleResponse:function(request){var responseXML=null;if(request.status==200){if(request.responseXML){responseXML=request.responseXML;}
else{var parser;try{request.responseType='msxml-document';parser=new DOMParser();responseXML=parser.parseFromString(request.responseText,'text/xml');}catch(e){parser=new DOMParser();responseXML=parser.parseFromString(request.responseText,'text/xml');}}
if(!responseXML){this.errorText='Configuration at ('+this.url+') does not contain XML data';Ext.Msg.alert('Load Context',this.errorText);}}else{this.errorText="Configuration at ("+this.url+") could not be loaded ("+request.status+")";Ext.Msg.alert('Load Context',this.errorText);}
return responseXML;},load:function(config){if(config){Ext.apply(this,config);this.setUrl(this.name);}
console.log('Loading (OL) map configuration '+this.name+' from url: '+this.url);if(this.showLoadMask){var msg=__('Loading map context from:')+'<br> '+this.url;if(!this.loadMask){this.loadMask=new Ext.LoadMask(Ext.getBody(),{msg:msg});}else{this.loadMask.msg=msg;}
this.loadMask.show();}
var self=this;self.request=null;var responseXML;OpenLayers.Request.GET({url:this.url,async:this.async,callback:function(request){self.request=request;if(self.loadMask){self.loadMask.hide();}
responseXML=self.handleResponse(self.request);if(self.async===true){if(!responseXML){self.fireEvent('failure',this.errorText);return;}
self.context=Heron.data.MapContextParser.parse(responseXML,self);self.fireEvent('loaded',self.context);}}});return responseXML;}});Heron.data.MapContextParser={includedLayers:[],context:{map:{settings:{},layers:[]},layerTree:{}},parse:function(xml,loader){this.loader=loader;this.context.map.settings=this.parseMap(xml);this.context.layerTree=this.parseTree(xml);this.context.map.layers=this.context.map.layers.concat(this.parseTMS(xml),this.parseImage(xml),this.parseWMTS(xml),this.parseWMS(xml),this.parseWFS(xml,this.context.map.settings.projection),this.parseAtom(xml),this.includedLayers);return this.context;},blankLayer:function(){var result=[];var blank=new OpenLayers.Layer.Image("Blank","data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",OpenLayers.Bounds.fromString(this.context.map.settings.maxExtent),new OpenLayers.Size(10,10),{resolutions:this.context.map.settings.resolutions,isBaseLayer:true,visibility:true,displayInLayerSwitcher:true});result.push(blank);return result;},parseMap:function(xml){var title=this.getTextContent('contextCollection > title',xml);var baseUrl=this.getTextContent('contextCollection > baseUrl',xml);var projection=this.getTextContent('projection',xml);var units=this.getTextContent('units',xml);var resolutions=this.getNumberArrayContent('resolutions',xml);var maxExtent=this.getTextContent('maxExtent',xml);var center=this.getTextContent('center',xml);var xyPrecision=this.getNumberContent('xyPrecision',xml);var zoom=this.getNumberContent('zoom',xml);var allOverlays=this.getBooleanContent('allOverlays',xml,true);var result={title:title,baseUrl:baseUrl,projection:projection,units:units,resolutions:resolutions,maxExtent:maxExtent,center:center,xy_precision:xyPrecision,zoom:zoom,theme:null,allOverlays:allOverlays};return result;},parseImage:function(xml){var result=[];var nodes=Ext.DomQuery.jsSelect('imageLayer',xml);for(var i=nodes.length-1;i>=0;i--){var title=this.getTextContent('title',nodes[i]);var url=this.getLayerUrlContent('url',nodes[i]);var isBaseLayer=this.getBooleanContent('isBaseLayer',nodes[i]);var isVisible=this.getBooleanContent('isVisible',nodes[i]);var isTransparent=this.getBooleanContent('isTransparent',nodes[i]);var size=this.getNumberArrayContent('size',nodes[i]);var config={isBaseLayer:isBaseLayer,visibility:isVisible,transparent:isTransparent,displayInLayerSwitcher:true};var imageLayer=new OpenLayers.Layer.Image(title,url,OpenLayers.Bounds.fromString(this.context.map.settings.maxExtent),new OpenLayers.Size(size[0],size[1]),config);result.push(imageLayer);}
return result;},parseWMTS:function(xml){var result=[];var nodes=Ext.DomQuery.jsSelect('wmtsLayer',xml);for(var i=nodes.length-1;i>=0;i--){var title=this.getTextContent('title',nodes[i]);var url=this.getLayerUrlContent('url',nodes[i]);var isBaseLayer=this.getBooleanContent('isBaseLayer',nodes[i]);var opacity=this.getNumberContent('opacity',nodes[i]);var isTransparent=this.getBooleanContent('isTransparent',nodes[i]);var isVisible=this.getBooleanContent('isVisible',nodes[i]);var attribution=this.getTextContent('attribution',nodes[i]);var serverResolutions=this.getNumberArrayContent('serverResolutions',nodes[i]);var layer=this.getTextContent('layer',nodes[i]);var style=this.getTextContent('style',nodes[i]);var matrixSet=this.getTextContent('matrixSet',nodes[i]);var matrixIds=this.getTextArrayContent('matrixIds',nodes[i]);var format=this.getTextContent('format',nodes[i]);var config={name:title,url:url,isBaseLayer:isBaseLayer,opacity:opacity,transparent:isTransparent,visibility:isVisible,layer:layer,style:style,matrixSet:matrixSet,matrixIds:matrixIds,attribution:attribution,format:format,serverResolutions:serverResolutions.length>0?serverResolutions:undefined};this.addResolutions(config,nodes[i]);var wmtsLayer=new OpenLayers.Layer.WMTS(config);result.push(wmtsLayer);}
return result;},parseTMS:function(xml){var result=[];var nodes=Ext.DomQuery.jsSelect('tmsLayer',xml);for(var i=nodes.length-1;i>=0;i--){var title=this.getTextContent('title',nodes[i]);var url=this.getLayerUrlContent('url',nodes[i]);var isBaseLayer=this.getBooleanContent('isBaseLayer',nodes[i]);var opacity=this.getNumberContent('opacity',nodes[i]);var isTransparent=this.getBooleanContent('isTransparent',nodes[i]);var isVisible=this.getBooleanContent('isVisible',nodes[i]);var layername=this.getTextContent('layername',nodes[i]);var type=this.getTextContent('type',nodes[i]);var bgColor=this.getTextContent('bgColor',nodes[i]);var isSingleTile=this.getBooleanContent('isSingleTile',nodes[i]);var attribution=this.getTextContent('attribution',nodes[i]);var isAlpha=this.getBooleanContent('isAlpha',nodes[i]);var serverResolutions=this.getNumberArrayContent('serverResolutions',nodes[i]);var config={isBaseLayer:isBaseLayer,opacity:opacity,transparent:isTransparent,visibility:isVisible,layername:layername,type:type,bgcolor:bgColor,singleTile:isSingleTile,attribution:attribution,alpha:isAlpha,serverResolutions:serverResolutions.length>0?serverResolutions:undefined};this.addResolutions(config,nodes[i]);var tmsLayer=new OpenLayers.Layer.TMS(title,url,config);result.push(tmsLayer);}
return result;},parseWMS:function(xml){var result=[];var nodes=Ext.DomQuery.jsSelect('wmsLayer',xml);for(var i=nodes.length-1;i>=0;i--){var title=this.getTextContent('title',nodes[i]);var url=this.getLayerUrlContent('url',nodes[i]);var isBaseLayer=this.getBooleanContent('isBaseLayer',nodes[i]);var opacity=this.getNumberContent('opacity',nodes[i]);var isTransparent=this.getBooleanContent('isTransparent',nodes[i]);var isVisible=this.getBooleanContent('isVisible',nodes[i]);var attribution=this.getTextContent('attribution',nodes[i]);var layers=this.getTextContent('layers',nodes[i]);var format=this.getTextContent('format',nodes[i]);var featureInfoFormat=this.getTextContent('featureInfoFormat',nodes[i]);var isAlpha=this.getBooleanContent('isAlpha',nodes[i]);var isSingleTile=this.getBooleanContent('isSingleTile',nodes[i]);var config={isBaseLayer:isBaseLayer,singleTile:isSingleTile,visibility:isVisible,alpha:isAlpha,opacity:opacity,attribution:attribution,featureInfoFormat:featureInfoFormat};this.addResolutions(config,nodes[i]);var wmsLayer=new OpenLayers.Layer.WMS(title,url,{layers:layers,format:format,transparent:isTransparent},config);result.push(wmsLayer);}
return result;},parseWFS:function(xml,srsName){var result=[];var nodes=Ext.DomQuery.jsSelect('wfsLayer',xml);for(var i=nodes.length-1;i>=0;i--){var title=this.getTextContent('title',nodes[i]);var url=this.getLayerUrlContent('url',nodes[i]);var isVisible=this.getBooleanContent('isVisible',nodes[i]);var attribution=this.getTextContent('attribution',nodes[i]);var wfsVersion=this.getTextContent('wfsVersion',nodes[i]);var wfsFeatureNamespace=this.getTextContent('wfsFeatureNamespace',nodes[i]);var wfsFeaturePrefix=this.getTextContent('wfsFeaturePrefix',nodes[i]);var wfsFeatureType=this.getTextContent('wfsFeatureType',nodes[i]);var wfsMaxFeatures=this.getNumberContent('wfsMaxFeatures',nodes[i]);var wfsGeometryElement=this.getTextContent('wfsGeometryElement',nodes[i]);var wfsOutputFormat=this.getTextContent('wfsOutputFormat',nodes[i]);var styleMap=this.getStyleContent('styleMap',nodes[i]);var readFormat=new OpenLayers.Format.GML.v3({featureType:this.featureType,featureNS:this.featureNS,geometryName:'wfsGeometryElement'});var config={strategies:[new OpenLayers.Strategy.BBOX({ratio:1,resFactor:1})],projection:new OpenLayers.Projection(srsName),styleMap:styleMap,protocol:new OpenLayers.Protocol.WFS({version:wfsVersion,srsName:srsName,url:url,featureNS:wfsFeatureNamespace,featurePrefix:wfsFeaturePrefix,featureType:wfsFeatureType,maxFeatures:wfsMaxFeatures,geometryName:wfsGeometryElement,outputFormat:wfsOutputFormat}),attribution:attribution,visibility:isVisible};this.addResolutions(config,nodes[i]);var wfsLayer=new OpenLayers.Layer.Vector(title,config);result.push(wfsLayer);}
return result;},parseAtom:function(xml){var result=[];var nodes=Ext.DomQuery.jsSelect('atomLayer',xml);var epsg4326=new OpenLayers.Projection("EPSG:4326");for(var i=nodes.length-1;i>=0;i--){var title=this.getTextContent('title',nodes[i]);var url=this.getLayerUrlContent('url',nodes[i]);var isBaseLayer=this.getBooleanContent('isBaseLayer',nodes[i]);var isVisible=this.getBooleanContent('isVisible',nodes[i]);var config={strategies:[new OpenLayers.Strategy.Fixed()],projection:epsg4326,protocol:new OpenLayers.Protocol.HTTP({url:url,format:new OpenLayers.Format.Atom()}),visibility:isVisible};this.addResolutions(config,nodes[i]);var atomLayer=new OpenLayers.Layer.Vector(title,config);result.push(atomLayer);}
return result;},parseTree:function(xml){var result=[];var rootNode=Ext.DomQuery.select('contextCollection',xml)[0];this.parseTreeNode(rootNode,result);return result;},parseTreeNode:function(node,tree){var children=node.childNodes;for(var i=0;i<children.length;i++){var node=children[i];if(node.tagName=='contextFolder'){var isExpanded=this.getBooleanContent('isExpanded',node);var folder={text:this.getTextContent("title",node),expanded:isExpanded,children:[]};tree.push(folder);this.parseTreeNode(node,folder.children);}else if(node.tagName=='context'){var url=Ext.DomQuery.jsSelect('>url',node);if(url.length){url=this.getText(url[0]);var result=this.loader.load({name:url,async:false});if(!result){Ext.Msg.alert('parseTreeNode','Cannot load: '+url);return;}
var rootNode=Ext.DomQuery.select('contextCollection',result)[0];this.includedLayers=this.includedLayers.concat(this.parseImage(result),this.parseTMS(result),this.parseWMTS(result),this.parseWMS(result),this.parseWFS(result,this.context.map.settings.projection),this.parseAtom(result));this.parseTreeNode(rootNode,tree);}
else{var titles=Ext.DomQuery.jsSelect('title',node);var layers=[];for(var j=1;j<titles.length;j++){var layerType=titles[j].parentNode.nodeName;var layer={nodeType:'gx_layer',layer:this.getText(titles[j]),disabled:false};layers.push(layer);}
var isExpanded=this.getBooleanContent('isExpanded',node);var folder={text:this.getTextContent("title",node),expanded:isExpanded,children:layers};tree.push(folder);}}}},getText:function(node){var result;if(window.ActiveXObject){result=node.firstChild.nodeValue;}else{result=node.textContent;}
return result;},getTextContent:function(elementName,node){var result;var child=Ext.DomQuery.selectNode(elementName,node);if(child){result=this.getText(child);}
return result;},getTextArrayContent:function(elementName,node){var result=[];var text=this.getTextContent(elementName,node);if(text){result=text.split(",");}
return result;},getBooleanContent:function(elementName,node,defaultValue){var result=this.getTextContent(elementName,node);if(!result&&defaultValue){result=defaultValue;}
return result==='true';},getLayerUrlContent:function(elementName,node){var result=this.getTextContent(elementName,node);if(result&&result.indexOf("{baseUrl}")>-1){var baseUrl=this.getTextContent("baseUrl",node.parentNode);if(baseUrl){result=result.replace("{baseUrl}",baseUrl);}else if(this.context.map.settings&&this.context.map.settings.baseUrl){result=result.replace("{baseUrl}",this.context.map.settings.baseUrl);}else{Ext.Msg.alert('getLayerUrlContent',"No base URL found for layer "
+this.getTextContent('title',node)+" in context "
+this.getTextContent('title',node.parentNode));}}
return result;},getNumberContent:function(elementName,node){var result;var text=this.getTextContent(elementName,node);if(!isNaN(text)){result=Number(text);}
return result;},getNumberArrayContent:function(elementName,node){var result=[];var text=this.getTextContent(elementName,node);if(text){var array=text.split(",");for(var i=0;i<array.length;i++){result.push(Number(array[i]));}}
return result;},getTextOrNumberContent:function(elementName,root){var result;var text=this.getTextContent(elementName,root);if(isNaN(text)){result=text;}else{result=Number(text);}
return result;},getStyleContent:function(elementName,root){var styleMapOptions={};var node=Ext.DomQuery.selectNode(elementName,root);if(node){var styleNodes=Ext.DomQuery.jsSelect('style',node);for(var i=0;i<styleNodes.length;i++){var styleName=this.getTextContent('name',styleNodes[i]);var propertyNodes=Ext.DomQuery.jsSelect('property',styleNodes[i]);var styleOptions={};for(var j=0;j<propertyNodes.length;j++){var name=this.getTextContent('name',propertyNodes[j]);var value=this.getTextOrNumberContent('value',propertyNodes[j]);styleOptions[name]=value;}
styleMapOptions[styleName]=new OpenLayers.Style(styleOptions);}}
return new OpenLayers.StyleMap(styleMapOptions);},addResolutions:function(properties,node){if(properties['serverResolutions']){return;}
var mapResolutions=this.context.map.settings.resolutions;var minResolution=this.getNumberContent('minResolution',node);if(!minResolution){minResolution=mapResolutions[mapResolutions.length-1];}else{properties['minResolution']=minResolution;}
var maxResolution=this.getNumberContent('maxResolution',node);if(!maxResolution){maxResolution=mapResolutions[0];}else{properties['maxResolution']=maxResolution;}}};Ext.namespace("Heron.data");Heron.data.OWSCapabilitiesCache=Ext.extend(Ext.util.Observable,{defaultOWSVersions:{WMS:'1.1.1',WFS:'1.1.0'},cache:{wms:{},wfs:{}},constructor:function(options){Ext.apply(this,options);this.addEvents("loaded","failure");Heron.data.OWSCapabilitiesCache.superclass.constructor.apply(this,arguments);},getWMSCapabilities:function(url,options){options=options?options:{};options.type='WMS';options.request='GetCapabilities';options.format=new OpenLayers.Format.WMSCapabilities();return this.getCapabilities(url,options.type,options);},getWMSLayerCapability:function(url,layerName,options){var caps=this.getWMSCapabilities(url,options);var layers=caps.capability.layers;var result;for(var i=0;i<layers.length;i++){if(layerName==layers[i].name){result=layers[i];break;}}
return result;},getCapabilities:function(url,type,options){var result=this.getCache(type,url);if(result){return result;}
type=type.toUpperCase();var params={SERVICE:type,REQUEST:options.request?options.request:"GetCapabilities",VERSION:options.version?options.version:this.defaultOWSVersions[type]};var self=this;OpenLayers.Request.GET({async:!!options.async===true,url:url,params:params,success:function(request){var doc=request.responseXML;if(!doc||!doc.documentElement){doc=request.responseText;}
result=self.putCache(type,url,options.format.read(doc));},failure:function(){console.error("Failed to retrieve capabilities from: "+url);}});return result;},getCache:function(type,url){return this.cache[type.toLowerCase()][url.toLowerCase()];},putCache:function(type,url,doc){this.cache[type.toLowerCase()][url.toLowerCase()]=doc;return doc;}});Heron.data.OWSCapabilitiesCache.getInstance=function(){var instance=Heron.data.OWSCapabilitiesCacheInstance;if(!instance){instance=Heron.data.OWSCapabilitiesCacheInstance=new Heron.data.OWSCapabilitiesCache();}
return instance;};var Base64=(function(){var keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function utf8Encode(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}
else if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128);}
else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128);}}
return utftext;}
return{encode:function(input){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;input=utf8Encode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=((chr1&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64;}else if(isNaN(chr3)){enc4=64;}
output=output+
keyStr.charAt(enc1)+keyStr.charAt(enc2)+
keyStr.charAt(enc3)+keyStr.charAt(enc4);}
return output;}};})();Ext.ux.Exporter=function(){return{exportGrid:function(grid,formatter,config){config=config||{};formatter=formatter||new Ext.ux.Exporter.CSVFormatter();Ext.applyIf(config,{title:grid.title});return formatter.format(grid.store,config);},exportStore:function(store,formatter,config){config=config||{};formatter=formatter||new Ext.ux.Exporter.ExcelFormatter();Ext.applyIf(config,{columns:config.store.fields.items});return Base64.encode(formatter.format(store,config));},exportTree:function(tree,formatter,config){config=config||{};formatter=formatter||new Ext.ux.Exporter.ExcelFormatter();var store=tree.store||config.store;Ext.applyIf(config,{title:tree.title});return Base64.encode(formatter.format(store,config));}};}();Ext.ux.Exporter.Button=Ext.extend(Ext.Button,{constructor:function(config){config=config||{};Ext.applyIf(config,{formatter:'CSVFormatter',fileName:'heron_export.csv',mimeType:'text/csv',exportFunction:'exportGrid',disabled:true,text:'Export',cls:'download'});if(config.store==undefined&&config.component!=undefined){Ext.applyIf(config,{store:config.component.store});}else{Ext.applyIf(config,{component:{store:config.store}});}
Ext.ux.Exporter.Button.superclass.constructor.call(this,config);if(this.store&&Ext.isFunction(this.store.on)){var self=this;self.store=this.store;var setLink=function(){var link=this.getEl().child('a',true);var buttonFun=function(){var formatter=new Ext.ux.Exporter[config.formatter]();var data=formatter.format(self.store,config);data=Base64.encode(data);Heron.data.DataExporter.download(data,config.fileName,config.mimeType)};link.href='#';link.onclick=buttonFun;this.enable();}
if(this.el){setLink.call(this);}else{this.on('render',setLink,this);}
this.store.on('load',setLink,this);}},template:new Ext.Template('<table border="0" cellpadding="0" cellspacing="0" class="x-btn-wrap"><tbody><tr>','<td class="x-btn-left"><i> </i></td><td class="x-btn-center"><a class="x-btn-text" href="{1}" target="{2}">{0}</a></td><td class="x-btn-right"><i> </i></td>',"</tr></tbody></table>"),onRender:function(ct,position){var btn,targs=[this.text||' ',this.href,this.target||"_self"];if(position){btn=this.template.insertBefore(position,targs,true);}else{btn=this.template.append(ct,targs,true);}
var btnEl=btn.child("a:first");this.btnEl=btnEl;btnEl.on('focus',this.onFocus,this);btnEl.on('blur',this.onBlur,this);this.initButtonEl(btn,btnEl);Ext.ButtonToggleMgr.register(this);},onClick:function(e){if(e.button!=0)return;if(!this.disabled){this.fireEvent("click",this,e);if(this.handler)this.handler.call(this.scope||this,this,e);}}});Ext.reg('exportbutton',Ext.ux.Exporter.Button);Ext.ux.Exporter.Formatter=function(config){config=config||{};Ext.applyIf(config,{});};Ext.ux.Exporter.Formatter.prototype={format:Ext.emptyFn};Ext.ux.Exporter.OpenLayersFormatter=Ext.extend(Ext.ux.Exporter.Formatter,{format:function(store,config){var formatter=config.format;if(typeof formatter=='string'){formatter=eval('new '+formatter+'()');}
if(config.fileProjection){formatter.internalProjection=config.mapProjection;formatter.externalProjection=config.fileProjection;}
formatter.srsName=formatter.externalProjection?formatter.externalProjection.getCode():config.assignSrs;var features=store.layer?store.layer.features:null;if(!features){features=[];store.each(function(record){features.push(record.getFeature());});}
return formatter.write(features);}});Ext.ux.Exporter.ExcelFormatter=Ext.extend(Ext.ux.Exporter.Formatter,{format:function(store,config){var workbook=new Ext.ux.Exporter.ExcelFormatter.Workbook(config);workbook.addWorksheet(store,config||{});return workbook.render();}});Ext.ux.Exporter.CSVFormatter=Ext.extend(Ext.ux.Exporter.Formatter,{extend:"Ext.ux.exporter.Formatter",contentType:'data:text/csv;base64,',separator:";",extension:"csv",format:function(store,config){this.columns=config.columns||(store.fields?store.fields.items:store.model.prototype.fields.items);return this.getHeaders(store)+"\n"+this.getRows(store);},getHeaders:function(store){var columns=[];Ext.each(this.columns,function(col){var title;if(col.text!=undefined){title=col.text;}else if(col.name){title=col.name.replace(/_/g," ");}
columns.push(title);},this);return columns.join(this.separator);},getRows:function(store){var rows=[];store.each(function(record,index){rows.push(this.getCell(record,index));},this);return rows.join("\n");},getCell:function(record,index){var cells=[];Ext.each(this.columns,function(col){var name=col.name||col.dataIndex;if(name){if(Ext.isFunction(col.renderer)){var value=col.renderer(record.get(name),null,record);}else{var value=record.get(name);}
cells.push(value);}});return cells.join(this.separator);}});Ext.ux.Exporter.ExcelFormatter.Workbook=Ext.extend(Object,{constructor:function(config){config=config||{};Ext.apply(this,config,{title:"Workbook",worksheets:[],compiledWorksheets:[],cellBorderColor:"#e4e4e4",styles:[],compiledStyles:[],hasDefaultStyle:true,hasStripeStyles:true,windowHeight:9000,windowWidth:50000,protectStructure:false,protectWindows:false});if(this.hasDefaultStyle)this.addDefaultStyle();if(this.hasStripeStyles)this.addStripedStyles();this.addTitleStyle();this.addHeaderStyle();},render:function(){this.compileStyles();this.joinedCompiledStyles=this.compiledStyles.join("");this.compileWorksheets();this.joinedWorksheets=this.compiledWorksheets.join("");return this.tpl.apply(this);},addWorksheet:function(store,config){var worksheet=new Ext.ux.Exporter.ExcelFormatter.Worksheet(store,config);this.worksheets.push(worksheet);return worksheet;},addStyle:function(config){var style=new Ext.ux.Exporter.ExcelFormatter.Style(config||{});this.styles.push(style);return style;},compileStyles:function(){this.compiledStyles=[];Ext.each(this.styles,function(style){this.compiledStyles.push(style.render());},this);return this.compiledStyles;},compileWorksheets:function(){this.compiledWorksheets=[];Ext.each(this.worksheets,function(worksheet){this.compiledWorksheets.push(worksheet.render());},this);return this.compiledWorksheets;},tpl:new Ext.XTemplate('<?xml version="1.0" encoding="utf-8"?>','<ss:Workbook xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns:o="urn:schemas-microsoft-com:office:office">','<o:DocumentProperties>','<o:Title>{title}</o:Title>','</o:DocumentProperties>','<ss:ExcelWorkbook>','<ss:WindowHeight>{windowHeight}</ss:WindowHeight>','<ss:WindowWidth>{windowWidth}</ss:WindowWidth>','<ss:ProtectStructure>{protectStructure}</ss:ProtectStructure>','<ss:ProtectWindows>{protectWindows}</ss:ProtectWindows>','</ss:ExcelWorkbook>','<ss:Styles>','{joinedCompiledStyles}','</ss:Styles>','{joinedWorksheets}','</ss:Workbook>'),addDefaultStyle:function(){var borderProperties=[{name:"Color",value:this.cellBorderColor},{name:"Weight",value:"1"},{name:"LineStyle",value:"Continuous"}];this.addStyle({id:'Default',attributes:[{name:"Alignment",properties:[{name:"Vertical",value:"Top"},{name:"WrapText",value:"1"}]},{name:"Font",properties:[{name:"FontName",value:"arial"},{name:"Size",value:"10"}]},{name:"Interior"},{name:"NumberFormat"},{name:"Protection"},{name:"Borders",children:[{name:"Border",properties:[{name:"Position",value:"Top"}].concat(borderProperties)},{name:"Border",properties:[{name:"Position",value:"Bottom"}].concat(borderProperties)},{name:"Border",properties:[{name:"Position",value:"Left"}].concat(borderProperties)},{name:"Border",properties:[{name:"Position",value:"Right"}].concat(borderProperties)}]}]});},addTitleStyle:function(){this.addStyle({id:"title",attributes:[{name:"Borders"},{name:"Font"},{name:"NumberFormat",properties:[{name:"Format",value:"@"}]},{name:"Alignment",properties:[{name:"WrapText",value:"1"},{name:"Horizontal",value:"Center"},{name:"Vertical",value:"Center"}]}]});},addHeaderStyle:function(){this.addStyle({id:"headercell",attributes:[{name:"Font",properties:[{name:"Bold",value:"1"},{name:"Size",value:"10"}]},{name:"Interior",properties:[{name:"Pattern",value:"Solid"},{name:"Color",value:"#A3C9F1"}]},{name:"Alignment",properties:[{name:"WrapText",value:"1"},{name:"Horizontal",value:"Center"}]}]});},addStripedStyles:function(){this.addStyle({id:"even",attributes:[{name:"Interior",properties:[{name:"Pattern",value:"Solid"},{name:"Color",value:"#CCFFFF"}]}]});this.addStyle({id:"odd",attributes:[{name:"Interior",properties:[{name:"Pattern",value:"Solid"},{name:"Color",value:"#CCCCFF"}]}]});Ext.each(['even','odd'],function(parentStyle){this.addChildNumberFormatStyle(parentStyle,parentStyle+'date',"[ENG][$-409]dd\-mmm\-yyyy;@");this.addChildNumberFormatStyle(parentStyle,parentStyle+'int',"0");this.addChildNumberFormatStyle(parentStyle,parentStyle+'float',"0.00");},this);},addChildNumberFormatStyle:function(parentStyle,id,value){this.addStyle({id:id,parentStyle:"even",attributes:[{name:"NumberFormat",properties:[{name:"Format",value:value}]}]});}});Ext.ux.Exporter.ExcelFormatter.Worksheet=Ext.extend(Object,{constructor:function(store,config){config=config||{};this.store=store;Ext.applyIf(config,{hasTitle:true,hasHeadings:true,stripeRows:true,title:"Workbook",columns:store.fields==undefined?{}:store.fields.items});Ext.apply(this,config);Ext.ux.Exporter.ExcelFormatter.Worksheet.superclass.constructor.apply(this,arguments);},dateFormatString:"Y-m-d",worksheetTpl:new Ext.XTemplate('<ss:Worksheet ss:Name="{title}">','<ss:Names>','<ss:NamedRange ss:Name="Print_Titles" ss:RefersTo="=\'{title}\'!R1:R2" />','</ss:Names>','<ss:Table x:FullRows="1" x:FullColumns="1" ss:ExpandedColumnCount="{colCount}" ss:ExpandedRowCount="{rowCount}">','{columns}','<ss:Row ss:Height="38">','<ss:Cell ss:StyleID="title" ss:MergeAcross="{colCount - 1}">','<ss:Data xmlns:html="http://www.w3.org/TR/REC-html40" ss:Type="String">','<html:B><html:U><html:Font html:Size="15">{title}','</html:Font></html:U></html:B></ss:Data><ss:NamedCell ss:Name="Print_Titles" />','</ss:Cell>','</ss:Row>','<ss:Row ss:AutoFitHeight="1">','{header}','</ss:Row>','{rows}','</ss:Table>','<x:WorksheetOptions>','<x:PageSetup>','<x:Layout x:CenterHorizontal="1" x:Orientation="Landscape" />','<x:Footer x:Data="Page &amp;P of &amp;N" x:Margin="0.5" />','<x:PageMargins x:Top="0.5" x:Right="0.5" x:Left="0.5" x:Bottom="0.8" />','</x:PageSetup>','<x:FitToPage />','<x:Print>','<x:PrintErrors>Blank</x:PrintErrors>','<x:FitWidth>1</x:FitWidth>','<x:FitHeight>32767</x:FitHeight>','<x:ValidPrinterInfo />','<x:VerticalResolution>600</x:VerticalResolution>','</x:Print>','<x:Selected />','<x:DoNotDisplayGridlines />','<x:ProtectObjects>False</x:ProtectObjects>','<x:ProtectScenarios>False</x:ProtectScenarios>','</x:WorksheetOptions>','</ss:Worksheet>'),render:function(store){return this.worksheetTpl.apply({header:this.buildHeader(),columns:this.buildColumns().join(""),rows:this.buildRows().join(""),colCount:this.columns.length,rowCount:this.store.getCount()+2,title:this.title});},buildColumns:function(){var cols=[];Ext.each(this.columns,function(column){cols.push(this.buildColumn());},this);return cols;},buildColumn:function(width){return String.format('<ss:Column ss:AutoFitWidth="1" ss:Width="{0}" />',width||164);},buildRows:function(){var rows=[];this.store.each(function(record,index){rows.push(this.buildRow(record,index));},this);return rows;},buildHeader:function(){var cells=[];Ext.each(this.columns,function(col){var title;if(col.header!=undefined){title=col.header;}else{title=col.name.replace(/_/g," ");}
cells.push(String.format('<ss:Cell ss:StyleID="headercell"><ss:Data ss:Type="String">{0}</ss:Data><ss:NamedCell ss:Name="Print_Titles" /></ss:Cell>',title));},this);return cells.join("");},buildRow:function(record,index){var style,cells=[];if(this.stripeRows===true)style=index%2==0?'even':'odd';Ext.each(this.columns,function(col){var name=col.name||col.dataIndex;if(Ext.isFunction(col.renderer)){var value=col.renderer(record.get(name),null,record),type="String";}else{var value=record.get(name),type=this.typeMappings[col.type||record.fields.item(name).type];}
cells.push(this.buildCell(value,type,style).render());},this);return String.format("<ss:Row>{0}</ss:Row>",cells.join(""));},buildCell:function(value,type,style){if(type=="DateTime"&&Ext.isFunction(value.format))value=value.format(this.dateFormatString);return new Ext.ux.Exporter.ExcelFormatter.Cell({value:value,type:type,style:style});},typeMappings:{'int':"Number",'string':"String",'float':"Number",'date':"DateTime"}});Ext.ux.Exporter.ExcelFormatter.Cell=Ext.extend(Object,{constructor:function(config){Ext.applyIf(config,{type:"String"});Ext.apply(this,config);Ext.ux.Exporter.ExcelFormatter.Cell.superclass.constructor.apply(this,arguments);},render:function(){return this.tpl.apply(this);},tpl:new Ext.XTemplate('<ss:Cell ss:StyleID="{style}">','<ss:Data ss:Type="{type}"><![CDATA[{value}]]></ss:Data>','</ss:Cell>')});Ext.ux.Exporter.ExcelFormatter.Style=Ext.extend(Object,{constructor:function(config){config=config||{};Ext.apply(this,config,{parentStyle:'',attributes:[]});Ext.ux.Exporter.ExcelFormatter.Style.superclass.constructor.apply(this,arguments);if(this.id==undefined)throw new Error("An ID must be provided to Style");this.preparePropertyStrings();},preparePropertyStrings:function(){Ext.each(this.attributes,function(attr,index){this.attributes[index].propertiesString=this.buildPropertyString(attr);this.attributes[index].children=attr.children||[];Ext.each(attr.children,function(child,childIndex){this.attributes[index].children[childIndex].propertiesString=this.buildPropertyString(child);},this);},this);},buildPropertyString:function(attribute){var propertiesString="";Ext.each(attribute.properties||[],function(property){propertiesString+=String.format('ss:{0}="{1}" ',property.name,property.value);},this);return propertiesString;},render:function(){return this.tpl.apply(this);},tpl:new Ext.XTemplate('<tpl if="parentStyle.length == 0">','<ss:Style ss:ID="{id}">','</tpl>','<tpl if="parentStyle.length != 0">','<ss:Style ss:ID="{id}" ss:Parent="{parentStyle}">','</tpl>','<tpl for="attributes">','<tpl if="children.length == 0">','<ss:{name} {propertiesString} />','</tpl>','<tpl if="children.length > 0">','<ss:{name} {propertiesString}>','<tpl for="children">','<ss:{name} {propertiesString} />','</tpl>','</ss:{name}>','</tpl>','</tpl>','</ss:Style>')});var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var output="";var chr1,chr2,chr3,enc1,enc2,enc3,enc4;var i=0;input=Base64._utf8_encode(input);while(i<input.length){chr1=input.charCodeAt(i++);chr2=input.charCodeAt(i++);chr3=input.charCodeAt(i++);enc1=chr1>>2;enc2=((chr1&3)<<4)|(chr2>>4);enc3=((chr2&15)<<2)|(chr3>>6);enc4=chr3&63;if(isNaN(chr2)){enc3=enc4=64;}else if(isNaN(chr3)){enc4=64;}
output=output+
this._keyStr.charAt(enc1)+this._keyStr.charAt(enc2)+
this._keyStr.charAt(enc3)+this._keyStr.charAt(enc4);}
return output;},decode:function(input){var output="";var chr1,chr2,chr3;var enc1,enc2,enc3,enc4;var i=0;input=input.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(i<input.length){enc1=this._keyStr.indexOf(input.charAt(i++));enc2=this._keyStr.indexOf(input.charAt(i++));enc3=this._keyStr.indexOf(input.charAt(i++));enc4=this._keyStr.indexOf(input.charAt(i++));chr1=(enc1<<2)|(enc2>>4);chr2=((enc2&15)<<4)|(enc3>>2);chr3=((enc3&3)<<6)|enc4;output=output+String.fromCharCode(chr1);if(enc3!=64){output=output+String.fromCharCode(chr2);}
if(enc4!=64){output=output+String.fromCharCode(chr3);}}
output=Base64._utf8_decode(output);return output;},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c);}
else if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128);}
else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128);}}
return utftext;},_utf8_decode:function(utftext){var string="";var i=0;var c=c1=c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++;}
else if((c>191)&&(c<224)){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode(((c&31)<<6)|(c2&63));i+=2;}
else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));i+=3;}}
return string;}}
Ext.grid.RowExpander=function(config){Ext.apply(this,config);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});Ext.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=='string'){this.tpl=new Ext.Template(this.tpl);}
this.tpl.compile();}
this.state={};this.bodyContent={};};Ext.extend(Ext.grid.RowExpander,Ext.util.Observable,{header:"",width:20,sortable:false,fixed:true,menuDisabled:true,dataIndex:'',id:'expander',lazyRender:true,enableCaching:true,getRowClass:function(record,rowIndex,p,ds){p.cols=p.cols-1;var content=this.bodyContent[record.id];if(!content&&!this.lazyRender){content=this.getBodyContent(record,rowIndex);}
if(content){p.body=content;}
return this.state[record.id]?'x-grid3-row-expanded':'x-grid3-row-collapsed';},init:function(grid){this.grid=grid;var view=grid.getView();view.getRowClass=this.getRowClass.createDelegate(this);view.enableRowBody=true;grid.on('render',function(){view.mainBody.on('mousedown',this.onMouseDown,this);},this);},getBodyContent:function(record,index){if(!this.enableCaching){return this.tpl.apply(record.data);}
var content=this.bodyContent[record.id];if(!content){content=this.tpl.apply(record.data);this.bodyContent[record.id]=content;}
return content;},onMouseDown:function(e,t){if(t.className=='x-grid3-row-expander'){e.stopEvent();var row=e.getTarget('.x-grid3-row');this.toggleRow(row);}},renderer:function(v,p,record){p.cellAttr='rowspan="2"';return'<div class="x-grid3-row-expander">&#160;</div>';},beforeExpand:function(record,body,rowIndex){if(this.fireEvent('beforeexpand',this,record,body,rowIndex)!==false){if(this.tpl&&this.lazyRender){body.innerHTML=this.getBodyContent(record,rowIndex);}
return true;}else{return false;}},toggleRow:function(row){if(typeof row=='number'){row=this.grid.view.getRow(row);}
this[Ext.fly(row).hasClass('x-grid3-row-collapsed')?'expandRow':'collapseRow'](row);},expandRow:function(row){if(typeof row=='number'){row=this.grid.view.getRow(row);}
var record=this.grid.store.getAt(row.rowIndex);var body=Ext.DomQuery.selectNode('tr:nth(2) div.x-grid3-row-body',row);if(this.beforeExpand(record,body,row.rowIndex)){this.state[record.id]=true;Ext.fly(row).replaceClass('x-grid3-row-collapsed','x-grid3-row-expanded');this.fireEvent('expand',this,record,body,row.rowIndex);}},collapseRow:function(row){if(typeof row=='number'){row=this.grid.view.getRow(row);}
var record=this.grid.store.getAt(row.rowIndex);var body=Ext.fly(row).child('tr:nth(1) div.x-grid3-row-body',true);if(this.fireEvent('beforecollapse',this,record,body,row.rowIndex)!==false){this.state[record.id]=false;Ext.fly(row).replaceClass('x-grid3-row-expanded','x-grid3-row-collapsed');this.fireEvent('collapse',this,record,body,row.rowIndex);}}});Ext.namespace("Heron.widgets.LayerNodeMenuItem");Heron.widgets.LayerNodeMenuItem=Ext.extend(Ext.menu.Item,{isApplicable:function(node){return true;}});Heron.widgets.LayerNodeMenuItem.Style=Ext.extend(Heron.widgets.LayerNodeMenuItem,{text:__('Edit Layer Style'),iconCls:"icon-palette",disabled:false,listeners:{'activate':function(menuItem,event){var node=menuItem.ownerCt.contextNode;if(!node||!node.layer){}},scope:this},initComponent:function(){Heron.widgets.LayerNodeMenuItem.Style.superclass.initComponent.call(this);},handler:function(menuItem,event){var node=menuItem.ownerCt.contextNode;if(!node||!node.layer){return;}
if(node.layer.CLASS_NAME!='OpenLayers.Layer.Vector'){Ext.Msg.alert(__('Warning'),__('Sorry, Layer style editing is only available for Vector Layers'));return;}
if(!gxp.VectorStylesDialog){Ext.Msg.alert(__('Warning'),__('Vector Layer style editing requires GXP with VectorStylesDialog'));return;}
var layerRecord=Heron.App.getMapPanel().layers.getByLayer(node.layer);new Ext.Window({layout:'auto',resizable:false,autoHeight:true,pageX:100,pageY:200,width:400,closeAction:'hide',title:__('Style Editor (Vector)'),items:[gxp.VectorStylesDialog.createVectorStylerConfig(layerRecord)]}).show();},isApplicable:function(node){return node.layer.CLASS_NAME=='OpenLayers.Layer.Vector';}});Ext.reg('hr_layernodemenustyle',Heron.widgets.LayerNodeMenuItem.Style);Heron.widgets.LayerNodeMenuItem.ZoomExtent=Ext.extend(Heron.widgets.LayerNodeMenuItem,{text:__('Zoom to Layer Extent'),iconCls:"icon-zoom-visible",initComponent:function(){Heron.widgets.LayerNodeMenuItem.ZoomExtent.superclass.initComponent.call(this);},handler:function(menuItem,event){var node=menuItem.ownerCt.contextNode;if(!node||!node.layer){return;}
var layer=node.layer;var zoomExtent;if(this.hasMaxExtent){zoomExtent=layer.maxExtent;}else{zoomExtent=layer.getDataExtent();}
if(!zoomExtent){Ext.Msg.alert(__('Warning'),__('Sorry, no data-extent is available for this Layer'));return;}
layer.map.zoomToExtent(zoomExtent);},isApplicable:function(node){this.hasMaxExtent=node.layer.maxExtent&&!node.layer.maxExtent.equals(node.layer.map.maxExtent);return node.layer.getDataExtent()||this.hasMaxExtent;}});Ext.reg('hr_layernodemenuzoomextent',Heron.widgets.LayerNodeMenuItem.ZoomExtent);Heron.widgets.LayerNodeMenuItem.LayerInfo=Ext.extend(Heron.widgets.LayerNodeMenuItem,{text:__('Get Layer information'),iconCls:"icon-information",initComponent:function(){Heron.widgets.LayerNodeMenuItem.LayerInfo.superclass.initComponent.call(this);},handler:function(menuItem,event){var node=menuItem.ownerCt.contextNode;if(!node||!node.layer){return;}
var layer=node.layer;var layerType=layer.CLASS_NAME.split(".").pop();var isVector=layerType=='Vector';var isWFS=layer.protocol&&layer.protocol.CLASS_NAME.indexOf('WFS')>0;layerType=isWFS?'Vector (WFS)':layerType;var tiled=layer.singleTile||isVector?'No':'Yes';var hasWFS=layer.metadata.wfs||isWFS?'Yes':'No';var hasFeatureInfo=isVector||layer.featureInfoFormat?'Yes':'No';Ext.MessageBox.show({title:String.format('Info for Layer "{0}"',layer.name),msg:String.format('Placeholder: should become more extensive with infos, metadata, etc.!<br>'+"<br>Name: {0}"+"<br>Type: {1}"+"<br>Tiled: {2}"+"<br>Has feature info: {3}"+"<br>Has WFS: {4}",layer.name,layerType,tiled,hasFeatureInfo,hasWFS),buttons:Ext.Msg.OK,fn:function(btn){if(btn=='ok'){}},icon:Ext.MessageBox.INFO,maxWidth:300});}});Ext.reg('hr_layernodemenulayerinfo',Heron.widgets.LayerNodeMenuItem.LayerInfo);Heron.widgets.LayerNodeMenuItem.OpacitySlider=Ext.extend(Heron.widgets.LayerNodeMenuItem,{text:__('Change Layer opacity'),iconCls:'icon-opacity',initComponent:function(){Heron.widgets.LayerNodeMenuItem.OpacitySlider.superclass.initComponent.call(this);},handler:function(menuItem,event){var node=menuItem.ownerCt.contextNode;if(!node||!node.layer){return;}
var layer=node.layer;var cmp=Ext.getCmp('WinOpacity-'+layer.id);var xy=event.getXY();xy[0]=xy[0]+40;xy[1]=xy[1]+0;if(!cmp){cmp=new Ext.Window({title:__('Opacity'),id:'WinOpacity-'+layer.id,x:xy[0],y:xy[1],width:200,resizable:false,constrain:true,bodyStyle:'padding:2px 4px',closeAction:'hide',listeners:{hide:function(){cmp.x=xy[0];cmp.y=xy[1];},show:function(){cmp.show();cmp.focus();}},items:[{xtype:'label',text:layer.name,height:20},{xtype:"gx_opacityslider",showTitle:false,plugins:new GeoExt.LayerOpacitySliderTip(),vertical:false,inverse:false,aggressive:false,layer:layer}]});cmp.show();}else{if(cmp.isVisible()){cmp.hide();}else{cmp.setPosition(xy[0],xy[1]);cmp.show();cmp.focus();}}}});Ext.reg('hr_layernodemenuopacityslider',Heron.widgets.LayerNodeMenuItem.OpacitySlider);Ext.namespace("Heron.widgets");Heron.widgets.LayerNodeContextMenu=Ext.extend(Ext.menu.Menu,{listeners:{beforeshow:function(cm){var node=cm.contextNode;cm.items.each(function(item){item.setDisabled(!item.isApplicable(node));})},scope:this},initComponent:function(){this.initialConfig=this.items?this.items:[{xtype:'hr_layernodemenulayerinfo'},{xtype:'hr_layernodemenuzoomextent'},{xtype:'hr_layernodemenuopacityslider'},{xtype:'hr_layernodemenustyle'}];this.items=undefined;Heron.widgets.LayerNodeContextMenu.superclass.initComponent.call(this);}});Ext.reg('hr_layernodecontextmenu',Heron.widgets.LayerNodeContextMenu);Ext.namespace("Heron.widgets");Heron.widgets.GridCellRenderer=(function(){var instance={substituteAttrValues:function(template,options,record){if(!options.attrNames){options.attrNames=new Array();var inAttrName=false;var attrName='';for(var i=0;i<template.length;i++){var s=template.charAt(i);if(s=='{'){inAttrName=true;attrName='';}else if(s=='}'){options.attrNames.push(attrName)
inAttrName=false;}else if(inAttrName){attrName+=s;}}}
var result=template;for(var j=0;j<options.attrNames.length;j++){var name=options.attrNames[j];var value=record.data[name];if(!value){value='';}
var valueTemplate='{'+name+'}';result=result.replace(valueTemplate,value);}
return result;},directLink:function(value,metaData,record,rowIndex,colIndex,store){if(!this.options){return value;}
var options=this.options;var url=options.url;if(!url){return value;}
url=Heron.widgets.GridCellRenderer.substituteAttrValues(url,options,record);var result='<a href="'+url+'" target="{target}">'+value+'</a>';var target=options.target?options.target:'_new';var targetTemplate='{target}';return result.replace(targetTemplate,target);},browserPopupLink:function(value,metaData,record,rowIndex,colIndex,store){if(!this.options){return value;}
var options=this.options;var templateURL=options.url;if(!templateURL){return value;}
var BrowserParam='\''+(options.winName?options.winName:'herongridcellpopup')+'\''
+', '+(options.bReopen?options.bReopen:false)
+', \''+(Heron.widgets.GridCellRenderer.substituteAttrValues(templateURL,options,record))+'\''
+', '+(options.hasMenubar?options.hasMenubar:false)
+', '+(options.hasToolbar?options.hasToolbar:false)
+', '+(options.hasAddressbar?options.hasAddressbar:false)
+', '+(options.hasStatusbar?options.hasStatusbar:false)
+', '+(options.hasScrollbars?options.hasScrollbars:false)
+', '+(options.isResizable?options.isResizable:false)
+', '+(options.hasPos?options.hasPos:false)
+', '+(options.xPos?options.xPos:0)
+', '+(options.yPos?options.yPos:0)
+', '+(options.hasSize?options.hasSize:false)
+', '+(options.wSize?options.wSize:200)
+', '+(options.hSize?options.hSize:100);return(options.attrPreTxt?options.attrPreTxt:"")+'<a href="#" onclick="'+'Heron.Utils.openBrowserWindow('+BrowserParam+'); return false">'+value+'</a>';},valueSubstitutor:function(value,metaData,record,rowIndex,colIndex,store){if(!this.options){return value;}
var options=this.options;var template=options.template;if(!template){return value;}
return Heron.widgets.GridCellRenderer.substituteAttrValues(template,options,record);}};return(instance);})();Ext.namespace("Heron.widgets");var ActiveLayerNodeUI=Ext.extend(GeoExt.tree.LayerNodeUI,new GeoExt.tree.TreeNodeUIEventMixin());Heron.widgets.ActiveLayerNode=Ext.extend(GeoExt.tree.LayerNode,{render:function(bulkRender){var layer=this.layer instanceof OpenLayers.Layer&&this.layer;if(layer&&this.attributes&&this.attributes.component&&this.attributes.component.xtype=="gx_opacityslider"){this.attributes.component.layer=layer;if(layer.opacity>=1.0){layer.setOpacity(1.0);}
else if(layer.opacity<0.0){layer.setOpacity(0.0);}
this.attributes.component.value=parseInt(layer.opacity*100);}
Heron.widgets.ActiveLayerNode.superclass.renderX.call(this,bulkRender);if(layer&&this.attributes&&this.attributes.component&&this.attributes.component.xtype=="gx_opacityslider"){if(layer.opacity>=1.0){layer.setOpacity(0.999);layer.setOpacity(1.0);}
else if(layer.opacity>=0.001){layer.setOpacity(layer.opacity-0.001);layer.setOpacity(layer.opacity+0.001);}else{layer.setOpacity(0.001);layer.setOpacity(0.0);}
this.attributes.component.value=parseInt(layer.opacity*100);}}});Ext.tree.TreePanel.nodeTypes.hr_activelayer=Heron.widgets.ActiveLayerNode;Heron.widgets.ActiveLayersPanel=Ext.extend(Ext.tree.TreePanel,{title:__('Active Layers'),contextMenu:null,applyStandardNodeOpts:function(opts,layer){if(opts.component){opts.component.layer=layer;}
opts.layerId=layer.id;},initComponent:function(){var self=this;var options={title:this.title,autoScroll:true,enableDD:true,plugins:[{ptype:"gx_treenodecomponent"}],root:{nodeType:"gx_layercontainer",text:__('Layers'),loader:{applyLoader:false,baseAttrs:{uiProvider:ActiveLayerNodeUI,iconCls:'gx-activelayer-drag-icon'},createNode:function(attr){return self.createNode(self,{layer:attr.layer});},filter:function(record){var layer=record.getLayer();return layer.getVisibility()&&layer.displayInLayerSwitcher;}}},rootVisible:false,lines:false,listeners:{contextmenu:function(node,e){node.select();var cm=this.contextMenu;if(cm){cm.contextNode=node;cm.showAt(e.getXY());}},scope:this}};if(this.contextMenu){var cmArgs=this.contextMenu instanceof Array?{items:this.contextMenu}:{};this.contextMenu=new Heron.widgets.LayerNodeContextMenu(cmArgs);}
Ext.apply(this,options);Heron.widgets.ActiveLayersPanel.superclass.initComponent.call(this);this.addListener("afterrender",this.onAfterRender);this.addListener("beforedblclick",this.onBeforeDblClick);this.addListener("beforenodedrop",this.onBeforeNodeDrop);},createNode:function(self,attr){if(self.hropts){Ext.apply(attr,self.hropts);}else{Ext.apply(attr,{});}
self.applyStandardNodeOpts(attr,attr.layer);attr.uiProvider=ActiveLayerNodeUI;attr.nodeType="hr_activelayer";attr.iconCls='gx-activelayer-drag-icon';return GeoExt.tree.LayerLoader.prototype.createNode.call(self,attr);},onBeforeDblClick:function(node,evt){return false;},onBeforeNodeDrop:function(dropEvt){if(dropEvt){switch(dropEvt.point){case"above":return true;break;case"below":var layer=dropEvt.target.layer;if(!layer.isBaseLayer){return true;}
break;}}
return false;},onAfterRender:function(){var self=this;var map=Heron.App.getMap();map.events.register('changelayer',null,function(evt){var layer=evt.layer;var rootNode=self.getRootNode();var layerNode=rootNode.findChild('layerId',evt.layer.id);if(evt.property==="visibility"){if(evt.layer.getVisibility()&&!layerNode){var newNode=self.createNode(self,{layer:layer});var newLayerId=layer.map.getLayerIndex(layer);if(layer.isBaseLayer){var bottomLayer;var bottomLayerId;if(rootNode.lastChild){bottomLayer=rootNode.lastChild.layer;if(bottomLayer){bottomLayerId=bottomLayer.map.getLayerIndex(bottomLayer);}}
rootNode.appendChild(newNode);if(bottomLayer){if(newLayerId>bottomLayerId){layer.map.raiseLayer(layer,bottomLayerId-newLayerId);}}}else{var topLayer;var topLayerId;if(rootNode.firstChild){topLayer=rootNode.firstChild.layer;if(topLayer){topLayerId=topLayer.map.getLayerIndex(topLayer);}}
rootNode.insertBefore(newNode,rootNode.firstChild);if(topLayer){if(topLayerId>newLayerId){layer.map.raiseLayer(layer,topLayerId-newLayerId);}}}
rootNode.reload();}else if(!evt.layer.getVisibility()&&layerNode){layerNode.un("move",self.onChildMove,self);layerNode.remove();}}});},onListenerDoLayout:function(node){if(node&&node.hropts&&node.hropts.component&&node.hropts.component.xtype=="gx_opacityslider"){var rootNode=node.getRootNode();rootNode.cascade(function(n){if(n.layer){n.component.setValue(parseInt(n.layer.opacity*100));n.component.syncThumb();}});rootNode.reload();node.doLayout();}},listeners:{activate:function(node){this.onListenerDoLayout(this);},expand:function(node){this.onListenerDoLayout(this);}}});Ext.reg('hr_activelayerspanel',Heron.widgets.ActiveLayersPanel);Ext.namespace("Heron.widgets");var ActiveThemeNodeUI=Ext.extend(GeoExt.tree.LayerNodeUI,new GeoExt.tree.TreeNodeUIEventMixin());Heron.widgets.ActiveThemeNode=Ext.extend(GeoExt.tree.LayerNode,{render:function(bulkRender){var layer=this.layer instanceof OpenLayers.Layer&&this.layer;Heron.widgets.ActiveThemeNode.superclass.renderX.call(this,bulkRender);}});Ext.tree.TreePanel.nodeTypes.hr_activetheme=Heron.widgets.ActiveThemeNode;Heron.widgets.ActiveThemesPanel=Ext.extend(Ext.tree.TreePanel,{title:__('Active Themes'),qtip_up:__('Move up'),qtip_down:__('Move down'),qtip_opacity:__('Opacity'),qtip_remove:__('Remove layer from list'),qtip_tools:__('Tools'),contextMenu:null,applyStandardNodeOpts:function(opts,layer){if(opts.component){opts.component.layer=layer;}
opts.layerId=layer.id;},initComponent:function(){var self=this;var options={title:this.title,autoScroll:true,enableDD:true,plugins:[{ptype:"gx_treenodeactions",listeners:{action:this.onAction}}],root:{nodeType:"gx_layercontainer",loader:{applyLoader:false,baseAttrs:{radioGroup:"radiogroup",uiProvider:ActiveThemeNodeUI},createNode:function(attr){return self.createNode(self,{layer:attr.layer});},filter:function(record){var layer=record.getLayer();return layer.getVisibility()&&layer.displayInLayerSwitcher;}}},rootVisible:false,lines:false,listeners:{contextmenu:function(node,e){node.select();var cm=this.contextMenu;if(cm){cm.contextNode=node;cm.showAt(e.getXY());}},scope:this}};if(this.contextMenu){var cmArgs=this.contextMenu instanceof Array?{items:this.contextMenu}:{};this.contextMenu=new Heron.widgets.LayerNodeContextMenu(cmArgs);}
Ext.apply(this,options);Heron.widgets.ActiveThemesPanel.superclass.initComponent.call(this);this.addListener("afterrender",this.onAfterRender);this.addListener("beforedblclick",this.onBeforeDblClick);this.addListener("beforenodedrop",this.onBeforeNodeDrop);},createNode:function(self,attr){if(self.hropts){Ext.apply(attr,self.hropts);}else{Ext.apply(attr,{showOpacity:false,showTools:false,showRemove:false});}
self.applyStandardNodeOpts(attr,attr.layer);attr.uiProvider=ActiveThemeNodeUI;attr.nodeType="hr_activetheme";attr.iconCls='gx-activethemes-drag-icon';attr.actions=[{action:"up",qtip:this.qtip_up,update:function(el){var layer=this.layer,map=layer.map;if(map.getLayerIndex(layer)==map.layers.length-1){el.addClass('disabled');}else{el.removeClass('disabled');}}},{action:"down",qtip:this.qtip_down,update:function(el){var layer=this.layer,map=layer.map;if(map.getLayerIndex(layer)==1){el.addClass('disabled');}else{el.removeClass('disabled');}}},{action:"opacity",qtip:this.qtip_opacity,update:function(el){var layer=this.layer,map=layer.map;}},{action:"tools",qtip:this.qtip_tools,update:function(el){var layer=this.layer,map=layer.map;}},{action:"remove",qtip:this.qtip_remove}];attr.actionsNum=attr.actions.length-1;if(!self.hropts.showRemove){attr.actions.remove(attr.actions[attr.actionsNum]);}
attr.actionsNum=attr.actionsNum-1;if(!self.hropts.showTools){attr.actions.remove(attr.actions[attr.actionsNum]);}
attr.actionsNum=attr.actionsNum-1;if(!self.hropts.showOpacity){attr.actions.remove(attr.actions[attr.actionsNum]);}
attr.actionsNum=attr.actionsNum-1;return GeoExt.tree.LayerLoader.prototype.createNode.call(self,attr);},onBeforeDblClick:function(node,evt){return false;},onBeforeNodeDrop:function(dropEvt){if(dropEvt){switch(dropEvt.point){case"above":return true;break;case"below":var layer=dropEvt.target.layer;if(!layer.isBaseLayer){return true;}
break;}}
return false;},onAction:function(node,action,evt){var layer=node.layer;var actLayerId=layer.map.getLayerIndex(layer);switch(action){case"up":if(!layer.isBaseLayer){var prevNode=node.previousSibling;if(prevNode){var prevLayer=prevNode.layer;var prevLayerId=prevLayer.map.getLayerIndex(prevLayer);if(prevLayerId>actLayerId){layer.map.raiseLayer(layer,prevLayerId-actLayerId);}}}
break;case"down":if(!layer.isBaseLayer){var nextNode=node.nextSibling;if(nextNode){var nextLayer=nextNode.layer;var nextLayerId=nextLayer.map.getLayerIndex(nextLayer);if(nextLayerId<actLayerId){if(!nextLayer.isBaseLayer){layer.map.raiseLayer(layer,nextLayerId-actLayerId);}}}}
break;case"remove":if(!layer.isBaseLayer){Ext.MessageBox.getDialog().defaultButton=2;Ext.MessageBox.show({title:String.format(__('Removing')+' "{0}"',layer.name),msg:String.format(__('Are you sure you want to remove the layer from your list of layers?'),'<i><b>'+layer.name+'</b></i>'),buttons:Ext.Msg.YESNO,fn:function(btn){if(btn=='yes'){layer.setVisibility(false);layer.destroy();}},scope:this,icon:Ext.MessageBox.QUESTION,maxWidth:300});}else{Ext.MessageBox.show({title:String.format(__('Removing')+' "{0}"',layer.name),msg:String.format(__('You are not allowed to remove the baselayer from your list of layers!'),'<i><b>'+layer.name+'</b></i>'),buttons:Ext.Msg.OK,fn:function(btn){if(btn=='ok'){}},icon:Ext.MessageBox.ERROR,maxWidth:300});}
break;case"opacity":var cmp=Ext.getCmp('WinOpacity-'+layer.id);var xy=evt.getXY();xy[0]=xy[0]+40;xy[1]=xy[1]+0;if(!cmp){cmp=new Ext.Window({title:__('Opacity'),id:'WinOpacity-'+layer.id,x:xy[0],y:xy[1],width:200,resizable:false,constrain:true,bodyStyle:'padding:2px 4px',closeAction:'hide',listeners:{hide:function(){cmp.x=xy[0];cmp.y=xy[1];},show:function(){cmp.show();cmp.focus();}},items:[{xtype:'label',text:layer.name,height:20},{xtype:"gx_opacityslider",showTitle:false,plugins:new GeoExt.LayerOpacitySliderTip(),vertical:false,inverse:false,aggressive:false,layer:layer}]});cmp.show();}else{if(cmp.isVisible()){cmp.hide();}else{cmp.setPosition(xy[0],xy[1]);cmp.show();cmp.focus();}}
break;case"tools":var id=layer.map.getLayerIndex(layer);var num_id=layer.map.getNumLayers();Ext.MessageBox.show({title:String.format('Tools "{0}"',layer.name),msg:String.format('Here should be a form for "{0}" containing'+' infos, etc.!<br>'+"<br>Layer: "+node+"<br>"+layer.name+"<br>"+layer.id+"<br>OL-LayerId: "+id+" ("+num_id+")",'<i><b>'+layer.name+'</b></i>'),buttons:Ext.Msg.OK,fn:function(btn){if(btn=='ok'){}},icon:Ext.MessageBox.INFO,maxWidth:300});break;}},onAfterRender:function(){var self=this;var map=Heron.App.getMap();map.events.register('changelayer',null,function(evt){var layer=evt.layer;var rootNode=self.getRootNode();var layerNode=rootNode.findChild('layerId',evt.layer.id);if(evt.property==="visibility"){if(evt.layer.getVisibility()&&!layerNode){var newNode=self.createNode(self,{layer:layer});var newLayerId=layer.map.getLayerIndex(layer);if(layer.isBaseLayer){var bottomLayer;var bottomLayerId;if(rootNode.lastChild){bottomLayer=rootNode.lastChild.layer;if(bottomLayer){bottomLayerId=bottomLayer.map.getLayerIndex(bottomLayer);}}
rootNode.appendChild(newNode);if(bottomLayer){if(newLayerId>bottomLayerId){layer.map.raiseLayer(layer,bottomLayerId-newLayerId);}}}else{var topLayer;var topLayerId;if(rootNode.firstChild){topLayer=rootNode.firstChild.layer;if(topLayer){topLayerId=topLayer.map.getLayerIndex(topLayer);}}
rootNode.insertBefore(newNode,rootNode.firstChild);if(topLayer){if(topLayerId>newLayerId){layer.map.raiseLayer(layer,topLayerId-newLayerId);}}}
rootNode.reload();}else if(!evt.layer.getVisibility()&&layerNode){var opacityWin=Ext.getCmp('WinOpacity-'+layer.id);if(opacityWin){opacityWin.hide();}
layerNode.un("move",self.onChildMove,self);layerNode.remove();}}});}});Ext.reg('hr_activethemespanel',Heron.widgets.ActiveThemesPanel);Ext.namespace("Heron.widgets");Heron.widgets.CapabilitiesTreePanel=Ext.extend(Ext.tree.TreePanel,{initComponent:function(){var layerOptions=Ext.apply({buffer:0,singleTile:true,ratio:1},this.hropts.layerOptions);var layerParams=Ext.apply({'TRANSPARENT':'TRUE'},this.hropts.layerParams);var root=new Ext.tree.AsyncTreeNode({text:this.hropts.text,expanded:this.hropts.preload,loader:new GeoExt.tree.WMSCapabilitiesLoader({url:this.hropts.url,layerOptions:layerOptions,layerParams:layerParams,createNode:function(attr){attr.checked=attr.leaf?false:undefined;return GeoExt.tree.WMSCapabilitiesLoader.prototype.createNode.apply(this,[attr]);}})});this.options={root:root,listeners:{'checkchange':function(node,checked){var map=Heron.App.getMap();if(!map){return;}
var layer=node.attributes.layer;if(checked===true){map.addLayer(layer);}else{map.removeLayer(layer);}}}};Ext.apply(this,this.options);Heron.widgets.CapabilitiesTreePanel.superclass.initComponent.call(this);}});Ext.reg('hr_capabilitiestreepanel',Heron.widgets.CapabilitiesTreePanel);Ext.namespace("GeoExt.tree");GeoExt.tree.WMSCapabilitiesLoader=function(config){Ext.apply(this,config);GeoExt.tree.WMSCapabilitiesLoader.superclass.constructor.call(this);};Ext.extend(GeoExt.tree.WMSCapabilitiesLoader,Ext.tree.TreeLoader,{url:null,requestMethod:'GET',getParams:function(node){return{'service':'WMS','request':'GetCapabilities','format':'text/XML'};},processResponse:function(response,node,callback,scope){console.log('processResponse');if(!response.responseXML){if(window.ActiveXObject){var resp=new ActiveXObject('Microsoft.XMLDOM');doc.async='false';doc.loadXML(response.responseText);}else{var parser=new DOMParser();var resp=parser.parseFromString(response.responseText,'text/xml');}}else{resp=response.responseXML;}
var capabilities=new OpenLayers.Format.WMSCapabilities().read(resp);node.appendChild(this.processLayer(resp,false));if(typeof callback=="function"){callback.apply(scope||node,[node]);}},processLayer:function(XmlEl,prevLink){console.log('processLayer');if(XmlEl==null){var result=new Ext.tree.TreeNode({text:"Error getting data."});return result;}
var t=((XmlEl.nodeType==3)?XmlEl.nodeValue:XmlEl.tagName);var link=false;if(prevLink){t="<a onclick='window.open(\""+t+"\")'>"+t+"</a>";}
if(XmlEl.tagName=="inspire_common:URL"||XmlEl.tagName=="xlink:href"||XmlEl.tagName=="href"){link=true;}
if(t==undefined||t.replace(/\s/g,'').length==0){if(XmlEl.childNodes.length==0){return null;}
t=this.url;}
var result=new Ext.tree.TreeNode({text:t});var self=this;Ext.each(XmlEl.attributes,function(a){var text=a.nodeValue;if(a.nodeName=="inspire_common:URL"||a.nodeName=="xlink:href"||a.nodeName=="href"){text="<a onclick='window.open(\""+text+"\")'>"+text
+"</a>";}
var c=new Ext.tree.TreeNode({text:a.nodeName});c.appendChild(new Ext.tree.TreeNode({text:text}));result.appendChild(c);});Ext.each(XmlEl.childNodes,function(el){if((el.nodeType==1)||(el.nodeType==3)){var c=self.processLayer(el,link);if(c){result.appendChild(c);}}});return result;}});Ext.namespace("Heron.widgets");Heron.widgets.CapabilitiesViewPanel=Ext.extend(Ext.tree.TreePanel,{eventRegistered:false,autoScroll:true,containerScroll:true,initComponent:function(){console.log('initComponent');console.log(this);this.initTree();Heron.widgets.CapabilitiesViewPanel.superclass.initComponent.call(this);this.addListener("afterrender",this.onAfterRender);},onAfterRender:function(){console.log('onAfterRender');var map=Heron.App.getMap();if(map==undefined||map==null){return;}
this.updateViewTree();map.events.register("changelayer",this,this.updateViewTree);},updateViewTree:function(){this.addLayers2Tree();if(this.doLayout){this.doLayout();}},addedUrl:[],initTree:function(){var root=new Ext.tree.TreeNode({text:"WMS Capabilities",expanded:true});this.options={root:root,listeners:{'checkchange':function(node,checked){}}};Ext.apply(this,this.options);},addLayers2Tree:function(){console.log('addLayers2Tree');var map=Heron.App.getMap();if(map!==undefined){for(var i=0;i<map.layers.length;i++){var layer=map.layers[i];if(!(layer instanceof OpenLayers.Layer.WMS)||this.addedUrl.indexOf(layer.url)!=-1){continue;}
this.addedUrl.push(layer.url);var url=layer.url;this.root.appendChild(new Ext.tree.AsyncTreeNode({text:this.getPath(layer.url),expanded:this.hropts.preload,loader:new GeoExt.tree.WMSCapabilitiesLoader({url:url})}));}
this.doLayout();}},getPath:function(url){var reg=/.+?\:\/\/.+?(\/.+?)(?:#|\?|$)/;return reg.exec(url)[1];}});Ext.reg('hr_capabilitiesviewpanel',Heron.widgets.CapabilitiesViewPanel);Ext.namespace("Heron.widgets");Heron.widgets.CascadingTreeNode=Ext.extend(Ext.tree.AsyncTreeNode,{checked:false,constructor:function(){if(arguments[0].checked===undefined){arguments[0].checked=this.checked;}
Heron.widgets.CascadingTreeNode.superclass.constructor.apply(this,arguments);this.on({"append":this.onAppend,"remove":this.onRemove,"checkchange":this.onCheckChange,scope:this});},onAppend:function(panel,self,child){child.on({"checkchange":this.onChildCheckChange,scope:this});},onRemove:function(panel,self,child){child.un({"checkchange":this.onChildCheckChange,scope:this});},onChildCheckChange:function(child,checked){if(this.childCheckChange){return;}
var childrenTotal=0,childrenChecked=0;var self=this;this.cascade(function(child){if(child==self||(child.hasChildNodes()&&!child.attributes.xtype=='hr_cascader')){return;}
childrenTotal++;if(child.ui.isChecked()){childrenChecked++;}},null,null);this.childCheckChange=true;this.ui.toggleCheck(childrenTotal==childrenChecked);this.childCheckChange=false;},onCheckChange:function(node,checked){node.cascade(function(child){if(child==node||node.childCheckChange){return;}
if(child.ui.rendered){child.ui.toggleCheck(checked);}else{child.attributes.checked=checked;}},null,null);}});Ext.tree.TreePanel.nodeTypes.hr_cascader=Heron.widgets.CascadingTreeNode;Ext.namespace("Heron.widgets.search");Heron.widgets.search.CoordSearchPanel=Ext.extend(Ext.form.FormPanel,{title:__('Go to coordinates'),titleDescription:null,titleDescriptionStyle:null,bodyBaseCls:'x-panel',bodyItemCls:null,bodyCls:null,fieldMaxWidth:150,fieldLabelWidth:'',fieldStyle:null,fieldLabelStyle:null,layerName:__('Location'),onProjectionIndex:0,onZoomLevel:-1,showProjection:false,showZoom:false,showAddMarkers:false,checkAddMarkers:false,showHideMarkers:false,checkHideMarkers:false,showResultMarker:false,fieldResultMarkerStyle:null,fieldResultMarkerText:__('Marker position: '),fieldResultMarkerSeparator:' , ',fieldResultMarkerPrecision:2,removeMarkersOnClose:false,showRemoveMarkersBtn:false,buttonAlign:'left',hropts:null,initComponent:function(){var self=this;var map=Heron.App.getMap();this.arrProj=new Ext.data.ArrayStore({fields:[{name:'id'},{name:'idLast'},{name:'idX'},{name:'idY'},{name:'idB'},{name:'projEpsg'},{name:'projDesc'},{name:'fieldLabelX'},{name:'fieldLabelY'},{name:'fieldEmptyTextX'},{name:'fieldEmptyTextY'},{name:'fieldMinX'},{name:'fieldMinY'},{name:'fieldMaxX'},{name:'fieldMaxY'},{name:'fieldDecPrecision'},{name:'iconWidth'},{name:'iconHeight'},{name:'localIconFile'},{name:'iconUrl'},{name:'iconOL'}]});var idX=Ext.id();var idY=Ext.id();var idB=Ext.id();var contexts=this.hropts;if(contexts&&typeof(contexts)!=="undefined"){for(var i=0;i<contexts.length;i++){var recArrPrj=this.arrProj.recordType;var recSrc=new recArrPrj({id:i,idLast:this.onProjectionIndex,idX:idX,idY:idY,idB:idB,projEpsg:contexts[i].projEpsg,projDesc:contexts[i].projDesc?contexts[i].projDesc:(contexts[i].projEpsg?contexts[i].projEpsg:__('Map system')),fieldLabelX:contexts[i].fieldLabelX?contexts[i].fieldLabelX:__('X'),fieldLabelY:contexts[i].fieldLabelY?contexts[i].fieldLabelY:__('Y'),fieldEmptyTextX:contexts[i].fieldEmptyTextX?contexts[i].fieldEmptyTextX:__('Enter X-coordinate...'),fieldEmptyTextY:contexts[i].fieldEmptyTextY?contexts[i].fieldEmptyTextY:__('Enter Y-coordinate...'),fieldMinX:contexts[i].fieldMinX?contexts[i].fieldMinX:null,fieldMinY:contexts[i].fieldMinY?contexts[i].fieldMinY:null,fieldMaxX:contexts[i].fieldMaxX?contexts[i].fieldMaxX:null,fieldMaxY:contexts[i].fieldMaxY?contexts[i].fieldMaxY:null,fieldDecPrecision:contexts[i].fieldDecPrecision?contexts[i].fieldDecPrecision:2,iconWidth:contexts[i].iconWidth?contexts[i].iconWidth:32,iconHeight:contexts[i].iconHeight?contexts[i].iconHeight:32,localIconFile:contexts[i].localIconFile?contexts[i].localIconFile:'redpin.png',iconUrl:contexts[i].iconUrl?contexts[i].iconUrl:null,iconOL:null});this.arrProj.add(recSrc);}}else{var recArrPrj=this.arrProj.recordType;var recSrc=new recArrPrj({id:0,idLast:0,idX:idX,idY:idY,idB:idB,projEpsg:null,projDesc:__('Map system'),fieldLabelX:__('X'),fieldLabelY:__('Y'),fieldEmptyTextX:__('Enter X-coordinate...'),fieldEmptyTextY:__('Enter Y-coordinate...'),fieldMinX:null,fieldMinY:null,fieldMaxX:null,fieldMaxY:null,fieldDecPrecision:2,iconWidth:32,iconHeight:32,localIconFile:'redpin.png',iconUrl:null,iconOL:null});this.arrProj.add(recSrc);}
this.pCombo=new Ext.form.ComboBox({fieldLabel:__('Input system'),emptyText:__('Choose input system...'),tooltip:__('Input system'),anchor:'100%',boxMaxWidth:this.fieldMaxWidth,itemCls:this.bodyItemCls,cls:this.bodyCls,style:this.fieldStyle,labelStyle:this.fieldLabelStyle,editable:false,triggerAction:'all',mode:'local',store:this.arrProj,displayField:'projDesc',valueField:'id',value:this.onProjectionIndex,hidden:((!this.showProjection)||((this.arrProj.data.length<=1)&&(!this.arrProj.getAt(0).data.projEpsg)))?true:false,listeners:{render:function(c){c.el.set({qtip:this.tooltip});c.trigger.set({qtip:this.tooltip});},select:function(combo,record,index){var idLast=combo.store.data.items[index].data.idLast;if(idLast!=index){var p=combo.store.data.items[index].data;var pX=Ext.getCmp(p.idX);var pY=Ext.getCmp(p.idY);var pB=Ext.getCmp(p.idB);if(record.data.fieldLabelX){pX.label.update(record.data.fieldLabelX);}
if(record.data.fieldEmptyTextX){Ext.getCmp(idX).emptyText=record.data.fieldEmptyTextX;}
pX.decimalPrecision=record.data.fieldDecPrecision;pX.setValue('');pX.show();if(record.data.fieldLabelY){pY.label.update(record.data.fieldLabelY);}
if(record.data.fieldEmptyTextY){Ext.getCmp(idY).emptyText=record.data.fieldEmptyTextY;}
pY.decimalPrecision=record.data.fieldDecPrecision;pY.setValue('');pY.show();pB.disable();pB.show();this.rLabel.setText(this.fieldResultMarkerText);for(var i=0;i<combo.store.data.length;i++){combo.store.data.items[i].data.idLast=index;}}},scope:this}});this.tLabel=new Ext.form.Label({html:this.titleDescription,style:this.titleDescriptionStyle});this.xField=new Ext.form.NumberField({id:idX,fieldLabel:this.arrProj.getAt(this.onProjectionIndex).data.fieldLabelX,emptyText:this.arrProj.getAt(this.onProjectionIndex).data.fieldEmptyTextX,anchor:'100%',boxMaxWidth:this.fieldMaxWidth,itemCls:this.bodyItemCls,cls:this.bodyCls,style:this.fieldStyle,labelStyle:this.fieldLabelStyle,decimalPrecision:this.arrProj.getAt(this.onProjectionIndex).data.fieldDecPrecision,enableKeyEvents:true,listeners:{keyup:function(numberfield,ev){this.onNumberKeyUp(numberfield,ev);},keydown:function(numberfield,ev){this.rLabel.setText(this.fieldResultMarkerText);},scope:this}});this.yField=new Ext.form.NumberField({id:idY,fieldLabel:this.arrProj.getAt(this.onProjectionIndex).data.fieldLabelY,emptyText:this.arrProj.getAt(this.onProjectionIndex).data.fieldEmptyTextY,anchor:'100%',boxMaxWidth:this.fieldMaxWidth,itemCls:this.bodyItemCls,cls:this.bodyCls,style:this.fieldStyle,labelStyle:this.fieldLabelStyle,decimalPrecision:this.arrProj.getAt(this.onProjectionIndex).data.fieldDecPrecision,enableKeyEvents:true,listeners:{keyup:function(numberfield,ev){this.onNumberKeyUp(numberfield,ev);},keydown:function(numberfield,ev){this.rLabel.setText(this.fieldResultMarkerText);},scope:this}});this.storeZoom=new GeoExt.data.ScaleStore({map:map});this.arrZoom=new Ext.data.ArrayStore({fields:[{name:'zoom',type:'string'},{name:'scale',type:'string'}],data:[['-1',__('no zoom')]]});for(var i=0;i<this.storeZoom.getCount();i++){var recArrZoom=this.arrZoom.recordType;var rec=new recArrZoom({zoom:this.storeZoom.getAt(i).data.level,scale:'1 : '+parseInt(this.storeZoom.getAt(i).data.scale+0.5)});this.arrZoom.add(rec);}
this.sCombo=new Ext.form.ComboBox({fieldLabel:__('Zoom'),emptyText:__('Choose scale...'),tooltip:__('Scale'),anchor:'100%',boxMaxWidth:this.fieldMaxWidth,itemCls:this.bodyItemCls,cls:this.bodyCls,style:this.fieldStyle,labelStyle:this.fieldLabelStyle,editable:false,hidden:this.showZoom?false:true,triggerAction:'all',mode:'local',store:this.arrZoom,displayField:'scale',valueField:'zoom',value:(this.onZoomLevel<0)?-1:this.onZoomLevel,listeners:{render:function(c){c.el.set({qtip:this.tooltip});c.trigger.set({qtip:this.tooltip});}}});this.mCheckbox=new Ext.form.Checkbox({fieldLabel:__('Mode'),boxLabel:__('Remember locations'),anchor:'100%',boxMaxWidth:this.arrProj.getAt(0).data.fieldMaxWidth,itemCls:this.bodyItemCls,cls:this.bodyCls,labelStyle:this.fieldLabelStyle,checked:this.checkAddMarkers?true:false,hidden:this.showAddMarkers?false:true});this.cCheckbox=new Ext.form.Checkbox({fieldLabel:this.mCheckbox.hidden?__('Mode'):'',boxLabel:this.removeMarkersOnClose?__('Remove markers on close'):__('Hide markers on close'),anchor:'100%',boxMaxWidth:this.arrProj.getAt(0).data.fieldMaxWidth,itemCls:this.bodyItemCls,cls:this.bodyCls,labelStyle:this.fieldLabelStyle,checked:this.checkHideMarkers?true:false,hidden:this.showHideMarkers?false:true});this.rLabel=new Ext.form.Label({anchor:'100%',html:this.fieldResultMarkerText,itemCls:this.bodyItemCls,cls:this.bodyCls,style:this.fieldResultMarkerStyle,hidden:this.showResultMarker?false:true});this.rButton=new Ext.Button({text:__('Remove markers'),minWidth:90,autoHeight:true,flex:1,hidden:this.showRemoveMarkersBtn?false:true,handler:function(){self.removeMarkers(self);self.rLabel.setText(self.fieldResultMarkerText);}});this.gButton=new Ext.Button({id:idB,text:__('Go!'),align:'right',tooltip:__('Pan and zoom to location'),minWidth:90,autoHeight:true,disabled:true,flex:1,handler:function(){self.panAndZoom(self);}});this.items=[{layout:'form',border:false,baseCls:this.bodyBaseCls,labelWidth:this.fieldLabelWidth,padding:5,items:[self.tLabel,self.pCombo,self.xField,self.yField,self.sCombo,self.mCheckbox,self.cCheckbox,self.rLabel],buttonAlign:this.buttonAlign,buttons:[this.rButton,this.gButton]}];this.keys=[{key:[Ext.EventObject.ENTER],handler:function(){if(!self.gButton.disabled){self.panAndZoom(self);}}}];Heron.widgets.search.CoordSearchPanel.superclass.initComponent.call(this);this.addListener("afterrender",this.onPanelRendered,this);},onPanelRendered:function(){if(this.ownerCt){this.ownerCt.addListener("hide",this.onParentHide,this);this.ownerCt.addListener("show",this.onParentShow,this);}},onParentShow:function(){var map=Heron.App.getMap();var markerLayer=map.getLayersByName(this.layerName);if(markerLayer[0]){markerLayer[0].setVisibility(true);}},onParentHide:function(){if(this.cCheckbox.checked){if(this.removeMarkersOnClose){this.removeMarkers(this);}
var map=Heron.App.getMap();var markerLayer=map.getLayersByName(this.layerName);if(markerLayer[0]){markerLayer[0].setVisibility(false);}}},onNumberKeyUp:function(numberfield,ev){var valueX=parseFloat(this.xField.getValue());var valueY=parseFloat(this.yField.getValue());var fieldMinX=this.arrProj.getAt(this.pCombo.getValue()).data.fieldMinX;var fieldMinY=this.arrProj.getAt(this.pCombo.getValue()).data.fieldMinY;var fieldMaxX=this.arrProj.getAt(this.pCombo.getValue()).data.fieldMaxX;var fieldMaxY=this.arrProj.getAt(this.pCombo.getValue()).data.fieldMaxY;if(valueX&&valueY){if(fieldMinX&&fieldMinY&&fieldMaxX&&fieldMaxY){if(((valueX>=parseFloat(fieldMinX))&&(valueX<=parseFloat(fieldMaxX)))&&((valueY>=parseFloat(fieldMinY))&&(valueY<=parseFloat(fieldMaxY)))){this.gButton.enable();}else{this.gButton.disable();}}else{this.gButton.enable();}}
else{this.gButton.disable();}},removeMarkers:function(self){var map=Heron.App.getMap();var markerLayer=map.getLayersByName(this.layerName);if(markerLayer[0]){markerLayer[0].clearMarkers();map.removeLayer(markerLayer[0]);}},panAndZoom:function(self){var map=Heron.App.getMap();var markerLayer=map.getLayersByName(this.layerName);if(markerLayer[0]){if(!self.mCheckbox.checked){markerLayer[0].clearMarkers();}}
var x=self.xField.getValue();var y=self.yField.getValue();var zoom=(self.sCombo.value>=0)?self.sCombo.value:map.getZoom();var position=new OpenLayers.LonLat(x,y);var selectedEpsg=this.arrProj.getAt(self.pCombo.value).data.projEpsg;if(selectedEpsg&&(selectedEpsg!=map.getProjection())){this.olProjection=null;this.olProjection=new OpenLayers.Projection(selectedEpsg);if(this.olProjection){position.transform(this.olProjection,map.getProjectionObject());}}
map.setCenter(position,zoom);this.rLabel.setText(this.fieldResultMarkerText+position.lon.toFixed(this.fieldResultMarkerPrecision)+this.fieldResultMarkerSeparator+position.lat.toFixed(this.fieldResultMarkerPrecision));if(!markerLayer[0]){this.layer=new OpenLayers.Layer.Markers(this.layerName);map.addLayer(this.layer);markerLayer=map.getLayersByName(this.layerName);}
if(!this.arrProj.getAt(self.pCombo.value).data.iconOL){var iconUrl=Heron.Utils.getImageLocation(this.arrProj.getAt(self.pCombo.value).data.localIconFile);var iconWidth=this.arrProj.getAt(self.pCombo.value).data.iconWidth;var iconHeight=this.arrProj.getAt(self.pCombo.value).data.iconHeight;var size=new OpenLayers.Size(iconWidth,iconHeight);var offset=new OpenLayers.Pixel(-(size.w/2),-size.h);this.arrProj.getAt(self.pCombo.value).data.iconOL=new OpenLayers.Icon(iconUrl,size,offset);}
var marker=new OpenLayers.Marker(position,this.arrProj.getAt(self.pCombo.value).data.iconOL.clone());markerLayer[0].addMarker(marker);markerLayer[0].setVisibility(true);}});Ext.reg("hr_coordsearchpanel",Heron.widgets.search.CoordSearchPanel);Ext.namespace("Heron.widgets.search");Ext.namespace("Heron.utils");Heron.widgets.search.FeatureInfoPanel=Ext.extend(Ext.Panel,{title:__('Feature Info'),maxFeatures:5,displayPanels:['Table'],exportFormats:['CSV','XLS','GMLv2','GeoJSON','WellKnownText'],infoFormat:'application/vnd.ogc.gml',hover:false,drillDown:true,layer:"",discardStylesForDups:false,showTopToolbar:true,showGeometries:true,featureSelection:true,columnCapitalize:true,gridCellRenderers:null,gridColumns:null,autoConfigMaxSniff:40,hideColumns:[],columnFixedWidth:100,autoMaxWidth:300,autoMinWidth:45,pop:null,map:null,displayPanel:null,lastEvt:null,olControl:null,tb:null,initComponent:function(){var self=this;Ext.apply(this,{layout:"fit"});this.display=this.displayFeatureInfo;Heron.widgets.search.FeatureInfoPanel.superclass.initComponent.call(this);this.map=Heron.App.getMap();if(!this.olControl){var controls=this.map.getControlsByClass("OpenLayers.Control.WMSGetFeatureInfo");if(controls&&controls.length>0){for(var index=0;index<controls.length;index++){if(controls[index].id!=="hr-feature-info-hover"){this.olControl=controls[index];this.olControl.infoFormat=this.infoFormat;this.olControl.maxFeatures=this.maxFeatures;this.olControl.hover=this.hover;this.olControl.drillDown=this.drillDown;break;}}}
if(!this.olControl){this.olControl=new OpenLayers.Control.WMSGetFeatureInfo({maxFeatures:this.maxFeatures,queryVisible:true,infoFormat:this.infoFormat,hover:this.hover,drillDown:this.drillDown});this.map.addControl(this.olControl);}}
this.olControl.events.register("getfeatureinfo",this,this.handleGetFeatureInfo);this.olControl.events.register("beforegetfeatureinfo",this,this.handleBeforeGetFeatureInfo);this.olControl.events.register("nogetfeatureinfo",this,this.handleNoGetFeatureInfo);this.addListener("afterrender",this.onPanelRendered,this);this.addListener("render",this.onPanelRender,this);this.addListener("show",this.onPanelShow,this);this.addListener("hide",this.onPanelHide,this);},onPanelRender:function(){this.mask=new Ext.LoadMask(this.body,{msg:__('Loading...')});},onPanelRendered:function(){if(this.ownerCt){this.ownerCt.addListener("hide",this.onPanelHide,this);this.ownerCt.addListener("show",this.onPanelShow,this);}},onPanelShow:function(){if(this.tabPanel){this.tabPanel.items.each(function(item){return item.showLayer?item.showLayer():true;},this);}},onPanelHide:function(){if(this.tabPanel){this.tabPanel.items.each(function(item){return item.hideLayer?item.hideLayer():true;},this);}},initPanel:function(){this.lastEvt=null;this.expand();if(this.tabPanel){this.tabPanel.items.each(function(item){this.tabPanel.remove(item);return item.cleanup?item.cleanup():true;},this);}
if(this.displayPanel){this.remove(this.displayPanel);this.displayPanel=null;}
this.displayOn=false;},handleBeforeGetFeatureInfo:function(evt){if(evt.object!==this.olControl){return;}
this.olControl.layers=[];this.olControl.url=null;this.olControl.drillDown=this.drillDown;var layer;if(this.layer){var layers=this.map.getLayersByName(this.layer);if(layers){layer=layers[0];this.olControl.layers.push(layer);}}
if(this.olControl.layers.length==0){this.layerDups={};for(var index=0;index<this.map.layers.length;index++){layer=this.map.layers[index];if(!layer instanceof OpenLayers.Layer.WMS||!layer.params){continue;}
if(layer.visibility&&(layer.featureInfoFormat||layer.params.INFO_FORMAT||layer.queryable)){if(!layer.params.INFO_FORMAT&&layer.featureInfoFormat){layer.params.INFO_FORMAT=layer.featureInfoFormat;}
if(layer.params.CQL_FILTER){this.olControl.requestPerLayer=true;layer.params.vendorParams={CQL_FILTER:layer.params.CQL_FILTER};}
if(this.layerDups[layer.params.LAYERS]&&!this.olControl.requestPerLayer){if(this.discardStylesForDups){var dupLayer=this.layerDups[layer.params.LAYERS];dupLayer.savedStyles=dupLayer.params.STYLES;dupLayer.params.STYLES="";}
continue;}
this.olControl.layers.push(layer);this.layerDups[layer.params.LAYERS]=layer;}}}
this.initPanel();if(this.mask){this.mask.show();}
this.fireEvent('beforefeatureinfo',evt);this.handleVectorFeatureInfo(evt.object.handler.evt);if(this.olControl.layers.length==0&&this.features==null){this.handleNoGetFeatureInfo();}},handleGetFeatureInfo:function(evt){var layers=this.olControl.layers;if(layers){for(var i=0,len=layers.length;i<len;i++){layers[i].params.vendorParams=null;}}
if(this.discardStylesForDups){for(var layerName in this.layerDups){var layerDup=this.layerDups[layerName];if(layerDup.savedStyles){layerDup.params.STYLES=layerDup.savedStyles;layerDup.savedStyles=null;}}}
if(evt&&evt.object!==this.olControl){return;}
if(this.mask){this.mask.hide();}
if(evt){this.lastEvt=evt;}
if(!this.lastEvt){return;}
this.displayFeatures(this.lastEvt);},handleVectorFeatureInfo:function(evt){this.vectorFeaturesFound=false;var screenX=Ext.isIE?Ext.EventObject.xy[0]:evt.clientX;var screenY=Ext.isIE?Ext.EventObject.xy[1]:evt.clientY;this.features=this.getFeaturesByXY(screenX,screenY);if(this.mask){this.mask.hide();}
evt.features=this.features;if(evt.features&&evt.features.length>0){this.vectorFeaturesFound=true;this.displayFeatures(evt);}},handleNoGetFeatureInfo:function(){if(!this.visibleVectorLayers){Ext.Msg.alert(__('Warning'),__('Feature Info unavailable (you may need to make some layers visible)'));}},getFeaturesByXY:function(x,y){this.visibleVectorLayers=false;var features=[],targets=[],layers=[];var layer,target,feature,i,len;for(i=this.map.layers.length-1;i>=0;--i){layer=this.map.layers[i];if(layer.div.style.display!=="none"){if(layer instanceof OpenLayers.Layer.Vector){target=document.elementFromPoint(x,y);while(target&&target._featureId){feature=layer.getFeatureById(target._featureId);if(feature){var featureClone=feature.clone();featureClone.type=layer.name;featureClone.layer=layer;features.push(featureClone);target.style.display="none";targets.push(target);target=document.elementFromPoint(x,y);this.visibleVectorLayers=true;}else{target=false;}}}
layers.push(layer);layer.div.style.display="none";}}
for(i=0,len=targets.length;i<len;++i){targets[i].style.display="";}
for(i=layers.length-1;i>=0;--i){layers[i].div.style.display="block";}
return features;},getFeatureType:function(feature){if(feature.gml&&feature.gml.featureType){return feature.gml.featureType;}
if(feature.fid&&feature.fid.indexOf('undefined')<0){var featureType=/[^\.]*/.exec(feature.fid);return(featureType[0]!="null")?featureType[0]:null;}
if(feature.type){return feature.type;}
if(feature.attributes['_LAYERID_']){return feature.attributes['_LAYERID_'];}
if(feature.attributes['DINO_DBA.MAP_SDE_GWS_WELL_W_HEADS_VW.DINO_NR']){return'TNO_DINO_WELLS';}
if(feature.attributes['DINO_DBA.MAP_SDE_BRH_BOREHOLE_RD_VW.DINO_NR']){return'TNO_DINO_BOREHOLES';}
return __('Unknown');},getFeatureTitle:function(feature,featureType){if(feature.layer){return feature.layer.name;}
var featureTitle=feature.layer?feature.layer.name:featureType;var layers=this.map.layers;for(var l=0;l<layers.length;l++){var nextLayer=layers[l];if(!nextLayer.params||!nextLayer.visibility){continue;}
if(featureType.toLowerCase()==/([^:]*$)/.exec(nextLayer.params.LAYERS)[0].toLowerCase()){featureTitle=nextLayer.name;break;}}
return featureTitle;},displayFeatures:function(evt){if(this.olControl.requestPerLayer){}
if(evt.features&&evt.features.length>0){if(!this.vectorFeaturesFound&&this.displayPanel){this.remove(this.displayPanel);this.displayPanel=null;this.displayOn=false;}
this.displayPanel=this.display(evt);}else if(!this.vectorFeaturesFound){this.displayPanel=this.displayInfo(__('No features found'));}
if(this.displayPanel&&!this.displayOn){this.add(this.displayPanel);this.displayPanel.doLayout();}
if(this.getLayout()instanceof Object&&!this.displayOn){this.getLayout().runLayout();}
this.displayOn=true;this.fireEvent('featureinfo',evt);},displayFeatureInfo:function(evt){var featureSets={},featureSet,featureType,featureTitle,featureSetKey;for(var index=0;index<evt.features.length;index++){var feature=evt.features[index];featureType=this.getFeatureType(feature);featureTitle=this.getFeatureTitle(feature,featureType);featureSetKey=featureType+featureTitle;if(!featureSets[featureSetKey]){featureSet={featureType:featureType,title:featureTitle,features:[]};featureSets[featureSetKey]=featureSet;}
for(var attrName in feature.attributes){var attrValue=feature.attributes[attrName];if(attrValue&&typeof attrValue=='string'&&attrValue.indexOf("http://")>=0){feature.attributes[attrName]='<a href="'+attrValue+'" target="_new">'+attrValue+'</a>';}
if(attrName.indexOf(".")>=0){var newAttrName=attrName.replace(/\./g,"_");feature.attributes[newAttrName]=feature.attributes[attrName];if(attrName!=newAttrName){delete feature.attributes[attrName];}}}
featureSet.features.push(feature);}
if(this.tabPanel!=null&&!this.displayOn){this.remove(this.tabPanel);this.tabPanel=null;}
for(featureSetKey in featureSets){featureSet=featureSets[featureSetKey];if(featureSet.features.length==0){continue;}
var autoConfig=true;var columns=null;if(this.gridColumns){for(var c=0;c<this.gridColumns.length;c++){if(this.gridColumns[c].featureType==featureSet.featureType){autoConfig=false;columns=this.gridColumns[c].columns;break;}}}
var panel=new Heron.widgets.search.FeaturePanel({title:featureSet.title,featureType:featureSet.featureType,featureSetKey:featureSetKey,header:false,features:featureSet.features,autoConfig:autoConfig,autoConfigMaxSniff:this.autoConfigMaxSniff,hideColumns:this.hideColumns,columnFixedWidth:this.columnFixedWidth,autoMaxWidth:this.autoMaxWidth,autoMinWidth:this.autoMinWidth,columnCapitalize:this.columnCapitalize,showGeometries:this.showGeometries,featureSelection:this.featureSelection,gridCellRenderers:this.gridCellRenderers,columns:columns,showTopToolbar:this.showTopToolbar,exportFormats:this.exportFormats,displayPanels:this.displayPanels,hropts:{zoomOnRowDoubleClick:true,zoomOnFeatureSelect:false,zoomLevelPointSelect:8}});if(!this.tabPanel){this.tabPanel=new Ext.TabPanel({border:false,autoDestroy:true,enableTabScroll:true,items:[panel],activeTab:0});}else{this.tabPanel.add(panel);this.tabPanel.setActiveTab(0);}
panel.loadFeatures(featureSet.features,featureSet.featureType);}
return this.tabPanel;},displayTree:function(evt){var panel=new Heron.widgets.XMLTreePanel();panel.xmlTreeFromText(panel,evt.text);return panel;},displayXML:function(evt){var opts={html:'<div class="hr-html-panel-body"><pre>'+Heron.Utils.formatXml(evt.text,true)+'</pre></div>',preventBodyReset:true,autoScroll:true};return new Ext.Panel(opts);},displayInfo:function(infoStr){var opts={html:'<div class="hr-html-panel-body"><pre>'+infoStr+'</pre></div>',preventBodyReset:true,autoScroll:true};return new Ext.Panel(opts);}});Ext.reg('hr_featureinfopanel',Heron.widgets.search.FeatureInfoPanel);Ext.namespace("Heron.widgets.search");Ext.namespace("Heron.utils");Heron.widgets.search.FeatureInfoPopup=Ext.extend(GeoExt.Popup,{title:__('FeatureInfo popup'),layout:'fit',resizable:true,width:320,height:200,anchorPosition:"auto",panIn:false,draggable:true,unpinnable:false,maximizable:false,collapsible:false,closeAction:'hide',olControl:null,anchored:true,hideonmove:false,layer:null,initComponent:function(){this.map=Heron.App.getMap();if(this.hideonmove){this.anchorPosition="bottom-left";}
this.fiPanel=this.createFeatureInfoPanel();this.fiPanel.addListener('beforefeatureinfo',this.onBeforeFeatureInfo,this);this.fiPanel.addListener('featureinfo',this.onFeatureInfo,this);var self=this;this.olControl=this.fiPanel.olControl;if(this.hideonmove&&this.olControl.handler&&this.olControl.handler.callbacks.move){this.olControl.handler.callbacks.move=function(){self.olControl.cancelHover();self.hide();}}
this.items=[this.fiPanel];Heron.widgets.search.FeatureInfoPopup.superclass.initComponent.call(this);},createFeatureInfoPanel:function(){var defaultConfig={title:null,header:false,border:false,showTopToolbar:false,exportFormats:[],maxFeatures:8,hover:false,drillDown:true,infoFormat:'application/vnd.ogc.gml',layer:this.layer,olControl:this.olControl};var config=Ext.apply(defaultConfig,this.featureInfoPanel);return new Heron.widgets.search.FeatureInfoPanel(config);},onBeforeFeatureInfo:function(evt){this.hide();},onFeatureInfo:function(evt){this.location=this.map.getLonLatFromPixel(evt.xy);this.show();},deactivate:function(){this.hide();}});Ext.reg('hr_featureinfopopup',Heron.widgets.search.FeatureInfoPopup);Ext.namespace("Heron.widgets");Heron.widgets.XMLTreePanel=Ext.extend(Ext.tree.TreePanel,{initComponent:function(){Ext.apply(this,{autoScroll:true,rootVisible:false,root:this.root?this.root:{nodeType:'async',text:'Ext JS',draggable:false,id:'source'}});Heron.widgets.XMLTreePanel.superclass.initComponent.apply(this,arguments);},xmlTreeFromUrl:function(url){var self=this;Ext.Ajax.request({url:url,method:'GET',params:null,success:function(result,request){self.xmlTreeFromDoc(self,result.responseXML);},failure:function(result,request){Ext.Msg.alert(__('Warning'),__('Error in ajax request'));}});},xmlTreeFromText:function(self,text){var doc=new OpenLayers.Format.XML().read(text);self.xmlTreeFromDoc(self,doc);return doc;},xmlTreeFromDoc:function(self,doc){self.setRootNode(self.treeNodeFromXml(self,doc.documentElement||doc));},treeNodeFromXml:function(self,XmlEl){var t=((XmlEl.nodeType==3)?XmlEl.nodeValue:XmlEl.tagName);if(t.replace(/\s/g,'').length==0){return null;}
var result=new Ext.tree.TreeNode({text:t});var xmlns='xmlns',xsi='xsi';if(XmlEl.nodeType==1){Ext.each(XmlEl.attributes,function(a){var nodeName=a.nodeName;if(!(XmlEl.parentNode.nodeType==9&&(nodeName.substring(0,xmlns.length)===xmlns||nodeName.substring(0,xsi.length)===xsi))){var c=new Ext.tree.TreeNode({text:a.nodeName});c.appendChild(new Ext.tree.TreeNode({text:a.nodeValue}));result.appendChild(c);}});Ext.each(XmlEl.childNodes,function(el){if((el.nodeType==1)||(el.nodeType==3)){var c=self.treeNodeFromXml(self,el);if(c){result.appendChild(c);}}});}
return result;}});Ext.reg('hr_xmltreepanel',Heron.widgets.XMLTreePanel);Ext.namespace("Heron.widgets");Heron.widgets.GXP_LayerPanel_Empty=Ext.extend(Ext.Container,{});GeoExt.data.LayerRecord.prototype.fields.addAll([new Ext.data.Field({name:"group",type:"string",mapping:"group"}),new Ext.data.Field({name:"queryable",type:"boolean",mapping:"queryable",defaultValue:true})]);Heron.widgets.GXP_LayerPanel=Ext.extend(Ext.Panel,{layerSortOrder:'ASC',header:true,initComponent:function(){if(OpenLayers.ProxyHost){this.proxy=OpenLayers.ProxyHost;}
this.layerSources={};this.initTools();this.addListener("afterrender",this.onAfterRender);this.addEvents("ready","portalready","beforelayerselectionchange","layerselectionchange");this.createLayerRecordQueue=[];Heron.widgets.GXP_LayerPanel.superclass.initComponent.call(this);},onAfterRender:function(){var config,queue=[];for(var key in this.sources){queue.push(this.createSourceLoader(key));}
gxp.util.dispatch(queue,this.activate,this);var tool=this.tools['undefined'];if(tool){tool.hide();}
this.fireEvent("portalready");},activate:function(){Ext.QuickTips.init();this.fireEvent("ready");},initTools:function(){if(this.tools&&this.tools.length>0){var tool;for(var i=0,len=this.tools.length;i<len;i++){try{tool=Ext.ComponentMgr.createPlugin(this.tools[i],this.defaultToolType);}catch(err){throw new Error("Could not create tool plugin with ptype: "+this.tools[i].ptype);}
tool.init(this);}}},createLayerRecord:function(config,callback,scope){this.createLayerRecordQueue.push({config:config,callback:callback,scope:scope});this.checkLayerRecordQueue();},checkLayerRecordQueue:function(){var request,source,s,record,called;var remaining=[];for(var i=0,ii=this.createLayerRecordQueue.length;i<ii;++i){called=false;request=this.createLayerRecordQueue[i];s=request.config.source;if(s in this.layerSources){source=this.layerSources[s];record=source.createLayerRecord(request.config);if(record){(function(req,rec){window.setTimeout(function(){if(req.callback){req.callback.call(req.scope,rec);}},0);})(request,record);called=true;}else if(source.lazy){source.store.load({callback:this.checkLayerRecordQueue,scope:this});}}
if(!called){remaining.push(request);}}
this.createLayerRecordQueue=remaining;},createSourceLoader:function(key){var map=this.map=Heron.App.getMap();this.mapPanel=Heron.App.getMapPanel();return function(done){var config=this.sources[key];config.projection=map.projection;this.addLayerSource({id:key,config:config,callback:done,fallback:function(source,msg,details){done();},scope:this});};},isAuthorized:function(roles){var authorized=true;if(this.authorizedRoles){authorized=false;if(!roles){roles="ROLE_ADMINISTRATOR";}
if(!Ext.isArray(roles)){roles=[roles];}
for(var i=roles.length-1;i>=0;--i){if(~this.authorizedRoles.indexOf(roles[i])){authorized=true;break;}}}
return authorized;},addLayerSource:function(options){var id=options.id||Ext.id(null,"gxp-source-");var source;var config=options.config;config.id=id;try{source=Ext.ComponentMgr.createPlugin(config,this.defaultSourceType);}catch(err){throw new Error("Could not create new source plugin with ptype: "+options.config.ptype);}
source.on({ready:{fn:function(){var callback=options.callback||Ext.emptyFn;callback.call(options.scope||this,id);},scope:this,single:true},failure:{fn:function(){var fallback=options.fallback||Ext.emptyFn;delete this.layerSources[id];fallback.apply(options.scope||this,arguments);},scope:this,single:true}});this.layerSources[id]=source;source.init(this);return source;},getSource:function(layerRec){return layerRec&&this.layerSources[layerRec.get("source")];},selectLayer:function(record){record=record||null;var changed=false;var allow=this.fireEvent("beforelayerselectionchange",record);if(allow!==false){changed=true;if(this.selectedLayer){this.selectedLayer.set("selected",false);}
this.selectedLayer=record;if(this.selectedLayer){this.selectedLayer.set("selected",true);}
this.fireEvent("layerselectionchange",record);}
return changed;}});Ext.reg('hr_gxplayerpanel',Heron.widgets.GXP_LayerPanel);Ext.namespace("Heron.widgets");Heron.widgets.HTMLPanel=Ext.extend(Ext.Panel,{initComponent:function(){Heron.widgets.HTMLPanel.superclass.initComponent.call(this);this.addListener('render',function(){this.loadMask=new Ext.LoadMask(this.body,{msg:__('Loading...')})});}});Ext.reg('hr_htmlpanel',Heron.widgets.HTMLPanel);Ext.namespace("Heron.widgets");Heron.widgets.Bookmarks=(function(){var contexts=undefined;var map=undefined;var bookmarksPanel=undefined;var instance={init:function(hroptions){},setMapContext:function(contextid,id){var elmm=Ext.getCmp(contextid);contexts=elmm.hropts;if(contexts){var map=Heron.App.getMap();for(var i=0;i<contexts.length;i++){if(contexts[i].id==id){if(contexts[i].x&&contexts[i].y&&contexts[i].zoom){map.setCenter(new OpenLayers.LonLat(contexts[i].x,contexts[i].y),contexts[i].zoom,false,true);}
else if(contexts[i].x&&contexts[i].y&&!contexts[i].zoom){map.setCenter(new OpenLayers.LonLat(contexts[i].x,contexts[i].y),map.getZoom(),false,true);}
else if(!(contexts[i].x&&contexts[i].y)&&contexts[i].zoom){map.setCenter(new OpenLayers.LonLat(map.center.lon,map.center.lat),contexts[i].zoom,false,true);}
if(contexts[i].layers){var mapLayers=map.layers;var ctxLayers=contexts[i].layers;var ctxName=contexts[i].name;if((ctxLayers.length)||(!ctxLayers.length&&ctxName.length)){if(!contexts[i].addLayers){for(var n=0;n<mapLayers.length;n++){if(mapLayers[n].getVisibility()){if(!mapLayers[n].isBaseLayer){mapLayers[n].setVisibility(false);}}}}
for(var m=0;m<ctxLayers.length;m++){for(n=0;n<mapLayers.length;n++){if(mapLayers[n].name==ctxLayers[m]){if(mapLayers[n].isBaseLayer){map.setBaseLayer(mapLayers[n]);}
mapLayers[n].setVisibility(true);}}}
if(map.baseLayer){map.setBaseLayer(map.baseLayer);}}}}}}},removeBookmark:function(contextid,id){var elmm=Ext.getCmp(contextid);elmm.removeBookmark(id);},setBookmarksPanel:function(abookmarksPanel){bookmarksPanel=abookmarksPanel;},getBookmarksPanel:function(){return bookmarksPanel;}};return(instance);})();Heron.widgets.BookmarksPanel=Ext.extend(Heron.widgets.HTMLPanel,{title:__('Bookmarks'),titleDescription:null,titleBookmarkProject:__("Project bookmarks"),titleBookmarkUser:__("Your bookmarks"),showProjectBookmarks:true,showUserBookmarks:true,autoProjectBookmarksTitle:true,autoUserBookmarksTitle:true,appBookmarkSign:null,autoScroll:true,bodyStyle:{overflow:'auto'},initComponent:function(){this.version=1;this.signature=this.appBookmarkSign;Heron.widgets.BookmarksPanel.superclass.initComponent.call(this);if(!this.titleDescription){this.titleDescription='';}
if(!this.titleBookmarkProject){this.titleBookmarkProject='';}
if(!this.titleBookmarkUser){this.titleBookmarkUser='';}
var contexts=undefined;var localStorageBookmarks=this.getlocalStorageBookmarks();if(localStorageBookmarks){contexts=this.hropts.concat(localStorageBookmarks);}
else{contexts=this.hropts;}
this.hropts=contexts;Heron.widgets.Bookmarks.init(contexts);if(this.showUserBookmarks){Heron.widgets.Bookmarks.setBookmarksPanel(this);}
this.createAddBookmarkWindow();this.addListener("afterrender",this.afterrender);},afterrender:function(){this.updateHtml(this.getHtml());},getHtml:function(){var firstProjectContext=true;var firstUserContext=true;var htmllines='<div class="hr-bookmark-panel-body">';var remove=__("Remove bookmark:");var restore=__("Restore map context:");var removeTooltip="";var restoreTooltip="";var divWidth=210;if(this.titleDescription.length){htmllines+='<div class="hr-bookmark-title-description">'+this.titleDescription+'</div>';}
if(this.el!==undefined){divWidth=this.getInnerWidth()-60;}
var contexts=this.hropts;if(typeof(contexts)!=="undefined"){for(var i=0;i<contexts.length;i++){if(contexts[i].id.substr(0,11)=="hr_bookmark"){if(this.showUserBookmarks){if(firstUserContext){if(!firstProjectContext){htmllines+='<div class="hr-bookmark-title-hr"><hr></div>';}
htmllines+='<div class="hr-bookmark-title-header">'+this.titleBookmarkUser+'</div>';firstUserContext=false;removeTooltip=remove;}
if(this.isValidBookmark(contexts[i])){restoreTooltip=restore+" '";if(contexts[i].desc+''!=''){restoreTooltip+=contexts[i].desc;}else{restoreTooltip+=contexts[i].name;}
restoreTooltip+="'";htmllines+='<div class="hr-bookmark-link-user" style="width: 80%;"><a href="#" id="'+contexts[i].id+'" title="'+restoreTooltip+'" onclick="Heron.widgets.Bookmarks.setMapContext(\''+this.id+"','"+contexts[i].id+'\'); return false;">'+contexts[i].name+'</a></div>';}
else{htmllines+='<div class="hr-bookmark-link-invalid" style="width: 80%;">'+contexts[i].name+'</div>';}
htmllines+='<div class="x-tool hr-bookmark-close-icon" title="'+removeTooltip+' \''+contexts[i].name+'\'" onclick="Heron.widgets.Bookmarks.removeBookmark(\''+this.id+"','"+contexts[i].id+'\')">&nbsp;</div>';}}
else{if(this.showProjectBookmarks){if(firstProjectContext){htmllines+='<div class="hr-bookmark-title-header">'+this.titleBookmarkProject+'</div>';firstProjectContext=false;}
if(contexts[i].desc.length){htmllines+='<div class="hr-bookmark-link-project"><a href="#" id="'+contexts[i].id+'" title="'+contexts[i].desc+'" onclick="Heron.widgets.Bookmarks.setMapContext(\''+this.id+"','"+contexts[i].id+'\'); return false;">'+contexts[i].name+'</a></div>';}else{htmllines+='<div class="hr-bookmark-link-project">&nbsp;</div>';}}}}}
if(this.showProjectBookmarks){if(firstProjectContext){if(!this.autoProjectBookmarksTitle){htmllines+='<div class="hr-bookmark-title-header">'+this.titleBookmarkProject+'</div>';firstProjectContext=false;}}}
if(this.showUserBookmarks){if(firstUserContext){if(!this.autoUserBookmarksTitle){if(!firstProjectContext){htmllines+='<div class="hr-bookmark-title-hr"><hr></div>';}
htmllines+='<div class="hr-bookmark-title-header">'+this.titleBookmarkUser+'</div>';}}}
htmllines+='</div>';return htmllines;},updateHtml:function(){this.update(this.getHtml());},onAddBookmark:function(){if(this.supportsHtml5Storage()){this.AddBookmarkWindow.show();}
else{Ext.Msg.alert(__('Warning'),__('Your browser does not support local storage for user-defined bookmarks'));}},addBookmark:function(){var strBookmarkMaxNr=localStorage.getItem("hr_bookmarkMax");if(strBookmarkMaxNr){var bookmarkmaxNr=Number(strBookmarkMaxNr);if(bookmarkmaxNr!==NaN){bookmarkmaxNr+=1;}
else{bookmarkmaxNr=1;}}
else{bookmarkmaxNr=1;}
this.scId='hr_bookmark'+bookmarkmaxNr;this.scName=this.edName.getValue();this.scDesc=this.edDesc.getValue();if(!this.scName||this.scName.length==0){Ext.Msg.alert(__('Warning'),__('Bookmark name cannot be empty'));return false;}
this.getMapContent();var newbookmark={id:this.scId,version:this.version,signature:this.signature,type:'bookmark',name:this.scName,desc:this.scDesc,layers:this.scvisibleLayers,x:this.scX,y:this.scY,zoom:this.scZoom,units:this.scUnits,projection:this.scProjection};var newbookmarkJSON=Ext.encode(newbookmark);localStorage.setItem(this.scId,newbookmarkJSON);localStorage.setItem("hr_bookmarkMax",bookmarkmaxNr);this.hropts.push(newbookmark);this.updateHtml();return true;},removeBookmark:function(id){localStorage.removeItem(id);var strBookmarkMaxNr=localStorage.getItem("hr_bookmarkMax")
var bookmarkmaxNr=Number(strBookmarkMaxNr)
if(bookmarkmaxNr==Number(id.substr(4))){bookmarkmaxNr-=1
localStorage.setItem("hr_bookmarkMax",bookmarkmaxNr)}
var contexts=this.hropts;var newcontexts=new Array();for(var i=0;i<contexts.length;i++){if(contexts[i].id!==id){newcontexts.push(contexts[i]);}}
this.hropts=newcontexts;this.updateHtml();},getlocalStorageBookmarks:function(){if(!this.supportsHtml5Storage()){return null;}
var bookmarkmaxNr=localStorage.getItem("hr_bookmarkMax");if(bookmarkmaxNr){var bookmarks=new Array();for(var index=1;index<=bookmarkmaxNr;index++){var bookmarkJSON=localStorage.getItem("hr_bookmark"+index);if(bookmarkJSON){try{var bookmark=Ext.decode(bookmarkJSON)
if(bookmark.signature){if(bookmark.signature==this.appBookmarkSign){bookmarks.push(bookmark);}}else{if(!this.appBookmarkSign){bookmarks.push(bookmark);}}}catch(err){}}}
return bookmarks;}
return null;},isValidBookmark:function(context){var map=Heron.App.getMap();if(context.layers){var mapLayers=map.layers;var ctxLayers=context.layers;for(var m=0;m<ctxLayers.length;m++){var layerPresent=false;for(var n=0;n<mapLayers.length;n++){if(mapLayers[n].name==ctxLayers[m]){layerPresent=true;break;}}
if(!layerPresent){return false;}}}
if(context.projection!==map.getProjection()){return false;}
if(context.units!==map.units){return false;}
var maxExtent=map.maxExtent;if(context.x<maxExtent.left&&context.x>maxExtent.right){return false;}
if(context.y<maxExtent.bottom&&context.y>maxExtent.top){return false;}
if(context.zoom>map.numZoomLevels){return false;}
return true;},getMapContent:function(){var map=Heron.App.getMap();var mapCenter=map.getCenter();this.scUnits=map.units;this.scProjection=map.getProjection();this.scX=mapCenter.lon;this.scY=mapCenter.lat;this.scZoom=map.getZoom();var mapLayers=map.layers;this.scvisibleLayers=new Array();for(var n=0;n<mapLayers.length;n++){if(mapLayers[n].getVisibility()&&mapLayers[n].CLASS_NAME!='OpenLayers.Layer.Vector.RootContainer'){this.scvisibleLayers.push(mapLayers[n].name);}}},createAddBookmarkWindow:function(){var labelWidth=80;var fieldWidth=300;var formPanel=new Ext.form.FormPanel({title:"",baseCls:'x-plain',autoHeight:true,defaultType:"textfield",labelWidth:labelWidth,anchor:"100%",items:[{id:"ed_name",fieldLabel:__("Name"),displayField:"Name",width:fieldWidth,enableKeyEvents:true,listeners:{keyup:function(textfield,ev){this.onNameKeyUp(textfield,ev);},scope:this}},{id:"ed_desc",fieldLabel:__("Description"),displayField:"Decription",width:fieldWidth}]});this.AddBookmarkWindow=new Ext.Window({title:__("Add a bookmark"),width:420,autoHeight:true,plain:true,statefull:true,stateId:"ZoomToWindow",bodyStyle:"padding: 5px;",buttonAlign:"center",resizable:false,closeAction:"hide",items:[formPanel],listeners:{show:function(){this.onShowWindow();},scope:this},buttons:[{id:"btn_add",text:__("Add"),disabled:true,handler:function(){if(this.addBookmark()){this.AddBookmarkWindow.hide();}},scope:this},{name:"btn_cancel",text:__("Cancel"),handler:function(){this.AddBookmarkWindow.hide();},scope:this}]});this.edName=Ext.getCmp("ed_name");this.edDesc=Ext.getCmp("ed_desc");this.btnAdd=Ext.getCmp("btn_add");},onNameKeyUp:function(textfield,ev){var value=this.edName.getValue();if(value&&OpenLayers.String.trim(value).length>0){this.btnAdd.enable();}
else{this.btnAdd.disable();}},onShowWindow:function(){this.edName.setValue('');this.edDesc.setValue('');this.edName.focus(false,200);},supportsHtml5Storage:function(){try{return'localStorage'in window&&window['localStorage']!==null;}catch(e){return false;}}});Ext.reg('hr_bookmarkspanel',Heron.widgets.BookmarksPanel);Ext.reg('hr_contextbrowserpanel',Heron.widgets.BookmarksPanel);Ext.namespace("Heron.tree");Heron.tree.UserLayerContainer=Ext.extend(GeoExt.tree.LayerContainer,{text:__('User-Added Layers'),initialLoad:false,constructor:function(config){config=Ext.applyIf(config||{},{text:this.text,loader:{}});var self=this;config.loader=Ext.applyIf(config.loader,{baseAttrs:Ext.applyIf(config.loader.baseAttrs||{},{iconCls:'hr-tree-node-icon-layer-raster'}),filter:function(record){var layer=record.getLayer();if(this.initialLoad===false){self.ui.hide();}
var hasSource=record.data.source;if(hasSource!==undefined){self.ui.show();this.initialLoad=true;return true;}
return false;}});Heron.tree.UserLayerContainer.superclass.constructor.call(this,config);if(this.ui){this.ui.hide();}}});Ext.tree.TreePanel.nodeTypes.hr_userlayercontainer=Heron.tree.UserLayerContainer;Ext.namespace("Heron.widgets");Heron.widgets.LayerTreePanel=Ext.extend(Ext.tree.TreePanel,{title:__('Layers'),textbaselayers:__('Base Layers'),textoverlays:__('Overlays'),lines:false,ordering:'none',layerIcons:'bylayertype',useMapContext:false,layerResolutions:{},appliedResolution:0.0,autoScroll:true,enableDD:true,plugins:[{ptype:"gx_treenodecomponent"}],contextMenu:null,blnCustomLayerTree:false,jsonTreeConfig:null,initComponent:function(){var layerTreePanel=this;var treeConfig;if(this.useMapContext){var context=Heron.App.getMapContext();this.tree=context.layerTree;}
Ext.apply(this,this.hropts);if(this.tree){this.blnCustomLayerTree=true;treeConfig=this.tree;}else{treeConfig=[{nodeType:"gx_baselayercontainer",text:this.textbaselayers,expanded:true},{nodeType:"gx_overlaylayercontainer",text:this.textoverlays}]}
this.jsonTreeConfig=new OpenLayers.Format.JSON().write(treeConfig,true);var LayerNodeUI=Ext.extend(GeoExt.tree.LayerNodeUI,new GeoExt.tree.TreeNodeUIEventMixin());var options={title:this.title,autoScroll:true,containerScroll:true,loader:new Ext.tree.TreeLoader({applyLoader:false,uiProviders:{"custom_ui":LayerNodeUI},createNode:function(attr){return layerTreePanel.createNode(this,attr);}}),root:{nodeType:"async",baseAttrs:{uiProvider:"custom_ui"},children:Ext.decode(this.jsonTreeConfig)},rootVisible:false,enableDD:this.enableDD,lines:this.lines,listeners:{contextmenu:function(node,e){node.select();var cm=this.contextMenu;if(cm){cm.contextNode=node;cm.showAt(e.getXY());}},beforemovenode:function(tree,node,oldParent,newParent,index){this.oldNodeNr=this.getNodePosition(tree,node);},movenode:function(tree,node,oldParent,newParent,index){this.newNodeNr=this.getNodePosition(tree,node);if((this.blnCustomLayerTree==true)&&(this.ordering=='TopBottom')){if(node.layer!=undefined&&node.attributes.checked==true){this.setLayerOrder(node);}else{var direction=this.oldNodeNr<this.newNodeNr?'down':'up';this.setLayerOrderFolder(node,direction);}}},checkchange:function(node,checked){if((this.blnCustomLayerTree==true)&&(this.ordering=='TopBottom')){this.setLayerOrder(node);}},scope:this}};if(this.contextMenu){var cmArgs=this.contextMenu instanceof Array?{items:this.contextMenu}:{};this.contextMenu=new Heron.widgets.LayerNodeContextMenu(cmArgs);}
Ext.apply(this,options);Heron.widgets.LayerTreePanel.superclass.initComponent.call(this);this.addListener("beforedblclick",this.onBeforeDblClick);this.addListener("afterrender",this.onAfterRender);this.addListener("expandnode",this.onExpandNode);},createNode:function(treeLoader,attr){var mapPanel=Heron.App.getMapPanel();if(!mapPanel||!attr.layer||(this.layerIcons=='default'&&!attr.legend)){return Ext.tree.TreeLoader.prototype.createNode.call(treeLoader,attr);}
var layer=undefined;if(mapPanel&&mapPanel.layers instanceof GeoExt.data.LayerStore){var layerStore=mapPanel.layers;var layerIndex=layerStore.findExact('title',attr.layer);if(layerIndex>=0){var layerRecord=layerStore.getAt(layerIndex);layer=layerRecord.getLayer();}}
if(this.layerIcons=='none'){attr.iconCls='hr-tree-node-icon-none';}
if(layer){var layerType=layer.CLASS_NAME.split('.').slice(-1)[0];if(this.layerIcons=='bylayertype'&&!(attr.iconCls||attr.cls||attr.icon)){var layerKind='raster';if(layerType=='Vector'){layerKind='vector';if(layer.protocol&&layer.protocol.format&&layer.protocol.format.CLASS_NAME&&layer.protocol.format.CLASS_NAME.indexOf('Atom')>-1){layerKind='atom';}}
attr.iconCls='hr-tree-node-icon-layer-'+layerKind;}
if(attr.legend){attr.uiProvider="custom_ui";var xtype=layerType=='Vector'?'gx_vectorlegend':'gx_wmslegend';attr.component={xtype:xtype,layerRecord:layerRecord,showTitle:false,cls:"hr-treenode-legend",hidden:!layer.getVisibility()}}}
return Ext.tree.TreeLoader.prototype.createNode.call(treeLoader,attr);},onBeforeDblClick:function(node,evt){return false;},onExpandNode:function(node){for(var i=0;i<node.childNodes.length;i++){var child=node.childNodes[i];if(child.leaf){this.setNodeEnabling(child,Heron.App.getMap());}}},onAfterRender:function(){var self=this;var map=Heron.App.getMap();self.applyMapMoveEnd();map.events.register('moveend',null,function(evt){self.applyMapMoveEnd();});this.setInitialLayerOrder(this.root.attributes);},applyMapMoveEnd:function(){var map=Heron.App.getMap();if(map){if(map.resolution!=this.appliedResolution){this.setNodeEnabling(this.getRootNode(),map);this.appliedResolution=map.resolution;}}},setNodeEnabling:function(rootNode,map){rootNode.cascade(function(node){var layer=node.layer;if(!layer){return;}
var layerMinResolution=layer.minResolution?layer.minResolution:map.resolutions[map.resolutions.length-1];var layerMaxResolution=layer.maxResolution?layer.maxResolution:map.resolutions[0];node.enable();if(map.resolution<layerMinResolution||map.resolution>layerMaxResolution){node.disable();}});},logMapLayers:function(action){console.log("Action: "+action);var map=Heron.App.getMap();for(var i=0;i<map.layers.length;i++){console.log(i+": "+map.layers[i].name);}},getBaseLayerCount:function(map){var intBaseLayers=0;for(var i=0;i<map.layers.length;i++){if(map.layers[i].isBaseLayer){intBaseLayers++;}}
return intBaseLayers;},setInitialLayerOrder:function(){if((this.blnCustomLayerTree==true)&&(this.ordering=='TopBottom')){if(this.root!=null){this.intLayer=-1;this.setVisibleLayersOrder(this.root.attributes);}}},setVisibleLayersOrder:function(child){var map=Heron.App.getMap();if(child.layer!=undefined){if(child.checkedGroup!="gx_baselayer"){var intLayerNew=0;if(child.checked==true){this.intLayer++;intLayerNew=map.layers.length-this.intLayer-1;}else{intLayerNew=this.getBaseLayerCount(map);}
map.setLayerIndex(map.getLayersByName(child.layer)[0],intLayerNew);}}else if(child.children.length>0){for(var i=0;i<child.children.length;i++){this.setVisibleLayersOrder(child.children[i]);}}},setLayerOrder:function(node){var map=Heron.App.getMap();var intLayerNr=0;if(node.attributes.checked==true){intLayerNr=this.getLayerNrInTree(node.layer.name);intLayerNr=map.layers.length-intLayerNr;}else{intLayerNr=this.getBaseLayerCount(map);}
map.setLayerIndex(node.layer,intLayerNr);},setLayerOrderFolder:function(node,direction){if(node.layer!=undefined&&node.attributes.checked==true){this.setLayerOrder(node);}else{if(direction=='up'){for(var i=0;i<node.childNodes.length;i++){this.setLayerOrderFolder(node.childNodes[i]);}}else{for(var j=node.childNodes.length-1;j>=0;j--){this.setLayerOrderFolder(node.childNodes[j]);}}}},getLayerNrInTree:function(layerName){var treePanel=Heron.App.topComponent.findByType('hr_layertreepanel')[0];this.intLayer=-1;var blnFound=false;if(treePanel!=null){var treeRoot=treePanel.root;if(treeRoot.childNodes.length>0){for(var intTree=0;intTree<treeRoot.childNodes.length;intTree++){if(blnFound==false){blnFound=this.findLayerInNode(layerName,treeRoot.childNodes[intTree],blnFound)}}}}
return blnFound?this.intLayer:-1;},findLayerInNode:function(layerName,node,blnFound){if(blnFound==false){if(node.layer!=undefined){if(node.attributes.checked){this.intLayer++;}
if(node.layer==layerName||node.layer.name==layerName){blnFound=true;}}else{for(var i=0;i<node.childNodes.length;i++){blnFound=this.findLayerInNode(layerName,node.childNodes[i],blnFound);}}}
return blnFound;},getNodePosition:function(tree,node){this.NodeNr=-1;this.findNodePosition(tree.root,node.id,false);return this.NodeNr;},findNodePosition:function(node,id,blnFound){if(blnFound==false){this.NodeNr++;if(node.id==id){blnFound=true;}else if(node.childNodes!='undefined'){for(var i=0;i<node.childNodes.length;i++){blnFound=this.findNodePosition(node.childNodes[i],id,blnFound);}}}
return blnFound;}});Ext.reg('hr_layertreepanel',Heron.widgets.LayerTreePanel);Ext.namespace("Heron.widgets");Heron.widgets.LayerCombo=Ext.extend(Ext.form.ComboBox,{map:null,store:null,emptyText:__('Choose a Layer'),tooltip:__('Choose a Layer'),sortOrder:'ASC',selectFirst:false,hideTrigger:false,layerFilter:function(map){return map.layers;},displayField:'name',forceSelection:true,triggerAction:'all',mode:'local',editable:false,initComponent:function(){if(!this.map){this.map=Heron.App.getMap();}
this.store=this.createLayerStore(this.layerFilter(this.map));this.displayField=this.store.fields.keys[1];if(this.selectFirst){var record=this.store.getAt(0);if(record){this.selectedLayer=record.getLayer();this.value=record.get('title');}}
if(!this.width){this.width=this.listWidth='auto';}
if(Ext.isIE&&this.listWidth=='auto'){this.listWidth=160;}
Heron.widgets.LayerCombo.superclass.initComponent.apply(this,arguments);this.addEvents({'selectlayer':true});if(this.initialValue){this.setValue(this.initialValue);}
this.on('select',function(combo,record,idx){this.selectedLayer=record.getLayer(idx);this.fireEvent('selectlayer',this.selectedLayer);},this);},createLayerStore:function(layers){return new GeoExt.data.LayerStore({layers:layers,sortInfo:this.sortOrder?{field:'title',direction:this.sortOrder}:null});},setLayers:function(layers){var store=this.createLayerStore(layers);this.bindStore(store,false);},resizeToFitContent:function(){if(!this.elMetrics){this.elMetrics=Ext.util.TextMetrics.createInstance(this.getEl());}
var m=this.elMetrics,width=0,el=this.el,s=this.getSize();this.store.each(function(r){var text=r.get(this.displayField);width=Math.max(width,m.getWidth(text));},this);if(el){width+=el.getBorderWidth('lr');width+=el.getPadding('lr');}
if(this.trigger){width+=this.trigger.getWidth();}
s.width=width;this.setSize(s);this.store.on({'datachange':this.resizeToFitContent,'add':this.resizeToFitContent,'remove':this.resizeToFitContent,'load':this.resizeToFitContent,'update':this.resizeToFitContent,buffer:10,scope:this});},listeners:{render:function(c){c.el.set({qtip:this.tooltip});c.trigger.set({qtip:this.tooltip});if(this.width=='auto'){c.resizeToFitContent();}}}});Ext.reg('hr_layercombo',Heron.widgets.LayerCombo);Ext.namespace("Heron.widgets");Heron.widgets.BaseLayerCombo=Ext.extend(Heron.widgets.LayerCombo,{emptyText:__('Choose a Base Layer'),tooltip:__('BaseMaps'),layerFilter:function(map){return map.getLayersBy('isBaseLayer',true);},initComponent:function(){if(this.initialConfig.map!==null&&this.initialConfig.map instanceof OpenLayers.Map&&this.initialConfig.map.allOverlays===false){this.map=this.initialConfig.map;this.on('selectlayer',function(layer){this.map.setBaseLayer(layer);},this);this.map.events.register('changebaselayer',this,function(obj){this.setValue(obj.layer.name);});this.initialValue=this.map.baseLayer.name;}
Heron.widgets.BaseLayerCombo.superclass.initComponent.apply(this,arguments);}});Ext.reg('hr_baselayer_combobox',Heron.widgets.BaseLayerCombo);Ext.namespace("Heron.widgets");Heron.widgets.LayerLegendPanel=Ext.extend(GeoExt.LegendPanel,{title:__('Legend'),bodyStyle:'padding:5px',autoScroll:true,defaults:{useScaleParameter:false,baseParams:{}},dynamic:true,legendFromCapabilities:false,legendFromCapabilitiesPatterns:['dino'],initComponent:function(){if(this.hropts){this.prefetchLegends=this.hropts.prefetchLegends;}
Heron.widgets.LayerLegendPanel.superclass.initComponent.call(this);},onRender:function(){Heron.widgets.LayerLegendPanel.superclass.onRender.apply(this,arguments);this.layerStore.addListener("update",this.onUpdateLayerStore,this);},onUpdateLayerStore:function(store,record,index){this.addLegend(record,index);},addLegend:function(record,index){record.store=this.layerStore;var layer=record.getLayer();if(!layer.metadata.legend){layer.metadata.legend={};}
var layerLegendMD=layer.metadata.legend;if(layer.noLegend){layer.hideInLegend=layerLegendMD.hideInLegend=true;}
if(layerLegendMD.hideInLegend&&!record.get('hideInLegend')){record.set('hideInLegend',true);}
if(layer.legendURL){layerLegendMD.legendURL=layer.legendURL;}
if(layerLegendMD.legendURL&&!record.get('legendURL')){record.set('legendURL',layerLegendMD.legendURL);}
var legend=undefined;if(this.items){legend=this.getComponent(this.getIdForLayer(layer));}
if((this.prefetchLegends&&!legend)||(((layer.map&&layer.visibility)||layer.getVisibility())&&!legend&&!layerLegendMD.hideInLegend)){if(layer.params&&layer.params.LAYERS&&this.hasLegendUrlFromCapabilities(layer)&&!record.get("legendURL"))
{var legendURL=this.getLegendUrlFromCapabilities(layer.url,layer.params.LAYERS);record.data['legendURL']=legendURL;}
Heron.widgets.LayerLegendPanel.superclass.addLegend.apply(this,arguments);this.doLayout();}
this.doLayout();},onListenerDoLayout:function(node){node.doLayout();},hasLegendUrlFromCapabilities:function(layer){if(this.legendFromCapabilities){return true;}
var result=false;if(this.legendFromCapabilitiesPatterns&&this.legendFromCapabilitiesPatterns.length>0){for(var i=0;i<this.legendFromCapabilitiesPatterns.length;i++){if(layer.url.indexOf(this.legendFromCapabilitiesPatterns[i].toLowerCase())>=0){result=true;break;}}}
return result;},getLegendUrlFromCapabilities:function(serviceUrl,layerName,styleName){var layerCaps=Heron.data.OWSCapabilitiesCache.getInstance().getWMSLayerCapability(serviceUrl,layerName,{async:false});if(!layerCaps){console.log("No layerCaps found for url "+serviceUrl+" and layerName "+layerName);return null;}
var legendUrl;try{var styles=layerCaps.styles;var style;if(!styleName){style=styles[0];}else{for(var i=0;i<styles.length;i++){if(styleName==styles[i].name){style=styles[i];break;}}}
legendUrl=style.legend.href;}
catch(e){}
if(!legendUrl){console.log("No legendURL found in capabilities for layer "+layerName+" and style "+styleName);}
return legendUrl;},listeners:{activate:function(node){this.onListenerDoLayout(this);},expand:function(node){this.onListenerDoLayout(this);}}});Ext.reg('hr_layerlegendpanel',Heron.widgets.LayerLegendPanel);OpenLayers.Control.LoadingPanel=OpenLayers.Class(OpenLayers.Control,{counter:0,maximized:false,visible:true,initialize:function(options){OpenLayers.Control.prototype.initialize.apply(this,[options]);},setVisible:function(visible){this.visible=visible;if(visible){OpenLayers.Element.show(this.div);}else{OpenLayers.Element.hide(this.div);}},getVisible:function(){return this.visible;},hide:function(){this.setVisible(false);},show:function(){this.setVisible(true);},toggle:function(){this.setVisible(!this.getVisible());},addLayer:function(evt){if(evt.layer){evt.layer.events.register('loadstart',this,this.increaseCounter);evt.layer.events.register('loadend',this,this.decreaseCounter);}},removeLayer:function(evt){if(evt.layer){evt.layer.events.unregister('loadstart',this,this.increaseCounter);evt.layer.events.unregister('loadend',this,this.decreaseCounter);}},getWaitText:function(){return __("Waiting for")+' '+this.counter+' '+(this.counter<=1?__('service'):__('services'));},setMap:function(map){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register('preaddlayer',this,this.addLayer);this.map.events.register('removelayer',this,this.removeLayer);for(var i=0;i<this.map.layers.length;i++){var layer=this.map.layers[i];layer.events.register('loadstart',this,this.increaseCounter);layer.events.register('loadend',this,this.decreaseCounter);}},increaseCounter:function(){this.counter++;if(this.counter>0){this.div.innerHTML=this.getWaitText();if(!this.maximized&&this.visible){this.maximizeControl();}}},decreaseCounter:function(){if(this.counter>0){this.div.innerHTML=this.getWaitText();this.counter--;}
if(this.counter==0){if(this.maximized&&this.visible){this.minimizeControl();}}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);return this.div;},minimizeControl:function(evt){this.div.style.display="none";this.maximized=false;if(evt!=null){OpenLayers.Event.stop(evt);}},maximizeControl:function(evt){this.div.style.display="block";this.maximized=true;if(evt!=null){OpenLayers.Event.stop(evt);}},destroy:function(){if(this.map){this.map.events.unregister('preaddlayer',this,this.addLayer);if(this.map.layers){for(var i=0;i<this.map.layers.length;i++){var layer=this.map.layers[i];layer.events.unregister('loadstart',this,this.increaseCounter);layer.events.unregister('loadend',this,this.decreaseCounter);}}}
OpenLayers.Control.prototype.destroy.apply(this,arguments);},CLASS_NAME:"OpenLayers.Control.LoadingPanel"});OpenLayers.Control.StyleFeature=OpenLayers.Class(OpenLayers.Control.Button,{layer:null,initialize:function(layer,options){this.layer=layer;this.options=options?options:{};this.title=__('Change feature styles');OpenLayers.Control.Button.prototype.initialize.apply(this,[options]);this.trigger=this.toggleStyleEditor;this.displayClass="oleControlEnabled "+this.displayClass;},toggleStyleEditor:function(){if(!gxp||!gxp.VectorStylesDialog){Ext.Msg.alert(__('Warning'),__('Vector Layer style editing requires GXP with VectorStylesDialog'));return;}
var layerRecord=Heron.App.getMapPanel().layers.getByLayer(this.layer);if(!this.styleEditor){this.styleEditor=new Ext.Window({layout:'auto',resizable:false,autoHeight:true,pageX:this.options.pageX?this.options.pageX:100,pageY:this.options.pageY?this.options.pageY:200,width:this.options.width?this.options.width:400,height:this.options.height?this.options.height:undefined,closeAction:'hide',title:__('Style Editor (Vector)'),items:[gxp.VectorStylesDialog.createVectorStylerConfig(layerRecord)]});}
if(!this.styleEditor.isVisible()){this.styleEditor.show();}else{this.styleEditor.hide();}},CLASS_NAME:"OpenLayers.Control.StyleFeature"});if(OpenLayers.Editor&&OpenLayers.Editor.Control){OpenLayers.Editor.Control.StyleFeature=OpenLayers.Class(OpenLayers.Control.StyleFeature,{initialize:function(layer,options){OpenLayers.Control.StyleFeature.prototype.initialize.apply(this,[layer,options]);},CLASS_NAME:"OpenLayers.Editor.Control.StyleFeature"});}
Ext.namespace("Heron.widgets");Heron.widgets.MapPanelOptsDefaults={center:'0,0',map:{units:'degrees',maxExtent:'-180,-90,180,90',extent:'-180,-90,180,90',maxResolution:0.703125,numZoomLevels:20,zoom:1,allOverlays:false,fractionalZoom:false,permalinks:{paramPrefix:'map',encodeType:false,prettyLayerNames:true},controls:[new OpenLayers.Control.Attribution(),new OpenLayers.Control.ZoomBox(),new OpenLayers.Control.Navigation({dragPanOptions:{enableKinetic:true}}),new OpenLayers.Control.LoadingPanel(),new OpenLayers.Control.PanPanel(),new OpenLayers.Control.ZoomPanel()]}};Heron.widgets.MapPanel=Ext.extend(GeoExt.MapPanel,{useMapContext:false,initComponent:function(){var gxMapPanelOptions={id:"gx-map-panel",split:false,layers:this.hropts.layers,items:this.items?this.items:[{xtype:"gx_zoomslider",vertical:true,height:150,x:18,y:85,aggressive:false,plugins:new GeoExt.ZoomSliderTip({template:__("Scale")+": 1 : {scale}<br>"+
__("Resolution")+": {resolution}<br>"+
__("Zoom")+": {zoom}"})}],statusbar:[{type:"epsgpanel"},{type:"-"},{type:"xcoord"},{type:"ycoord"},{type:"-"},{type:"measurepanel"}],tbar:new Ext.Toolbar({enableOverflow:true,items:[]}),bbar:new Ext.Toolbar({enableOverflow:true,items:[]})};if(this.hropts.hasOwnProperty("statusbar")){if(this.hropts.statusbar){Ext.apply(gxMapPanelOptions.statusbar,this.hropts.statusbar);}else{gxMapPanelOptions.statusbar={};}}
Ext.apply(gxMapPanelOptions,Heron.widgets.MapPanelOptsDefaults);if(this.useMapContext){var context=Heron.App.getMapContext(this.context);this.hropts.settings=context.map.settings;this.hropts.layers=context.map.layers;}
if(this.hropts.settings){Ext.apply(gxMapPanelOptions.map,this.hropts.settings);}
if(gxMapPanelOptions.map.controls&&typeof gxMapPanelOptions.map.controls=="string"){gxMapPanelOptions.map.controls=undefined;}
if(typeof gxMapPanelOptions.map.maxExtent=="string"){gxMapPanelOptions.map.maxExtent=OpenLayers.Bounds.fromString(gxMapPanelOptions.map.maxExtent);gxMapPanelOptions.maxExtent=gxMapPanelOptions.map.maxExtent;}
if(typeof gxMapPanelOptions.map.extent=="string"){gxMapPanelOptions.map.extent=OpenLayers.Bounds.fromString(gxMapPanelOptions.map.extent);gxMapPanelOptions.extent=gxMapPanelOptions.map.extent;}
if(!gxMapPanelOptions.map.center){gxMapPanelOptions.map.center=OpenLayers.LonLat.fromString('0,0');}else if(typeof gxMapPanelOptions.map.center=="string"){gxMapPanelOptions.map.center=OpenLayers.LonLat.fromString(gxMapPanelOptions.map.center);}
gxMapPanelOptions.center=gxMapPanelOptions.map.center;if(gxMapPanelOptions.map.zoom){gxMapPanelOptions.zoom=gxMapPanelOptions.map.zoom;}
if(gxMapPanelOptions.map.controls){gxMapPanelOptions.controls=gxMapPanelOptions.map.controls;}
gxMapPanelOptions.map.layers=this.hropts.layers;Ext.apply(this,gxMapPanelOptions);var layer,prependLayer;if(gxMapPanelOptions.map.allOverlays&&gxMapPanelOptions.map.layers&&(gxMapPanelOptions.map.layers[0].minResolution||gxMapPanelOptions.map.layers[0].maxResolution)){var j=0,layers=gxMapPanelOptions.map.layers;for(j=0;j<layers.length;j++){layer=layers[j];if(!layer.minResolution&&!layer.maxResolution){prependLayer=layer;break;}}
if(prependLayer){layers.splice(j,1);layers.unshift(prependLayer);}}
if(this.layers){for(var i=0;i<this.layers.length;i++){if(this.layers[i]instanceof Array){try{this.layers[i]=Heron.Utils.createOLObject(this.layers[i]);}catch(err){Ext.Msg.alert(__('Warning'),__('Error creating Layer')+" - num="+i+" msg="+err.message+" args="+this.layers[i]);}}}}
if(this.map.permalinks){this.prettyStateKeys=this.map.permalinks.prettyLayerNames;this.stateId=this.map.permalinks.paramPrefix;this.permalinkProvider=new GeoExt.state.PermalinkProvider({encodeType:this.map.permalinks.encodeType});Ext.state.Manager.setProvider(this.permalinkProvider);}
Heron.widgets.MapPanel.superclass.initComponent.call(this);if(this.hropts.settings&&this.hropts.settings.formatX){this.formatX=this.hropts.settings.formatX;}
if(this.hropts.settings&&this.hropts.settings.formatY){this.formatY=this.hropts.settings.formatY;}
Heron.App.setMap(this.getMap());Heron.App.setMapPanel(this);Heron.widgets.ToolbarBuilder.build(this,this.hropts.toolbar,this.getTopToolbar());Heron.widgets.ToolbarBuilder.build(this,gxMapPanelOptions.statusbar,this.getBottomToolbar());},formatX:function(lon,precision){return"X: "+lon.toFixed(precision);},formatY:function(lat,precision){return"Y: "+lat.toFixed(precision);},getPermalink:function(){return this.permalinkProvider.getLink();},getMap:function(){return this.map;},afterRender:function(){Heron.widgets.MapPanel.superclass.afterRender.apply(this,arguments);var xy_precision=3;if(this.hropts&&this.hropts.settings&&this.hropts.settings.hasOwnProperty('xy_precision')){xy_precision=this.hropts.settings.xy_precision;}
var formatX=this.formatX;var formatY=this.formatY;var onMouseMove=function(e){var lonLat=this.getLonLatFromPixel(e.xy);if(!lonLat){return;}
if(this.displayProjection){lonLat.transform(this.getProjectionObject(),this.displayProjection);}
var xcoord=Ext.getCmp("x-coord");if(xcoord){xcoord.setText(formatX(lonLat.lon,xy_precision));}
var ycoord=Ext.getCmp("y-coord");if(ycoord){ycoord.setText(formatY(lonLat.lat,xy_precision));}};var map=this.getMap();map.events.register("mousemove",map,onMouseMove);var epsgTxt=map.getProjection();if(epsgTxt){var epsg=Ext.getCmp("map-panel-epsg");if(epsg){epsg.setText(epsgTxt);}}}});Ext.reg('hr_mappanel',Heron.widgets.MapPanel);Ext.namespace("Heron.widgets");Heron.widgets.MenuHandler=(function(){var options=null;function getContainer(){return Ext.getCmp(options.pageContainer);}
function loadPage(page){var container=Ext.getCmp(options.pageContainer);if(page&&container&&options.pageRoot){container.load(options.pageRoot+'/'+page+'.html?t='+new Date().getMilliseconds());}}
function loadURL(url){var container=Ext.getCmp(options.pageContainer);if(url&&container){container.load({url:url,nocache:true,scripts:true});}}
function setActiveCard(card){if(card&&options.cardContainer){Ext.getCmp(options.cardContainer).getLayout().setActiveItem(card);}}
var instance={init:function(hroptions){if(hroptions&&!options){options=hroptions;setActiveCard(options.defaultCard);loadPage(options.defaultPage);}},onSelect:function(item){setActiveCard(item.card);if(item.page){loadPage(item.page);}else if(item.url){loadURL(item.url)}},onLinkSelect:function(card,page){if(card){setActiveCard(card);}
if(page){loadPage(page);}}};return(instance);})();Heron.widgets.MenuPanel=Ext.extend(Ext.Panel,{initComponent:function(){this.addListener('afterrender',function(){if(this.hropts){Heron.widgets.MenuHandler.init(this.hropts);}});Heron.widgets.MenuPanel.superclass.initComponent.apply(this,arguments);}});Ext.reg('hr_menupanel',Heron.widgets.MenuPanel);Ext.namespace("Heron.widgets");Heron.widgets.MultiLayerNode=Ext.extend(GeoExt.tree.LayerNode,{layerNames:[],layers:[],constructor:function(config){if(config.layers){this.layerNames=config.layers.split(",");if(this.layerNames[0]){arguments[0].layer=this.layerNames[0];}}
for(var i=0;i<this.layerNames.length;i++){if(!this.layerStore||this.layerStore=="auto"){this.layerStore=GeoExt.MapPanel.guess().layers;}
var j=this.layerStore.findBy(function(o){return o.get("title")==this.layerNames[i];},this);if(j!=-1){this.layers[i]=this.layerStore.getAt(j).getLayer();}}
Heron.widgets.MultiLayerNode.superclass.constructor.apply(this,arguments);},render:function(bulkRender){this.layer=this.layers[0];Heron.widgets.MultiLayerNode.superclass.render.apply(this,arguments);},onLayerVisibilityChanged:function(){this.layer=this.layers[0];Heron.widgets.MultiLayerNode.superclass.onLayerVisibilityChanged.apply(this,arguments);},onCheckChange:function(node,checked){for(var i=0;i<this.layers.length;i++){this.layer=this.layers[i];Heron.widgets.MultiLayerNode.superclass.onCheckChange.apply(this,arguments);}},onStoreAdd:function(store,records,index){for(var i=0;i<this.layers.length;i++){this.layer=this.layers[i];Heron.widgets.MultiLayerNode.superclass.onStoreAdd.apply(this,arguments);}},onStoreRemove:function(store,record,index){for(var i=0;i<this.layers.length;i++){this.layer=this.layers[i];Heron.widgets.MultiLayerNode.superclass.onStoreRemove.apply(this,arguments);}},onStoreUpdate:function(store,record,operation){for(var i=0;i<this.layers.length;i++){this.layer=this.layers[i];Heron.widgets.MultiLayerNode.superclass.onStoreUpdate.apply(this,arguments);}},destroy:function(){for(var i=0;i<this.layers.length;i++){this.layer=this.layers[i];Heron.widgets.MultiLayerNode.superclass.destroy.apply(this,arguments);}}});Ext.tree.TreePanel.nodeTypes.hr_multilayer=Heron.widgets.MultiLayerNode;Ext.namespace("Heron.widgets.search");Heron.widgets.search.OpenLSSearchCombo=Ext.extend(Ext.form.ComboBox,{map:null,width:240,listWidth:400,loadingText:__('Searching...'),emptyText:__('Search with OpenLS'),zoom:8,minChars:4,queryDelay:200,maxRows:'10',url:'http://geodata.nationaalgeoregister.nl/geocoder/Geocoder?',hideTrigger:true,displayField:'text',forceSelection:false,autoSelect:false,queryParam:'zoekterm',initComponent:function(){Heron.widgets.search.OpenLSSearchCombo.superclass.initComponent.apply(this,arguments);this.store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:this.url,method:'GET'}),fields:[{name:"lon",type:"number"},{name:"lat",type:"number"},"text"],reader:new Heron.data.OpenLS_XLSReader()});if(this.zoom>0){this.on("select",function(combo,record,index){this.setValue(record.data.text);var position=new OpenLayers.LonLat(record.data.lon,record.data.lat);position.transform(new OpenLayers.Projection("EPSG:28992"),this.map.getProjectionObject());this.map.setCenter(position,this.zoom);this.collapse();},this);}}});Ext.reg('hr_openlssearchcombo',Heron.widgets.search.OpenLSSearchCombo);Ext.namespace("Heron.widgets.search");Heron.widgets.search.NominatimSearchCombo=Ext.extend(Ext.form.ComboBox,{map:null,width:240,listWidth:400,loadingText:__('Searching...'),emptyText:__('Search Nominatim'),zoom:8,minChars:4,queryDelay:50,maxRows:'10',url:'http://open.mapquestapi.com/nominatim/v1/search?format=json&addressdetails=1',storeFields:["place_id","display_name",{name:"address",type:"Object"},"boundingbox",{name:"lat",type:"number"},{name:"lon",type:"number"}],tpl:'<tpl for="."><tpl for="address"><div class="x-combo-list-item">{road} {postcode} {city} {country}</div></tpl></tpl>',displayTpl:'<tpl for="."><tpl for="address">{road} {city} {country}</tpl></tpl>',lang:'en',charset:'UTF8',hideTrigger:true,displayField:'display_name',forceSelection:true,queryParam:'q',initComponent:function(){if(this.displayTpl){this.displayTplObj=new Ext.XTemplate(this.displayTpl);}
Heron.widgets.search.NominatimSearchCombo.superclass.initComponent.apply(this,arguments);this.store=new Ext.data.JsonStore({proxy:new Ext.data.HttpProxy({url:this.url,method:'GET'}),idProperty:'place_id',successProperty:null,totalProperty:null,fields:this.storeFields});if(this.zoom>0){this.on("select",function(combo,record,index){var result=record.data;var value=result[this.displayField];if(this.displayTplObj){value=this.displayTplObj.apply(result);}
this.setValue(value);var lonlat1=new OpenLayers.LonLat(result.boundingbox[2],result.boundingbox[0]);var lonlat2=new OpenLayers.LonLat(result.boundingbox[3],result.boundingbox[1]);lonlat1.transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());lonlat2.transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());var bounds=new OpenLayers.Bounds();bounds.extend(lonlat1);bounds.extend(lonlat2);this.map.zoomToExtent(bounds);this.collapse();},this);}}});Ext.reg('hr_nominatimsearchcombo',Heron.widgets.search.NominatimSearchCombo);Ext.namespace("Heron.widgets");Heron.widgets.PrintPreviewWindow=Ext.extend(Ext.Window,{title:__('Print Preview'),printCapabilities:null,modal:true,border:false,resizable:false,width:400,autoHeight:true,layout:'fit',method:'POST',showTitle:true,mapTitle:null,mapTitleYAML:"mapTitle",showComment:true,mapComment:null,mapCommentYAML:"mapComment",showFooter:true,mapFooter:null,mapFooterYAML:"mapFooter",printAttribution:true,mapAttribution:null,mapAttributionYAML:"mapAttribution",showRotation:true,showOutputFormats:false,showLegend:true,mapLegend:null,showLegendChecked:false,mapLimitScales:true,mapPreviewAutoHeight:true,mapPreviewHeight:300,excludeLayers:['OpenLayers.Handler.Polygon','OpenLayers.Handler.RegularPolygon','OpenLayers.Handler.Path','OpenLayers.Handler.Point'],legendDefaults:{useScaleParameter:true,baseParams:{FORMAT:"image/png"}},initComponent:function(){if(this.hropts){Ext.apply(this,this.hropts);}
if(!this.url){Ext.Msg.alert(__('Warning'),__('No print provider url property passed in hropts.'));return;}
var busyMask=new Ext.LoadMask(Ext.getBody(),{msg:__('Loading print data...')});busyMask.show();var self=this;Ext.Ajax.request({url:this.url+'/info.json',method:'GET',params:null,success:function(result,request){self.printCapabilities=Ext.decode(result.responseText);self.addItems();busyMask.hide();},failure:function(result,request){busyMask.hide();Ext.Msg.alert(__('Warning'),__('Error getting Print options from server: ')+this.url);}});Heron.widgets.PrintPreviewWindow.superclass.initComponent.call(this);},addItems:function(){var legendPanel=new Heron.widgets.LayerLegendPanel({renderTo:document.body,hidden:true,defaults:this.legendDefaults});var self=this;var item=new GeoExt.ux.PrintPreview({autoHeight:true,printMapPanel:{limitScales:this.mapLimitScales,map:{controls:[new OpenLayers.Control.Navigation({zoomBoxEnabled:false,zoomWheelEnabled:(this.showRotation)?true:false}),new OpenLayers.Control.Zoom()]}},printProvider:{method:this.method,capabilities:this.printCapabilities,outputFormatsEnabled:this.showOutputFormats,listeners:{"print":function(){self.close();},"printexception":function(printProvider,result){Ext.Msg.alert(__('Warning'),__('Error from Print server: ')+result.statusText);},"beforeencodelayer":function(printProvider,layer){for(var i=0;i<self.excludeLayers.length;i++){if(layer.name==self.excludeLayers[i]){return false;}}
return true;}}},sourceMap:this.mapPanel,showTitle:this.showTitle,mapTitle:this.mapTitle,mapTitleYAML:this.mapTitleYAML,showComment:this.showComment,mapComment:this.mapComment,mapCommentYAML:this.mapCommentYAML,showFooter:this.showFooter,mapFooter:this.mapFooter,mapFooterYAML:this.mapFooterYAML,printAttribution:this.printAttribution,mapAttribution:this.mapAttribution,mapAttributionYAML:this.mapAttributionYAML,showRotation:this.showRotation,showOutputFormats:this.showOutputFormats,showLegend:this.showLegend,mapLegend:(this.showLegend)?legendPanel:null,showLegendChecked:this.showLegendChecked,mapPreviewAutoHeight:this.mapPreviewAutoHeight,mapPreviewHeight:this.mapPreviewHeight});if(this.showRotation){var ctrlPanel=new OpenLayers.Control.Zoom();item.printMapPanel.map.addControl(ctrlPanel);}
this.add(item);this.doLayout();this.show();this.center();},listeners:{show:function(node){}}});Ext.reg('hr_printpreviewwindow',Heron.widgets.PrintPreviewWindow);Ext.namespace("Heron.widgets.search");Heron.widgets.search.FeaturePanel=Ext.extend(Ext.Panel,{downloadable:true,displayPanels:['Table'],exportFormats:['CSV','XLS','GMLv2','GeoJSON','Shapefile','WellKnownText'],columnCapitalize:true,showTopToolbar:true,showGeometries:true,featureSelection:true,loadMask:true,exportConfigs:{CSV:{name:'Comma Separated Values (CSV)',formatter:'CSVFormatter',fileExt:'.csv',mimeType:'text/csv'},XLS:{name:'Excel (XLS)',formatter:'ExcelFormatter',fileExt:'.xls',mimeType:'application/vnd.ms-excel'},GMLv2:{name:'GML v2',formatter:'OpenLayersFormatter',format:new OpenLayers.Format.GML.v2({featureType:'heronfeat',featureNS:'http://heron-mc.org'}),fileExt:'.gml',mimeType:'text/xml'},GeoJSON:{name:'GeoJSON',formatter:'OpenLayersFormatter',format:'OpenLayers.Format.GeoJSON',fileExt:'.json',mimeType:'text/plain'},GeoPackage:{name:'GeoPackage',formatter:'OpenLayersFormatter',format:'OpenLayers.Format.GeoJSON',targetFormat:'GPKG',fileExt:'.gpkg',mimeType:'application/binary'},Shapefile:{name:'Esri Shapefile',formatter:'OpenLayersFormatter',format:'OpenLayers.Format.GeoJSON',targetFormat:'ESRI Shapefile',fileExt:'.zip',mimeType:'application/zip'},WellKnownText:{name:'Well-known Text (WKT)',formatter:'OpenLayersFormatter',format:'OpenLayers.Format.WKT',fileExt:'.wkt',mimeType:'text/plain'}},separateSelectionLayer:false,zoomOnFeatureSelect:false,zoomOnRowDoubleClick:true,zoomLevelPointSelect:10,zoomLevelPoint:10,zoomToDataExtent:false,autoConfig:true,autoConfigMaxSniff:40,hideColumns:[],columnFixedWidth:100,autoMaxWidth:300,autoMinWidth:45,vectorLayerOptions:{noLegend:true,displayInLayerSwitcher:false},tableGrid:null,propGrid:null,mainPanel:null,store:null,initComponent:function(){Ext.apply(this,{layout:"fit"});if(this.columns){this.autoConfig=false;}
Ext.apply(this,this.hropts);if(this.featureSelection){this.showGeometries=true;}
if(this.displayPanels.indexOf('Grid')>=0){this.displayPanels.splice(this.displayPanels.indexOf('Grid'),1);if(this.displayPanels.indexOf('Table')<0){this.displayPanels.push('Table');}}
if(this.showGeometries){var layer=this.layer=new OpenLayers.Layer.Vector(this.title,this.vectorLayerOptions);this.map=Heron.App.getMap();this.map.addLayer(this.layer);var self=this;if(this.featureSelection&&this.zoomOnFeatureSelect){layer.events.on({"featureselected":function(e){self.zoomToFeature(self,e.feature.geometry);},"dblclick":function(e){self.zoomToFeature(self,e.feature.geometry);},"scope":layer});}
if(this.separateSelectionLayer){this.selLayer=new OpenLayers.Layer.Vector(this.title+'_Sel',{noLegend:true,displayInLayerSwitcher:false});this.selLayer.styleMap.styles['default']=layer.styleMap.styles['select'];this.selLayer.style=this.selLayer.styleMap.styles['default'].defaultStyle;layer.styleMap.styles['select']=layer.styleMap.styles['default'].clone();layer.styleMap.styles['select'].defaultStyle.fillColor='white';layer.styleMap.styles['select'].defaultStyle.fillOpacity=0.0;this.map.addLayer(this.selLayer);this.map.setLayerIndex(this.selLayer,this.map.layers.length-1);this.layer.events.on({featureselected:this.updateSelectionLayer,featureunselected:this.updateSelectionLayer,scope:this});}}
this.setupStore(this.features);if(this.featureSelection&&!this.sm){this.sm=new GeoExt.grid.FeatureSelectionModel();}
if(this.showTopToolbar){this.tbar=this.createTopToolbar();}
Heron.widgets.search.FeaturePanel.superclass.initComponent.call(this);this.tableGrid=new Ext.grid.GridPanel({id:'grd_Table'+'_'+this.featureSetKey,store:this.store,title:this.title,autoScroll:true,featureType:this.featureType,header:false,features:this.features,autoConfig:this.autoConfig,autoConfigMaxSniff:this.autoConfigMaxSniff,hideColumns:this.hideColumns,columnFixedWidth:this.columnFixedWidth,autoMaxWidth:this.autoMaxWidth,autoMinWidth:this.autoMinWidth,columnCapitalize:this.columnCapitalize,showGeometries:this.showGeometries,featureSelection:this.featureSelection,gridCellRenderers:this.gridCellRenderers,columns:this.columns,showTopToolbar:this.showTopToolbar,exportFormats:this.exportFormats,hropts:{zoomOnRowDoubleClick:true,zoomOnFeatureSelect:false,zoomLevelPointSelect:8},sm:this.sm});if(this.zoomOnRowDoubleClick){this.tableGrid.on('celldblclick',function(grid,rowIndex,columnIndex,e){var record=grid.getStore().getAt(rowIndex);var feature=record.getFeature();self.zoomToFeature(self,feature.geometry);});}
if((this.displayPanels.indexOf('Table')>=0)&&(this.displayPanels.indexOf('Detail')>=0)){this.tableGrid.on('cellclick',function(grid,rowIndex,columnIndex,e){if(columnIndex==0){self.displayVertical('goto',rowIndex);}});}
if(this.displayPanels.indexOf('Detail')>=0){this.propGrid=new Ext.grid.PropertyGrid({id:'grd_Detail'+'_'+this.featureSetKey,listeners:{'beforeedit':function(e){return false;}},title:this.title,featureType:this.featureType,header:false,features:this.features,autoConfig:this.autoConfig,autoConfigMaxSniff:this.autoConfigMaxSniff,autoHeight:false,hideColumns:this.hideColumns,columnFixedWidth:this.columnFixedWidth,autoMaxWidth:this.autoMaxWidth,autoMinWidth:this.autoMinWidth,columnCapitalize:this.columnCapitalize,showGeometries:this.showGeometries,featureSelection:this.featureSelection,gridCellRenderers:this.gridCellRenderers,columns:this.columns,showTopToolbar:this.showTopToolbar,exportFormats:this.exportFormats,curRecordNr:0,hropts:{zoomOnRowDoubleClick:true,zoomOnFeatureSelect:false,zoomLevelPointSelect:8}});}
this.cardPanels=[];if(this.tableGrid)
this.cardPanels.push(this.tableGrid);if(this.propGrid)
this.cardPanels.push(this.propGrid);var activeItem=0;if(this.displayPanels.length>0){activeItem='grd_'+this.displayPanels[0]+'_'+this.featureSetKey;}
this.mainPanel=new Ext.Panel({border:false,activeItem:activeItem,layout:"card",items:this.cardPanels});this.add(this.mainPanel);if((this.showTopToolbar)&&(this.displayPanels.indexOf('Table')>=0)&&(this.displayPanels.indexOf('Detail')>=0)){this.tableGrid.addListener("activate",this.onActivateTable,this);this.propGrid.addListener("activate",this.onActivateDetail,this);this.tableGrid.addListener("afterlayout",this.onAfterlayoutTable,this);this.propGrid.addListener("afterlayout",this.onAfterlayoutDetail,this);this.topToolbar.addListener("afterlayout",this.onAfterlayoutTopToolbar,this);}
this.addListener("afterrender",this.onPanelRendered,this);this.addListener("show",this.onPanelShow,this);this.addListener("hide",this.onPanelHide,this);},activateDisplayPanel:function(name){if(!this.mainPanel.getLayout().setActiveItem){return;}
this.mainPanel.getLayout().setActiveItem("grd_"+name);},createTopToolbar:function(){var tbarItems=[this.tbarText=new Ext.Toolbar.TextItem({itemId:'result',text:__(' ')})];tbarItems.push('->');if(this.downloadable){var downloadMenuItems=[];var item;for(var j=0;j<this.exportFormats.length;j++){var exportFormat=this.exportFormats[j];var exportFormatConfig=exportFormat instanceof Object?exportFormat:this.exportConfigs[exportFormat];if(!exportFormatConfig){Ext.Msg.alert(__('Warning'),__('Invalid export format configured: '+exportFormat));continue;}
item={text:__('as')+' '+exportFormatConfig.name,cls:'x-btn',iconCls:'icon-table-export',scope:this,exportFormatConfig:exportFormatConfig,handler:function(evt){this.exportData(evt.exportFormatConfig);}};downloadMenuItems.push(item);}
if(this.downloadInfo&&this.downloadInfo.downloadFormats){var downloadFormats=this.downloadInfo.downloadFormats;for(var k=0;k<downloadFormats.length;k++){var downloadFormat=downloadFormats[k];item={text:__('as')+' '+downloadFormat.name,cls:'x-btn',iconCls:'icon-table-export',downloadFormat:downloadFormat.outputFormat,fileExt:downloadFormat.fileExt,scope:this,handler:function(evt){this.downloadData(evt.downloadFormat,evt.fileExt);}};downloadMenuItems.push(item);}}
if(downloadMenuItems.length>0){tbarItems.push({itemId:'download',text:__('Download'),cls:'x-btn-text-icon',iconCls:'icon-table-save',tooltip:__('Choose a Download Format'),menu:new Ext.menu.Menu({style:{overflow:'visible'},items:downloadMenuItems})});}}
if((this.showTopToolbar)&&(this.displayPanels.indexOf('Table')>=0)&&(this.displayPanels.indexOf('Detail')>=0)){var blnTable=(this.displayPanels.indexOf('Detail')==0);tbarItems.push('->');tbarItems.push({itemId:'table-detail',text:(blnTable)?__('Table'):__('Detail'),cls:'x-btn-text-icon',iconCls:(blnTable)?'icon-table':'icon-detail',tooltip:(blnTable)?__('Show record(s) in a table grid'):__('Show single record'),enableToggle:true,pressed:false,scope:this,handler:function(btn){if(btn.pressed){if(btn.iconCls=='icon-table'){this.displayGrid();}else{var selRecord=Ext.data.Record;selRecord=this.tableGrid.selModel.getSelected();if(selRecord){var selIndex=this.tableGrid.store.indexOf(selRecord);this.displayVertical('goto',selIndex);}
else{this.displayVertical('first');}}
btn.toggle(false,false);}}});}
tbarItems.push('->');tbarItems.push({itemId:'clear',text:__('Clear'),cls:'x-btn-text-icon',iconCls:'icon-table-clear',tooltip:__('Remove all results'),scope:this,handler:function(){this.removeFeatures();}});if((this.showTopToolbar)&&(this.displayPanels.indexOf('Detail')>=0)){tbarItems.push('->');tbarItems.push({itemId:'nextrec',text:__(''),cls:'x-btn-text-icon',iconCls:'icon-arrow-right',tooltip:__('Show next record'),scope:this,visible:false,disabled:true,handler:function(){this.displayVertical('next');}});tbarItems.push('->');tbarItems.push({itemId:'prevrec',text:__(''),cls:'x-btn-text-icon',iconCls:'icon-arrow-left',tooltip:__('Show previous record'),scope:this,hidden:true,disabled:true,handler:function(){this.displayVertical('previous');}});}
return new Ext.Toolbar({enableOverflow:true,items:tbarItems});},displayGrid:function(){this.activateDisplayPanel('Table'+'_'+this.featureSetKey);this.updateTbarText('table');},displayVertical:function(action,intRecNew){var column;var objCount=this.tableGrid.store?this.tableGrid.store.getCount():0;var value;if(objCount>0){switch(action){case'first':this.propGrid.curRecordNr=0;break;case'goto':this.propGrid.curRecordNr=intRecNew;break;case'previous':this.propGrid.curRecordNr--;break;case'next':this.propGrid.curRecordNr++;break;}
var sourceStore=this.mainPanel.items.items[0].store.data.items[this.propGrid.curRecordNr].data.feature.attributes;this.propGrid.store.removeAll();for(var c=0;c<this.columns.length;c++){column=this.columns[c];if(column.id!='btn_detail'){if(column.renderer){value=column.renderer(sourceStore[column.dataIndex],null,this.mainPanel.items.items[0].store.data.items[this.propGrid.curRecordNr]);}else{value=sourceStore[column.dataIndex];}
var rec=new Ext.grid.PropertyRecord({name:column.header,value:value});this.propGrid.store.add(rec);}}
if(action!='first'){this.tableGrid.selModel.selectRow(this.propGrid.curRecordNr,false);}}
if(objCount>1){this.topToolbar.items.get('prevrec').show();this.topToolbar.items.get('nextrec').show();if(this.propGrid.curRecordNr==objCount-1){this.topToolbar.items.get('prevrec').setDisabled(false);this.topToolbar.items.get('nextrec').setDisabled(true);}
else if(this.propGrid.curRecordNr==0){this.topToolbar.items.get('prevrec').setDisabled(true);this.topToolbar.items.get('nextrec').setDisabled(false);}
else{this.topToolbar.items.get('prevrec').setDisabled(false);this.topToolbar.items.get('nextrec').setDisabled(false);}}else{this.topToolbar.items.get('prevrec').hide();this.topToolbar.items.get('nextrec').hide();}
this.activateDisplayPanel('Detail'+'_'+this.featureSetKey);this.updateTbarText('detail');},loadFeatures:function(features,featureType){this.removeFeatures();this.featureType=featureType;if(!features||features.length==0){return;}
this.showLayer();this.store.loadData(features);if(this.zoomToDataExtent){if(features.length==1&&features[0].geometry.CLASS_NAME=="OpenLayers.Geometry.Point"){var point=features[0].geometry.getCentroid();this.map.setCenter(new OpenLayers.LonLat(point.x,point.y),this.zoomLevelPoint);}else if(this.layer){this.map.zoomToExtent(this.layer.getDataExtent());}}
if(this.displayPanels.length>0){if(this.displayPanels[0]=='Table')
this.displayGrid();else if(this.displayPanels[0]=='Detail'){this.displayVertical('first');}}},hasFeatures:function(){return this.store&&this.store.getCount()>0;},removeFeatures:function(){if(this.store){this.store.removeAll(false);}
if((this.propGrid)&&(this.propGrid.store)){this.propGrid.store.removeAll();}
if(this.selLayer){this.selLayer.removeAllFeatures({silent:true});}
this.updateTbarText();if((this.topToolbar)&&(this.topToolbar.items.get('prevrec'))){this.topToolbar.items.get('prevrec').hide();this.topToolbar.items.get('nextrec').hide();}},showLayer:function(){if(this.layer){if(this.selLayer){this.map.setLayerIndex(this.selLayer,this.map.layers.length-1);this.map.setLayerIndex(this.layer,this.map.layers.length-2);}else{this.map.setLayerIndex(this.layer,this.map.layers.length-1);}
if(!this.layer.getVisibility()){this.layer.setVisibility(true);}
if(this.selLayer&&!this.selLayer.getVisibility()){this.selLayer.setVisibility(true);}}},hideLayer:function(){if(this.layer&&this.layer.getVisibility()){this.layer.setVisibility(false);}
if(this.selLayer&&this.selLayer.getVisibility()){this.selLayer.setVisibility(false);}},zoomToFeature:function(self,geometry){if(!geometry){return;}
if(geometry.getVertices().length==1){var point=geometry.getCentroid();self.map.setCenter(new OpenLayers.LonLat(point.x,point.y),self.zoomLevelPointSelect);}else{self.map.zoomToExtent(geometry.getBounds());}},zoomButtonRenderer:function(){var id=Ext.id();(function(){new Ext.Button({renderTo:id,text:'Zoom'});}).defer(25);return(String.format('<div id="{0}"></div>',id));},setupStore:function(features){if(this.store&&!this.autoConfig){return;}
var storeFields=[];var column;this.columns=this.columns==null?[]:this.columns;var blnBtnExists=false;if((this.columns[0]!=null)&&(this.columns[0].id=='btn_detail'))
blnBtnExists=true;if((this.showTopToolbar)&&(this.displayPanels.indexOf('Detail')>=0)&&(blnBtnExists==false)){var columnDetail=new Ext.grid.Column({id:'btn_detail',header:'',width:20,tooltip:__('Show single record'),renderer:function(value,metadata,record,rowindex){return('+');}});this.columns.splice(0,0,columnDetail);}
if(this.autoConfig&&features){var columnsFound={};var columnsWidth={};var suppressColumns=this.hideColumns.toString().toLowerCase();var defaultColumnWidth=this.columnFixedWidth;var autoMaxWidth=this.autoMaxWidth;var autoMinWidth=this.autoMinWidth;var arrLen=features.length<=this.autoConfigMaxSniff?features.length:this.autoConfigMaxSniff;var pixelsPerCharacter=7;for(var i=0;i<arrLen;i++){var feature=features[i];var fieldName;var position=-1;for(fieldName in feature.attributes){if(i>0){position++;}
if(columnsFound[fieldName]||suppressColumns.indexOf(fieldName.toLowerCase())!==-1){continue;}
column={header:this.columnCapitalize?fieldName.substr(0,1).toUpperCase()+fieldName.substr(1).toLowerCase():fieldName,width:defaultColumnWidth,dataIndex:fieldName,sortable:true};if(this.gridCellRenderers&&this.featureType){var gridCellRenderer;for(var k=0;k<this.gridCellRenderers.length;k++){gridCellRenderer=this.gridCellRenderers[k];if(gridCellRenderer.attrName&&fieldName==gridCellRenderer.attrName){if(gridCellRenderer.featureType&&this.featureType==gridCellRenderer.featureType||!gridCellRenderer.featureType){column.options=gridCellRenderer.renderer.options;column.renderer=gridCellRenderer.renderer.fn;}}}}
if(autoMaxWidth>0){if(!(fieldName in columnsWidth)){columnsWidth[fieldName]=fieldName.length*pixelsPerCharacter;if(columnsWidth[fieldName]<autoMinWidth){columnsWidth[fieldName]=autoMinWidth;}}
if(feature.attributes[fieldName]){var columnWidth=feature.attributes[fieldName].length;if(typeof(column.options)!=="undefined"&&(typeof(column.options.attrPreTxt)!=="undefined")){columnWidth=columnWidth+column.options.attrPreTxt.length;}
columnWidth=columnWidth*pixelsPerCharacter;if(columnWidth>columnsWidth[fieldName]&&columnWidth<=autoMaxWidth){columnsWidth[fieldName]=columnWidth;}}}
if(position>=0&&position<this.columns.length){this.columns.splice(position,0,column);}else{this.columns.push(column);}
storeFields.push({name:column.dataIndex});columnsFound[fieldName]=fieldName;}}
if(autoMaxWidth>0){for(var key in this.columns){if(columnsWidth[this.columns[key].dataIndex])
this.columns[key].width=columnsWidth[this.columns[key].dataIndex];}}}else{for(var c=0;c<this.columns.length;c++){column=this.columns[c];if(column.dataIndex){storeFields.push({name:column.dataIndex,type:column.type});}
column.sortable=true;}}
var storeConfig={layer:this.layer,fields:storeFields};Ext.apply(storeConfig,this.hropts.storeOpts);this.store=new GeoExt.data.FeatureStore(storeConfig);},updateSelectionLayer:function(evt){if(!this.showGeometries){return;}
this.selLayer.removeAllFeatures({silent:true});var features=this.layer.selectedFeatures;for(var i=0;i<features.length;i++){var feature=features[i].clone();this.selLayer.addFeatures(feature);}},onActivateTable:function(){this.topToolbar.items.get('prevrec').hide();this.topToolbar.items.get('nextrec').hide();var btn=this.topToolbar.items.get('table-detail');btn.setText(__('Detail'));btn.setIconClass('icon-detail');btn.setTooltip(__('Show single record'));},onActivateDetail:function(){var btn=this.topToolbar.items.get('table-detail');btn.setText(__('Table'));btn.setIconClass('icon-table');btn.setTooltip(__('Show record(s) in a table grid'));this.tableGrid.selModel.selectRow(this.propGrid.curRecordNr,false);},onAfterlayoutTable:function(){this.activePanel='Table';},onAfterlayoutDetail:function(){this.activePanel='Detail';},onAfterlayoutTopToolbar:function(){var objCount=this.tableGrid.store?this.tableGrid.store.getCount():0;if((this.activePanel=='Table')||(objCount<=1)){this.topToolbar.items.get('prevrec').hide();this.topToolbar.items.get('nextrec').hide();}else{this.topToolbar.items.get('prevrec').show();this.topToolbar.items.get('nextrec').show();}},onPanelRendered:function(){if(this.ownerCt){this.ownerCt.addListener("parenthide",this.onParentHide,this);this.ownerCt.addListener("parentshow",this.onParentShow,this);}},onPanelShow:function(){if(this.selModel&&this.selModel.selectControl){this.selModel.selectControl.activate();}},onPanelHide:function(){if(this.selModel&&this.selModel.selectControl){this.selModel.selectControl.deactivate();}},onParentShow:function(){this.showLayer();},onParentHide:function(){this.removeFeatures();this.hideLayer();},cleanup:function(){this.removeFeatures();if(this.selModel&&this.selModel.selectControl){this.selModel.selectControl.deactivate();this.selModel=null;}
if(this.layer){this.map.removeLayer(this.layer);}
if(this.selLayer){this.map.removeLayer(this.selLayer);}
return true;},updateTbarText:function(type){if(!this.tbarText){return;}
var objCount=this.store?this.store.getCount():0;if((type)&&(type=='detail')&&(objCount>0))
this.tbarText.setText(__('Result')+' '+(this.propGrid.curRecordNr+1)+' '+__('of')+' '+objCount);else
this.tbarText.setText(objCount+' '+(objCount!=1?__('Results'):__('Result')));},exportData:function(config){var store=this.store;var featureType=this.featureType?this.featureType:'heron';config.fileName=featureType+config.fileExt;config.columns=(store.fields&&store.fields.items&&store.fields.items.length>3)?store.fields.items.slice(3):null;if(store.layer&&store.layer.projection){config.assignSrs=store.layer.projection.getCode();}
config.encoding='base64';var data=Heron.data.DataExporter.formatStore(store,config);Heron.data.DataExporter.download(data,config);},downloadData:function(downloadFormat,fileExt){var downloadInfo=this.downloadInfo;downloadInfo.params.outputFormat=downloadFormat;downloadInfo.params.filename=downloadInfo.params.typename+fileExt;var paramStr=OpenLayers.Util.getParameterString(downloadInfo.params);var url=OpenLayers.Util.urlAppend(downloadInfo.url,paramStr);if(url.length>2048){Ext.Msg.alert(__('Warning'),__('Download URL string too long (max 2048 chars): ')+url.length);return;}
Heron.data.DataExporter.directDownload(url);}});Ext.reg('hr_featurepanel',Heron.widgets.search.FeaturePanel);Ext.reg('hr_featuregridpanel',Heron.widgets.search.FeaturePanel);Ext.reg('hr_featselgridpanel',Heron.widgets.search.FeaturePanel);Ext.namespace("Heron.widgets.search");Heron.widgets.search.SearchCenterPanel=Ext.extend(Ext.Panel,{initComponent:function(){var self=this;Ext.apply(this,{layout:'card',activeItem:0,bbar:[{text:__('< Search'),ref:'../prevButton',disabled:true,handler:function(){self.showSearchPanel(self);}},'->',{text:__('Result >'),ref:'../nextButton',disabled:true,handler:function(){self.showResultGridPanel(self);}}]});if(!this.items){this.items=[this.hropts.searchPanel];}
if(this.ownerCt){this.ownerCt.addListener("hide",this.onParentHide,this);this.ownerCt.addListener("show",this.onParentShow,this);this.addEvents({"parenthide":true,"parentshow":true});}
Heron.widgets.search.SearchCenterPanel.superclass.initComponent.call(this);this.addListener("afterrender",this.onRendered,this);},showSearchPanel:function(self){self.getLayout().setActiveItem(this.searchPanel);self.prevButton.disable();self.nextButton.disable();if(this.resultPanel&&this.resultPanel.hasFeatures()){self.nextButton.enable();}},showResultGridPanel:function(self){self.getLayout().setActiveItem(this.resultPanel);self.prevButton.enable();self.nextButton.disable();},onRendered:function(){this.searchPanel=this.getComponent(0);if(this.searchPanel){this.searchPanel.addListener('searchissued',this.onSearchIssued,this);this.searchPanel.addListener('searchsuccess',this.onSearchSuccess,this);this.searchPanel.addListener('searchcomplete',this.onSearchComplete,this);this.searchPanel.addListener('searchreset',this.onSearchReset,this);}},onSearchIssued:function(searchPanel){this.showSearchPanel(this);this.nextButton.disable();},onSearchComplete:function(searchPanel){},onSearchReset:function(searchPanel){if(this.resultPanel){this.resultPanel.removeFeatures();}},onSearchSuccess:function(searchPanel,result){if(this.hropts.resultPanel.autoConfig&&this.resultPanel){this.resultPanel.cleanup();this.remove(this.resultPanel);this.resultPanel=null;}
var features=result.olResponse.features;if(!this.resultPanel){this.hropts.resultPanel.features=features;this.hropts.resultPanel.downloadInfo=result.downloadInfo;this.hropts.resultPanel.featureType=searchPanel.getFeatureType();this.resultPanel=new Heron.widgets.search.FeaturePanel(this.hropts.resultPanel);this.add(this.resultPanel);}
this.resultPanel.loadFeatures(features,searchPanel.getFeatureType());if(features&&features.length>0){this.showResultGridPanel(this);}},onParentShow:function(){if(this.resultPanel){this.showSearchPanel(this);}
this.fireEvent('parentshow');},onParentHide:function(){this.fireEvent('parenthide');}});Ext.reg('hr_searchcenterpanel',Heron.widgets.search.SearchCenterPanel);Ext.reg('hr_featselsearchpanel',Heron.widgets.search.SearchCenterPanel);Ext.namespace("Heron.widgets.search");Heron.widgets.search.MultiSearchCenterPanel=Ext.extend(Heron.widgets.search.SearchCenterPanel,{config:[],initComponent:function(){this.config=this.hropts;var searchNames=[];Ext.each(this.config,function(item){searchNames.push(item.searchPanel.name?item.searchPanel.name:__('Undefined (check your config)'));});this.combo=new Ext.form.ComboBox({store:searchNames,value:searchNames[0],editable:false,typeAhead:false,triggerAction:'all',emptyText:__('Select a search...'),selectOnFocus:true,width:250,listeners:{scope:this,'select':this.onSearchSelect}});this.tbar=[{'text':__('Search')+': '},this.combo];this.setPanels(this.config[0].searchPanel,this.config[0].resultPanel);Heron.widgets.search.MultiSearchCenterPanel.superclass.initComponent.call(this);},onSearchSelect:function(comboBox){var self=this;Ext.each(this.config,function(item){if(item.searchPanel.name==comboBox.value){self.switchPanels(item.searchPanel,item.resultPanel);}});this.showSearchPanel(this);},onSearchSuccess:function(searchPanel,result){Heron.widgets.search.MultiSearchCenterPanel.superclass.onSearchSuccess.call(this,searchPanel,result);this.lastResultFeatures=result.features;},setPanels:function(searchPanel,resultPanel){if(this.hropts.searchPanel&&this.hropts.searchPanel.name===searchPanel.name){return false;}
this.hropts.searchPanel=searchPanel;this.hropts.resultPanel=resultPanel;return true;},switchPanels:function(searchPanel,resultPanel){if(!this.setPanels(searchPanel,resultPanel)){return;}
if(this.searchPanel){this.lastSearchName=this.searchPanel.name;this.remove(this.searchPanel,true);}
if(this.resultPanel){this.resultPanel.cleanup();this.remove(this.resultPanel,true);this.resultPanel=null;}
if(this.hropts.searchPanel.hropts&&this.hropts.searchPanel.hropts.fromLastResult){this.hropts.searchPanel.hropts.filterFeatures=this.lastResultFeatures;this.hropts.searchPanel.hropts.lastSearchName=this.lastSearchName;}
this.searchPanel=Ext.create(this.hropts.searchPanel);this.add(this.searchPanel);this.searchPanel.show();this.getLayout().setActiveItem(this.searchPanel);this.onRendered();}});Ext.reg('hr_multisearchcenterpanel',Heron.widgets.search.MultiSearchCenterPanel);Ext.namespace("Heron.widgets.search");Heron.widgets.search.FormSearchPanel=Ext.extend(GeoExt.form.FormPanel,{onSearchCompleteZoom:11,autoWildCardAttach:false,caseInsensitiveMatch:false,logicalOperator:OpenLayers.Filter.Logical.AND,layerOpts:undefined,statusPanelOpts:{html:'&nbsp;',height:132,preventBodyReset:true,bodyCfg:{style:{padding:'6px',border:'0px'}},style:{marginTop:'24px',paddingTop:'24px',fontFamily:'Verdana, Arial, Helvetica, sans-serif',fontSize:'11px',color:'#0000C0'}},progressMessages:[__('Working on it...'),__('Still searching, please be patient...')],header:true,bodyStyle:'padding: 6px',style:{fontFamily:'Verdana, Arial, Helvetica, sans-serif',fontSize:'12px'},downloadFormats:[],defaults:{enableKeyEvents:true,listeners:{specialKey:function(field,el){if(el.getKey()==Ext.EventObject.ENTER){var form=this.ownerCt;if(!form&&!form.search){return;}
form.action=null;form.search();}}}},initComponent:function(){this.addEvents({"searchcomplete":true,"searchcanceled":true,"searchfailed":true,"searchsuccess":true});Ext.apply(this,this.hropts);Heron.widgets.search.FormSearchPanel.superclass.initComponent.call(this);if(this.protocol&&this.protocol.url instanceof Array){this.protocol.url=Heron.Utils.randArrayElm(this.protocol.url);this.protocol.options.url=this.protocol.url;}
var items=[this.createStatusPanel(),this.createActionButtons()];this.add(items);this.addListener("beforeaction",this.onSearchIssued,this);this.addListener("searchcanceled",this.onSearchCanceled,this);this.addListener("actioncomplete",this.onSearchComplete,this);this.addListener("actionfailed",this.onSearchFailed,this);},createActionButtons:function(){this.searchButton=new Ext.Button({text:__('Search'),tooltip:__('Search'),disabled:false,handler:function(){this.search();},scope:this});this.cancelButton=new Ext.Button({text:'Cancel',tooltip:__('Cancel ongoing search'),disabled:true,handler:function(){this.fireEvent('searchcanceled',this);},scope:this});return this.actionButtons=new Ext.ButtonGroup({fieldLabel:null,labelSeparator:'',anchor:"-50",title:null,border:false,bodyBorder:false,items:[this.cancelButton,this.searchButton]});},createStatusPanel:function(){return this.statusPanel=new Heron.widgets.HTMLPanel(this.statusPanelOpts);},updateStatusPanel:function(text){if(!text){text='&nbsp;';}
if(this.statusPanel.body){this.statusPanel.body.update(text);}else{this.statusPanel.html=text;}},getFeatureType:function(){return this.protocol?this.protocol.featureType:'heron';},onSearchIssued:function(form,action){this.protocol=action.form.protocol;this.searchState="searchissued";this.features=null;this.updateStatusPanel(__('Searching...'));this.cancelButton.enable();this.searchButton.disable();var self=this;var startTime=new Date().getTime()/1000;this.timer=setInterval(function(){if(self.searchState!='searchissued'){return;}
self.updateStatusPanel(Math.floor(new Date().getTime()/1000-startTime)+' '+__('Seconds')+' - '+
Heron.Utils.randArrayElm(self.progressMessages));},4000);},onSearchFailed:function(form,action){this.searchAbort();},onSearchCanceled:function(searchPanel){this.searchState='searchcanceled';this.searchAbort();this.updateStatusPanel(__('Search Canceled'));},onSearchComplete:function(form,action){if(this.timer){clearInterval(this.timer);this.timer=null;}
this.cancelButton.disable();this.searchButton.enable();if(this.searchState=='searchcanceled'){this.searchState=null;return;}
this.searchState="searchcomplete";var result={olResponse:action.response};this.fireEvent('searchcomplete',this,result);if(action&&action.response&&action.response.success()){var features=this.features=action.response.features;var featureCount=features?features.length:0;this.updateStatusPanel(__('Search Completed: ')+featureCount+' '+(featureCount!=1?__('Results'):__('Result')));var filter=GeoExt.form.toFilter(action.form,action.options);var filterFormat=new OpenLayers.Format.Filter.v1_1_0({srsName:this.protocol.srsName});var filterStr=OpenLayers.Format.XML.prototype.write.apply(filterFormat,[filterFormat.write(filter)]);result.downloadInfo={type:'wfs',url:this.protocol.options.url,downloadFormats:this.downloadFormats,params:{typename:this.protocol.featureType,maxFeatures:this.protocol.maxFeatures,"Content-Disposition":"attachment",filename:this.protocol.featureType,srsName:this.protocol.srsName,service:"WFS",version:"1.1.0",request:"GetFeature",filter:filterStr}};if(this.onSearchCompleteAction){var lropts=this.layerOpts;if(lropts){var map=Heron.App.getMap();for(var l=0;l<lropts.length;l++){if(lropts[l]['layerOn']){var mapLayers=map.getLayersByName(lropts[l]['layerOn']);for(var n=0;n<mapLayers.length;n++){if(mapLayers[n].isBaseLayer){map.setBaseLayer(mapLayers[n]);}else{mapLayers[n].setVisibility(true);}
if(lropts[l]['layerOpacity']){mapLayers[n].setOpacity(lropts[l]['layerOpacity']);}}}}}
this.onSearchCompleteAction(result);}
this.fireEvent('searchsuccess',this,result);}else{this.fireEvent('searchfailed',this,action.response);this.updateStatusPanel(__('Search Failed')+' details: '+action.response.priv.responseText);}},onSearchCompleteAction:function(result){var features=result.olResponse.features;if(!features||features.length==0){return;}
var map=Heron.App.getMap();if(features.length==1&&features[0].geometry.CLASS_NAME=="OpenLayers.Geometry.Point"&&this.onSearchCompleteZoom){var point=features[0].geometry.getCentroid();map.setCenter(new OpenLayers.LonLat(point.x,point.y),this.onSearchCompleteZoom);}else{var geometryCollection=new OpenLayers.Geometry.Collection();for(var i=0;i<features.length;i++){geometryCollection.addComponent(features[i].geometry);}
geometryCollection.calculateBounds();map.zoomToExtent(geometryCollection.getBounds());}},search:function(){this.action=null;Heron.widgets.search.FormSearchPanel.superclass.search.call(this,{wildcard:this.autoWildCardAttach?GeoExt.form.CONTAINS:-1,matchCase:!this.caseInsensitiveMatch,logicalOp:this.logicalOperator});},searchAbort:function(){if(this.timer){clearInterval(this.timer);this.timer=null;}
if(this.protocol){this.protocol.abort(this.response);}
this.protocol=null;this.searchButton.enable();this.cancelButton.disable();this.updateStatusPanel(__('Search aborted'));}});Ext.reg('hr_formsearchpanel',Heron.widgets.search.FormSearchPanel);Ext.reg('hr_searchpanel',Heron.widgets.search.FormSearchPanel);Ext.namespace("Heron.widgets.search");Heron.widgets.search.SpatialSearchPanel=Ext.extend(Ext.Panel,{layout:'form',bodyStyle:'padding: 24px 12px 12px 12px',border:false,name:__('Spatial Search'),description:'',fromLastResult:false,lastSearchName:null,filterFeatures:null,showFilterFeatures:true,maxFilterGeometries:24,selectLayerStyle:{pointRadius:10,strokeColor:"#dd0000",strokeWidth:1,fillOpacity:0.4,fillColor:"#cc0000"},layerSortOrder:'ASC',downloadFormats:null,layerFilter:function(map){return map.getLayersBy('metadata',{test:function(metadata){return metadata&&metadata.wfs;}})},progressMessages:[__('Working on it...'),__('Still searching, please be patient...'),__('Still searching, have you selected an area with too many objects?')],initComponent:function(){this.addEvents(this.getEvents());Heron.widgets.search.SpatialSearchPanel.superclass.initComponent.call(this);this.map=Heron.App.getMap();this.addSelectionLayer();this.addListener("selectionlayerupdate",this.onSelectionLayerUpdate,this);this.addListener("targetlayerselected",this.onTargetLayerSelected,this);this.addListener("drawingcomplete",this.onDrawingComplete,this);this.addListener("searchissued",this.onSearchIssued,this);this.addListener("searchcomplete",this.onSearchComplete,this);this.addListener("searchcanceled",this.onSearchCanceled,this);this.addListener("beforehide",this.onBeforeHide,this);this.addListener("beforeshow",this.onBeforeShow,this);this.addListener("beforedestroy",this.onBeforeDestroy,this);this.addListener("afterrender",this.onPanelRendered,this);if(this.ownerCt){this.ownerCt.addListener("parenthide",this.onParentHide,this);this.ownerCt.addListener("parentshow",this.onParentShow,this);}},addSelectionLayer:function(){if(this.selectionLayer){return;}
this.selectionLayer=new OpenLayers.Layer.Vector(__('Selection'),{style:this.selectLayerStyle,displayInLayerSwitcher:false,hideInLegend:false,isBaseLayer:false});this.map.addLayers([this.selectionLayer]);},getEvents:function(){return{"drawcontroladded":true,"selectionlayerupdate":true,"targetlayerselected":true,"drawingcomplete":true,"searchissued":true,"searchcomplete":true,"searchcanceled":true,"searchfailed":true,"searchsuccess":true,"searchreset":true};},createStatusPanel:function(){var infoText=__('Select the Layer to query')+'<p>'+this.description+'</p>';if(this.lastSearchName){infoText+='<p>'+__('Using geometries from the result: ')+'<br/>'+this.lastSearchName;if(this.filterFeatures){infoText+='<br/>'+__('with')+' '+this.filterFeatures.length+' '+__('features');}
infoText+='</p>';}
this.statusPanel=new Heron.widgets.HTMLPanel({html:infoText,preventBodyReset:true,bodyCfg:{style:{padding:'6px',border:'1px'}},style:{marginTop:'10px',marginBottom:'10px',fontFamily:'Verdana, Arial, Helvetica, sans-serif',fontSize:'11px',color:'#0000C0'}});return this.statusPanel;},createDrawToolPanel:function(config){var defaultConfig={html:'<div class="olControlEditingToolbar olControlNoSelect">&nbsp;</div>',preventBodyReset:true,style:{marginTop:'32px',marginBottom:'24px'},activateControl:true,listeners:{afterrender:function(htmlPanel){var div=htmlPanel.body.dom.firstChild;if(!div){Ext.Msg.alert(__('Warning'),__('Cannot render draw controls'));return;}
this.addDrawControls(div);if(this.activateControl){this.activateDrawControl();}},scope:this}};config=Ext.apply(defaultConfig,config);return this.drawToolPanel=new Heron.widgets.HTMLPanel(config);},addDrawControls:function(div){this.drawControl=new OpenLayers.Control.EditingToolbar(this.selectionLayer,{div:div});this.drawControl.controls[0].panel_div.title=__('Return to map navigation');this.drawControl.controls[1].panel_div.title=__('Draw point');this.drawControl.controls[2].panel_div.title=__('Draw line');this.drawControl.controls[3].panel_div.title=__('Draw polygon');var drawCircleControl=new OpenLayers.Control.DrawFeature(this.selectionLayer,OpenLayers.Handler.RegularPolygon,{title:__('Draw circle (click and drag)'),displayClass:'olControlDrawCircle',handlerOptions:{citeCompliant:this.drawControl.citeCompliant,sides:30,irregular:false}});this.drawControl.addControls([drawCircleControl]);var drawRectangleControl=new OpenLayers.Control.DrawFeature(this.selectionLayer,OpenLayers.Handler.RegularPolygon,{displayClass:'olControlDrawRectangle',title:__('Draw Rectangle (click and drag)'),handlerOptions:{citeCompliant:this.drawControl.citeCompliant,sides:4,irregular:true}});this.drawControl.addControls([drawRectangleControl]);this.map.addControl(this.drawControl);this.activeControl=drawRectangleControl;this.fireEvent('drawcontroladded');},removeDrawControls:function(){if(this.drawControl){var self=this;Ext.each(this.drawControl.controls,function(control){self.map.removeControl(control);});this.map.removeControl(this.drawControl);this.drawControl=null;}},activateDrawControl:function(){if(!this.drawControl||this.drawControlActive){return;}
var self=this;Ext.each(this.drawControl.controls,function(control){control.events.register('featureadded',self,self.onFeatureDrawn);control.deactivate();if(self.activeControl&&control==self.activeControl){control.activate();}});this.drawControlActive=true;},deactivateDrawControl:function(){if(!this.drawControl){return;}
var self=this;Ext.each(this.drawControl.controls,function(control){control.events.unregister('featureadded',self,self.onFeatureDrawn);if(control.active){self.activeControl=control;}
control.deactivate();});this.updateStatusPanel();this.drawControlActive=false;},onFeatureDrawn:function(){},createTargetLayerCombo:function(config){var defaultConfig={fieldLabel:__('Search in'),sortOrder:this.layerSortOrder,layerFilter:this.layerFilter,selectFirst:true,listeners:{selectlayer:function(layer){this.targetLayer=layer;this.fireEvent('targetlayerselected');},scope:this}};config=Ext.apply(defaultConfig,config);return this.targetLayerCombo=new Heron.widgets.LayerCombo(config);},getFeatureType:function(){return this.lastFeatureType?this.lastFeatureType:(this.targetLayer?this.targetLayer.name:'heron');},updateStatusPanel:function(text){if(!text){text='&nbsp;';}
if(this.statusPanel.body){this.statusPanel.body.update(text);}else{this.statusPanel.html=text;}},onBeforeHide:function(){if(this.selectionLayer){this.selectionLayer.setVisibility(false);}},onBeforeShow:function(){if(this.selectionLayer){this.selectionLayer.setVisibility(true);}},onBeforeDestroy:function(){this.deactivateDrawControl();if(this.selectionLayer){this.selectionLayer.removeAllFeatures();this.map.removeLayer(this.selectionLayer);}},onDrawingComplete:function(searchPanel,selectionLayer){},onTargetLayerSelected:function(){},onSelectionLayerUpdate:function(){},onSearchIssued:function(){this.searchState="searchissued";this.response=null;this.features=null;this.updateStatusPanel(__('Searching...'));var self=this;var startTime=new Date().getTime()/1000;this.timer=setInterval(function(){if(self.searchState!='searchissued'){return;}
self.updateStatusPanel(Math.floor(new Date().getTime()/1000-startTime)+' '+__('Seconds')+' - '+
Heron.Utils.randArrayElm(self.progressMessages));},4000);},onSearchCanceled:function(searchPanel){this.searchState='searchcanceled';this.searchAbort();this.updateStatusPanel(__('Search Canceled'));},onSearchComplete:function(searchPanel,result){this.protocol=null;if(this.timer){clearInterval(this.timer);this.timer=null;}
if(this.sketch){this.selectionLayer.removeAllFeatures();this.sketch=false;}
this.fireEvent('selectionlayerupdate');if(this.searchState=='searchcanceled'){this.fireEvent('searchfailed',searchPanel,null);return;}
this.searchState="searchcomplete";var olResponse=result.olResponse;if(!olResponse||!olResponse.success()||olResponse.priv.responseText.indexOf('ExceptionReport')>0){this.fireEvent('searchfailed',searchPanel,olResponse);this.updateStatusPanel(__('Search Failed')+' details: '+olResponse.priv.responseText);return;}
this.onSearchSuccess(searchPanel,result);},onSearchSuccess:function(searchPanel,result){var features=this.features=this.filterFeatures=result.olResponse.features;var featureCount=features?features.length:0;this.updateStatusPanel(__('Search Completed: ')+featureCount+' '+(featureCount!=1?__('Results'):__('Result')));this.fireEvent('searchsuccess',searchPanel,result);},search:function(geometries,options){var targetLayer=options.targetLayer;var wfsOptions=targetLayer.metadata.wfs;if(wfsOptions.protocol=='fromWMSLayer'){this.protocol=OpenLayers.Protocol.WFS.fromWMSLayer(targetLayer,{outputFormat:'GML2'});if(this.protocol.url instanceof Array){this.protocol.url=Heron.Utils.randArrayElm(this.protocol.url);this.protocol.options.url=this.protocol.url;}}else{this.protocol=wfsOptions.protocol;}
this.lastFeatureType=this.protocol.featureType;var geometry=geometries[0];var spatialFilterType=options.spatialFilterType||OpenLayers.Filter.Spatial.INTERSECTS;var filter=new OpenLayers.Filter.Spatial({type:spatialFilterType,value:geometry});if(geometries.length>1){var filters=[];geometry=new OpenLayers.Geometry.Collection();Ext.each(geometries,function(g){geometry.addComponent(g);filters.push(new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,value:g}));});filter=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:filters});}
if(geometry.CLASS_NAME.indexOf('LineString')>0&&wfsOptions.maxQueryLength){var length=Math.round(geometry.getGeodesicLength(options.projection));if(length>wfsOptions.maxQueryLength){this.selectionLayer.removeAllFeatures();var units=options.units;Ext.Msg.alert(__('Warning - Line Length is ')+length+units,__('You drew a line with length above the layer-maximum of ')+wfsOptions.maxQueryLength+units);return false;}}
if(geometry.CLASS_NAME.indexOf('Polygon')>0&&wfsOptions.maxQueryArea){var area=Math.round(geometry.getGeodesicArea(options.projection));if(area>wfsOptions.maxQueryArea){this.selectionLayer.removeAllFeatures();var areaUnits=options.units+'2';Ext.Msg.alert(__('Warning - Area is ')+area+areaUnits,__('You selected an area for this layer above its maximum of ')+wfsOptions.maxQueryArea+areaUnits);return false;}}
var filterFormat=new OpenLayers.Format.Filter.v1_1_0({srsName:this.protocol.srsName});var filterStr=OpenLayers.Format.XML.prototype.write.apply(filterFormat,[filterFormat.write(filter)]);var maxFeatures=this.single==true?this.maxFeatures:undefined;this.response=this.protocol.read({maxFeatures:maxFeatures,filter:filter,callback:function(olResponse){if(!this.protocol){return;}
var downloadInfo={type:'wfs',url:this.protocol.options.url,downloadFormats:this.downloadFormats?this.downloadFormats:wfsOptions.downloadFormats,params:{typename:this.protocol.featureType,maxFeatures:maxFeatures,"Content-Disposition":"attachment",filename:targetLayer.name,srsName:this.protocol.srsName,service:"WFS",version:"1.1.0",request:"GetFeature",filter:filterStr}};var result={olResponse:olResponse,downloadInfo:downloadInfo,layer:targetLayer};this.fireEvent('searchcomplete',this,result);},scope:this});this.fireEvent('searchissued',this);return true;},searchAbort:function(){if(this.protocol){this.protocol.abort(this.response);}
this.protocol=null;if(this.timer){clearInterval(this.timer);this.timer=null;}}});Ext.reg('hr_spatialsearchpanel',Heron.widgets.search.SpatialSearchPanel);Ext.namespace("Heron.widgets.search");Heron.widgets.search.SearchByDrawPanel=Ext.extend(Heron.widgets.search.SpatialSearchPanel,{name:__('Search by Drawing'),initComponent:function(){this.items=[this.createTargetLayerCombo(),this.createDrawToolPanel(),this.createStatusPanel(),this.createActionButtons()];Heron.widgets.search.SearchByDrawPanel.superclass.initComponent.call(this);this.addListener("drawcontroladded",this.activateDrawControl,this);},createActionButtons:function(){return this.cancelButton=new Ext.Button({text:__('Cancel'),tooltip:__('Cancel ongoing search'),disabled:true,handler:function(){this.fireEvent('searchcanceled',this);},scope:this});},onDrawingComplete:function(searchPanel,selectionLayer){this.searchFromSketch();},onFeatureDrawn:function(){this.fireEvent('drawingcomplete',this,this.selectionLayer);},onPanelRendered:function(){this.updateStatusPanel(__('Select a drawing tool and draw to search immediately'));this.targetLayer=this.targetLayerCombo.selectedLayer;if(this.targetLayer){this.fireEvent('targetlayerselected',this.targetLayer);}},onParentShow:function(){this.activateDrawControl();},onParentHide:function(){this.deactivateDrawControl();},onSearchCanceled:function(searchPanel){Heron.widgets.search.SearchByFeaturePanel.superclass.onSearchCanceled.call(this);this.cancelButton.disable();if(this.selectionLayer){this.selectionLayer.removeAllFeatures();}},onSearchComplete:function(searchPanel,result){Heron.widgets.search.SearchByFeaturePanel.superclass.onSearchComplete.call(this,searchPanel,result);this.cancelButton.disable();},searchFromSketch:function(){var selectionLayer=this.selectionLayer;var geometry=selectionLayer.features[0].geometry;if(!this.search([geometry],{projection:selectionLayer.projection,units:selectionLayer.units,targetLayer:this.targetLayer})){}
this.sketch=true;this.cancelButton.enable();}});Ext.reg('hr_searchbydrawpanel',Heron.widgets.search.SearchByDrawPanel);Ext.namespace("Heron.widgets.search");Heron.widgets.search.SearchByFeaturePanel=Ext.extend(Heron.widgets.search.SpatialSearchPanel,{name:__('Search by Feature Selection'),targetLayerFilter:function(map){return map.getLayersBy('metadata',{test:function(metadata){return metadata&&metadata.wfs&&!metadata.isSourceLayer;}})},initComponent:function(){this.resetButton=new Ext.Button({anchor:"20%",text:'Reset',tooltip:__('Start a new search'),listeners:{click:function(){this.resetForm();},scope:this}});this.items=[this.createSourceLayerCombo(),this.createDrawFieldSet(),this.createTargetLayerCombo({selectFirst:false}),this.createSearchTypeCombo(),this.createActionButtons(),this.createStatusPanel(),this.resetButton];Heron.widgets.search.SearchByFeaturePanel.superclass.initComponent.call(this);},activateSearchByFeature:function(){this.deactivateSearchByFeature();this.sourceLayerCombo.addListener('selectlayer',this.onSourceLayerSelect,this);this.selectionLayer.events.register('featureadded',this,this.onSelectionLayerUpdate);this.selectionLayer.events.register('featuresadded',this,this.onSelectionLayerUpdate);this.selectionLayer.events.register('featureremoved',this,this.onSelectionLayerUpdate);this.selectionLayer.events.register('featuresremoved',this,this.onSelectionLayerUpdate);},deactivateSearchByFeature:function(){this.sourceLayerCombo.removeListener('selectlayer',this.onSourceLayerSelect,this);this.selectionLayer.events.unregister('featureadded',this,this.onSelectionLayerUpdate);this.selectionLayer.events.unregister('featuresadded',this,this.onSelectionLayerUpdate);this.selectionLayer.events.unregister('featureremoved',this,this.onSelectionLayerUpdate);this.selectionLayer.events.unregister('featuresremoved',this,this.onSelectionLayerUpdate);},resetForm:function(){this.selectionLayer.removeAllFeatures();this.searchButton.disable();this.sourceLayerCombo.reset();this.targetLayerCombo.reset();this.spatialFilterType=OpenLayers.Filter.Spatial.INTERSECTS;this.drawFieldSet.hide();this.deactivateDrawControl();this.selectionStatusField.hide();this.targetLayerCombo.hide();this.searchTypeCombo.hide();this.actionButtons.hide();this.updateStatusPanel(__('Select a source Layer and then draw to select objects from that layer. <br/>Then select a target Layer to search in using the geometries of the selected objects.'));this.fireEvent('searchreset');},createActionButtons:function(){this.searchButton=new Ext.Button({text:__('Search'),tooltip:__('Search in target layer using the feature-geometries from the selection'),disabled:true,handler:function(){this.searchFromFeatures();},scope:this});this.cancelButton=new Ext.Button({text:'Cancel',tooltip:__('Cancel ongoing search'),disabled:true,listeners:{click:function(){this.fireEvent('searchcanceled',this);},scope:this}});return this.actionButtons=new Ext.ButtonGroup({fieldLabel:__('Actions'),anchor:"100%",title:null,border:false,items:[this.cancelButton,this.searchButton]});},createDrawFieldSet:function(){this.selectionStatusField=new Heron.widgets.HTMLPanel({html:__('No objects selected'),preventBodyReset:true,bodyCfg:{style:{padding:'2px',border:'0px'}},style:{marginTop:'2px',marginBottom:'2px',fontFamily:'Verdana, Arial, Helvetica, sans-serif',fontSize:'11px',color:'#0000C0'}});return this.drawFieldSet=new Ext.form.FieldSet({xtype:"fieldset",title:null,anchor:"100%",items:[this.createDrawToolPanel({style:{marginTop:'12px',marginBottom:'12px'},activateControl:false}),this.selectionStatusField]});},createSearchTypeCombo:function(){var store=new Ext.data.ArrayStore({fields:['name','value'],data:[['INTERSECTS (default)',OpenLayers.Filter.Spatial.INTERSECTS],['WITHIN',OpenLayers.Filter.Spatial.WITHIN],['CONTAINS',OpenLayers.Filter.Spatial.CONTAINS]]});return this.searchTypeCombo=new Ext.form.ComboBox({mode:'local',listWidth:160,value:store.getAt(0).get("name"),fieldLabel:__('Type of Search'),store:store,displayField:'name',valueField:'value',forceSelection:true,triggerAction:'all',editable:false,listeners:{select:function(cb,record){this.spatialFilterType=record.data['value'];},scope:this}});},createSourceLayerCombo:function(){return this.sourceLayerCombo=new Heron.widgets.LayerCombo({fieldLabel:__('Choose Layer to select with'),sortOrder:this.layerSortOrder,layerFilter:this.layerFilter});},updateSelectionStatusField:function(text){if(this.selectionStatusField.body){this.selectionStatusField.body.update(text);}else{this.selectionStatusField.html=text;}},onFeatureDrawn:function(evt){var selectionLayer=this.selectionLayer;selectionLayer.removeAllFeatures();selectionLayer.addFeatures(evt.feature);var geometries=[selectionLayer.features[0].geometry];if(!this.search(geometries,{targetLayer:this.sourceLayer,projection:this.selectionLayer.projection,units:this.selectionLayer.units})){return;}
this.searchSelect=true;this.searchButton.enable();this.cancelButton.disable();},onSourceLayerSelect:function(layer){if(this.sourceLayer&&this.sourceLayer.metadata){this.sourceLayer.metadata.isSourceLayer=false;}
this.sourceLayer=layer;if(this.sourceLayer&&this.sourceLayer.metadata){this.sourceLayer.metadata.isSourceLayer=true;}
this.searchButton.enable();this.cancelButton.disable();this.drawFieldSet.show();this.activateDrawControl();this.selectionStatusField.show();this.updateStatusPanel();this.updateSelectionStatusField(__('Select a draw tool and draw to select objects from')+(this.sourceLayer?'<br/>"'+this.sourceLayer.name+'"':''));},onSelectionLayerUpdate:function(){},onTargetLayerSelected:function(){this.searchTypeCombo.show();this.actionButtons.show();this.searchButton.enable();this.cancelButton.disable();this.doLayout();this.updateStatusPanel(__('Select the spatial operator (optional) and use the Search button to start your search.'));},onPanelRendered:function(){if(this.fromLastResult&&this.filterFeatures){this.selectionLayer.addFeatures(this.filterFeatures);}
this.activateSearchByFeature();this.resetForm();},onParentShow:function(){this.activateSearchByFeature();},onParentHide:function(){this.deactivateSearchByFeature();this.resetForm();},onBeforeDestroy:function(){this.deactivateSearchByFeature();if(this.selectionLayer){this.selectionLayer.removeAllFeatures();this.map.removeLayer(this.selectionLayer);}},onSearchCanceled:function(searchPanel){Heron.widgets.search.SearchByFeaturePanel.superclass.onSearchCanceled.call(this);this.resetForm();},onSearchSuccess:function(searchPanel,result){var features=this.features=this.filterFeatures=result.olResponse.features;this.searchButton.enable();this.cancelButton.disable();if(this.searchSelect){this.selectionLayer.removeAllFeatures();this.selectionLayer.addFeatures(features);this.targetLayerCombo.hide();this.updateStatusPanel();if(this.selectionLayer.features.length==0){this.updateSelectionStatusField(__('No objects selected.'));return;}
if(this.selectionLayer.features.length>this.maxFilterGeometries){this.updateSelectionStatusField(__('Too many geometries for spatial filter: ')+this.selectionLayer.features.length+' '+'max: '+this.maxFilterGeometries);return;}
this.searchSelect=false;this.targetLayerCombo.setLayers(this.targetLayerFilter(this.map));this.targetLayerCombo.show();var text=this.selectionLayer.features.length+' '+__('objects selected from "')+(this.sourceLayer?this.sourceLayer.name:'')+'"';this.updateSelectionStatusField(text);this.updateStatusPanel(__('Select a target layer to search using the geometries of the selected objects'));}else{Heron.widgets.search.SearchByFeaturePanel.superclass.onSearchSuccess.call(this,searchPanel,result);}},searchFromFeatures:function(){var geometries=[];var features=this.selectionLayer.features;for(var i=0;i<features.length;i++){geometries.push(features[i].geometry);}
this.searchButton.disable();this.cancelButton.enable();if(!this.search(geometries,{spatialFilterType:this.spatialFilterType,targetLayer:this.targetLayer,projection:this.selectionLayer.projection,units:this.selectionLayer.units})){this.selectionLayer.removeAllFeatures();}}});Ext.reg('hr_searchbyfeaturepanel',Heron.widgets.search.SearchByFeaturePanel);Ext.namespace("Heron.widgets.search");Heron.widgets.GXP_QueryPanel_Empty=Ext.extend(Ext.Panel,{});Heron.widgets.search.GXP_QueryPanel=Ext.extend(gxp.QueryPanel,{statusReady:__('Ready'),statusNoQueryLayers:__('No query layers found'),wfsVersion:'1.1.0',title:__('Query Panel'),bodyStyle:'padding: 12px',layerSortOrder:'ASC',caseInsensitiveMatch:false,autoWildCardAttach:false,downloadFormats:null,wfsLayers:undefined,layerFilter:function(map){return map.getLayersBy('metadata',{test:function(metadata){return metadata&&metadata.wfs&&!metadata.wfs.noBBOX;}})},progressMessages:[__('Working on it...'),__('Still searching, please be patient...'),__('Still searching, have you selected an area with too many objects?')],initComponent:function(){var map=this.map=Heron.App.getMap();this.wfsLayers=this.getWFSLayers();var config={map:map,layerStore:new Ext.data.JsonStore({data:{layers:this.wfsLayers},sortInfo:this.layerSortOrder?{field:'title',direction:this.layerSortOrder}:null,root:"layers",fields:["title","name","namespace","url","schema","options"]}),listeners:{ready:function(panel,store){store.addListener("exception",this.onQueryException,this);},layerchange:function(panel,record){this.layerRecord=record;},beforequery:function(panel,store){var area=Math.round(map.getExtent().toGeometry().getGeodesicArea(map.projection));var filter=this.getFilter();return true;},query:function(panel,store){this.fireEvent('searchissued',this);},storeload:function(panel,store){var features=[];store.each(function(record){features.push(record.get("feature"));});var protocol=store.proxy.protocol;var wfsOptions=this.layerRecord.get('options');var filterFormat=new OpenLayers.Format.Filter.v1_1_0({srsName:protocol.srsName});var filterStr=protocol.filter?OpenLayers.Format.XML.prototype.write.apply(filterFormat,[filterFormat.write(protocol.filter)]):null;var downloadInfo={type:'wfs',url:protocol.options.url,downloadFormats:this.downloadFormats?this.downloadFormats:wfsOptions.downloadFormats,params:{typename:protocol.featureType,maxFeatures:undefined,"Content-Disposition":"attachment",filename:protocol.featureType,srsName:protocol.srsName,service:"WFS",version:"1.1.0",request:"GetFeature",filter:filterStr}};var result={olResponse:store.proxy.response,downloadInfo:downloadInfo};this.fireEvent('searchcomplete',panel,result);store.removeListener("exception",this.onQueryException,this);}}};if(config.layerStore.data.items[0]){Ext.apply(this,config);this.addEvents({"searchissued":true,"searchcomplete":true,"searchfailed":true,"searchsuccess":true,"searchaborted":true});this.likeSubstring=this.autoWildCardAttach;Heron.widgets.search.GXP_QueryPanel.superclass.initComponent.call(this);this.addButton(this.createActionButtons());this.addListener("searchissued",this.onSearchIssued,this);this.addListener("searchcomplete",this.onSearchComplete,this);this.addListener("beforedestroy",this.onBeforeDestroy,this);this.addListener("afterrender",this.onPanelRendered,this);if(this.ownerCt){this.ownerCt.addListener("parenthide",this.onParentHide,this);this.ownerCt.addListener("parentshow",this.onParentShow,this);}}else{Ext.apply(this,{});Heron.widgets.GXP_QueryPanel_Empty.superclass.initComponent.apply(this,arguments);}
this.statusPanel=this.add({xtype:"hr_htmlpanel",html:config.layerStore.data.items[0]?this.statusReady:this.statusNoQueryLayers,height:132,preventBodyReset:true,bodyCfg:{style:{padding:'6px',border:'0px'}},style:{marginTop:'24px',paddingTop:'24px',fontFamily:'Verdana, Arial, Helvetica, sans-serif',fontSize:'11px',color:'#0000C0'}});},createActionButtons:function(){this.searchButton=new Ext.Button({text:__('Search'),tooltip:__('Search in target layer using the selected filters'),disabled:false,handler:function(){this.search();},scope:this});this.cancelButton=new Ext.Button({text:__('Cancel'),tooltip:__('Cancel current search'),disabled:true,listeners:{click:function(){this.searchAbort();},scope:this}});return this.actionButtons=new Ext.ButtonGroup({fieldLabel:null,anchor:"100%",title:null,border:false,width:160,padding:'2px',bodyBorder:false,style:{border:'0px'},items:[this.cancelButton,this.searchButton]});},getWFSLayers:function(){var self=this;if(this.wfsLayers){return this.wfsLayers;}
var wmsLayers=this.layerFilter(this.map);var wfsLayers=[];Ext.each(wmsLayers,function(wmsLayer){var wfsOpts=wmsLayer.metadata.wfs;var protocol=wfsOpts.protocol;if(wfsOpts.protocol==='fromWMSLayer'){protocol=OpenLayers.Protocol.WFS.fromWMSLayer(wmsLayer);if(protocol.url instanceof Array){protocol.url=Heron.Utils.randArrayElm(protocol.url);protocol.options.url=protocol.url;}}else{protocol=wfsOpts.protocol;}
var url=protocol.url.indexOf('?')==protocol.url.length-1?protocol.url.slice(0,-1):protocol.url;var featureType=protocol.featureType;var featurePrefix=wfsOpts.featurePrefix;var fullFeatureType=featurePrefix?featurePrefix+':'+featureType:featureType;var wfsVersion=protocol.version?protocol.version:self.version;var outputFormat=protocol.outputFormat?'&outputFormat='+protocol.outputFormat:'';var wfsLayer={title:wmsLayer.name,name:featureType,namespace:wfsOpts.featureNS,url:url,schema:url+'?service=WFS&version='+wfsVersion+'&request=DescribeFeatureType&typeName='+fullFeatureType+outputFormat,options:wfsOpts};wfsLayers.push(wfsLayer);});return wfsLayers;},getFeatureType:function(){return this.layerRecord?this.layerRecord.get('name'):'heron';},updateStatusPanel:function(text){this.statusPanel.body.update(text);},onPanelRendered:function(){},onParentShow:function(){},onParentHide:function(){},onBeforeDestroy:function(){},onQueryException:function(type,action,obj,response_error,o_records){this.searchButton.enable();if(this.timer){clearInterval(this.timer);this.timer=null;}
this.updateStatusPanel(__('Search Failed'));},onSearchIssued:function(){this.searchState="searchissued";this.response=null;this.features=null;this.updateStatusPanel(__('Searching...'));if(this.timer){clearInterval(this.timer);this.timer=null;}
this.searchButton.disable();var self=this;var startTime=new Date().getTime()/1000;this.timer=setInterval(function(){if(self.searchState!='searchissued'){return;}
self.updateStatusPanel(Math.floor(new Date().getTime()/1000-startTime)+' '+__('Seconds')+' - '+
self.progressMessages[Math.floor(Math.random()*self.progressMessages.length)]);},4000);},onSearchComplete:function(searchPanel,result){this.searchButton.enable();this.cancelButton.disable();if(this.timer){clearInterval(this.timer);this.timer=null;}
if(this.searchState=='searchaborted'){return;}
this.searchState="searchcomplete";var features=result.olResponse.features;var featureCount=features?features.length:0;this.updateStatusPanel(__('Search Completed: ')+featureCount+' '+(featureCount!=1?__('Results'):__('Result')));this.fireEvent('searchsuccess',searchPanel,result);},searchAbort:function(){if(this.timer){clearInterval(this.timer);this.timer=null;}
if(this.featureStore&&this.featureStore.proxy&&this.featureStore.proxy.protocol){this.featureStore.proxy.protocol.abort(this.featureStore.proxy.response);}
this.fireEvent('searchaborted',this);this.searchState='searchaborted';this.searchButton.enable();this.cancelButton.disable();this.updateStatusPanel(__('Search aborted'));},search:function(){this.query();this.cancelButton.enable();}});Ext.reg('hr_gxpquerypanel',Heron.widgets.search.GXP_QueryPanel);Ext.namespace("Heron.widgets.ToolbarBuilder");Heron.widgets.ToolbarBuilder.defs={baselayer:{options:{id:"baselayercombo"},create:function(mapPanel,options){if(!options.initialConfig){options.initialConfig={};}
Ext.apply(options.initialConfig,options);options.initialConfig.map=mapPanel.getMap();return new Heron.widgets.BaseLayerCombo(options);}},geocoder:{options:{id:"geocodercombo"},create:function(mapPanel,options){return new Heron.widgets.search.GeocoderCombo(options);}},scale:{options:{id:"scalecombo"},create:function(mapPanel,options){if(!options.initialConfig){options.initialConfig={};}
Ext.apply(options.initialConfig,options);return new Heron.widgets.ScaleSelectorCombo(options);}},featureinfo:{options:{tooltip:__('Feature information'),iconCls:"icon-getfeatureinfo",enableToggle:true,pressed:false,id:"featureinfo",toggleGroup:"toolGroup",popupWindowDefaults:{title:__('Feature Info'),width:360,height:200,anchored:false,hideonmove:false},controlDefaults:{maxFeatures:8,hover:false,drillDown:true,infoFormat:"application/vnd.ogc.gml",queryVisible:true}},create:function(mapPanel,options){if(options.getfeatureControl){options.controlDefaults=Ext.apply(options.controlDefaults,options.getfeatureControl);}
options.control=new OpenLayers.Control.WMSGetFeatureInfo(options.controlDefaults);if(options.popupWindow){var self=this;var popupWindowProps=Ext.apply(options.popupWindowDefaults,options.popupWindow);popupWindowProps.olControl=options.control;popupWindowProps.featureInfoPanel=options.popupWindow?options.popupWindow.featureInfoPanel:null;var createPopupWindow=function(){if(!self.featurePopupWindow){self.featurePopupWindow=new Heron.widgets.search.FeatureInfoPopup(popupWindowProps);}};if(options.pressed){createPopupWindow();}
options.handler=function(){createPopupWindow();self.featurePopupWindow.hide();};}
return new GeoExt.Action(options);}},help:{options:{tooltip:__('Help'),iconCls:"icon-help",enableToggle:false,pressed:false,id:"helpinfo",content:'<b>Default help info</b>',contentUrl:null,popupWindowDefaults:{title:__('Help'),border:true,layoutConfig:{padding:'0'},width:460,height:540,autoScroll:true,items:[{xtype:'hr_htmlpanel',height:'100%',width:'95%',preventBodyReset:true,bodyBorder:false,border:false,style:{paddingTop:'12px',paddingBottom:'12px',paddingLeft:'10px',paddingRight:'10px',fontFamily:'Verdana, Arial, Helvetica, sans-serif',fontSize:'10px',background:'#FFFFFF',color:'#111111'}}]}},create:function(mapPanel,options){options.handler=function(){var popupOptions=Ext.apply(options.popupWindowDefaults,options.popupWindow);if(options.contentUrl){popupOptions.items[0].autoLoad={url:options.contentUrl};}else{popupOptions.items[0].html=options.content}
new Ext.Window(popupOptions).show();};return new Ext.Action(options);}},tooltips:{options:{tooltip:__('Feature tooltips'),iconCls:"icon-featuretooltip",enableToggle:true,pressed:false,id:"tooltips",toggleGroup:"tooltipsGrp",popupWindowDefaults:{title:__('FeatureTooltip'),anchored:true,hideonmove:true,height:150},controlDefaults:{maxFeatures:1,hover:true,drillDown:false,infoFormat:"application/vnd.ogc.gml",queryVisible:true}},create:function(mapPanel,options){return Heron.widgets.ToolbarBuilder.defs.featureinfo.create(mapPanel,options);}},pan:{options:{tooltip:__('Pan'),iconCls:"icon-hand",enableToggle:true,pressed:true,control:new OpenLayers.Control.Navigation(),id:"pan",toggleGroup:"toolGroup"},create:function(mapPanel,options){return new GeoExt.Action(options);}},upload:{options:{tooltip:__('Upload features from local file'),iconCls:"icon-upload",enableToggle:false,pressed:false,id:"hr-upload-button",toggleGroup:"toolGroup",upload:{layerName:__('My Upload'),visibleOnUpload:true,url:Heron.globals.serviceUrl,params:{action:'upload',mime:'text/html',encoding:'escape'},formats:[{name:'Well-Known-Text (WKT)',fileExt:'.wkt',mimeType:'text/plain',formatter:'OpenLayers.Format.WKT'},{name:'Geographic Markup Language - v2 (GML2)',fileExt:'.gml',mimeType:'text/xml',formatter:'OpenLayers.Format.GML'},{name:'Geographic Markup Language - v3 (GML3)',fileExt:'.gml',mimeType:'text/xml',formatter:'OpenLayers.Format.GML.v3'},{name:'GeoJSON',fileExt:'.json',mimeType:'text/plain',formatter:'OpenLayers.Format.GeoJSON'},{name:'GPS Exchange Format (GPX)',fileExt:'.gpx',mimeType:'text/xml',formatter:'OpenLayers.Format.GPX'},{name:'Keyhole Markup Language (KML)',fileExt:'.kml',mimeType:'text/xml',formatter:'OpenLayers.Format.KML'},{name:'CSV (with X,Y)',fileExt:'.csv',mimeType:'text/plain',formatter:'OpenLayers.Format.GeoJSON'},{name:'ESRI Shapefile (zipped)',fileExt:'.zip',mimeType:'text/plain',formatter:'OpenLayers.Format.GeoJSON'}],fileProjection:new OpenLayers.Projection('EPSG:4326')}},create:function(mapPanel,options){var map=mapPanel.getMap();options.upload.map=map;var layers=map.getLayersByName(options.upload.layerName);var layer;if(layers.length==0){layer=new OpenLayers.Layer.Vector(options.upload.layerName);map.addLayers([layer]);}else{layer=layers[0];}
options.control=new OpenLayers.Editor.Control.UploadFeature(layer,options.upload);return new GeoExt.Action(options);}},zoomin:{options:{tooltip:__('Zoom in'),iconCls:"icon-zoom-in",enableToggle:true,pressed:false,control:new OpenLayers.Control.ZoomBox({title:__('Zoom in'),out:false}),id:"zoomin",toggleGroup:"toolGroup"},create:function(mapPanel,options){return new GeoExt.Action(options);}},zoomout:{options:{tooltip:__('Zoom out'),iconCls:"icon-zoom-out",enableToggle:true,pressed:false,control:new OpenLayers.Control.ZoomBox({title:__('Zoom out'),out:true}),id:"zoomout",toggleGroup:"toolGroup"},create:function(mapPanel,options){return new GeoExt.Action(options);}},zoomvisible:{options:{tooltip:__('Zoom to full extent'),iconCls:"icon-zoom-visible",enableToggle:false,pressed:false,control:new OpenLayers.Control.ZoomToMaxExtent(),id:"zoomvisible"},create:function(mapPanel,options){return new GeoExt.Action(options);}},zoomprevious:{options:{tooltip:__('Zoom previous'),iconCls:"icon-zoom-previous",enableToggle:false,disabled:true,pressed:false,id:"zoomprevious"},create:function(mapPanel,options){if(!mapPanel.historyControl){mapPanel.historyControl=new OpenLayers.Control.NavigationHistory();mapPanel.getMap().addControl(mapPanel.historyControl);}
options.control=mapPanel.historyControl.previous;return new GeoExt.Action(options);}},zoomnext:{options:{tooltip:__('Zoom next'),iconCls:"icon-zoom-next",enableToggle:false,disabled:true,pressed:false,id:"zoomnext"},create:function(mapPanel,options){if(!mapPanel.historyControl){mapPanel.historyControl=new OpenLayers.Control.NavigationHistory();mapPanel.getMap().addControl(mapPanel.historyControl);}
options.control=mapPanel.historyControl.next;return new GeoExt.Action(options);}},measurelength:{options:{tooltip:__('Measure length'),iconCls:"icon-measure-length",enableToggle:true,pressed:false,measureLastLength:0.0,control:new OpenLayers.Control.Measure(OpenLayers.Handler.Path,{persist:true,immediate:true,displayClass:"olControlMeasureDistance",handlerOptions:{layerOptions:{styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{"Point":{pointRadius:10,graphicName:"square",fillColor:"white",fillOpacity:0.25,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},"Line":{strokeWidth:1,strokeOpacity:1,strokeColor:"#FF0000",strokeDashstyle:"solid"}}})]})})}}}),id:"measurelength",toggleGroup:"toolGroup"},create:function(mapPanel,options){var action=new GeoExt.Action(options);var map=mapPanel.getMap();var controls=map.getControlsByClass("OpenLayers.Control.Measure");Heron.widgets.ToolbarBuilder.onMeasurementsActivate=function(event){Ext.getCmp("measurelength").measureLastLength=0.0;};Heron.widgets.ToolbarBuilder.onMeasurements=function(event){var units=event.units;var measure=event.measure;var out="";if(event.order==1){out+=__('Length')+": "+measure.toFixed(2)+" "+units;var item=Ext.getCmp("measurelength");item.measureLastLength=0.0;}else{out+=__('Area')+": "+measure.toFixed(2)+" "+units+"&#178;";}
Ext.getCmp("bbar_measure").setText(out);};Heron.widgets.ToolbarBuilder.onMeasurementsPartial=function(event){var units=event.units;var measure=event.measure;var out="";if(event.order==1){out+=__('Length')+": "+measure.toFixed(2)+" "+units;var item=Ext.getCmp("measurelength");item.measureLastLength=measure;}else{out+=__('Area')+": "+measure.toFixed(2)+" "+units+"&#178;";}
Ext.getCmp("bbar_measure").setText(out);};Heron.widgets.ToolbarBuilder.onMeasurementsDeactivate=function(event){Ext.getCmp("bbar_measure").setText("");};for(var i=0;i<controls.length;i++){if(controls[i].displayClass=='olControlMeasureDistance'){controls[i].geodesic=options.geodesic;controls[i].events.register("activate",map,Heron.widgets.ToolbarBuilder.onMeasurementsActivate);controls[i].events.register("measure",map,Heron.widgets.ToolbarBuilder.onMeasurements);controls[i].events.register("measurepartial",map,Heron.widgets.ToolbarBuilder.onMeasurementsPartial);controls[i].events.register("deactivate",map,Heron.widgets.ToolbarBuilder.onMeasurementsDeactivate);break;}}
return action;}},measurearea:{options:{tooltip:__('Measure area'),iconCls:"icon-measure-area",enableToggle:true,pressed:false,control:new OpenLayers.Control.Measure(OpenLayers.Handler.Polygon,{persist:true,immediate:true,displayClass:"olControlMeasureArea",handlerOptions:{layerOptions:{styleMap:new OpenLayers.StyleMap({"default":new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{"Point":{pointRadius:10,graphicName:"square",fillColor:"white",fillOpacity:0.25,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},"Polygon":{strokeWidth:1,strokeOpacity:1,strokeColor:"#FF0000",strokeDashstyle:"solid",fillColor:"#FFFFFF",fillOpacity:0.5}}})]})})}}}),id:"measurearea",toggleGroup:"toolGroup"},create:function(mapPanel,options){var action=new GeoExt.Action(options);var map=mapPanel.getMap();var controls=map.getControlsByClass("OpenLayers.Control.Measure");for(var i=0;i<controls.length;i++){if(controls[i].displayClass=='olControlMeasureArea'){controls[i].geodesic=options.geodesic;controls[i].events.register("activate",map,Heron.widgets.ToolbarBuilder.onMeasurementsActivate);controls[i].events.register("measure",map,Heron.widgets.ToolbarBuilder.onMeasurements);controls[i].events.register("measurepartial",map,Heron.widgets.ToolbarBuilder.onMeasurementsPartial);controls[i].events.register("deactivate",map,Heron.widgets.ToolbarBuilder.onMeasurementsDeactivate);break;}}
return action;}},oleditor:{options:{tooltip:__('Draw Features'),iconCls:"icon-mapedit",enableToggle:true,pressed:false,id:"mapeditor",toggleGroup:"toolGroup",olEditorOptions:{activeControls:['UploadFeature','DownloadFeature','Separator','Navigation','SnappingSettings','CADTools','Separator','DeleteAllFeatures','DeleteFeature','DragFeature','SelectFeature','Separator','DrawHole','ModifyFeature','Separator'],featureTypes:['text','polygon','path','point'],language:'en',DownloadFeature:{url:Heron.globals.serviceUrl,params:{action:'download',mime:'text/plain',filename:'editor',encoding:'none'},formats:[{name:'Well-Known-Text (WKT)',fileExt:'.wkt',mimeType:'text/plain',formatter:'OpenLayers.Format.WKT'},{name:'Geographic Markup Language - v2 (GML2)',fileExt:'.gml',mimeType:'text/xml',formatter:new OpenLayers.Format.GML.v2({featureType:'oledit',featureNS:'http://geops.de'})},{name:'Geographic Markup Language - v3 (GML3)',fileExt:'.gml',mimeType:'text/xml',formatter:new OpenLayers.Format.GML.v3({featureType:'oledit',featureNS:'http://geops.de'})},{name:'GeoJSON',fileExt:'.json',mimeType:'text/plain',formatter:'OpenLayers.Format.GeoJSON'},{name:'GPS Exchange Format (GPX)',fileExt:'.gpx',mimeType:'text/xml',formatter:'OpenLayers.Format.GPX'},{name:'Keyhole Markup Language (KML)',fileExt:'.kml',mimeType:'text/xml',formatter:'OpenLayers.Format.KML'}],fileProjection:new OpenLayers.Projection('EPSG:4326')},UploadFeature:{url:Heron.globals.serviceUrl,params:{action:'upload',mime:'text/html',encoding:'escape'},formats:[{name:'Well-Known-Text (WKT)',fileExt:'.wkt',mimeType:'text/plain',formatter:'OpenLayers.Format.WKT'},{name:'Geographic Markup Language - v2 (GML2)',fileExt:'.gml',mimeType:'text/xml',formatter:'OpenLayers.Format.GML'},{name:'Geographic Markup Language - v3 (GML3)',fileExt:'.gml',mimeType:'text/xml',formatter:'OpenLayers.Format.GML.v3'},{name:'GeoJSON',fileExt:'.json',mimeType:'text/plain',formatter:'OpenLayers.Format.GeoJSON'},{name:'GPS Exchange Format (GPX)',fileExt:'.gpx',mimeType:'text/xml',formatter:'OpenLayers.Format.GPX'},{name:'Keyhole Markup Language (KML)',fileExt:'.kml',mimeType:'text/xml',formatter:'OpenLayers.Format.KML'},{name:'CSV (with X,Y)',fileExt:'.csv',mimeType:'text/plain',formatter:'OpenLayers.Format.GeoJSON'},{name:'ESRI Shapefile (zipped)',fileExt:'.zip',mimeType:'text/plain',formatter:'OpenLayers.Format.GeoJSON'}],fileProjection:new OpenLayers.Projection('EPSG:4326')}}},create:function(mapPanel,options){OpenLayers.Lang.setCode(options.olEditorOptions.language);var map=mapPanel.getMap();this.editor=new OpenLayers.Editor(map,options.olEditorOptions);this.startEditor=function(self){var editor=self.editor;if(!editor){return;}
if(editor.editLayer){editor.editLayer.setVisibility(true);}
self.editor.startEditMode();};this.stopEditor=function(self){var editor=self.editor;if(!editor){return;}
if(editor.editLayer){}
editor.stopEditMode();};var self=this;options.handler=function(cmp,event){if(cmp.pressed===true){self.startEditor(self);}else{self.stopEditor(self);}};if(options.pressed){this.startEditor(self);}
options.control=this.editor.editorPanel;return new GeoExt.Action(options);}},any:{options:{tooltip:__('Anything is allowed here'),text:__('Any valid Toolbar.add() config goes here')},create:function(mapPanel,options){return options;}},search_nominatim:{options:{tooltip:__('Search Nominatim'),id:"search_nominatim"},create:function(mapPanel,options){return new Heron.widgets.search.NominatimSearchCombo(options);}},namesearch:{options:{id:"namesearch"},create:function(mapPanel,options){return Ext.create(options);}},searchcenter:{options:{id:"searchcenter",tooltip:__('Search'),iconCls:"icon-find",pressed:false,enableToggle:false,searchWindowDefault:{title:__('Search'),layout:"fit",closeAction:"hide",x:100,width:400,height:400}},create:function(mapPanel,options){var searchWindow,searchWindowId=options.id;var pressButton=function(){var sc=Ext.getCmp(searchWindowId);if(sc&&!sc.pressed){sc.toggle();}};var depressButton=function(){var sc=Ext.getCmp(searchWindowId);if(sc&&sc.pressed){sc.toggle();}};var showSearchWindow=function(){if(!searchWindow){var windowOptions=options.searchWindowDefault;Ext.apply(windowOptions,options.searchWindow);searchWindow=new Ext.Window(windowOptions);searchWindow.on('hide',depressButton);searchWindow.on('show',pressButton);}
searchWindow.show();};var toggleSearchWindow=function(){if(searchWindow&&searchWindow.isVisible()){searchWindow.hide();}else{showSearchWindow();}};if(options.show){options.pressed=true;}
if(options.pressed||options.show){showSearchWindow();}
options.handler=function(){toggleSearchWindow();};if(options.enableToggle){return new GeoExt.Action(options)}else{return new Ext.Action(options);}}},printdialog:{options:{id:"hr_printdialog",title:__('Print Dialog'),tooltip:__('Print Dialog Popup with Preview Map'),iconCls:"icon-printer",enableToggle:false,pressed:false,windowTitle:__('Print Preview'),windowWidth:400,method:'POST',url:null,legendDefaults:{useScaleParameter:false,baseParams:{FORMAT:"image/png"}},showTitle:true,mapTitle:null,mapTitleYAML:"mapTitle",showComment:true,mapComment:null,mapCommentYAML:"mapComment",showFooter:false,mapFooter:null,mapFooterYAML:"mapFooter",printAttribution:true,mapAttribution:null,mapAttributionYAML:"mapAttribution",showRotation:true,showLegend:true,showLegendChecked:false,mapLimitScales:true,showOutputFormats:false,mapPreviewAutoHeight:false,mapPreviewHeight:300},create:function(mapPanel,options){options.handler=function(){if(!Heron.widgets.ToolbarBuilder.checkCanWePrint(mapPanel.getMap().layers)){return;}
var printWindow=new Heron.widgets.PrintPreviewWindow({title:options.windowTitle,modal:true,border:false,resizable:false,width:options.windowWidth,autoHeight:true,hropts:{mapPanel:mapPanel,method:options.method,url:options.url,legendDefaults:options.legendDefaults,showTitle:options.showTitle,mapTitle:options.mapTitle,mapTitleYAML:options.mapTitleYAML,showComment:options.showComment,mapComment:options.mapComment,mapCommentYAML:options.mapCommentYAML,showFooter:options.showFooter,mapFooter:options.mapFooter,mapFooterYAML:options.mapFooterYAML,printAttribution:options.printAttribution,mapAttribution:options.mapAttribution,mapAttributionYAML:options.mapAttributionYAML,showRotation:options.showRotation,showLegend:options.showLegend,showLegendChecked:options.showLegendChecked,mapLimitScales:options.mapLimitScales,showOutputFormats:options.showOutputFormats,mapPreviewAutoHeight:options.mapPreviewAutoHeight,mapPreviewHeight:options.mapPreviewHeight}});};return new Ext.Action(options);}},printdirect:{options:{id:"printdirect",tooltip:__('Print Visible Map Area Directly'),iconCls:"icon-print-direct",enableToggle:false,pressed:false,method:'POST',url:null,mapTitle:null,mapTitleYAML:"mapTitle",mapComment:__('This is a simple map directly printed.'),mapCommentYAML:"mapComment",mapFooter:null,mapFooterYAML:"mapFooter",printAttribution:true,mapAttribution:null,mapAttributionYAML:"mapAttribution",mapPrintLayout:"A4",mapPrintDPI:"75",mapPrintLegend:false,mapPrintOutputFormat:null,excludeLayers:['OpenLayers.Handler.Polygon','OpenLayers.Handler.RegularPolygon','OpenLayers.Handler.Path','OpenLayers.Handler.Point'],legendDefaults:{useScaleParameter:true,baseParams:{FORMAT:"image/png"}}},create:function(mapPanel,options){options.handler=function(){if(!Heron.widgets.ToolbarBuilder.checkCanWePrint(mapPanel.getMap().layers)){return;}
var busyMask=new Ext.LoadMask(Ext.getBody(),{msg:__('Create PDF...')});busyMask.show();Ext.Ajax.request({url:options.url+'/info.json',method:'GET',params:null,success:function(result,request){var printCapabilities=Ext.decode(result.responseText);var printProvider=new GeoExt.data.PrintProvider({method:options.method,capabilities:printCapabilities,outputFormatsEnabled:(options.mapPrintOutputFormat!=null),customParams:{},listeners:{"printexception":function(printProvider,result){Ext.Msg.alert(__('Warning'),__('Error from Print server: ')+result.statusText);},"beforeencodelayer":function(printProvider,layer){for(var i=0;i<options.excludeLayers.length;i++){if(layer.name==options.excludeLayers[i]){return false;}}
return true;}}});printProvider.customParams[options.mapTitleYAML]=(options.mapTitle)?options.mapTitle:'';printProvider.customParams[options.mapCommentYAML]=(options.mapComment)?options.mapComment:'';printProvider.customParams[options.mapFooterYAML]=(options.mapFooter)?options.mapFooter:'';printProvider.customParams[options.mapAttributionYAML]='';if(options.printAttribution){if(options.mapAttribution){printProvider.customParams[options.mapAttributionYAML]=options.mapAttribution;}else{var attributions=[];var map=mapPanel.getMap();if(map&&map.layers){for(var i=0,len=map.layers.length;i<len;i++){var layer=map.layers[i];if(layer.attribution&&layer.getVisibility()){if(OpenLayers.Util.indexOf(attributions,layer.attribution)===-1){attributions.push(layer.attribution);}}}
var tmp=document.createElement("DIV");tmp.innerHTML=attributions?attributions:'';printProvider.customParams[options.mapAttributionYAML]=tmp.textContent||tmp.innerText||"";}}}
if((printProvider.layouts.getCount()>1)&&(options.mapPrintLayout)){var index=printProvider.layouts.find('name',options.mapPrintLayout);if(index!=-1){printProvider.setLayout(printProvider.layouts.getAt(index));}}
if((printProvider.dpis.getCount()>1)&&(options.mapPrintDPI)){var index=printProvider.dpis.find('value',options.mapPrintDPI);if(index!=-1){printProvider.setDpi(printProvider.dpis.getAt(index));}}
if(printProvider.outputFormatsEnabled&&options.mapPrintOutputFormat&&(printProvider.outputFormats.getCount()>0)){var index=printProvider.outputFormats.find('name',options.mapPrintOutputFormat);if(index!=-1){printProvider.setOutputFormat(printProvider.outputFormats.getAt(index));}}
if(options.mapPrintLegend){var legendPanel=new Heron.widgets.LayerLegendPanel({renderTo:document.body,hidden:true,defaults:options.legendDefaults});}
var printPage=new GeoExt.data.PrintPage({printProvider:printProvider});printPage.fit(mapPanel,true);printProvider.print(mapPanel,printPage,options.mapPrintLegend&&{legend:legendPanel});busyMask.hide();},failure:function(result,request){busyMask.hide();Ext.Msg.alert(__('Warning'),__('Error getting Print options from server: ')+options.url);}});};return new Ext.Action(options);}},coordinatesearch:{options:{id:"coordinatesearch",tooltip:__('Enter coordinates to go to location on map'),iconCls:"icon-map-pin",enableToggle:false,pressed:false,formWidth:340,formPageX:200,formPageY:75,buttonAlign:'center'},create:function(mapPanel,options){options.handler=function(){if(!this.coordPopup){var sp=new Heron.widgets.search.CoordSearchPanel({});this.coordPopup=new Ext.Window({layout:'auto',resizable:false,autoHeight:true,pageX:options.formPageX,pageY:options.formPageY,width:options.formWidth,closeAction:'hide',title:__('Go to coordinates'),items:[new Heron.widgets.search.CoordSearchPanel({deferredRender:false,border:false,title:options.title?options.title:null,titleDescription:options.titleDescription?options.titleDescription:sp.titleDescription,titleDescriptionStyle:options.titleDescriptionStyle?options.titleDescriptionStyle:sp.titleDescriptionStyle,bodyBaseCls:options.bodyBaseCls?options.bodyBaseCls:sp.bodyBaseCls,bodyItemCls:options.bodyItemCls?options.bodyItemCls:null,bodyCls:options.bodyCls?options.bodyCls:null,fieldMaxWidth:options.fieldMaxWidth?options.fieldMaxWidth:sp.fieldMaxWidth,fieldLabelWidth:options.fieldLabelWidth?options.fieldLabelWidth:sp.fieldLabelWidth,fieldStyle:options.fieldStyle?options.fieldStyle:sp.fieldStyle,fieldLabelStyle:options.fieldLabelStyle?options.fieldLabelStyle:sp.fieldLabelStyle,layerName:options.layerName?options.layerName:sp.layerName,onProjectionIndex:options.onProjectionIndex?options.onProjectionIndex:sp.onProjectionIndex,onZoomLevel:options.onZoomLevel?options.onZoomLevel:sp.onZoomLevel,showProjection:options.showProjection?options.showProjection:sp.showProjection,showZoom:options.showZoom?options.showZoom:sp.showZoom,showAddMarkers:options.showAddMarkers?options.showAddMarkers:sp.showAddMarkers,checkAddMarkers:options.checkAddMarkers?options.checkAddMarkers:sp.checkAddMarkers,showHideMarkers:options.showHideMarkers?options.showHideMarkers:sp.showHideMarkers,checkHideMarkers:options.checkHideMarkers?options.checkHideMarkers:sp.checkHideMarkers,showResultMarker:options.showResultMarker?options.showResultMarker:sp.showResultMarker,fieldResultMarkerStyle:options.fieldResultMarkerStyle?options.fieldResultMarkerStyle:sp.fieldResultMarkerStyle,fieldResultMarkerText:options.fieldResultMarkerText?options.fieldResultMarkerText:sp.fieldResultMarkerText,fieldResultMarkerSeparator:options.fieldResultMarkerSeparator?options.fieldResultMarkerSeparator:sp.fieldResultMarkerSeparator,fieldResultMarkerPrecision:options.fieldResultMarkerPrecision?options.fieldResultMarkerPrecision:sp.fieldResultMarkerPrecision,removeMarkersOnClose:options.removeMarkersOnClose?options.removeMarkersOnClose:sp.removeMarkersOnClose,showRemoveMarkersBtn:options.showRemoveMarkersBtn?options.showRemoveMarkersBtn:sp.showRemoveMarkersBtn,buttonAlign:options.buttonAlign?options.buttonAlign:sp.buttonAlign,hropts:options.hropts?options.hropts:null})]});}
if(this.coordPopup.isVisible()){this.coordPopup.hide();}else{this.coordPopup.show(this);}};return new Ext.Action(options);}},vectorstyler:{options:{id:"styler",tooltip:__('Edit vector Layer styles'),iconCls:"icon-palette",enableToggle:false,pressed:false,formWidth:340,formPageX:200,formPageY:75,buttonAlign:'center'},create:function(mapPanel,options){options.handler=function(){if(!this.stylerPopup){var layer=mapPanel.map.getLayersByName('RD Info - Punten')[0];var layerRecord=mapPanel.layers.getByLayer(layer);var url='http://kademo.nl/gs2';this.stylerPopup=new Ext.Window({layout:'auto',resizable:false,autoHeight:true,pageX:options.formPageX,pageY:options.formPageY,width:options.formWidth,closeAction:'hide',title:__('Style Editor'),items:[{xtype:"gxp_wmsstylesdialog",layerRecord:layerRecord,plugins:[{ptype:"gxp_memorystylewriter",baseUrl:url}],listeners:{"styleselected":function(cmp,style){layer.mergeNewParams({styles:style});},"modified":function(cmp,style){cmp.saveStyles();},"saved":function(cmp,style){layer.mergeNewParams({_olSalt:Math.random(),styles:style});},scope:this}}]});}
if(this.stylerPopup.isVisible()){this.stylerPopup.hide();}else{this.stylerPopup.show(this);}};return new Ext.Action(options);}},addbookmark:{options:{id:"addbookmark",tooltip:__('Bookmark current map context (layers, zoom, extent)'),iconCls:"icon-bookmark",enableToggle:false,disabled:false,pressed:false},create:function(mapPanel,options){options.handler=function(){var bookmarksPanel=Heron.widgets.Bookmarks.getBookmarksPanel(this);if(!bookmarksPanel){Ext.Msg.alert(__('Warning'),__('Error: No \'BookmarksPanel\' found.'));return null;}
bookmarksPanel.onAddBookmark();};return new GeoExt.Action(options);}},mapopen:{options:{id:"mapopen",tooltip:__('Open a map context (layers, styling, extent) from file'),iconCls:"icon-map-open",enableToggle:false,disabled:false,pressed:false},create:function(mapPanel,options){options.handler=function(){Heron.data.MapContext.openContext(mapPanel,options);}
return new GeoExt.Action(options);}},mapsave:{options:{id:"mapsave",tooltip:__('Save current map context (layers, styling, extent) to file'),iconCls:"icon-map-save",enableToggle:false,disabled:false,pressed:false,mime:'text/xml',fileName:'heron_map',fileExt:'.cml'},create:function(mapPanel,options){options.handler=function(){Heron.data.MapContext.saveContext(mapPanel,options);}
return new GeoExt.Action(options);}},epsgpanel:{options:{id:"map-panel-epsg",text:"",width:80,xtype:"tbtext"},create:function(mapPanel,options){return Ext.create(options);}},xcoord:{options:{id:"x-coord",text:"X:",width:80,xtype:"tbtext"},create:function(mapPanel,options){return Ext.create(options);}},ycoord:{options:{id:"y-coord",text:"Y:",width:80,xtype:"tbtext"},create:function(mapPanel,options){return Ext.create(options);}},measurepanel:{options:{id:"bbar_measure",text:"",xtype:"tbtext"},create:function(mapPanel,options){return Ext.create(options);}}};Heron.widgets.ToolbarBuilder.checkCanWePrint=function(layers){var failingLayers='';for(var l=0;l<layers.length;l++){var nextLayer=layers[l];if(!nextLayer.visibility||!nextLayer.disallowPrinting){continue;}
failingLayers+="\n - "+nextLayer.name;if(nextLayer.isBaseLayer){failingLayers+=__(' [Baselayer]');}}
if(failingLayers!=''){Ext.Msg.alert(__('Warning'),__('!!Cannot Print!!\nThis service disallows printing of the following layer(s).\nPlease disable these layers and print again.\n')+failingLayers);return false;}
return true;};Heron.widgets.ToolbarBuilder.setItemDef=function(type,createFun,defaultOptions){Heron.widgets.ToolbarBuilder.defs[type].create=createFun;Heron.widgets.ToolbarBuilder.defs[type].options=defaultOptions?defaultOptions:{};};Heron.widgets.ToolbarBuilder.build=function(mapPanel,config,toolbar){var toolbarItems=[];if(typeof(config)!=="undefined"){for(var i=0;i<config.length;i++){var itemDef=config[i];if(itemDef.type=="-"){toolbarItems.push("-");continue;}
if(itemDef.type=="->"){toolbarItems.push("->");continue;}
var createFun;var defaultItemDef=Heron.widgets.ToolbarBuilder.defs[itemDef.type];if(itemDef.create){createFun=itemDef.create;}else if(defaultItemDef&&defaultItemDef.create){createFun=defaultItemDef.create;}
if(!createFun){continue;}
var coreOptions={map:mapPanel.getMap(),scope:mapPanel};var defaultItemOptions={};if(defaultItemDef&&defaultItemDef.options){defaultItemOptions=defaultItemDef.options;}
var extraOptions=itemDef.options?itemDef.options:{};var options=Ext.apply(coreOptions,extraOptions,defaultItemOptions);var item=createFun(mapPanel,options);if(item){toolbarItems.push(item);}}}
if(toolbarItems.length>0){toolbar.add(toolbarItems);}else{toolbar.setVisible(false);}};Ext.namespace("Heron.widgets");Heron.widgets.XMLTreePanel=Ext.extend(Ext.tree.TreePanel,{initComponent:function(){Ext.apply(this,{autoScroll:true,rootVisible:false,root:this.root?this.root:{nodeType:'async',text:'Ext JS',draggable:false,id:'source'}});Heron.widgets.XMLTreePanel.superclass.initComponent.apply(this,arguments);},xmlTreeFromUrl:function(url){var self=this;Ext.Ajax.request({url:url,method:'GET',params:null,success:function(result,request){self.xmlTreeFromDoc(self,result.responseXML);},failure:function(result,request){Ext.Msg.alert(__('Warning'),__('Error in ajax request'));}});},xmlTreeFromText:function(self,text){var doc=new OpenLayers.Format.XML().read(text);self.xmlTreeFromDoc(self,doc);return doc;},xmlTreeFromDoc:function(self,doc){self.setRootNode(self.treeNodeFromXml(self,doc.documentElement||doc));},treeNodeFromXml:function(self,XmlEl){var t=((XmlEl.nodeType==3)?XmlEl.nodeValue:XmlEl.tagName);if(t.replace(/\s/g,'').length==0){return null;}
var result=new Ext.tree.TreeNode({text:t});var xmlns='xmlns',xsi='xsi';if(XmlEl.nodeType==1){Ext.each(XmlEl.attributes,function(a){var nodeName=a.nodeName;if(!(XmlEl.parentNode.nodeType==9&&(nodeName.substring(0,xmlns.length)===xmlns||nodeName.substring(0,xsi.length)===xsi))){var c=new Ext.tree.TreeNode({text:a.nodeName});c.appendChild(new Ext.tree.TreeNode({text:a.nodeValue}));result.appendChild(c);}});Ext.each(XmlEl.childNodes,function(el){if((el.nodeType==1)||(el.nodeType==3)){var c=self.treeNodeFromXml(self,el);if(c){result.appendChild(c);}}});}
return result;}});Ext.reg('hr_xmltreepanel',Heron.widgets.XMLTreePanel);Ext.namespace("Heron.widgets");Heron.widgets.IFramePanel=Ext.extend(Ext.Panel,{name:'iframe',iframe:null,src:Ext.isIE&&Ext.isSecure?Ext.SSL_SECURE_URL:'about:blank',maskMessage:__('Loading...'),doMask:true,initComponent:function(){this.bodyCfg={tag:'iframe',frameborder:'0',src:this.src,name:this.name};Ext.apply(this,{});Heron.widgets.IFramePanel.superclass.initComponent.apply(this,arguments);this.addListener=this.on;},onRender:function(){Heron.widgets.IFramePanel.superclass.onRender.apply(this,arguments);this.iframe=Ext.isIE?this.body.dom.contentWindow:window.frames[this.name];this.body.dom[Ext.isIE?'onreadystatechange':'onload']=this.loadHandler.createDelegate(this);},loadHandler:function(){this.src=this.body.dom.src;this.removeMask();},getIframe:function(){return this.iframe;},getIframeBody:function(){var b=this.iframe.document.getElementsByTagName('body');if(!Ext.isEmpty(b)){return b[0];}else{return'';}},getUrl:function(){return this.body.dom.src;},setUrl:function(source){this.setMask();this.body.dom.src=source;},resetUrl:function(){this.setMask();this.body.dom.src=this.src;},refresh:function(){if(!this.isVisible()){return;}
this.setMask();this.body.dom.src=this.body.dom.src;},setMask:function(){if(this.doMask){this.el.mask(this.maskMessage);}},removeMask:function(){if(this.doMask){this.el.unmask();}}});Ext.reg('hr_iframePpanel',Heron.widgets.IFramePanel);Ext.namespace("Heron.widgets");Heron.widgets.ScaleSelectorCombo=Ext.extend(Ext.form.ComboBox,{map:null,tpl:'<tpl for="."><div class="x-combo-list-item">1 : {[parseInt(values.scale + 0.5)]}</div></tpl>',editable:false,width:130,listWidth:120,emptyText:__('Scale'),tooltip:__('Scale'),triggerAction:'all',mode:'local',initComponent:function(){Heron.widgets.ScaleSelectorCombo.superclass.initComponent.apply(this,arguments);this.store=new GeoExt.data.ScaleStore({map:this.map});for(var i=0;i<this.store.getCount();i++){this.store.getAt(i).data.formattedScale=parseInt(this.store.getAt(i).data.scale+0.5);}
this.on('select',function(combo,record,index){this.map.zoomTo(record.data.level);},this);this.map.events.register('zoomend',this,this.zoomendUpdate);this.map.events.triggerEvent("zoomend");},listeners:{render:function(c){c.el.set({qtip:this.tooltip});c.trigger.set({qtip:this.tooltip});}},zoomendUpdate:function(record){var scale=this.store.queryBy(function(record){return this.map.getZoom()==record.data.level;});if(scale.length>0){scale=scale.items[0];this.setValue("1 : "+parseInt(scale.data.scale+0.5));}else{if(!this.rendered){return;}
this.clearValue();}},beforeDestroy:function(){this.map.events.unregister('zoomend',this,this.zoomendUpdate);Heron.widgets.ScaleSelectorCombo.superclass.beforeDestroy.apply(this,arguments);}});Ext.reg('hr_scaleselectorcombo',Heron.widgets.ScaleSelectorCombo);Ext.namespace("Heron.widgets.search");Heron.widgets.search.GeocoderCombo=Ext.extend(Ext.form.ComboBox,{map:null,emptyText:__('Search'),loadingText:__('Loading...'),srs:"EPSG:4326",zoom:10,layerOpts:undefined,queryDelay:200,valueField:"bounds",displayField:"name",locationField:"lonlat",url:"http://nominatim.openstreetmap.org/search?format=json",queryParam:"q",minChars:3,hideTrigger:true,tooltip:__('Search'),initComponent:function(){if(this.map){this.setMap(this.map);}
if(Ext.isString(this.srs)){this.srs=new OpenLayers.Projection(this.srs);}
if(!this.store){this.store=new Ext.data.JsonStore({root:null,fields:[{name:"name",mapping:"display_name"},{name:"bounds",convert:function(v,rec){var bbox=rec.boundingbox;return[bbox[2],bbox[0],bbox[3],bbox[1]];}},{name:"lonlat",convert:function(v,rec){return[rec.lon,rec.lat];}}],proxy:new Ext.data.ScriptTagProxy({url:this.url,callbackParam:"json_callback"})});}
this.on({added:this.handleAdded,select:this.handleSelect,focus:function(){this.clearValue();this.removeLocationFeature();},scope:this});return Heron.widgets.search.GeocoderCombo.superclass.initComponent.apply(this,arguments);},handleAdded:function(){if(!this.map){this.setMap(Heron.App.getMap());}},handleSelect:function(combo,rec){var value=this.getValue();if(Ext.isArray(value)){var mapProj=this.map.getProjectionObject();delete this.center;delete this.locationFeature;if(this.zoom<0){this.map.zoomToExtent(OpenLayers.Bounds.fromArray(value).transform(this.srs,mapProj));}else{this.map.setCenter(OpenLayers.LonLat.fromArray(value).transform(this.srs,mapProj),Math.max(this.map.getZoom(),this.zoom));}
this.center=this.map.getCenter();var lonlat=rec.get(this.locationField);if(this.layer&&lonlat){var geom=new OpenLayers.Geometry.Point(this.center.lon,this.center.lat).transform(this.srs,mapProj);this.locationFeature=new OpenLayers.Feature.Vector(geom,rec.data);this.layer.addFeatures([this.locationFeature]);var vm=this.map.getLayersByName(this.layer);if(vm.length===0){this.layer.setVisibility(true);}}
var lropts=this.layerOpts;if(lropts){var map=Heron.App.getMap();for(var l=0;l<lropts.length;l++){if(lropts[l]['layerOn']){var mapLayers=map.getLayersByName(lropts[l]['layerOn']);for(var n=0;n<mapLayers.length;n++){if(mapLayers[n].isBaseLayer){map.setBaseLayer(mapLayers[n]);}else{mapLayers[n].setVisibility(true);}
if(lropts[l]['layerOpacity']){mapLayers[n].setOpacity(lropts[l]['layerOpacity']);}}}}}}
(function(){this.triggerBlur();this.el.blur();}).defer(100,this);},removeLocationFeature:function(){if(this.locationFeature){this.layer.destroyFeatures([this.locationFeature]);}},clearResult:function(){if(this.center&&!this.map.getCenter().equals(this.center)){this.clearValue();}},setMap:function(map){if(map instanceof GeoExt.MapPanel){map=map.map;}
this.map=map;map.events.on({"moveend":this.clearResult,scope:this});},addToMapPanel:Ext.emptyFn,beforeDestroy:function(){this.map.events.un({"moveend":this.clearResult,scope:this});this.removeLocationFeature();delete this.map;delete this.layer;delete this.center;Heron.widgets.search.GeocoderCombo.superclass.beforeDestroy.apply(this,arguments);},listeners:{render:function(c){c.el.set({qtip:this.tooltip});c.trigger.set({qtip:this.tooltip});}}});Ext.reg("hr_geocodercombo",Heron.widgets.search.GeocoderCombo);Heron.version='1.0.2';
